/*!
* Data Aquarium Framework - Touch UI
* Copyright 2008-2017 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function wl(){return kt.appName||"Code On Time"}function ai(){return!!f.isVirtual}function ltt(){v.location.href="cloudontime://exit/?{}"}function iw(){return!!v.location.host.match(/^localhost\b/)}function bl(){var t=v.location.host+"_DevToolsDevice",n;if(arguments.length)i.storage.set(t,JSON.stringify(arguments[0]));else return n=i.storage.get(t),n&&(n=JSON.parse(n)),n||{name:"Responsive"}}function rw(n,t){var i=0;return n[2]<t[2]?i=1:n[2]>t[2]&&(i=-1),i}function uw(n){var t=n.text();return t.length>300&&(t=t.substring(0,300)+"..."),t.match(/</)&&(t=i.htmlEncode(t)),t}function fw(n){var t,i,u,r;t=b(n);i=t.offset();r=n.offset();r.top<i.top?u=-(i.top-r.top+8):r.top+n.outerHeight()>i.top+t.height()&&(u=r.top+n.outerHeight()-(i.top+t.height())+8);u!=null&&t.scrollTop(t.scrollTop()+u)}function kl(n,t){n&&typeof n!="string"&&(n=n.Name);t||(t=y());t.data("last-focused-field",n)}function ch(n){var i=n.is("iframe"),t=i?n[0].contentDocument.body.innerHTML.trim():n.val();return i&&t.match(/^(\s*(&nbsp;|<\/?(p|br)\/?>)\s*)+$/)&&(t=""),t}function lh(){var t=n.promo(),i,r;return!g||!t.length||!t.is(":visible")?!1:(i=g.offset(),r=t.offset(),!(i.left+g.outerWidth()<r.left||i.left>r.left+t.outerWidth()))}function ew(n){var i=y(),t;return i.is(".app-page-modal")?!1:(t=i.find(".app-bar-footer"),t.is(":visible")&&(!n||n(t)))}function ah(){return y(".app-bar-footer")}function att(){var n=$(".app-page-modal-root .app-bar-footer");return n.length&&n.css("transform")!="none"?n:null}function vh(n){var t={transition:"",transform:""};n?n.css(t):ah().css(t)}function dl(){var i,y;if(g||(g=$('<div class="app-bar-notify app-hidden"><\/div>').appendTo(s).on("vclick",function(){function t(){var r=n.promo(),i=g.outerHeight(),u=ew(function(n){return n.css("transform")!="none"}),f={transition:"transform 200ms ease-in",transform:"translate3d(0,"+i+"px,0)"},t=att(),e=lh();e&&r.css({transition:"transform 200ms ease-in",transform:"translate3d(0,"+i+"px,0)"});u&&ah().css(f);t&&t.css(f);g.data("busy",!0).css({transform:"translate3d(0,"+i+"px,0)"}).one("transitionend",function(){g.removeData("busy shown").addClass("app-hidden");u&&vh();e&&(r.css({transition:"",transform:""}),n.promo(!0));t&&vh(t)})}g.is(".app-hidden")||(lt?setTimeout(function(){g.trigger("vclick")},100):t())}),e("ui.notify.transparent")==!0&&g.addClass("app-bar-notify-transparent")),i=cl[0],g.data("busy")||g.data("shown")&&(!i||i.force!=!0)||lt||!hl)setTimeout(dl,100);else if(i){var r=i.text,t=i.duration,u,o=n.promo(),w=o.is(":visible"),p=ew(),c,l=f.width>568&&!p,a=l&&e("ui.notify.location")=="left",v=h.left.visible?h.left.width:0;cl.splice(0,1);g.data({busy:!0,shown:!0,notify:i}).addClass("app-hidden").css("transition-property","none");g.toggleClass("app-bar-notify-center",l).toggleClass("app-bar-notify-left",a).css("left","");w&&n.promo(!0);vh();g.removeClass("app-hidden");r=be(r).trim();r.length>250&&(r=r.substring(0,250)+"...");y=(new Date).getTime();g.data("timestamp",y).text(r).css({bottom:a?16:"",left:l?a?v+(h.left.visible?-8:16):(f.width-g.outerWidth())/2:v>0?v:""});u=g.outerHeight();g.css({transform:"translate3d(0,"+u+"px,0)"});t==null&&(t="short");t=="short"?t=e("ui.notify.duration.short")||2500:t=="medium"?t=e("ui.notify.duration.medium")||5e3:t=="long"&&(t=e("ui.notify.duration.long")||1e4);typeof t=="string"&&(t=2500);c=lh();setTimeout(function(){c&&o.css({transition:"transform 200ms ease-in",transform:"translate3d(0,-"+u+"px,0)"});p&&gl();g.css({transform:"","transition-property":"transform"}).one("transitionend",function(){g.removeData("busy");g.css("transition-property","");c&&(n.promo(!0),o.css({transform:"",transition:""}));setTimeout(function(){g.data("timestamp")==y&&g.trigger("vclick")},t)})},16)}}function gl(n){var t="transform 200ms ease-in",i;g&&g.is(":visible")&&!y().is(".app-page-modal")&&!g.is(".app-bar-notify-center,.app-bar-notify-left")&&(i=ah().css({transition:n?"":t,transform:"translate3d(0,-"+g.outerHeight()+"px,0)"}),n&&i.css("transiton",t))}function na(n){var t=n.sidebar||us();t.length&&(ai()?t.css({minHeight:f.height,height:f.height,left:f.left,top:f.top}):t.css({minHeight:"",height:"",left:"",top:""}))}function ow(n){var t=n.accountManager||dr();t.length&&(ai()?t.css({left:f.left,top:f.top,right:f.right,bottom:f.bottom}):t.css({left:"",top:"",right:"",bottom:""}))}function du(t){var e;t||(t={isVirtual:ai(),width:f.width,height:f.height});t.isVirtual==null&&(t.isVirtual=ai());t.width||(t.width=f.width);t.height||(t.height=f.height);var i=eu.width(),r=eu.height(),o=t.toolbar||(n?n._toolbar:$(".app-bar-tools")),u=$(".app-virtual-screen-bar"),h=f.isVirtual=t.isVirtual;h?(f.deviceWidth&&(t.width=f.deviceWidth,t.deviceWidth=null),f.deviceHeight&&(t.height=f.deviceHeight,t.deviceHeight=null),t.width>i&&(f.deviceWidth=t.width,t.width=i-40),t.height>r&&(f.deviceHeight=t.height,t.height=r-40),f.width=t.width,f.height=t.height,f.physicalWidth=i,f.physicalHeight=r,f.left=Math.ceil((i-t.width)/2),f.top=Math.ceil((r-t.height)/2),f.right=i-f.left-f.width,f.bottom=r-f.top-f.height,o.css({left:f.left,top:f.top,width:f.width}),u.length||(e='<div class="app-virtual-screen-bar"><\/div>',$(e).appendTo(s),$(e).appendTo(s),$(e).appendTo(s),$(e).appendTo(s)),u=$(".app-virtual-screen-bar"),$(u[0]).css({width:f.left,right:"auto"}),$(u[1]).css({width:f.right,left:"auto"}),$(u[2]).css({height:f.top,bottom:"auto"}),$(u[3]).css({height:f.bottom,top:"auto"}),na(t)):(f.width=i,f.height=r,f.physicalWidth=i,f.physicalHeight=r,f.left=0,f.top=0,f.right=0,f.bottom=0,o.css({left:"",top:"",width:""}),u.remove());na(t);ow(t);s.toggleClass("app-virtual-screen",ai());g&&g.is(":visible")&&(lt=!0,n.notify(g.addClass("app-hidden").removeData("busy shown").data("notify")))}function e(n,t){var f,o=arguments.length;if(o==1&&(f=eh[n],f!==undefined||n in eh))return f;for(var s=n.split(/\./g),e=s.length,r,i=kt,u=0;u<e;u++)if(r=s[u],o==2)u==e-1?(i[r]=t,eh[n]=t):i=i[r]==null?i[r]={}:i[r];else{if(u==e-1)return f=i[r],eh[n]=f,f;if(i[r]!=null)i=i[r];else if(u<e-1)i[r]={},i=i[r];else return null}}function st(n){return e(n)!=!1}function sw(n){return n.tagName=="DIV"&&!n.className.match(/app\-drop\-box/)}function hw(n,t,i){return(n.ctrlKey==t.ctrlKey||i&&n.ctrlKey==t.metaKey)&&n.altKey==t.altKey&&n.shiftKey==t.shiftKey&&n.metaKey==t.metaKey}function ao(i,r,u){var s=i.keyCode||i.which,e,f,o,h,c;if(r)for(o=0;o<l.list.length;o++)if(f=l.list[o],f.key&&(e=f.shortcut,e||(e=f.shortcut=cw(f.key,f)),e.which==s&&hw(e,i,f.metaKey)))return i.preventDefault(),i.stopPropagation(),u||l.range("exec",{command:f.command,argument:f.argument,validate:!0}),!0;if(or.list.length&&!u&&(s=i.keyCode||i.which,h=or.keyCodes.indexOf(s),h!=-1&&(e=or.list[h],hw(e,i))))return t.popup(":visible")?!1:(c=[],n.navContext(c),$(c).each(function(){var n=this;if(n.shortcut==e.shortcut)return yo(!0),setTimeout(function(){rr(n)},100),!1}),i.preventDefault(),i.stopPropagation(),!0)}function cw(n,t){for(var u,r={shortcut:n,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},e=n.split(/\s*\+\s*/g),f=0;f<e.length;f++)if(u=e[f].toLowerCase(),u.length>1)switch(u){case"ctrl":r.ctrlKey=!0;break;case"alt":r.altKey=!0;break;case"shift":r.shiftKey=!0;break;case"meta":r.metaKey=!0;break;default:r.which=i.keyCode[u];r.which||(r.invalid=!0)}else r.which=t&&t.which!=null?t.which:u.toUpperCase().charCodeAt(0);return or.cache[n]=r,r}function vo(n,t){var i=$(".app-popup");if(i.length&&(!t||i.is(t)))return i.popup("close",n),!0}function yo(n){var t=$(".ui-panel-open");return t.length?(t.panel("close",n),!0):vo(n)}function ta(n){var t=n.text,i=n.shortcut;return i&&(t+=" ("+i+")"),t}function yh(n,t){i.AccountManager.avatar(n,t)}function vtt(n){lo=pu(n)}function ytt(n){var t=$(this),i;lo&&(i=pu(n),lo.y<i.y?(t[0].scrollHeight<t.height()||t.scrollTop()==0)&&n.preventDefault():lo.y>i.y&&(t[0].scrollHeight<t.height()||t.outerHeight()+t.scrollTop()>=t[0].scrollHeight)&&n.preventDefault(),lo=null)}function po(n,t){var i=n.is(".ui-panel-inner,.app-wrapper")?n:n.find(".ui-panel-inner"),r=i.closest(".app-popup,.ui-panel");if(nr)if(t)i.off("touchstart touchmove");else i.on("touchstart",vtt).on("touchmove",ytt);i.is(".ui-panel-inner")}function ia(){lt=!0;setTimeout(function(){lt=!1},250)}function ptt(n){var t=k.navigate.history;k.navigate("#"+n);t.stack[t.activeIndex].pageUrl=n}function ph(n){n=n.split(/@/g);n=n[0];n=n.split(/\\/g);n=n[n.length>1?1:0];var t=n.replace(/\W/g," ").trim(),i,u="",r;for(t||(t=n),t=t.split(/\b/g),r=0;r<t.length;r++)if(i=t[r],i&&(i=i.trim()),i&&(u+=i.substring(0,1)),u.length==2)break;return u}function wtt(n,t){var u,i,f=/(\w+)(\s*=\s*(\w+))?/g,r=n.ContextFields;if(r)for(i=f.exec(r);i;){if(i[1]==t.Name){u=n._dataView.findField(i[3]?i[3]:i[1]);break}i=f.exec(r)}return u}function ra(n){return n.match(/^(=|<>|<|>|<=|>=|(\$(between|in|notin|beginswith|doesnotbeginwith|contains|doesnotcontain|endswith|doesnotendwith)))$/)!=null}function re(n){var i=n._dataView,t=ua(i,n,[]);return t=t.length?JSON.stringify(t):"",n.Name+"_listOfValues_"+t.toLowerCase().replace(/\W+/g,"_")}function ua(n,t,r){for(var h=n.get_contextFilter(t,n.extension().collect()),o=0,u,e,y=t.ItemsStyle||"",l=n.editRow(),v,a,s,c;o<h.length;)if(u=h[o],u.Literal)o++;else{e=wtt(t,u);var p=n.findField(e.Name+"_op2"),v=n.findField(e.Name+"_op"),f=null,w;p&&(f=l[p.Index]);f==null&&v&&(f=l[v.Index]);f==null&&(f="=");w=ra(f);f.match(/^\$/)&&(f+="$");u.Value==null?v?(h.splice(o,1),f&&!w&&r.push(u.Name+":"+f)):(o++,r.push(u.Name+":=null")):e&&(e.ItemsTargetController||e.ItemsStyle=="CheckBoxList"?(h.splice(o,1),a=i.csv.toArray(u.Value),a.forEach(function(t,i){a[i]=n.convertFieldValueToString(e,t)}),f=="="&&(f="$in$"),r.push(u.Name+":"+f+a.join("$or$"))):(f=="$between$"&&(u.Value2=l[n.findField(e.Name+"_v2").Index],u.Value2==null?f=">=":u.Value>u.Value2&&(u.Value=[u.Value2,u.Value2=u.Value][0])),u.Value=n.convertFieldValueToString(e,u.Value),u.Value2!=null&&(u.Value2=n.convertFieldValueToString(e,u.Value2)),f=="="?(o++,r.push(u.Name+":="+u.Value)):(h.splice(o,1),r.push(u.Name+":"+f+(u.Value!=null?u.Value:"")+(u.Value2!=null?"$and$"+u.Value2:"")))))}return(y.match(/^(AutoComplete|Lookup)$/)&&t.ItemsTargetController||y=="CheckBoxList")&&(s=l[t.Index],s!=null&&(s=i.csv.toArray(s.toString()),s.forEach(function(n,t){s[t]="%js%"+i.serializer.serialize(n)}),r.push(t.Name+":$notin$"+s.join("$or$")))),c=t.Extended,c&&c.filter&&(c.filter.forEach(function(n){var i=n.match(/^(.+?)\:/);i&&i[1]!=t.Name&&r.push(n)}),c.search.forEach(function(n){r.push(n)})),h}function kr(n){var e=n[0],t,i,r=e.className,o=h.left.visible?h.left.width:0,u=h.left.visible?h.right.width:0;return r.match(/\b(app\-wrapper)\b/)?(t=n.closest(".ui-page")[0].className,i=t.match(/\b(app\-page\-modal|app\-has\-panel)\b/)&&t.indexOf("app-page-modal-never")==-1?p(n,"width"):f.width-o-u):i=r.match(/\b(app\-bar\-tools)\b/)?f.width-u:n.outerWidth(),i}function lw(n){return n.ItemsDataController&&n.ItemsNewDataView}function wh(){return f.width>=pt(e("ui.modal.when")||"md")&&f.height>=pt("xs")||fa().length>0}function aw(){return f.width>420&&f.height>=600}function fa(){return $(".app-page-modal-root")}function ue(){var t=v._toolbarHeight;return t||(t=v._toolbarHeight=n.toolbar().outerHeight()),t}function vw(){return o&&($(document.activeElement).is(":input")||eu.height()<f.height)}function wo(n,t){t||(t=y().prevAll(".ui-page").first().attr("id"));$(document).one("pagecanceled.app",function(i){if(i.namespace=="app"){var r=wt();t==r||r=="Main"?n():y().prevAll(".ui-page").filter(function(){return $(this).attr("id")==t}).length&&wo(n,t)}})}function ri(n){$(document).one("pageready.app",function(t){t.namespace=="app"&&n()})}function di(n){t.ignoreErrors=!0;n&&typeof n=="function"&&ri(n);rt=!0;oh.go(-1)}function yw(n){var t=n?n.page.find(".app-page-header").filter(function(){return!$(this).is(".app-page-header-fixed")}):null;s.is(".app-page-header-hidden")||n&&n.headerText==!1?ir(!1,t):ir(n&&n.headerText||n&&n.dataView&&n.dataView.get_view().Label||document.title,t)}function ii(){}function pw(t){var r=typeof t=="string";n.infoView(i.find(r?t:t.id),r)}function btt(n,t){n.Token&&i.userName()!=n.UserName?kc(n.UserName):it(t,function(){kc(n.UserName)})}function bh(){return v.location.pathname.match(/\/login(\.aspx|$)/i)}function ww(){function t(){n.showAccountManager(null,!0)}if(n._started)t();else{i.AccountManager.count()&&dr(null,"loading");$(document).one("start.app",t)}}function bw(){if(st("splash.enabled")){if(sessionStorage){if(sessionStorage.spashShown)return;sessionStorage.spashShown=!0}var n=Math.max(1e3,e("splash.duration")||2500)-500;dr(null,"splash");setTimeout(function(){var n=dr();n.css("transition","opacity 500ms");setTimeout(function(){n.css("opacity",0);setTimeout(function(){n.remove()},525)})},n)}}function ktt(){var r=v.location.href.match(/(\?|&)_accMan=(\w+)/),c=n.returnUrl(),o=ka(".TOKEN"),l=ka(".PROVIDER"),a,s=i.loggedIn(),e;if(o&&cit(".TOKEN",null,-1),sessionStorage&&(a=sessionStorage.signedOut,sessionStorage.removeItem("signedOut")),!s&&i.AccountManager.enabled()||r){var w=i.userName(),h=i.AccountManager.list(),t=h._lastUser&&h[h._lastUser],y=!r&&t&&!!t.Token,u=r?r[2]:null,f=u=="loading"||u=="splash",p=u=="list";if(o&&(t={UserName:l,Token:o,Handler:l},y=!0,f=!1),y||f){if(f&&!t&&(t={UserName:"Test"}),e=[],u!="splash"&&(e.push({text:t.UserName,context:t}),e.push({text:er})),dr(e,u),f)return;i.switchUser(t,function(){var n=c||__baseUrl;r||v.location.replace(n)},function(){n.busy(!1);t.Token=null;i.AccountManager.set(t);ww()})}else(p||c||a)&&!bh()?ww():s||bw()}else s||bw()}function dr(n,t){var u=$(".app-acc-man"),o,h,e,c,l,p;if(!arguments.length)return u;if(u.length)u.show().appendTo(s).removeClass("app-acc-man-inactive"),o=u.find("ul").empty();else{u=$('<div class="app-acc-man"><div class="app-acc-space"><\/div><\/div>').appendTo(s);var f=$('<div class="app-acc-inner"><\/div>').appendTo(u),a=$('<div class="app-logo"><\/div>').appendTo(f).html(wl()),v=$('<div class="app-acc-list"><\/div>').appendTo(f);if(ow({accountManager:u}),h=$('<a class="app-acc-close"><i class="material-icon">close<\/i><\/a>').attr("title",el.Close).prependTo(f),e=kt.splash,e){c=e.background;l=e.logo;function y(n,t){t.match(/url\(/)?n.css("background",t):n.css("background-image","url("+t+")");n.css("text-indent","-9999px")}c&&y(u.find(".app-acc-space"),c);l&&y(a,l)}h.on("vclick",function(){it(h,function(){u.fadeOut()})});o=$("<ul/>").appendTo(v).on("vclick","a",function(n){var u=$(n.target),t=u.closest("a"),f=t.data("context"),e;return u.is(".app-btn-more")?(e=f.context.UserName,it(u,function(){hi({anchor:u,items:[{text:e,user:e,keepOpen:!0,callback:ii,selected:!0,depth:1},{},{text:wr.LoginButton,icon:"material-icon-arrow-forward",callback:function(){t.trigger("vclick")}},{text:r.Forget,icon:"material-icon-delete",callback:function(){i.AccountManager.remove(e,!0);t.remove()}}]})})):f.callback&&it(t,function(){f.callback(f.context,t)}),!1});p=$('<div class="app-acc-footer"><\/div>').appendTo(f).html($("#PageFooterBar,footer small").html());v.css({top:a.outerHeight(!0)+16,bottom:p.outerHeight(!0)})}t&&t!="loading"&&t!="splash"&&!u.is(".app-acc-man-loading")&&u.hide().fadeIn();t&&u.removeClass("app-acc-man-loading app-acc-man-switch").addClass("app-acc-man-"+t);$(n).each(function(){var t=this,s=$("<li/>").appendTo(o),n=$("<a/>").appendTo(s),h=$('<div class="app-user-name"><\/div>').text(t.text).appendTo(n),u=t.context,e,f;t.icon&&et(t.icon,n);n.data("context",t);u&&(n.addClass("app-avatar"),f=u.UserName,h.text(f),f==i.userName()&&n.addClass("app-selected"),u.Email&&n.append($('<span class="app-user-email"><\/span>').text(u.Email)),u.Token||n.append($('<span class="app-user-signed-out"><\/span>').text(r.SignedOut)),e=$('<i class="app-icon-avatar">'+ph(f)+"<\/i>"),n.prepend(e),yh(f,e),t.callback&&$('<span class="app-icon material-icon app-btn-more"/>').appendTo(n).attr("title",fi));t.callback||n.addClass("app-link-disabled")})}function kw(n,t){n._syncKey=t;n._selectedKey=t}function dtt(t){var i=t._controller;$(n._pages).each(function(){var r=this,n=r.dataView;n&&r.id!=t._id&&!n.get_isForm()&&n._syncKey==null&&(n._controller==i?n._syncKey=!0:$(n._fields).each(function(){if(this.ItemsDataController==i)return n._syncKey=!0,!1}))})}function dw(){return bs>=144}function fe(n){n.type!="taphold"&&(cr=pu(n))}function vi(n){return cr&&cr.x||n}function gu(n){return cr&&cr.y||n}function gw(n){var t=n.find(".ui-popup-arrow-container");return n.outerHeight()+(t.length?t.height()/2:0)+5}function ee(n,t){if(n.multiSelect()){var i;t||(t=(wt()==n._id?y():fs(n)).find(".app-listview .ui-btn.app-selected"),i=!0);t.is(".app-checked")||(n._selectedKeyList.length&&uv(n,i),ov(n,t))}}function nb(n){var t=y(),i=p(t,"width"),r=p(t,"height"),u=p(n,"width"),f=p(n,"height");(i!=u||r!=f)&&ui(n)}function ea(n){return n.is(".app-page-modal-centered,.app-page-modal-fullscreen,.app-page-modal-fit-content,.app-page-modal-dock")}function kh(){return f.width>1200?80:f.width<500?40:50}function oa(n,t){var v=si.stack,c,s,e,r,h,o,w=kh(),p=[],u=[],l,i,a;if(n||(n=y()),n.is(".app-page-modal")){for(s="#"+n.attr("id"),r=v.length;r--;r>=0){if(l=v[r],u.length)if(s=l.hash,s){if(i=$(s),!i.length||!i.is(".app-page-modal"))break}else break;else l.hash==s&&(i=n);i&&(u.push(i),ea(i)&&(e=i))}for(e&&(r=u.indexOf(e),r<u.length-1&&(e=u[r+1])),r=0;r<u.length;r++){if(i=u[r],r>0)if(e)nb(i.addClass("app-page-modal-revealed"));else{if(t=u[r-1],c=f.physicalWidth-t.offset().left+w,c>f.width*1.75)break;nb(i.addClass("app-page-modal-partial"));i.css("right",c);o||(o=i)}e&&(a=i.css("width")+","+i.css("height"),u.length>1&&(p.indexOf(a)==-1?(e!=i&&i.addClass("app-page-modal-centered"),p.push(a)):i.addClass("app-page-modal-obscured")));e==i&&(e=null)}h=$(".app-page-modal-glass-pane");h.length||(h=$('<div class="app-page-modal-glass-pane"><\/div>'));o&&u.indexOf(o)==1?h.addClass("app-page-modal-glass-pane-partial").css({right:o.css("right"),top:o.css("top"),height:o.css("height")}).insertAfter(o):h.css({right:0,top:"",height:""}).removeClass("app-page-modal-glass-pane-partial").insertBefore(u[0])}}function tb(r){var v,l,a,d;if(kt){hh=!1;lt=!1;hl=!1;gt();dk(!1);rd();var u=r.toPageInfo||c(),o,p=r.options,s=p&&p.fromPage&&p.reverse;u&&u.initCallback&&(u.initCallback(),u.initCallback=null);n.busy(!1);var f=$(r.toPage),w=f.is(".app-page-modal"),h=f.is(".app-page-panel"),e=$(r.prevPage),k=e.is(".app-page-modal");if(rt||(u&&u&&(o=u.dataView,o&&o._syncKey&&(o._syncKey==!0?o.sync():o.sync(o._syncKey),o._syncKey=null)),f.find(".app-echo").each(function(){var t=$(this).attr("data-for"),n=i.find(t);n._syncKey&&(n._syncKey==!0?n.sync():n.sync(n._syncKey),n._syncKey=null)})),f&&e&&f.attr("id")==e.attr("id"))return!1;on(h?e:f);ui(h?e:f);h&&ns();h||(v=si.stack,si.activeIndex>1&&v[si.activeIndex].hash==v[si.activeIndex-1].hash&&v.splice(--si.activeIndex,1),l=n._modalBackground,!k&&w?(e.addClass("app-page-modal-root"),l||(l=n._modalBackground=$('<div class="app-page-modal-background"><\/div>')),l.insertBefore(f).show()):k&&!w&&l&&l.hide(),$(".app-page-modal-partial").removeClass("app-page-modal-partial").css("right",""),$(".app-page-modal-revealed,.app-page-modal-centered,.app-page-modal-obscured").removeClass("app-page-modal-revealed app-page-modal-centered app-page-modal-obscured"),w?oa(f,e,s):(f.removeClass("app-page-modal-root"),$(".app-page-modal-glass-pane").remove()));vh();h&&yw(u);a=u&&u.scrollable||b(f);yr(a.find(".app-listview"));ef(a);vr(f);lr(a);rs(a);rc();br&&!vl&&n._toolbar.css("visibility",wt()=="Main"||y()&&y().is(".app-page-modal")?"hidden":"");ru(u?u.page:null);t.popup("hide");s=si.activeIndex<si.previousIndex;gl(!0);!h&&uf()=="slide"&&e?nit(e,f,s,function(){sa(u,s)}):(d=u&&u.dynamic&&!u.delayed,d?(u.delayed=!0,setTimeout(function(){sa(u,s)})):sa(u,s))}}function sa(i,r){var s=i?i.scrollable:null,l=$.Event("pageready.app"),a,f,u,h,c,e,v;i&&(u=l.dataView=i.dataView,gtt(i));no(100);n.busy(!1);$(document).trigger(l);he(i?i.dataView:null);bt(!1,0);hu(null,null,i?i.scrollable.find(".app-echo"):null);o||setTimeout(function(){(!$(document.activeElement).closest("[data-control]").length||r)&&s&&(sr(s),a!=!1&&s.find("[data-input-container]").length&&t.focus({container:s,lastFocused:r==!0}))});i&&(h=u&&u.odp,a=i.autoFocus,i.autoFocus=!0,f=i.calculate,f&&(delete i.calculate,f=u.findField(f),u._raiseCalculate(f,f)));n.garbageCollector();r&&(c=si.stack[si.activeIndex+1],e=c&&c.hash,e&&e.match(/^#/)&&(v=n.pageInfo(e.substring(1)),v&&$(e).trigger("pagecanceled.app")));h&&h.is(":active")&&h.root(u)&&u.get_isForm()&&!u.editing()&&(rt=!0,n.executeInContext(ro("edit")),rt=!1);hl=!0}function gtt(n){n&&n.home&&!n.tabBar&&(n.tabBar=ib(),bo(n,!0))}function ha(){n._tabBar||(n._tabBar=ib(),bo(null,!0))}function ib(){var t=n._tabBarItems,u,i,f,r;if(t||(t=n._tabBarItems=[],items=[],pr(items,!0),$(items).each(function(n){var i=this;if(i.icon&&i.context)t.push(i);else return t.splice(n),!1})),t.length>1&&e("ui.menu.tabbar")!=!1){if(u=n.bar("create",{type:"footer",page:y()}),!u.length)return null;i=$('<div class="app-bar-tabs" data-location="bottom"><\/div>').hide().appendTo(u);f=$("<ul>").appendTo(i);t.forEach(function(n){r=$('<li data-tooltip-location="above">').appendTo(f).data("item",n).css("width",Math.floor(100/t.length)+"%");et(n.icon,r);$("<span/>").appendTo(r).text(n.text);r.attr("title",n.tooltip);var i=n.context.selected;i&&$(n.context.children).each(function(){this.selected&&(i=!1)});i&&r.addClass("app-selected")});i.data("items",i.find("li"))}return i}function rb(){var i=e("ui.menu.tabbar"),r=n._uiSideBarWhen,t=as();return t&&(r=="Never"?t=!1:r=="Landscape"&&f.width<f.height&&(t=!1)),i==!0||i!=!1&&!h.left.visible&&!t}function bo(t,i){var r=t?t.tabBar:n._tabBar,o,u;if(r&&r.length){if(u=rb(),o=r.is(":visible"),(u&&!o||!u&&o)&&n.bar(u?"show":"hide",r),u&&i){var f,e=r.data("items"),h=e.first().outerWidth(),c=n._tabBarItems.length,s=Math.floor(r.width()/h);r.data("more")&&(r.data("more").remove(),r.removeData("more"),e.show());c>s&&(f=$('<li data-tooltip-location="above" class="app-has-icon">').appendTo(r.find("ul")).attr("title",fi),$('<i class="app-icon material-icon material-icon-more"><\/i>').appendTo(f),r.data("more",f),e.filter(":gt("+(s-2)+")").hide(),$("<span>").appendTo(f).text(fi),e.filter(ar).filter(".app-selected").length||f.addClass("app-selected"))}ub(u)}return u}function ub(n){n==null&&(n=rb());s.toggleClass("app-has-complete-tabbar",n&&Web.Menu.nodeCount==Web.Menu.nodesWithIcons.length)}function fb(){var n=Web.Menu.nodeCountInSidebar;n&&s.toggleClass("app-has-complete-toolbar-in-sidebar",h.left.visible&&Web.Menu.nodeCount==n)}function nit(t,i,r,u){function it(){l--;l==0&&(w&&w(),l==0&&(u(),lt=!1))}function rt(n,t){n.is(":visible")&&(l++,n.one("transitionend",it).css(t))}function h(n){lt=!0;w=n.done;n.position();setTimeout(function(){n.transition();setTimeout(function(){$(n.run).each(function(){var n=this,i={};for(var t in n)t!="element"&&(i[t]=n[t]);rt(n.element,i)})},16)},16)}var nt=t.is(".app-page-modal"),g=i.is(".app-page-modal"),tt,a,y,o,c,e=n._backText,w,l=0,b,k,s,d;n.busy(!0);bt(!0);nt?g?(tt=t.is(".app-page-modal-partial"),a=ea(t),y=ea(i),r?a||y?h({position:function(){t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out")},run:[{element:t,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""})}}):(o=$(".app-page-modal-partial").add(i),c=p(i,"width")+kh(),b=p(t,"left")+c,h({position:function(){t.css("left",b).addClass("app-page-revealed");t.css({transform:"translate3d("+-c+"px,0,0)"});o.css({transform:"translate3d("+-c+"px,0,0)"})},transition:function(){o.addClass("app-transition-slide");t.addClass("app-transition-slide")},run:[{element:t,transform:"translate3d("+(f.physicalWidth-b+kh())+"px,0,0)"},{element:o,transform:""}],done:function(){o.removeClass("app-transition-slide").css({transform:"",transition:""});t.removeClass("app-transition-slide app-page-revealed").css({left:"",transform:"",transition:""})}})):y||a?(k=t.is(".app-page-modal-obscured"),h({position:function(){k&&t.toggleClass("app-page-modal-obscured app-page-modal-centered");i.css({opacity:0})},transition:function(){i.addClass("app-transition-fade-in")},run:[{element:i,opacity:""}],done:function(){i.removeClass("app-transition-fade-in");k&&t.toggleClass("app-page-modal-obscured app-page-modal-centered")}})):(o=$(".app-page-modal-partial").add(i),h({position:function(){c=p(i,"width")+kh();o.css({transform:"translate3d("+c+"px,0,0)"});o=$(o.get().reverse())},transition:function(){o.addClass("app-transition-slide")},run:[{element:o,transform:""}],done:function(){o.removeClass("app-transition-slide").css({transform:"",transition:""})}}))):(s=n._modalBackground,h({position:function(){s.show().css({opacity:1});t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out");s.addClass("app-transition-fade-out")},run:[{element:t,opacity:0},{element:s,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""});s.hide().removeClass("app-transition-fade-out").css({opacity:""})}})):g?(s=n._modalBackground,h({position:function(){i.css({opacity:0});s.css({opacity:0})},transition:function(){i.addClass("app-transition-fade-in");s.addClass("app-transition-fade-in")},run:[{element:i,opacity:""},{element:s,opacity:""}],done:function(){i.removeClass("app-transition-fade-in");s.removeClass("app-transition-fade-in")}})):t.length?t.is("#Main")&&!v.location.hash?u():(d=p(i,"width"),d>pt("md")?r?h({position:function(){i.addClass("app-transition-slide-background");t.addClass("app-page-revealed").css({transform:"translate3d(0,0,0)","z-index":2,opacity:1});e.css({transform:"translate3d(-"+p(e,"width")+"px,0,0)",opacity:0})},transition:function(){t.addClass("app-transition-slide-peel-out");e.addClass("app-transition-slide-and-reveal")},run:[{element:t,transform:"translate3d(200px,0,0)",opacity:0},{element:e,transform:"",opacity:""}],done:function(){i.removeClass("app-transition-slide-background");t.removeClass("app-transition-slide-peel-out app-page-revealed").css({transform:"","z-index":"",opacity:""});e.removeClass("app-transition-slide-and-reveal")}}):h({position:function(){i.css({transform:"translate3d(200px,0,0)"});t.addClass("app-transition-slide-background app-page-revealed");e.css({transform:"translate3d("+p(e,"width")+"px,0,0)",opacity:0})},transition:function(){i.addClass("app-transition-slide-peel-in");e.addClass("app-transition-slide-and-reveal")},run:[{element:i,transform:""},{element:e,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide-background app-page-revealed");i.removeClass("app-transition-slide-peel-in").css({transform:"",transition:"","z-index":""});e.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}}):h({position:function(){i.css({transform:"translate3d("+(r?-1:1)*d+"px,0,0)","z-index":2});t.addClass("app-page-revealed");e.css({transform:"translate3d("+(r?-1:1)*p(e,"width")+"px,0,0)",opacity:0})},transition:function(){e.addClass("app-transition-slide-and-reveal");t.addClass("app-transition-slide");i.addClass("app-transition-slide2")},run:[{element:i,transform:""},{element:t,transform:"translate3d("+(r?1:-1)*p(t,"width")+"px,0,0)"},{element:e,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide app-page-revealed").css({transform:""});i.removeClass("app-transition-slide2").css({transform:"",transition:""});e.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}})):u()}function eb(n,t){function u(t){if(!h){var i=[];$(n.get_actions("Custom")).each(function(){var t=this;n._isActionMatched(t,!0)&&i.push(t)});i.length&&(t&&r.push('<div data-container="collapsible" data-wrap="false" data-header-text="none">'),r.push('<div data-container="row">'),$(i).each(function(){r.push('<span data-control="action" data-action="'+this.Path+'"><span class="app-control-inner"/><\/span>')}),r.push("<\/div>"),t&&r.push("<\/div>"));h=!0}}var a=n.get_view(),e,r,f=[],o={},s,h,c=[],l=[];return $(n._expressions).each(function(){var n=this,t=n.Scope,i=n.Target;t==2&&c.push(i);t==3&&l.push(i)}),$(n._categories).each(function(n){var u=this,i=u.Wizard,e=n==0||u.Flow=="NewRow",r,t;i?s:i=s?"_after_":"_before_";t=o[i];t||(t={text:i,rows:[]},o[i]=t,f.push(t),e=!0);e?(r={categories:[]},t.rows.push(r)):r=t.rows[t.rows.length-1];r.categories.push(u)}),$(f).each(function(){var t=this;$(t.rows).each(function(){var t=this,i=[],r={},u={};$(t.categories).each(function(){var n=this,e=n.Tab,t=r["t_"+e],f,o={id:n.Id,headerText:n.HeaderText,desc:n.Description,collapsed:n.Collapsed,fields:[],floating:n.Floating,wrap:n.Wrap,dataViewCount:0};t?n.Flow=="NewColumn"?(f={categories:[]},t.columns.push(f)):f=t.columns[t.columns.length-1]:(f={categories:[]},t={text:n.Tab,columns:[f]},r["t_"+e]=t,i.push(t));u[n.Index]=o;f.categories.push(o)});$(n._fields).each(function(){var n=this,t=u[n.CategoryIndex];t&&(t.fields.push(n),n.Type=="DataView"&&t.dataViewCount++)});t.tabList=i})}),r=['<div data-layout="form" data-layout-size="'+nf(t)+'">'],$(f).each(function(){var f=this,o=f.text,s=!o.match(/^\_(before|after)\_$/);s&&(r.push('<div data-container="wizard" data-wizard-step="'+i.htmlAttributeEncode(o)+'">'),u(!0));$(f.rows).each(function(){var s=this,o=s.tabList,f=o.length>1;f&&u(!0);f&&r.push('<div data-container="tabset">');$(o).each(function(){var s=this,h=s.columns,o=s.columns.length>1;f&&r.push('<div data-container="tab" data-tab-text="'+i.htmlAttributeEncode(s.text)+'">');$(h).each(function(){var i=this,s=100/h.length-1,a=o?t*s/100:t;o&&a<=pt("tn")&&(o=!1);o&&(u(!0),r.push('<div data-container="column" style="width:'+s+'%">'));$(i.categories).each(function(){var h=this,b=h.desc,k=' data-visibility="c:'+h.id+'"',v=f&&i.categories.length==1&&h.dataViewCount==h.fields.length,d=b&&b.replace(/\{([\w+\_]+)\}/g,'<span data-control="field" data-field="$1" data-read-only="true"><span class="app-control-inner">&#160;<\/span><\/span>'),nt=d&&n._formatViewText(ep.DefaultCategoryDescriptions[d],!0,d),p=h.wrap==!0||(o?a:t)<=pt("xs"),g=c.indexOf(h.id)!=-1;v?h.dataViewCount>1&&r.push('<div data-container="simple"'+(g?k:"")+">"):r.push('<div data-container="collapsible" data-wrap="'+(p?"true":"false")+'" data-header-text="'+(h.headerText||"none")+'"'+(h.collapsed?'data-collapsed="true" ':"")+(g?k:"")+">");u();b&&(v||r.push('<div data-container="row">'),r.push('<div data-control="description"><span class="app-control-inner">'+nt+"<\/span><\/div>"),v||r.push("<\/div>"));var w=[],y=[],s=1;$(h.fields).each(function(){var n=this;n.Type=="DataView"?(y.length&&w.push(y),w.push([n]),y=[]):y.push(n)});!o&&h.floating&&(h.wrap?(pt("sm")<=t&&(s=2),pt("md")<=t&&(s=3),pt("lg")<=t&&(s=4)):(pt("md")<=t&&(s=2),pt("xl")<=t&&(s=3)),s=Math.min(s,h.fields.length));y.length&&w.push(y);$(w).each(function(){for(var t,u,n,c=this,b=c.length,a=Math.ceil(b/s),o=0;o<a;o++){for(v?r.push('<div data-container="simple"'):r.push('<div data-container="row"'+(s>1?' data-columns="'+s+'"':"")),t=[],u=0;u<s;u++)if(n=c[o+u*a],n){var y=n.Type=="DataView",i=n.Name,w=n.HeaderText,h=l.indexOf(i)!=-1,f=h?' data-visibility="f:'+i+'"':"";v?h?r.push(f):g&&r.push(k):s==1&&h&&r.push(f);p&&s>1&&t.push('<span class="app-field-group">');y||p&&(!w||w=="&nbsp;")||t.push('<span data-control="label" data-field="'+i+'"'+(s>1?f:"")+'><span class="app-control-inner">'+i+"<\/span><\/span>");t.push('<span data-control="'+(y?"dataview":"field")+'" data-field="'+i+'"'+(s>1?f:"")+(n.is("focus-auto")?' data-focus="true"':"")+'><span class="app-control-inner">['+i+"]<\/span><\/span>");p&&s>1&&t.push("<\/span>");e||(e=n)}r.push(">");$(t).each(function(){r.push(this)});r.push("<\/div>")}});v?h.dataViewCount>1&&r.push("<\/div>"):r.push("<\/div>")});o&&r.push("<\/div>")});f&&r.push("<\/div>")});f&&r.push("<\/div>")});s&&r.push("<\/div>")}),r.push("<\/div>"),r=r.join("\r\n")}function nf(n){return n>=1366?"xxl":n>=1200?"xl":n>=992?"lg":n>=768?"md":n>=576?"sm":n>=480?"xs":n>=320?"xxs":"tn"}function tit(n){var t=hr.indexOf(n);return t==-1?f.width:pt(hr[Math.min(hr.length-1,t+1)])-1}function pt(n){switch(n){case"tn":return 280;case"xxs":return 320;case"xs":return 480;case"sm":return 576;case"md":return 768;case"lg":return 992;case"xl":return 1200;case"xxl":return 1366;default:return f.width}}function ob(n,t){var h=nf(t),c=n._controller+"_"+n._viewId+"_"+n._filterFields+"_layout_"+h+(wh(n)?"_m":""),f=i.cache[c],e=n.survey(),u,r,o,s,l,a;return f||(u=n.get_view().Layout,u&&(o=$("<div>"+u+"<\/div>"),s=o.find("[data-layout]"),s.length?(a=hr.indexOf(h),s.each(function(){var t=$(this),i=t.attr("data-layout-size")||"tn",n=hr.indexOf(i);n!=-1&&n<=a&&(!r||n>l)&&(r=t,l=n)})):(r=$('<div data-layout="form"><\/div>'),$(o.html()).appendTo(r))),r?(r.find("[data-control]").each(function(){var n=$(this),t=n.contents().remove();t.appendTo($('<span class="app-control-inner"/>').appendTo(n))}),u=$("<div><\/div>").append(r.clone()).html()):u=eb(n,t),f={html:u},e&&(e.dynamic||!e.cache)||(i.cache[c]=f)),r=$(f.html),r.attr("data-input-container",n._id),n._isWizard=r.find('[data-container="wizard"]').length>0,r}function sb(n,i,r){function s(n,t,i){if(n.getAttribute){var v=n.getAttribute("data-control"),l=!v&&n.getAttribute("data-container"),a,y=n.childNodes,o,p,r;for(v&&t?(f.push(n),o=$(n),p=o.offset(),r={self:o,parent:i,type:v,children:[]},c.push(r),i.children.push(r),o.data("node",r)):l&&(u.push(n),o=$(n),r={self:o,children:[],type:l},o.data("node",r),h.push(r),t?(r.parent=i,i.children.push(r)):e.push(r)),a=0;a<y.length;a++)s(y[a],l?n:t,l?r:i,null)}}var a=n._allFields,v=n.get_viewType()=="Form",y=r.offset(),u=[],h=[],f=[],c=[],e=[],p=b(r),l=n.extension(),o=l.editing();r.data("prepared",!0);r.find("[data-visible-when]").each(function(t){var i=$(this),r=n._expressions,e=i.attr("data-visible-when"),u=i.parent().is('[data-container="wizard"]'),f={Scope:u?2:7,Target:t,Test:e,Type:1,ViewId:n._viewId};r||(r=n._expressions=[]);r.push(f);i.attr({"data-visible-when":null,"data-visibility":(u?"c:":"v:")+f.Target})});t.evaluate({dataView:n,row:i,container:r,ignoreDynamicButtons:!0});s(r[0]);u=$(u);f=$(f);r.data("rootNodes",e).attr("data-state",o?"write":"read");hb(n,i,o,e)}function hb(i,r,u,f){$(f).each(function(f){var e=this,s=e.self,h,c,v,l,a;!e.ready&&s.is(":visible")&&(e.ready=!0,e.type=="tabset"?(h=[],$(e.children).each(function(){var n=this;n.type=="tab"&&h.push({text:n.self.attr("data-tab-text"),content:n.self,context:n})}),h.length&&(e.tabs=h,n.tabs("create",{id:i._id+"_tabset_"+f,tabs:h,className:"app-tabs-layout",scope:i.get_selectedKey(),change:function(n){var u=n.content;ko({dataView:i,row:r,controls:n.context.children});gi(null,u);en(u);!i.editing()||o||rt||t.focus({container:u})}}),$(h).each(function(){var n=this;if(n.active)return ko({dataView:i,row:r,editing:u,controls:n.context.children}),!1}))):(e.type=="collapsible"&&(c=s.attr("data-header-text"),c&&c!="none"&&(v=s.contents(),l=$('<div data-container="toggle" class="app-feedback"><\/div>'),a=$('<div data-container="simple"><\/div>)'),v.appendTo(a),$('<span class="app-collapsible-toggle-text"/>').appendTo(l).text(c),$('<span class="app-collapsible-toggle-button"/>').appendTo(l).attr("title",fu.Minimize),l.appendTo(s),a.appendTo(s),s.attr("data-collapsed")=="true"&&s.addClass("app-container-collapsed"))),ca(i,r,u,e.children)))})}function ca(n,r,u,f){$(f).each(function(){var y=this,e=y.self,a,v,l,f,p,tt,rt,ut,k,ot,st,ft,ht;if(y.children.length)hb(n,r,u,[y]);else{if(y.ready||!e.is(":visible"))return;if(y.ready=!0,l=e.attr("data-field"),a=y.type,l){if(v=e.find(".app-control-inner"),f=n.findField(l),f)if(f.AllowNulls||e.attr("data-required",!0),a=="label"||a=="header")f=n._allFields[f.AliasIndex],p=f.HeaderText,v.html(p),p&&p!="&nbsp;"||e.attr("data-required",null);else if(a=="footer")tt=f.FooterText,tt?v.html(tt):e.addClass("app-hidden");else if(e.addClass("app-field-"+f.Name),a=="dataview"){if(f.Type=="DataView"&&f.DataViewController)if(n.extension().inserting())e.hide(),e.parent().is('[data-container="row"]')&&e.parent().hide();else{var d=n.get_parentDataView(n),l=f.Name,s=n._id+"_"+l,h,ct=0,g,p=f.HeaderText,it=f.DataViewFilterFields,o,et=r[f.Index],w,nt;for(w=n._dataViewFields,w||(w=n._dataViewFields={}),w[l]?s+=w[l]++:w[l]=1,h=i.find(s);h&&h._dataViewFieldParentId!=d._id;)s=d._id+"_"+l+ct++,h=i.find(s);y.echoSelector="#"+n._id+" #"+s+"_echo";e.empty().attr("id",s+"_ph");h?h._startPage=et:(o={id:s,controller:f.DataViewController,viewId:f.DataViewId,filterFields:f.DataViewFilterFields,baseUrl:__baseUrl,servicePath:__servicePath,showSearchBar:!0,autoHide:it?2:null,tag:f.Tag},o.startPage=et,it&&(o.filterSource=f.DataViewFilterSource?n.findField(it)._dataViewId:n._id),o.showInSummary=!!f.DataViewShowInSummary,f.DataViewPageSize&&(o.pageSize=f.DataViewPageSize),o.selectionMode=!f.DataViewMultiSelect?"Single":"Multiple",f.DataViewShowActionButtons&&(o.showActionButtons=f.DataViewShowActionButtons),o.showActionBar=f.DataViewShowActionBar!=!1,o.showDescription=f.DataViewShowDescription!=!1,o.showViewSelector=f.DataViewShowViewSelector!=!1,o.showSearchBar=f.DataViewShowSearchBar!=!1,o.showQuickFind=f.DataViewShowQuickFind!=!1,o.showRowNumber=!!f.DataViewShowRowNumber,f.DataViewShowPager&&(o.showPager=f.DataViewShowPager),o.showPageSize=f.DataViewShowPageSize!=!1,o.showModalForms=!!f.DataViewShowModalForms,o.searchOnStart=!!f.DataViewSearchOnStart,o.autoSelectFirstRow=!!f.DataViewAutoSelectFirstRow,o.autoHighlightFirstRow=!!f.DataViewAutoHighlightFirstRow,h=$create(Web.DataView,o,null,null,$("<p>")[0]),h._dataViewFieldName=l,f._dataViewId=s,h._dataViewFieldParentId=d._id,h._filterSourceSelected(d),g=c(s),g.text=p,g.headerText=p,g.activator.text=p);rt=b(e);nt=rt.find('[data-for="'+s+'"]');nt.length||(nt=lv(s,rt).addClass("app-echo-embedded"));nt.width(e.width());h.get_startPage()&&(h._loadPage(),iu(s+"_echo"))}}else a=="field"&&(f.ToolTip&&e.attr("title",f.ToolTip),t.render({container:e,inner:v,dataView:n,field:f,row:r,editing:u}))}else a=="description"?e.closest("[data-container]").addClass("app-has-description"):a=="action"&&(v=e.find(".app-control-inner"),ut=e.attr("data-action"),k=n.findAction(ut),k?(ot=$('<span class="app-action-column-button"/>').appendTo(v.empty().addClass("app-action-column")).text(k.HeaderText),ft=k.Description,ft&&ot.attr("title",ft),st=k&&n._isActionAvailable(k),st||e.addClass("app-disabled")):(ht=ut+": "+v.text(),$('<span class="app-action-column-button"/>').appendTo(v.empty().addClass("app-action-column")).text(ht),e.addClass("app-disabled")))}})}function cb(n,i,r,u){$(u).each(function(){var u=this,f=u.self,e;if(!u.ready)if(f.is(":visible"))ca(n,i,r,[u]);else return!1;u.children.length?cb(n,i,r,u.children):u.ready&&u.dirty&&f.is(":visible")&&(e=t.elementToField(f),t.render({container:f,dataView:n,field:e,editing:r,row:i}),u.dirty=!1)})}function ko(n){var t=n.dataView,u=n.row,f=n.editing,r=n.controls;r&&r.length&&(t||(t=i.find($(r[0].self).closest("[data-input-container]").attr("data-input-container"))),u||(u=t.editRow()),f==null&&(f=t.editing()),ca(t,u,f,r),cb(t,u,f,r))}function lr(n,t){if(t){clearTimeout(v._syncEmbeddedViewsTimeout);v._syncEmbeddedViewsTimeout=setTimeout(function(){lr(n)});return}n||(n=b());var r=[],u=tc(n),e=n.offset(),i,f;n.find('[data-control="dataview"]').each(function(){var t=$(this),u=t.data("node"),n=$(u.echoSelector),i=p(n,"height")+p(n,"margin-top")+p(n,"margin-bottom")+p(n,"padding-top")+p(n,"padding-bottom");n.length&&i&&(i!=p(t,"height")&&t.height(i),r.push({p:t,e:n}))});$(r).each(function(){var t=this,o=t.p,r,s=o.width();s?(i==null&&(i=n.scrollTop(),f=u.length?u.offset().left:0),r=o.offset(),t.e.css({visibility:"",left:r.left-f,top:r.top+i-e.top,width:s})):t.e.css({visibility:"hidden",top:0})});ef(n)}function iit(n,t){for(var i=t.parent().hide().next();i.length&&!i.is(":visible");)i=i.show().next()}function ar(){return $(this).is(":visible")}function dh(){return $("<style/>").appendTo($("head"))}function la(n){return n._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,n.get_viewId())}function oe(n,t,i,r){var f,u;r||(r=la(n));r&&r.length&&(f=n._evaluateJavaScriptExpressions(r,t,!0),i&&(u=[],$(r).each(function(){var n=this;n.Scope==1&&u.push(n.Result)}),u=u.join(" "),i.removeClass(u),f&&i.addClass(f)))}function gh(n){var t=n.pageProp("frozenField");return!t&&n._hasKey()&&(t="_first_"),t||"_none_"}function nc(n){return n||(n=y()),n.find(".dv-heading")}function lb(n){nc(n).remove()}function aa(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function go(){var n=f.width,t=f.height;return n<480&&t<640||t<480&&n<640}function ab(n){c(typeof n=="string"?n:n._id).echoChanged=!0}function vb(){var n=480;return h.left.visibile&&(n+=193),h.right.visible&&(n+=193),f.width>=n}function yb(n,t){var u=t&&t._controller?t:i.find(tc(t).attr("id")),r;return u&&$(u._panels).each(function(){var t=this;return t.location==n&&$(t.pages).each(function(){var n=this;if(n.is(".app-page-panel-active"))return r=n,!1}),r?!1:void 0}),r}function d(n,i){return t.of(n,i)}function b(n){return n?typeof n=="string"?(n.match(/^\w/)&&(n="#"+n),$(n).find(".app-wrapper")):n.length&&n[0].className.indexOf("ui-page")!=-1?n.find(".app-wrapper"):n.closest(".app-wrapper"):y()?y(".app-wrapper"):$()}function tc(n){return n?n.closest(".ui-page"):y()}function yi(n){return $(n).closest(".app-echo")}function sr(n){var i=document.activeElement,t=$(i).closest(".app-wrapper"),n=b(n);n.length&&(!t.length||t[0]!==n[0])&&n.focus()}function va(){var n=v.location.href,t=n.indexOf("#");t>=0&&(n=n.substr(0,t));v.location.reload(n)}function se(){if(!te){var n=e("ui.displayDensity.value");te=16;n=="Compact"?te=14:(n=="Condensed"||n=="Tiny")&&(te=12)}return te}function rit(t){var i=$(this),u,f=i.is(".app-bar-toolbar")?8:4,r=vi(t.clientX),e=gu(t.clientY);return i.find(".ui-btn-icon-notext").each(function(){var t=$(this),i,u,f;if(t.is(":visible")&&(t.is(".ui-icon-bars")?(i=0,u=p(n._backText,"left")):(i=t.offset().left,u=i+t.outerWidth()+8,i-=8),i<=r&&r<=u))return setTimeout(function(){t.trigger("vclick")}),f=!0,!1}),u}function gr(n,t){function r(){n.removeData("scrolling enableScrollEventsTimeout");nu(n)}n.data("scrolling",!0);n.scrollTop(t);var i=n.data("enableScrollEventsTimeout");i!=null&&clearTimeout(i);n.data("enableScrollEventsTimeout",setTimeout(r,300))}function tf(t,i){i||(i=fs(t));i.length&&i.find(".app-echo-toolbar .app-echo-controls").addClass("app-stale");var r=wt();clearTimeout(v._refreshEchoToolbar);v._refreshEchoToolbar=setTimeout(function(){r!=wt()||n.busy()||rt||hu()},500)}function pb(n){return!n&&go()?kt.pageTransition!="none"?"slideup":"none":o?"fade":"none"}function ic(n){return n&&typeof n=="string"&&n.match(/^(material\-icon|glyphicons|glyphicon|fa|ion)\-.+/)}function et(n,t){var i=n.match(/^(material\-icon|glyphicons|glyphicon|fa|ion)\-(.+)/),r,u;return i?(r=i[1],u=r=="material-icon",$('<i class="app-icon '+r+" "+i[0]+'" aria-hidden="true">'+(u?i[2].replace(/\-/g,"_"):"")+"<\/i>").appendTo(t.addClass("app-has-icon app-has-"+r))):null}function wb(){return $(".ui-panel-open .ui-btn.app-animated")}function bb(){return $(".ui-popup-active .ui-btn.app-animated")}function kb(n){i.search("show",n.dataViewId)}function db(n){$(n).find(".app-signature").each(function(){i.upload("resize",{container:this})})}function gb(n){var t=n.find(".Current"),i,r;t.length&&(r=n.offset(),i=t.offset(),n.scrollLeft(i.left-r.left-t.outerWidth(!0)/2))}function ou(n,r){function h(n){var t,i=u.steps[n];return i.isDynamic&&(t=!0,$(u.containers[n]).children().each(function(){var n=this;if(n.style.display!="none")return t=!1,!1})),!t}function c(n,t){for(t==null&&(t=u.active),t+=n;t>=0&&t<u.steps.length;)if(h(t))break;else t+=n;return t}function d(n){$(u.steps).each(function(t){var i=this;i.text==n&&h(t)&&(u.active=t,v())})}function l(n,t){var t=c(n,t);return t>=0&&t<u.steps.length}function a(){ni();u.containers.removeClass("app-wizard-active");var n=u.active,t;n!=-1&&(t=$(u.containers[n]).addClass("app-wizard-active"),ko({controls:t.data("node").children}),gi())}function v(){a();p();o||t.focus({container:$(u.containers[u.active])})}function p(){var n=e.closest(".ui-content"),t,i;n.length||(n=e.find(".ui-content"));t=n.find('[data-action-path="wizard-next"]');i=n.find('[data-action-path="wizard-prev"]');t.toggleClass("app-btn-disabled",!l(1));i.toggleClass("app-btn-disabled",!l(-1));k()}function k(){var o=f.closest(".ui-page"),t=o.find(".app-status-bar"),n,r,e,s;t.length&&(n=i.find(o.attr("id")),n._statusBarAuto&&(r=[n._controller+"."+n._viewId+"._wizard:"+u.active+"\n"],$(u.steps).each(function(n){var i=this,t,f=i.text;i.isDynamic&&(t=!0,$(u.containers[n]).children().each(function(){if(this.style.display!="none")return t=!1,!1}));t||r.push((n==u.active?"["+f+"]":f)+" >")}),n._statusBarAuto=r.join("")),t.html(n.statusBar()),e=t.find("li.Segment"),s=e.length+10,e.each(function(n){this.style.zIndex=s-n}),gb(t))}var e,f,u,w,b,s;if(r||(r={}),e=r.container||y(),f=r.layout||e,f.is("[data-layout]")||(f=f.find("[data-layout]"),!f.length&&e&&(f=e.closest("[data-layout]"))),u=f.data("wizard-config"),u||(u={steps:[],active:0},u.containers=f.find('[data-container="wizard"]').each(function(){var n=$(this),t={text:n.attr("data-wizard-step"),isDynamic:n.find("> [data-visibility]").length>0};u.steps.push(t)}),f.data("wizard-config",u)),u.steps.length)switch(n){case"start":u.active=l(1,-1)?0:-1;a();k();break;case"status":p();break;case"select":d(r.text);break;case"next":w=c(1);w!=-1&&(u.active=w,v());break;case"prev":b=c(-1);b!=-1&&(u.active=b,v());break;case"visible":if(r.step)return r.step.is(".app-wizard-active")?!0:(s=r.step.prevAll('[data-container="wizard"]').length,h(s));break;case"show":r.step&&!r.step.is(".app-wizard-active")&&(s=r.step.prevAll('[data-container="wizard"]').length,s!=u.active&&h(s)&&(u.active=s,a(),p()))}}function he(t,r){var a,g,v,w,b,o,l,s,k,u,d,nt;e("ui.actions.promote")&&(a=n.promo(),t||(t=n.dataView()),t&&(t._panelContainer&&(t=i.find(t._panelContainer.attr("id"))),g=t._id),t&&(v=t.extension().viewStyle(),w=v=="List"||v=="Cards",s=v=="Map",w&&r==null&&(r=y(".app-listview .ui-li-has-thumb").length>0),v!="Map"&&(w&&r||t.get_showMultipleSelection()||!ga())&&(s=!1)),a=n.promo(),b=c(g),b&&(o=b.page,k=a.outerWidth(),u=Math.floor(k/3),o&&(o.is(".app-page-modal")?(l=o.offset(),o.is(".app-page-modal-fullscreen")?a.css({left:s?l.left+u:"auto",right:s?"auto":f.physicalWidth-(l.left+o.outerWidth())+u,bottom:f.physicalHeight-(l.top+o.outerHeight()-u),"margin-bottom":0}):a.css({left:s?l.left+u:"auto",right:s?"auto":f.physicalWidth-(l.left+o.outerWidth())+u,bottom:f.physicalHeight-(l.top+o.outerHeight()+Math.ceil(k/2)),"margin-bottom":0})):(d=yb("right",t),nt=(d?p(d,"width"):0)+f.left,a.css({left:s?h.left.visible?h.left.width+u:u:"auto",right:s?"auto":nt+(h.right.visible?h.right.width+u:u),bottom:ai()?f.top:""})))))}function rc(t){var i=n._title;(i.data("screen-width")!=f.width||t)&&i.data("screen-width",f.width).css("marginLeft",h.left.visible?h.left.width:n._logo.offset().left+n._logo.outerWidth())}function nk(){var n=h.left.inner;h.left.width=n.css("width","").outerWidth();tt.width&&n.css({"overflow-y":"scroll",width:h.left.width-tt.width+2})}function ns(t){var i,r,u,o,c,l,a;if(t&&s.removeClass("app-has-panel-right"),i=document.body.className,!br){function v(){h.left.mini&&!i.match(/\bapp\-has\-minisidebar\-left\b/)?s.addClass("app-has-minisidebar-left"):!h.left.mini&&i.match(/\bapp\-has\-minisidebar\-left\b/)&&s.removeClass("app-has-minisidebar-left");i.match(/\bapp-has-sidebar-left\b/)||(s.addClass("app-has-sidebar-left"),h.left.visible=!0,nk(),r=!0)}function y(){i.match(/\bapp\-has\-minisidebar\-left\b/)&&s.removeClass("app-has-minisidebar-left");i.match(/\bapp-has-sidebar-left\b/)&&(s.removeClass("app-has-sidebar-left"),h.left.visible=!1,h.left.width=0,r=!0)}e("ui.sidebar.when")=="Landscape"?as()&&f.width>f.height?v():y():e("ui.sidebar.when")=="Never"?i.match(/\bapp-has-sidebar-left\b/)&&(s.removeClass("app-has-sidebar-left app-has-minisidebar-left"),h.left.visible=!1,h.left.width=0,r=!0):as()?v():y()}f.width>=pt("md")&&!1||i.match(/\bapp-has-sidebar-right\b/)&&(s.removeClass("app-has-sidebar-right"),h.right.visible=!1,h.right.width=0,u=!0);r&&(rc(!0),fb(),ru(),he());o=$(".ui-page.app-has-panel-right").first();c=o.is(".app-has-panel");o.is(".app-page-modal")||(c&&!i.match(/\bapp-has-panel-right\b/)?u=!0:!c&&i.match(/\bapp-has-panel-right\b/)&&(u=!0));u&&(l=yb("right",o),a=l?p(l,"width"):0,h.right.visible&&(a+=h.right.width+1),s.toggleClass("app-has-panel-right",c&&!!l),n._toolbar.css(a?{right:a,width:"auto"}:{right:"",width:""}),he());tk()}function tk(){if(h.left.visible){var n=h.left.inner,t=parseInt(n[0].style.bottom||"0");h.left.mini?t||n.css("bottom",n.next().outerHeight()-1):t&&h.left.inner.css("bottom","")}}function ts(n){gt();var t=n.match(/^(_\w+)\:(.+)$/),r,i;t&&t[1]?(u=t[2],i=t[1]=="_blank"?null:"modal=yes,alwaysRaised=yes,resizable=yes",i?v.open(u,r,i):v.open(u,r)):o?v.location.href=n:v.open(n)}function uc(){return(new Date).getTime()}function p(n,t){return parseFloat(arguments.length==1?n:n.css(t))}function uit(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function fit(){var r=n._toolbarButtons,o,u=n._contextButton,s=Math.ceil(u.show().offset().left),h=p(u,"width")+2,e=se(),t,i=r.length-1;for(t=p(n._toolbar,"width")-s+e,ai()&&(t+=f.left);i>=0;)o=$(r[i]).css("right",t),t=t+h+e,i--}function ik(n,t,r,u){if(n.htmlEncode())if(n.TextMode==3){for(var f=i.htmlEncode(t).split(/\r?\n/),o,e=0;e<f.length;e++)o=f[e],m=o.match(/^\s+/),m&&(f[e]=Array(m[0].length*2).join("&nbsp;")+o.substring(m[0].length));t=f.join("<br/>");f.length>15?(r.html('<div class="app-text-collapsible"><\/div>').children().html(t),$('<span class="ui-btn ui-btn-icon-notext ui-btn-inline ui-icon-carat-d ui-inline ui-corner-all app-btn-toggle"/>').attr("title",fu.Maximize).appendTo(r)):(r.html(t),u&&r.css("white-space","nowrap"))}else r.text(t);else r.html(t)}function rk(t,i,r){t.find("> .app-map, > .app-presenter-instruction").hide();r||(i._mapPageWindow=null);n.presenter("hide",{container:t})}function fc(){return!0}function ya(n,t,i){if(n._hasKey()){var r=$('<span class="app-btn-more">&nbsp;<\/span>').appendTo(t).attr("title",fi);i&&r.addClass("app-frozen")}}function eit(n,t){n.extension().quickFind(t)}function ce(n){var t=[];return n&&n.viewProp("useAdvancedSearch")&&(t=n.viewProp("advancedSearchFilter")||t),t}function uk(t){var i=t.extension().filterStatus(!0,!1);n.notify({dataView:t,text:i||r.FilterCleared})}function le(n){to(n);ek(n);$(n._allFields).each(function(){delete this._listOfValues});ty(n);uk(n);n._forceSync();n.refreshData()}function pa(n,t){!t&&ce(n).length&&n.viewProp("advancedSearchFilter",null);n.clearFilter(!0);le(n)}function fk(n){var i=n._filter,r=ce(n),t;return r.length&&(n._filter=[],t=n.extension().filterStatus(!0),n._filter=i),t}function ek(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0,f=$.Event("searching.app",{dataView:n});for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!=-1?t.splice(i,1):i++;n.viewProp("filter",t);$(document).trigger(f)}function ok(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function is(t){var r=n._menuStrip,i=r&&r.strip,u=n._title;i&&(arguments.length==0&&(t=ok()),t?i.show():(i.hide(),n.refreshTitleState()))}function sk(n){n.length&&n[n.length-1].text&&n.push({})}function su(n){var i=!0,t;if(n)setTimeout(function(){su()},5);else try{v.getSelection?(t=v.getSelection(),t&&t.rangeCount>0&&t.removeAllRanges()):document.selection&&document.selection.empty()}catch(r){i=!1}return i}function hk(){var n,t,i,u,r;return document.selection&&document.selection.createRange?(n=document.selection.createRange(),t=n.htmlText):window.getSelection&&(i=window.getSelection(),i.rangeCount>0&&(n=i.getRangeAt(0),u=n.cloneContents(),r=document.createElement("div"),r.appendChild(u),t=r.innerHTML)),t}function ck(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length==1&&i.attr("data-enabled",t?"true":"false"))}function oit(n,t){t=="Cards"?n.addClass("app-cardview").removeClass("app-grid app-onecolumnview"):t=="Grid"?n.addClass("app-grid").removeClass("app-cardview app-onecolumnview"):t=="List"&&n.addClass("app-onecolumnview").removeClass("app-cardview app-grid")}function ae(n,t,r){var u=i.find(n);to(u);u.extension().viewStyle(t,r);ab(n);bt(!0);bt(!1,10)}function wa(n,t){if(t.instruction){var i=n.find("> .app-presenter-instruction"),r=t.instruction();i.length||(i=$('<div class="app-presenter-instruction"><\/div>').appendTo(n).hide());r?(i.show(),i.html(r)):i.hide();es();lk(t.dataView(),n.closest(".ui-page"),!1,!0)}}function lk(n,t,i,r){var e,o,f,u;c(n).stickyHeader.hide();e=n.extension();e._instructed||n._totalRowCount==-1||(f=e.instruction(),u=nc(t),f||i?(u.empty(),e._instructed=!0,u.length||(u=$('<span class="dv-heading"/>').appendTo(t).hide()),f&&$('<span class="app-view-instruction"/>').appendTo(u).html(f.replace(/<a.*?<\/a>/gi,"")),u.attr("data-selector",r?".app-presenter-instruction:visible":"ul.app-listview li.app-list-instruction"),i&&(o=sv(n,u),f||o.addClass("app-grid-header-no-description")),ru(),(i||n.extension().viewStyle().match(/Cards|List/)&&n.get_groupExpression())&&$(document).trigger($.Event("scrollstop.app",{relatedTarget:b(t)}))):u.remove())}function ak(t){function i(i){var e=i.attr("data-presenter"),u=n.dataView(),r=u?u._id:null,f=i.closest(".app-echo");f.length&&(r=f.attr("data-for"));r&&i.css("display")!="none"&&n.presenter("show",{name:e,id:r,container:t||b(i)})}t?(t.find('div[data-role="presenter"]').each(function(){i($(this))}),$('.ui-page:not(.ui-page-active) div[data-role="presenter"]').each(function(){var n=$(this);n.closest(".app-echo-inner").length||n.addClass("app-stale")})):$('div[data-role="presenter"].app-stale').each(function(){var n=$(this);n.removeClass("app-stale");i(n)})}function ba(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header:visible"),f=n.find("> .app-presenter-instruction:visible"),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function sit(){var t=e("ui.modal.max"),n,i=f.width;return t?n=Math.min(pt(t),i-30):(n=Math.max(i,f.height*.85),n=n<=pt("xxs")?n-30:Math.ceil(n/1.618),n=Math.min(n,pt("md"))),n}function hit(){var n=Math.max(354,f.width<=pt("xxs")?f.height-30:Math.ceil(f.height*.8));return n>f.height-30&&(n=f.height-30),n}function vk(n){var i=n.prev(),r,t;i.is(".app-page-header-fixed")&&(i.css("top",p(n,"top")),r=i.outerHeight(),n.data("header-height",r),t=i.prev(),t.is(".app-page-header-image")&&(t.css("height",""),t.css({top:p(n,"top"),height:t.height()+r})))}function ui(n){var vt=y(),t=n||vt,kt,ft,dt,gt,ut,d,v;if(!t.is(".app-page-panel")){var ni=t.attr("id")==vt.attr("id")||t.is(".app-page-modal-root"),ti=t.is(".app-page-modal"),w=ue(),g=f.height-ue(),yt=t.find(".ui-content"),pt=yt.children().filter(function(){return $(this).is(".app-bar-header,.app-bar-actions,.app-tabs")}),et=yt.find(".app-bar-footer"),ot=co&&t.find(co.fixedTop.selector),st=ot&&ot.css("position")=="fixed"&&ot.outerHeight(),ht=co&&t.find(co.fixedBottom.selector),ct=ht&&ht.css("position")=="fixed"&&ht.outerHeight(),ri=t.is(".app-stale"),nt=0,lt,r=f.width<480&&!t.is(".app-page-modal-gap-required")?0:15;if(ti){var wt=t.attr("class"),at=wt.match(/\bapp\-page\-modal\-max\-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),l=wt.match(/\bapp\-page\-modal\-dock\-(top|left|right|bottom)\b/),i=hit(),a=sit(),ii=at?tit(at[1]):0;l&&(l=l[1]);at&&(a=Math.min(f.width-r*2,ii));lt=t.is(".app-page-modal-fullscreen");lt&&(a=f.width-r*2,i=f.height-r*2);var u=b(t),e=0,bt=c(t.attr("id")),rt=bt&&bt.dataView,k=(f.height-i)/2,d=(f.width-a)/2,v,it;l&&(l=="top"?k=r:l=="left"?(d=r,rt&&rt.tagged("modal-fit-content")||(k=r,it=r,i=f.height-r*2)):l=="bottom"?(k="auto",it=r):l=="right"&&(d="auto",v=r,rt&&rt.tagged("modal-fit-content")||(k=r,it=r,i=f.height-r*2)));ai()&&(k!="auto"&&(k+=f.top),d!="auto"&&(d+=f.left),it!=null&&it!="auto"&&(it-=f.bottom),v!=null&&v!="auto"&&(v-=f.right));t.css({"padding-top":0,top:k,left:d,right:v,bottom:it,"min-width":a,"max-width":a,width:a,"min-height":i,"max-height":i,height:i});footerHeight=et.length?et.outerHeight():0;pt.each(function(){var n=$(this);n.css("display")!="none"&&(e+=n.outerHeight(!0))});kt=u.data("scrolling");u.data("scrolling",!0);t.find(".app-bar-actions,.app-bar-footer,.app-bar-header").each(function(){var n=$(this);n.width(a-p(n,"padding-left")-p(n,"padding-right"))});e+=t.find(".app-page-modal-title").outerHeight();u.css({top:e,left:0,"min-width":a+tt.width,"max-width":a+tt.width,width:a+tt.width,"min-height":i-footerHeight-e,"max-height":i-footerHeight-e,height:i-footerHeight-e});!lt&&rt&&rt.tagged("modal-fit-content")&&(ft=u.find(".app-stub"),ft.length&&(dt=ft.position(),gt=Math.ceil(dt.top+ft.height()+u.scrollTop()),ut=u.height()-gt,ut>0&&(u.css({"min-height":i-footerHeight-e-ut,"max-height":i-footerHeight-e-ut,height:i-footerHeight-e-ut}),i-=ut,l!="top"&&l!="bottom"&&(k=f.top+(f.height-i)/2),t.css({top:k,"min-height":i,"max-height":i,height:i}))),t.addClass("app-page-modal-fit-content"));vk(u);u.data("vscrollbar").css({height:i-footerHeight-e,right:0,top:e});ba(u);kt||u.data("scrolling",!1)}else t.css({"padding-top":w,"min-height":g}),w=p(w),br&&!vl&&t.attr("id")=="Main"&&(w=0,g+=ue()),d=h.left.visible?h.left.width+1:0,v=h.right.visible?h.right.width+1:0,ai()&&(d+=f.left,v-=f.left),t.css({left:d,right:v,width:f.width-v-d,top:ai()?f.top:""}),b(t).each(function(){var n=$(this),i=0,u=n.data("scrolling"),r;n.data("scrolling",!0);pt.each(function(){var n=$(this);n.css("display")!="none"&&(i+=n.outerHeight(!0))});et.each(function(){var n=$(this);n.css("display")!="none"&&(nt+=n.outerHeight(!0))});i&&(g=g-i,w=w+i);st&&(g-=st,w+=st);ct&&(g-=ct,nt+=ct);nt&&(nt-=2);r=g-nt;t.is(".app-has-panel")&&$(c(t.attr("id")).dataView._panels).each(function(){var n=this,u=p(t,"left"),r=f.width-(h.right.visible?h.right.width:0)-u-1,i=r;$(n.pages).each(function(){var u=this;u.is(".app-page-panel-active")&&n.location=="right"&&(i=Math.ceil(r*n.size/100),t.css({right:v+i}),u.css({top:p(t,"top"),left:"auto",bottom:nt,width:i,"min-height":p(t,"min-height")}))})});n.css({top:w,bottom:nt,"min-height":r});ni&&n.css({height:r});tt.width&&n.css("width","").width(n.width()+tt.width);n.data("vscrollbar").css({height:g-nt,right:0,top:w});vk(n);ba(n);u||n.data("scrolling",!1)});o&&s.scrollTop(0)}}function ka(n){var i=document.cookie.split(";"),r,t;for(r in i)if(t=i[r].trim(),t.startsWith(n+"="))return t.substring(n.length+1)}function cit(n,t,i){var u="",r;i&&(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString());document.cookie=n+"="+t+u+"; path=/"}function lit(){function et(n){return n&&(n=n.match(/Landscape|Always|Never/)),n?n[0]:"Landscape"}var b=e("ui.displayDensity.mobile"),ut=e("ui.displayDensity.desktop"),a=Sys.Browser,d,v,g,c=$("#PageHeader").parent(),u,y=$("div[data-content-framework]").first(),nt=ct("promoteActions"),it=ct("smartDates"),ft=kt.appInfo.split("|")[1],rt=ka(".COTTHEME"+ft),l,w,t,i;if(rt&&(l=rt.split("."),l.length>1&&(u={theme:l[0],accent:l[1]})),c.length||(c=s),e("membership.profile",e("membership.profile")||"view switch login logout"),e("ui.transitions.style",ct("transitions")||e("ui.transitions.style")||(tr||dw()||$app.host?"slide":"none")),n._uiSideBarWhen=ct("sidebar")||et(e("ui.sidebar.when")),e("ui.sidebar.when",n._uiSideBarWhen||(as()?"Always":"Landscape")),w=ct("minisidebar"),e("ui.sidebar.mini",w!=null?w:st("ui.sidebar.mini")||e("ui.sidebar.mini")==null&&f.width<=pt("lg")),e("ui.menu.location",br?"toolbar":e("ui.menu.location")?e("ui.menu.location"):"toolbar"),kt.bars={left:{visible:!1,width:0,content:[]},bottom:{visible:!1,height:0,content:[]},right:{visible:!1,width:0,content:[]}},e("ui.theme.name",ct("theme")||u&&u.theme||e("ui.theme.name")),e("ui.theme.accent",ct("accent")||u&&u.accent||e("ui.theme.accent")),e("ui.displayDensity.value",ct("displayDensity")||(bs<144?ut:b=="Auto"?bs>=432?"Comfortable":"Compact":b)),e("ui.list.labels.display",ct("labelsInList")||e("ui.list.labels.display")),e("ui.showSystemButtons",ct("showSystemButtons")||e("ui.showSystemButtons")||"Auto"),e("ui.actions.promote",nt!=null?nt:e("ui.actions.promote")),e("ui.list.initialMode",br?"Summary":ct("initialListMode")||e("ui.list.initialMode")||"SeeAll"),e("ui.smartDates",it!=null?it:e("ui.smartDates")==!0),h=kt.bars,a.agent==a.InternetExplorer&&a.version<=9&&!(__settings.host||window.external)&&(s.hide(),kt.defaultUI?(d=(new Date).getDate()+365,v=new Date,v.setDate(d),g=String.format("appfactorytouchui=false; expires={0}; path=/",v.toUTCString()),document.cookie=g,location.reload(k.path.parseUrl(location.href).hrefNoHash)):alert(r.TouchUINotSupported)),nr&&(s.addClass("app-ios"),tp<8&&s.addClass("app-ios7")),tr&&s.addClass("app-android"),e("ui.showSystemButtons")!="Always"&&s.addClass("app-show-system-buttons-on-hover"),c.is(".Tall")&&s.addClass("app-page-header-hidden"),(c.is(".Wide")||e("ui.menu.location")!="sidebar"&&y.length&&y.attr("data-sidebar")!="true"||!y.length&&$('div[data-app-role="page"]').first().attr("data-sidebar")=="false")&&(e("ui.sidebar.when","Never"),e("settings.options.sidebar",!1)),br){if(location.href.match(/_showNavigation=false/)||(s.addClass("app-hosted-show-navigation"),vl=!0,n._toolbar.css("visibility","")),location.hash){s.children().hide();location.reload(location.pathname+location.search);return}s.addClass("app-hosted")}$(document).trigger($.Event("init.app"));k.defaultPageTransition="none";t=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed ui-body-a app-sidebar app-sidebar-left app-sidebar"><div class="ui-panel-inner" tabindex="0"><ul/><\/div><div class="app-bar-toolbar-bottom"><\/div><\/div>').appendTo(s);i=t.find(".ui-panel-inner");na({sidebar:t});tt.width&&i.css({"overflow-y":"scroll",width:t.width()-p(i,"padding-left")-p(i,"padding-right")+tt.width});h.left.inner=i;h.left.toolbar=i.next();h.left.content.push(t.find("ul").listview());t=$('<div class="ui-panel ui-panel-fixed ui-body-a app-sidebar app-sidebar-right"><div class="ui-panel-inner" tabindex="0"><ul/><\/div><\/div>').appendTo(s);i=t.find(".ui-panel-inner");h.right.inner=i;h.right.content.push(t.find("ul").listview());st("ui.sidebar.mini")&&(h.left.mini=!0);ns();e("ui.displayDensity.value")||e("ui.displayDensity.value",o?"Comfortable":"Compact");s.addClass(ry(e("ui.theme.name")));s.addClass("app-accent-"+e("ui.theme.accent"));s.addClass(iy(e("ui.displayDensity.value")));e("ui.list.labels.display")=="DisplayedAbove"&&s.addClass("app-labelsinlist-displayedabove")}function vr(t){n.tabs("fit",{page:t})}function yk(n){n=$(n);b(n).each(function(){var n=$(this),t=n.data("scroll-top")});n.find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)});ge(n)}function da(n){n=$(n);n.is(":visible")&&(b(n).each(function(){var n=$(this)}),n.find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())}))}function pk(n){var t=n.scrollTop();return{top:t*-1,height:n.height()+t,maxHeight:n[0].scrollHeight}}function wk(n){var t=n.find(".ui-panel-inner"),i,r;if(t.length)t.on("scroll keydown keyup",function(){if(!rt&&o&&!i){i=!0;r=t.scrollTop();lt=!0;var n=(new Date).getTime();function u(){var f=t.scrollTop(),e=f!=r;e||(new Date).getTime()-n<100?(r=f,e&&(n=(new Date).getTime()),requestAnimationFrame(u)):(i=!1,lt=!1,t.data("scroll-stop-time",new Date))}requestAnimationFrame(u)}})}function ait(n){n.find(".ui-panel-inner").off("scroll keydown keyup")}function rs(n,t){n||(n=b());nu(n,!1,t==!0);n.find(".app-data-list").each(function(){ec($(this))})}function ec(n,t){function e(){t.css({left:i*r,width:n.width()*r,display:""})}var i;n.length&&(t||(t=n,n.parent().attr("class").match(/\-outer/)&&(t=n.parent()),t=t.next().find(".app-hscrollbar-handle")));i=n.scrollLeft();var u=n.width(),f=n[0].scrollWidth,r=Math.abs(u-f)<=2?1:u/f;t.parent().css("visibility",r==1?"hidden":"");r==1||n.find(".app-hidden").length?(t.css("display","none"),n.removeClass("app-inner-shadow-left app-inner-shadow-right app-inner-shadow-left-right")):(i<=0?n.addClass("app-inner-shadow-right").removeClass("app-inner-shadow-left app-inner-shadow-left-right"):i>=n[0].scrollWidth-n[0].clientWidth-1?n.addClass("app-inner-shadow-left").removeClass("app-inner-shadow-right app-inner-shadow-left-right"):n.addClass("app-inner-shadow-left-right").removeClass("app-inner-shadow-right app-inner-shadow-left"),e())}function nu(n,t,i){if(n.length)if(i)clearTimeout(v._updateVScrollbarTimeout),v._updateVScrollbarTimeout=setTimeout(function(){nu(n,t)},100);else{t||(t=n.next().find(".app-vscrollbar-handle"));var f=n[0].scrollHeight,u=n.height(),r=u/f,e=t.parent(),o=n.parent().parent();footer=e.next();e.css("visibility",r==1?"hidden":"");r==1?(t.css("display","none"),footer.addClass("app-bar-footer-no-scrolling"),o.removeClass("app-page-scrolled")):requestAnimationFrame(function(){var i=n.scrollTop(),e=u*r,s;e<16&&(e=16);t.css({top:i*r-0,height:e,display:""});f<=i+u?footer.addClass("app-bar-footer-no-scrolling"):footer.removeClass("app-bar-footer-no-scrolling");s=n.data("header-height");o.toggleClass("app-page-scrolled",i>(s||50))})}}function oc(t,i){function y(){u=r.data("lastScrollTop");u==null&&(u=0);var t=r.data("scroll-dir"),i=r.scrollTop(),n=i<u?"up":i==u?"none":"down";n=="none"&&t=="none"&&(n="up");n!=t&&(r.data("scroll-dir",n),$(document).trigger($.Event("scrolldir.app",{relatedTarget:r})))}var r=b(t),e,s,l,v,c,u,p,a;if(!r.length){if(l=t.find(".ui-content"),v=l.contents(),r=$('<div class="app-wrapper"><\/div>').appendTo(l),tt.width&&r.css("overflow-y","scroll"),p=f.width,r.toggleClass("app-display-tablet",p>=pt("sm")+(h.left.visible?h.left.width:0)),e=$('<div class="app-vscrollbar"><\/div>').insertAfter(r),s=$('<div class="app-vscrollbar-handle" data-draggable="vscrollbar"><\/div>').appendTo(e),r.data({vscrollbar:e,"vscrollbar-handle":s}),nu(r,s),po(r,!1),a=n.pageInfo(t),a&&a.external&&e.css("display","none"),i==!1)r.on("scroll",function(){nu(r,s)});else r.on("scroll",function(){if(rt||r.data("scrolling")){clearInterval(r.data("scrollInterval"));r.data("lastScrollTop",r.scrollTop());c=!1;lt=!1;return}if(nu(r,s),c)y();else{c=!0;ni();$(document).trigger($.Event("scrollstart.app",{relatedTarget:r}));lt=!0;e.addClass("app-scrollbar-reveal");var n=(new Date).getTime();function t(){var i=r.scrollTop(),f=i!=u,o=(new Date).getTime();f||o-n<100?(u=i,f&&(n=o),requestAnimationFrame(t)):(clearInterval(r.data("scrollInterval")),y(),c=!1,lt=!1,r.data({"scroll-stop-time":new Date,lastScrollTop:i,scrollInterval:null}),e.removeClass("app-scrollbar-reveal"),$(document).trigger($.Event("scrollstop.app",{relatedTarget:r})))}requestAnimationFrame(t)}});o||r.attr("tabindex",0);$('<div class="app-page-header"><h2/><h1/><\/div><div class="app-page-header-divider"><\/div>').appendTo(r);v.appendTo(r)}return r}function gt(t){n.activeLink(t)}function it(n,t){t||(t=ii);n=$(n);var i=n.attr("class");i&&i.match(/\bapp-btn-/)?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");al="link";t(n)},dt)):(gt(n),setTimeout(function(){rt&&t==ii||(gt(),al="link",n&&n.is(".app-btn")&&(al="toolbar"),t(n))},dt))}function bk(n,t){if(t||(t=n.find(".app-stub,.app-stub-main")),t.length){var i=Math.ceil(t.offset().top),r=Math.ceil(n.offset().top),u=n.height();i>r&&(i>r+u?t.height(""):t.height(u-(i-r)))}}function ve(){fr&&fr._updateLastActivity()}function us(){return rh&&rh.length||(rh=$(".app-sidebar").first()),rh}function ga(n){return kt.bars[n||"left"].visible}function rr(n,t,i){n&&(i||sr(),n.href?ts(n.href):n.callback&&n.callback(n.context,t))}function nv(n){var t=n.closest("ul").find(".app-focus");n.closest(".ui-panel-inner").focus();t.length&&(t.removeClass("app-focus ui-btn-active"),n.addClass("app-focus ui-btn-active"))}function kk(n,t){if(n.length){t||(t=n.closest(".ui-panel-inner"));var i=n.offset(),e=t.offset(),r,u=e.top,f=u+t.outerHeight()-1;i.top<u?r=i.top-u:i.top+n.outerHeight()>f&&(r=i.top+n.outerHeight()-f);r&&setTimeout(function(){t.scrollTop(t.scrollTop()+r)},10)}}function dk(n){var t=y();t&&t.find(".dv-load-at-top").css("visibility",n?"hidden":"");rt=n}function y(n){var t=k.activePage;return arguments.length?t.find(n):t}function wt(){var n=y();return n?n.attr("id"):"_"}function c(t){return n.pageInfo(t)}function fs(n){var t=c(n),i=t.echo;return i||(i=t.echo=$("#"+t.id+"_echo")),i}function gk(){return wt()=="Main"}function tv(n,t){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_f_"+t.Name}function ye(n){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_scroll_"}function nd(n){var t=n.Columns;return t==0&&n.Type=="String"&&(t=Math.floor(n.Len)),n.ItemsTargetController&&!t?t=80:t>80?t=80:t||(n.Type=="String"?(t=n.Rows>1?80:30,n.Len>0&&n.Len<t&&(t=n.Len)):t=7),n.Type.match(/^Date/)&&t<20?t=n.DataFormatString=="d"||n.DataFormatString=="{0:d}"?10:t:n.Type=="Guid"&&t<36&&(t=36),t}function yit(n,t){t||(t=se());var i=n.cols!=null?n.cols:nd(n),r=n.long?i*.5:i<11?i:i<21?Math.ceil(i*.5):10;return Math.ceil(t*(r<=3?1:.55)*r)}function yr(n){var t=Math.ceil(se()*1);$(n||y(".app-listview")).each(function(){var i=$(this),l=i.parent(),a=i.closest(".ui-page"),et,wt="w"+Math.ceil(p(a,"width")/t),r=kp[wt],nt,ot,st,bt,ht,it,ct=i.data("data-yardstick-class"),e=s.find("#app-yardstick"),kt=i.is(".app-grid"),rt=l.is(".app-echo-inner"),dt,ai=rt||l.is(".app-map-info"),gt,ni,yt,pt,ii,ri,ui,h,fi;if(r||(e.length||(e=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(s).listview()),rt&&kt&&(l=b(l)),e.addClass("app-onecolumnview").appendTo(l).show(),nt=e.find("li").first(),et=a.css("display"),et!="block"&&a.css("display","block"),st=nt.outerWidth(),e.toggleClass("app-onecolumnview  app-cardview"),ot=nt.outerWidth(),e.toggleClass("app-cardview app-grid"),bt=e.find("span").first(),ht=p(bt,"margin-left"),tt.gridColumnPadding=ht,dt=nt.outerWidth(),e.removeClass("app-grid"),et!="block"&&a.css("display",""),e.appendTo(s).hide(),gt=nf(st),ni=nf(ot),r={listBreakpoint:gt,cardBreakpoint:ni,card:Math.floor(ot/t),list:Math.floor(st/t),columnPadding:ht,grid:{},gridWidth:dt},kp[wt]=r),it="app-listitem-"+(i.is(".app-cardview")?r.cardBreakpoint:r.listBreakpoint),it!=ct&&(ct&&i.removeClass(ct),i.addClass("app-yardstick "+it).data("data-yardstick-class",it)),kt){var ei=c(rt?yi(i).attr("data-for"):a.attr("id")),n=ei.dataView,v=n.session("grid-style"),o=ff(n);if(!v||n.session("grid-style-changed")||o&&(n.session("window-width")!=f.width||n.session("grid-with-sidebar")!=ga())){n.session("grid-style-changed",null);var oi=n._fields,si=n._allFields,lt=[],y,hi=0,w=n.get_showMultipleSelection(),u=i.is(":visible")?i.width():r.gridWidth,at=n._hasKey(),ti=(at?22:0)+(w?38:0)+tt.gridColumnPadding,ut=ti,ft,vi=2*t+r.columnPadding,h,k=n.gridSettings(),vt=new Sys.StringBuilder;if($(oi).each(function(){var r=this,i=si[this.AliasIndex];r.Hidden||i.GroupBy||r.OnDemand||r.Type=="DataView"||(y=nd(i),ft=Math.ceil(Math.min(u*.5,y*t*(y<=3?1:.55))),k&&k.width[i.Name]&&(ft=k.width[i.Name]),ut+=ft+tt.gridColumnPadding,hi+=y,lt.push({name:i.Name,className:tv(n,i),cols:y,type:i.Type,ew:ft,long:i.ItemsDataController||i.Type=="String"&&i.Rows>1}))}),n){if(n.session("avail-width",u),yt=n.session("grid-avail-width"),pt=ti,n.tagged("grid-fit-none")&&(o&&ff(n,!1),o=!1),k){for(h in k.width)ri=!0;ri&&(o&&ff(n,!1),o=!1)}yt==null||o?(u-=tt.gridColumnPadding+1,rt&&(u-=tt.width),o&&(u<ut&&(ui=(u-(w?22:0))/ut,$(lt).each(function(){var n=this,i=yit(n,t);n.ew=(n.ew+tt.gridColumnPadding)*ui-tt.gridColumnPadding;n.ew<i&&(n.ew=i,ii=!0);pt+=n.ew+tt.gridColumnPadding})),n.session("scroll-left",0)),ii?u=pt:o||(u=ut),n.session("grid-avail-width",Math.floor(u)),ff(n,o),n.session("window-width",f.width),n.session("grid-with-sidebar",ga())):u=yt}var ci,d=0,g=gh(n),li=g!="_none_";$(lt).each(function(){h=this;var n=h.ew;h==ci&&(at&&(n-=22),w&&(n-=22+r.columnPadding));g!="_none_"&&(d+=n+r.columnPadding,(g==h.name||g=="_first_")&&(g="_none_"));vt.appendFormat(".{0} {{width:{1}px;max-width:{1}px}}",h.className,Math.floor(n));vt.appendLine()});fi=vt.toString();v||(v=dh(),n.session("grid-style",v));v.text(fi);d&&(d+=4);n.session("grid-frozen-width",!li&&!w?0:Math.floor(d+(at?26:4))+(w?22+(d>0?r.columnPadding:4):0))}}})}function pi(t){var i=n._menuButton;if(arguments.length==0)return i.is(".app-transition");i&&!t&&n.toolbar().is(":visible")&&!y().is(".app-page-modal")&&(t?i.removeClass("ui-icon-bars").addClass("app-transition"):i.removeClass(gc).addClass(td()?"ui-icon-bars":"ui-icon-back"))}function pe(){pi(!0);eu.one("beforeunload pagehide",function(){pi(!1)})}function td(){var i=wt(),t=n._pages;return i=="Main"||t.length&&i==t[0].id&&t[0].home}function rd(){var u=n._menuButton,l=y(),i,e,o;if(u&&n.toolbar().is(":visible")&&!l.is(".app-page-modal"))if(td()?u.removeClass("ui-icon-back ui-icon-bars "+gc).addClass("ui-icon-bars").attr({"data-action":"#app-btn-menu",title:r.Menu}):u.removeClass("ui-icon-bars "+gc).addClass("ui-icon-back").attr({"data-action":"#app-back",title:r.Back}),e=!u.is(".ui-icon-bars"),n.toolbar().toggleClass("app-has-back",e),o=n._backText,e){var f=si.stack[si.activeIndex-1],s=f&&f.hash,h=s?c(s.substring(1)):null,t=h?h.headerText:f&&f.title;i=c();(!t||i&&i.headerText==t)&&(i&&(t=i.backText),t||(t=r.Back));o.text(typeof t=="string"?t:t[0]).show()}else o.hide()}function iv(n){n.length&&n.closest(".app-sidebar").length&&(bp[wt()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function pit(n){n.find(".ui-panel-inner").scrollTop(n.length&&n.closest(".app-sidebar").length?bp[wt()+"_"+n.attr("id")]||0:0)}function rv(n){var t=$(n.target).closest(".ui-btn,.app-grid-header").find(".app-btn-check");return t.length>0&&vi(n.pageX)<=t.offset().left+t.outerWidth()+8}function ud(n,t){var u,i,f=vi(n.clientX),e=gu(n.clientY),o=$(n.target).closest(".ui-btn").find(".app-action-column"),r;return o.length&&o.find(".app-action-column-button").each(function(){var n=$(this),o=n.offset();if(f>=o.left-4&&f<=o.left+n.outerWidth()+3&&e>=o.top-6&&e<=o.top+n.outerHeight()+4)return u=!0,n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");i=yi(n);cv(i);hc(t).removeClass("app-selected ui-btn-active");r=n.closest(".ui-btn");t.extension().tap(r.data("data-context"),"none");i.length&&r.addClass("app-selected");var u=[],f=n.attr("data-action-path");ys("ActionColumn",t,u,t.extension().commandRow());$(u).each(function(){var n=this;if(n.path==f)return rr(n,r),!1});i.length?tf(t,i):ab(t._id)},dt),!1}),u}function fd(n){var i=$(n.target).closest(".ui-btn").find(".app-btn-more"),r=vi(n.clientX),u=gu(n.clientY),t;return i.length?(t=i.offset(),t.left-8<=r&&r<=t.left+i.outerWidth(!0)+8&&t.top-8<=u&&u<=t.top+i.outerHeight(!0)+8):!1}function ed(n){return n.closest(".ui-btn").find(".app-btn-more")}function sc(n){return String.format("app-style-dv-{0} app-style-c-{1} app-style-cv-{1}-{2}",n._id,n._controller,n._viewId)}function hc(n){return c(n).page.find('ul[data-role="listview"] li a')}function tu(n){$(arguments).each(function(t){t&&(n?$(this).addClass("app-btn-check-selected").closest(".ui-btn").addClass("app-checked").parent().addClass("app-checked"):$(this).removeClass("app-btn-check-selected").closest(".ui-btn").removeClass("app-checked").parent().removeClass("app-checked"))})}function cc(n){n.is(".app-cardcolumn")&&(n=n.parent());n.find("a.app-selected").removeClass("app-selected ui-btn-active")}function uv(t,r){function a(){e.length&&tf(t,e)}var u=t._selectedKeyList,o=u.length==0,f=b().find(".app-style-dv-"+t._id),e=yi(f),s=f.find(".dv-item .ui-btn:not(.app-calculated) .app-btn-check"),v=f.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check"),y=n.stickyHeaderBar().find(".app-grid-header .app-btn-check"),h,l;if(o&&t._totalRowCount>yl){i.alert(String.format(ci.Presenters.Charts.DataWarning,yl),function(){e.length&&n.contextScope(t._id);hf({mode:"everything"});n.contextScope(null)});return}if(u.splice(0,u.length),tu(o,s,v,y),o)if(s.length&&!t.extension().commandRow()&&(l=$(s[0]).closest(".ui-btn"),t.extension().tap(l.data("data-context"),"none"),e.length&&l.addClass("app-selected")),t._keyFields.length==1&&f.find(".dv-load-at-top,.dv-load-at-bottom,.dv-action-see-all").length){if(t._busy())return;h=t._createArgsForListOfValues(t._keyFields[0].Name);h.request.MaximumValueCount=yl;t._invoke("GetListOfValues",h,function(n){t._busy(!1);$(n).each(function(){u.push(this.toString())});t.set_selectedValue(u.join(";"));ev(t);a()})}else f.find(".dv-item .ui-btn:not(.app-calculated)").each(function(){u.push(t._createRowKey($(this).data("data-context").row))}),a();else r||t.extension().clearSelection(!0);t.set_selectedValue(u.join(";"));e.length?(tu(o,c(t).page.find(".app-wrapper .app-listview .app-btn-check, .dv-heading .app-btn-check")),a()):(c(t).echoChanged=!0,bt());ev(t)}function fv(n){return n.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check")}function od(n){return vu(c(n).page).find(".app-grid-header .app-btn-check")}function sd(n){var t=n._selectedKeyList.length;return t?" "+String.format(t>1?r.ItemsSelectedMany:r.ItemsSelectedOne,t)+".":""}function ev(n){var r=n._selectedKeyList.length,t=c(n),i=$.merge(t.page.find(".app-multi-select-instruction"),fs(n).find(".app-multi-select-instruction"));wt()==n._id&&$.merge(i,vu(t.page).find(".app-multi-select-instruction"));i.text(sd(n));r>1&&es()}function es(n){n||(n=vu());n.find(".app-bar-text-instruction-hidden").removeClass("app-bar-text-instruction-hidden")}function ov(n,t){var s=n.extension(),a=t.find(".app-btn-check"),f=t.data("data-context"),i=n._selectedKeyList,h=i.length,v=f?n._createRowKey(f.row):n.get_selectedKey().join(";"),l=i.indexOf(v),r=t.closest(".ui-listview"),u=yi(r),y,p=od(n),e,o,w=t.is(".app-selected");y=fv(r);l!=-1?(i.splice(l,1),tu(!1,a),w&&(cc(r),h>1?n._clearSelectedKey():s.clearSelection(!0),o=r.find(".dv-item.app-checked .ui-btn").first(),o.length?(s.tap(o.data("data-context"),"none"),u.length&&o.addClass("app-selected")):i.length&&n.sync(i[0])),u.length?tf(n,u):c(n).echoChanged=!0):(i.push(v),tu(!0,a),cc(r),f&&s.tap(f,"none"),u.length?t.addClass("app-selected"):c(n).echoChanged=!0);tu(i.length,y,p);u.length&&(r=b(n._id).find(".app-listview"),r.length&&(e=t.data("data-context"),r.find(".ui-btn").each(function(){var t=$(this),u=t.data("data-context"),f=0;if(e&&($(n._keyFields).each(function(){var t=n.findField(this.Name);e.row&&u&&u.row&&e.row[t.Index]==u.row[t.Index]&&f++}),f==n._keyFields.length))return checkBox=t.find(".app-btn-check"),l!=-1?tu(!1,checkBox):(cc(r),tu(!0,checkBox),t.addClass("app-selected")),tu(r,i.length,fv(r)),!1})));n.set_selectedValue(i.join(";"));(!h&&i.length||h&&!i.length)&&bt();ev(n)}function sv(n,t){var l=n._fields,a=n._allFields,s=!0,i=$('<div data-draggable="grid-header" class="app-grid-header app-grid-header-cv-'+n._id+"-"+n._viewId+'"><\/div>').appendTo(t).attr("data-for",n._id),h=ye(n),u=gh(n),f=u=="_none_",v=0,c,e;return n.get_showMultipleSelection()&&(e=$('<span class="app-btn-check"><\/span>').appendTo(i).attr("title",r.LookupSelectAction),n._selectedKeyList.length&&e.addClass("app-btn-check-selected")),(u!="_none_"||e)&&$('<span class="app-frozen-spacer '+h+'frozen_"/>').appendTo(i),$(l).each(function(){var e=this,t=a[e.AliasIndex],r,l,y,p,w,b;e.Hidden||t.GroupBy||e.OnDemand||e.Type=="DataView"||(r=$('<span data-draggable="grid-header-field"/>').addClass(tv(n,t)).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(i),t.Type.match(up)?r.addClass("app-field-type-numeric"):t.Type=="Boolean"&&r.addClass("app-field-type-bool"),l=yu(n,t.Name),y=n.get_fieldFilter(t,!0),l||y?$('<b class="app-grid-header-text"/>').appendTo(r).text(t.HeaderText+" "):r.text(t.HeaderText),l&&et("material-icon-arrow-"+(l.match(/^asc/i)?"upward":"downward"),r),y&&(b=et("material-icon-filter-list",r),$(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return p=n,!1}),p&&!o&&(w=n._filter,n._filter=[p],b.attr("title",n.extension().filterStatus(!0)),n._filter=w)),s&&(s=!1,ya(n,i)),c=$('<span class="app-field-separator" data-draggable="grid-header-separator"/>').appendTo(i),u!="_none_"?(r.addClass("app-frozen"),t.Name==u||u=="_first_"?(f=!0,u="_none_"):c.addClass("app-frozen")):f&&(r.addClass(h+" app-scroll"),f=!1),v++)}),i}function hd(n,t,i,u){if(n.get_showMultipleSelection()){var e=$('<span class="app-btn-check"><\/span>').appendTo(u).attr("title",r.LookupSelectAction),f;i||(f=n._createRowKey(t),n._selectedKeyList.indexOf(f)!=-1&&(e.addClass("app-btn-check-selected"),u.addClass("app-checked").parent().addClass("app-checked")))}}function lc(n,t){var i=n.HyperlinkFormatString,r;return i&&(r=n._dataView._parseLocation(i,t)),r}function os(n,t,r,u,f){if(f)switch(t.Type){case"Date":case"DateTime":n.removeAttr("data-smart-type data-smart-value data-smart-text")}if(kt.ui.smartDates&&r!=null&&!t.is("smart-dates-disabled")){var e,o;switch(t.Type){case"Date":case"DateTime":e=ld(n,t.Type,r,u,new Date);e&&(o=!0,n.attr({"data-smart-type":t.Type,"data-smart-value":JSON.stringify(r),"data-smart-text":u}));break;default:t._smartSize&&(e=i.sizeToText(r),n.text(e))}return e&&o&&!v.smartValueInterval&&(v.smartValueInterval=setTimeout(function(){cd();v.smartValueInterval=setInterval(cd,6e4)},6e4-(new Date).getSeconds()*1e3)),e}}function cd(n){n&&n.length||(n=$("[data-smart-value]"));var t=new Date;n.each(function(i){var r=n.eq(i),f=r.attr("data-smart-type"),u=JSON.parse(r.attr("data-smart-value")),e=r.attr("data-smart-text");switch(f){case"Date":case"DateTime":u=new Date(u)}ld(r,f,u,e,t)})}function ld(n,t,i,r,u){if(i)switch(t){case"Date":case"DateTime":var f=ad(i,u);return f?(n.text(f),!0):(n.removeAttr("data-smart-type").removeAttr("data-smart-value").removeAttr("data-smart-text").text(r),!1)}}function ad(n,t){var u,e;if(n==null)return null;var o=uu.AbbreviatedDayNames,i=r.Dates,s=t-n,h=s/864e5;if(h>=8||h<-14)return n.getYear()==t.getYear()?String.format("{0:"+uu.MonthDayPattern.replace(/M+/,"MMM")+"}",n)+we(n):null;var c=new Date(t).setHours(0,0,0,0),l=new Date(n).setHours(0,0,0,0),f=(c-l)/864e5;return f>1?i.Last+" "+o[n.getDay()]+we(n):f==1?i.Yesterday+we(n):f==0?vd(n)?i.Today:(u=s/6e4,e=u/60,u%=60,s>0)?e>1?String.format("{0:"+uu.ShortTimePattern+"}",n):e==1?i.OneHour:u>2?String.format(i.MinAgo,Math.floor(u)):u>1?i.AMinAgo:i.JustNow:e<=-1?String.format("{0:"+uu.ShortTimePattern+"}",n):u<=-59?i.InHour:u<-2?String.format(i.InMin,-Math.floor(u)):u<-1?i.InAMin:i.Now:f==-1?i.Tomorrow+we(n):f>=-7?o[n.getDay()]+we(n):i.Next+" "+o[n.getDay()]+we(n)}function vd(n){var t=n.getHours(),i=n.getMinutes(),r=n.getSeconds();return t==0&&i==0&&r==0}function we(n){if(!vd(n)){var t=n.getSeconds(),i=n.getMinutes(),r=n.getHours();if(r||i||t)return t==0?", "+String.format("{0:"+uu.ShortTimePattern+"}",n):", "+String.format("{0:"+uu.LongTimePattern+"}",n)}return""}function ss(n,t,i,r,u){var l=n._fields,a=n._allFields,h=ye(n),e,f=gh(n),o=f=="_none_",c,s=!0,v=0;(f!="_none_"||n.get_showMultipleSelection())&&$('<span class="app-frozen-spacer '+h+'frozen_"/>').appendTo(r);r.attr("data-draggable","data-item");hd(n,t,u,r);$(l).each(function(l){var b=this,y=a[b.AliasIndex],g=y.itemColumnClass||tv(n,y),p,w,d,nt,k=b.Items,tt;b.Hidden||y.GroupBy||b.OnDemand||b.Type=="DataView"||(p=$('<span data-draggable="data-item"><\/span>').appendTo(r).addClass(g+" app-field app-field-"+y.Name),y.itemColumnClass||(y.itemColumnClass=g),tt=w=t[u?b.Index:y.Index],w==null?(nt=!0,p.addClass("app-null")):d=lc(b,t),w=y.text(w,y.TextMode!=3),s&&ya(n,r,f!="_none_"),y.Type.match(up)&&p.addClass("app-field-type-numeric"),u?(e=u?u[l]:null,e&&(w=t[b.Index],w=String.localeFormat(b.DataFormatString||"{0:n0}",w),p.text(w),$('<div class="app-static-text"><\/div>').text(e).insertBefore(p.contents()),p.attr("title",y.HeaderText+"\n"+e+" "+w))):(y.Type=="Boolean"?(p.addClass("app-field-type-bool"),et("material-icon-"+(!nt&&k&&k.length>=2&&k[k.length-1][1]==w?"check-box":"check-box-outline-blank"),p)):ik(y,w,p,!0),p.attr("title",y.HeaderText+":\n"+(y.Type=="Boolean"?w:uw(p))),d&&p.attr("data-href",d)),os(p,y,tt,w),s&&i!=null&&$('<span class="app-item-number"/>').insertBefore(p.contents()).text(i+"."),u&&(c=$('<span class="app-field-separator"/>').appendTo(r)),f!="_none_"?(p.addClass("app-frozen"),y.Name==f||f=="_first_"?(o=!0,f="_none_"):u&&c.addClass("app-frozen")):o&&(p.addClass(h),o=!1),y.TextMode==2&&p.addClass("app-field-data app-field-data-rtf"),v++,s=!1)})}function be(n){var t=i._htmlConverter;return t||(t=i._htmlConverter=$("<p/>")),t.html(n.replace(/></g,"> <")).text()}function rf(n,t,i,r,u,f,e,o){var b=n._allFields,rt=f.is("a"),k=$("<h3>").appendTo(f),g=b[i.heading],h,l,v,y,w;if(rt&&hd(n,t,null,f),i.thumb!=null)if(h=t[i.thumb],h&&h.toString().match(/^null/))u.addClass("ui-li-has-thumb");else var vt=n.resolveClientUrl(n.get_appRootPath()),st=b[i.thumb],wt=$('<img class="ui-li-thumb"/>').appendTo(f).attr({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",vt,st.OnDemandHandler,h,st.OnDemandStyle==2?"&_nocrop":"")});if(h=t[i.heading],h=g.text(h),rt&&f.attr("title",h),g.HtmlEncode?k.text(h):k.html(h),k.addClass("app-field app-field-"+g.Name).attr("title",g.HeaderText+":\n"+k.text()),r&&$('<span class="app-item-number"/>').insertBefore(k.contents()).text(r+". "),k.contents().wrap('<span class="app-field-data"/>'),i.desc.length){var nt=$('<p class="app-para"/>').appendTo(f),d=nt,c,ht=1,tt;$(i.desc).each(function(n){var a=this,o=b[a],k=i.descLabels[n],g=i.descPara[n],it=i.descColumn[n],v,l,w=o.HeaderText,s,y,p;g&&(d.is(".app-para")||(nt=$('<p class="app-para"/>').appendTo(f),c||nt.insertAfter(d),d=nt,ht++),c=null);it&&(c||u.addClass("app-has-column"),c=$('<span class="app-column"/>').appendTo(f).addClass(c?"":"app-column-first"),v=100/i.descColumnCount+"%",c.css({minWidth:v,maxWidth:v}));h=t[a];y=h==null;s=$('<span class="app-item-desc"/>').insertAfter(d).addClass("app-field app-field-"+o.Name);c&&s.appendTo(c);d=s;h=o.text(h);e?(tt=$('<span class="app-field-data"/>').appendTo(s),o.TextMode==2&&tt.addClass("app-field-data-rtf"),ik(o,h,tt)):o.TextMode==2?s.text(be(h)):o.HtmlEncode||o.TextMode==3?s.text(h):s.html(h);e&&a==i.heading&&(s.addClass("app-item-heading"),r&&$('<span class="app-item-number"/>').insertBefore(tt.contents()).text(r+". "));l=s.contents();s.attr("title",o.HeaderText+":\n"+uw(s));y||(i.descOriginal[n]!=null&&(o=b[i.descOriginal[n]]),p=lc(o,t),p&&(l=l.wrap("<span/>").parent().attr("data-href",p)));k!=null&&((kt.ui.list.labels.display=="DisplayedAbove"||e)&&$('<span class="app-field-label-before"/>').insertBefore(l.first()).text(w),kt.ui.list.labels.display=="DisplayedBelow"&&$('<span class="app-field-label-after"/>').insertAfter(l.last()).text(w));y?l.wrap('<span class="app-null"/>'):e||l.wrap('<span class="app-field-data"/>');os(e?l:l.parent(),o,t[a],h)});ht>1&&u.addClass("app-para-multi")}if(rt){var ut=n.extension(),yt=ut._commandRow,ft,ct=n.get_actionGroups("ActionColumn",!0),pt=0,lt=se();if(ct.length&&o!=!0){ft=$('<span class="app-action-column"/>').appendTo(f);var et=p(f,"padding-left"),ot=ct[0],at=ot.groupText,a=ot.groupTextMaxWidth,it;at&&!a&&(a=0,it=$('<span class="app-action-column"><span class="app-action-column-button"/><\/span>').appendTo(s).find("span"),$(at).each(function(){it.text(this);a=Math.max(a,it.outerWidth())}),it.parent().remove(),ot.groupTextMaxWidth=a);ft.css({left:et,maxWidth:a});et+=a+lt;f.css("padding-left",et/lt+"em");ut._commandRow=t;$(n.actionGroups("ActionColumn")).each(function(){$(this.Actions).each(function(){var n=this;pt++;$('<span class="app-action-column-button"/>').appendTo(ft).text(n.HeaderText).attr({title:n.Description,"data-action-scope":"ActionColumn","data-action-path":n.Path})})});ut._commandRow=yt}i.aside!=null&&(u.addClass("app-li-has-aside"),l=$('<p class="ui-li-aside"/>').appendTo(f),v=b[i.aside],h=t[i.aside],h=v.text(h),v.HtmlEncode?l.text(h):l.html(h),l.addClass("app-field app-field-"+v.Name).attr("title",v.HeaderText+":\n"+l.text()),os(l,v,t[i.aside],h),i.asideLabel&&$('<span class="app-field-label"/>').insertBefore(l.contents()).text(v.HeaderText));i.count!=null&&(l==null||i.desc.length)&&(y=$('<span class="ui-li-count"/>').appendTo(f),w=b[i.count],h=t[i.count],h=w.text(h),w.HtmlEncode?y.text(h):y.html(h),y.addClass("app-field app-field-"+w.Name).attr("title",w.HeaderText+":\n"+y.text()),os(y,w,t[i.count],h),i.countLabel&&$('<span class="app-field-label"/>').insertBefore(y.contents()).text(w.HeaderText));ya(n,f)}}function bit(n,t,i){var r=n._headerImageField,e="t",u,f,o;r&&(f=i[r.Index],o=r.tagged("header-image-original"),typeof f!="string"||f.match(/^null\|/)||(r.tagged("header-image-original")&&(e=nf(p(t,"width"))),u=c(n),u.dataImage=String.format("{0}blob.ashx?{1}={2}|{3}&_nocrop",n.resolveClientUrl(n.get_appRootPath()),r.OnDemandHandler,e,r.format(i[r.Index])),u.dataImageOriginal=o))}function yd(n,t,i){var r=n.tagged(rp),u;!r&&n._lookupInfo&&(r=["","material-icon-playlist-add-check"]);r&&(i.find(".app-icon").remove(),et(r[1],i.addClass("app-has-icon")),u=t.find(".app-page-modal-title"),u.length&&et(r[1],u.addClass("app-has-icon")),t.addClass("app-has-icon"),et(r[1],i).addClass("app-icon-background"))}function ir(t,i){function k(){var u,n,f,t;i.length>1&&(i=i.first());i.show().next().show();u=r.find(".app-wrapper");n=r.find(".app-page-header-fixed");n.is(".app-page-header")||(n=$('<div class="app-page-header app-page-header-fixed"><\/div>').insertBefore(u));n.html(i.html()).css("top",p(u,"top"));n.toggleClass("app-has-action-bar",i.is(".app-has-action-bar"));n.toggleClass("app-has-icon",i.is(".app-has-icon"));f=s&&s.dataImage;f&&(n.addClass("app-has-image"),i.addClass("app-has-image"),t=n.prev(),t.is(".app-page-header-image")||(t=$('<div class="app-page-header-image"><\/div>').insertBefore(n)),t.css("background-image",'url("'+f+'")'),s.dataImageOriginal&&t.addClass("app-page-header-image-original"))}function d(){i.hide().next().hide()}var o,r,h,v,l,u,f="",e,w,a,b,tt;if(i)r=i.first().closest(".ui-page");else{if(r=y(),!r)return;i=r.find(".app-page-header")}var g=r.is(".app-page-modal"),nt=r.attr("id"),s=c(nt);if(v=i.find("h1"),l=i.find("h2"),h=r.attr("data-page-header")!="false",typeof t=="boolean")t&&h?k():d();else return o=i.data("data-text"),t?(o&&typeof o!="string"&&typeof t=="string"&&(o[1]=t,t=o),i.data("data-text",t)):t=o,e=at.currentNode,nt=="Main"&&e&&(e.showPageHeaderDescription&&(t=[t,e.description]),e.icon&&e.showPageHeaderIcon&&!i[0].className.match(/\bapp\-has\-icon\b/)&&(et(e.icon,i.addClass("app-has-icon")),et(e.icon,i).addClass("app-icon-background"))),t&&(typeof t=="string"?u=t.trim():(u=t[0].trim(),f=t[1].trim())),i.attr("data-locked")!="true"&&(v.length&&(v[0].innerText=u,u&&(a=u)),l.length&&(l[0].innerText=f,f&&(a+=" / "+f),f||(l[0].innerHTML="")),u&&(g?(w=r.find(".app-page-modal-title"),a=w.find(".app-text").text(u),f&&!w.next().is(".app-bar-actions")&&$("<span/>").appendTo(a).text(f)):(b=r.find(".app-page-header-placeholder"),b.length&&(tt=b.find(".app-text").text(u),f&&$("<span/>").appendTo(tt).text(f)))),s&&u&&(s.headerText=f?[u,f]:u,s.text=u)),(t!=n.title()||wt()=="Main"&&(!at.currentNode||at.currentNode.showPageHeaderTitle)||g)&&h||r.is(".app-page-header-show")?k():(d(),h&&r.attr("data-page-header","false")),t}function kit(n,t){var i=Math.ceil(f.width*.9);!t&&go()?n.css({maxWidth:f.width-1,minWidth:f.width-1}):(i>800&&(i=800),n.css({maxWidth:i}))}function uf(n){var t=e("ui.transitions.style");if(!arguments.length)return t;n?e("ui.transitions.style",e("ui.transitions.currentStyle")):(e("ui.transitions.currentStyle",t),e("ui.transitions.style","none"))}function hv(n,t,i){if(navigator.msSaveBlob)return navigator.msSaveBlob(new Blob(["﻿",t],{type:"data:attachment/text"}),n);var r=$('<a style="display: none;"/>').appendTo(s),u=window.URL.createObjectURL(new Blob(["﻿",t],{type:i||"text/csv"}));r.attr({download:n,href:u})[0].click();r.remove();window.URL.revokeObjectURL(u)}function ke(n){n.find(".app-listview a").removeData();n.find('ul[data-role="listview"]').listview("destroy").remove()}function hs(t){var i=$app.find(t);i._requiresContextRefresh=!0;n.notify({dataView:i,text:r.Refreshed});i.sync()}function dit(n,t){var u,f;typeof n=="string"&&(n=i.find(n));f=n.extension().viewStyle();t.push({});f!="Grid"||n.tagged("grid-fit-none")||(u=n.viewProp("grid-is-fitted")!=!1,t.push({text:r.FitToWidth,icon:u?"check":!1,callback:function(){var t=n.gridSettings();t&&(t.width={},n.gridSettings(t));ff(n,!u,!0);ls(n);yr();ge();ef();lr()}}));f.match(/Grid|List|Cards/)&&!n.tagged("multi-select-none")&&(!n._lookupInfo||n._lookupInfo.multiSelect)&&t.push({text:r.MultiSelection,icon:n.multiSelect()?"check":!1,callback:function(){n.multiSelect(!n.multiSelect());ls(n);n.sync()}});t.push({text:wu.Refresh,icon:"refresh",context:n._id,callback:hs})}function cv(n){n.find(".app-echo-inner .app-selected").removeClass("app-selected")}function lv(t,u){function v(i){function c(n){var r=parseInt(o.attr("data-start-index")),u=parseInt(o.attr("data-end-index")),t=n=="next"?u+1:r-1,i=0;return t<0&&(t=0),i=Math.floor(t/s.extension().pageSize()),{action:n,rowIndex:t,pageIndex:i,ensurePageIndex:Math.max(n=="next"?i+1:i-1,0),pageY:f.offset().top}}var u=$(i.target),f=u.closest("a"),r=f.find(".app-btn-next"),o=f.find(".app-info"),h=t+"_echo",e=vi(i.pageX);r.length&&e>=r.offset().left&&e<r.offset().left+r.outerWidth()+4?u=r:(r=f.find(".app-btn-prev"),r.length&&e>=r.offset().left&&e<r.offset().left+r.outerWidth()?u=r:(f.find(".app-btn-see-all").addClass("ui-btn-active"),u=f));u.is(".app-btn-disabled")||(f.removeClass("ui-btn-active"),it(u,function(){u.removeClass("ui-btn-active");setTimeout(function(){u.is(".app-btn-next")?iu(h,c("next")):u.is(".app-btn-prev")?iu(h,c("prev")):(hh=!0,n.changePage(t))},25)}))}var f=$('<div class="app-echo"><\/div>').appendTo(u).attr({id:t+"_echo","data-for":t}),l,a,h,s=i.find(t),e,y=c(t);y.echoChanged=!0;e=$('<div class="app-echo-toolbar"><h3><\/h3><a class="ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more"/><div class="app-echo-controls"><\/div><span class="app-echo-see-all"/><\/div>').appendTo(f);l=e.find("h3");s.get_showViewSelector()||l.addClass("app-hidden");e.find(".ui-icon-dots").attr("title",fi).css("visibility","hidden");e.find(".ui-icon-carat-r").attr("title",r.SeeAll).toggleClass("ui-icon-recycle").prev().hide();et("material-icon-chevron-right",e.find(".app-echo-see-all").html(r.SeeAll));e.find(".app-echo-controls");s.get_showActionBar()||e.hide();$('<div class="app-echo-instruction"><\/div>').appendTo(f).hide();a=$('<div class="app-echo-inner"><\/div>').appendTo(f).on("vclick taphold",function(i){var e=$(i.target),r=e.closest("a"),b,u,o,a,s,y=i.type,l=y!="taphold"&&!i.ctrlKey,p=r.is(".dv-action-see-all"),w;if(!e.closest(".app-presenter").length||p){if(h){h=!1;return}if(r.length&&!r.is(".app-divider")&&cu(e,y)&&(!p||l)&&!n.busy())if(p)v(i);else{if(e.is("[data-href]"))return;if(n.contextScope(t),b=c(t),u=b.dataView,o=u.extension(),s=r.data("data-context"),w=r.is(".app-selected"),u._hasKey()){if(ud(i,u))return!1;a=u.get_showMultipleSelection();l&&a&&rv(i)?ov(u,r):(cv(f),l?r.addClass("app-selected"):w?r.removeClass("app-selected"):r.addClass("app-selected"),hc(u).removeClass("app-selected"),l?(a&&r.find(".app-btn-check").addClass("app-btn-check-selected"),o.tap(s,"none"),ee(u,r),fd(i)?ps(ed(e)):o.tap(s)):(w?o.clearSelection():o.tap(s,"none"),y=="taphold"&&(h=!0)),it(e));tf(u,f)}else n.infoView(u,!0,s.row);n.contextScope(null)}if(!e.closest(".app-grid-header").length)return!1}}).on("contextmenu",function(n){return nn(c(t).dataView,n)});$('<div class="app-echo-footer"><\/div>').appendTo(f).on("vclick",function(){var t=$(event.target),n=t.closest("a");return n.length&&n.is(".dv-action-see-all")&&v(event),!1});return $('<div class="app-echo-empty"><\/div>').appendTo(a).text(er),pd(f),e.find("h3").text(c(t).text),o||f.find(".app-echo-inner").attr("tabindex",0),s._hidden&&f.hide(),f}function hu(t,i,r){var e,f,u,o=0;t?y(".app-echo-toolbar").each(function(){e=$(this).parent();f=e.attr("data-for");u=c(f);u.echoId&&!u.dataView._busy()&&iu(u.echoId)}):lt||rt||kf||g&&g.data("busy")?(clearTimeout(lp),lp=setTimeout(function(){hu(t,i)},50)):(n.callWhenVisible(r||".app-echo",function(t){setTimeout(function(){f=t.attr("data-for");u=c(f);u&&u.dataView&&!u.dataView._busy()&&!u.dataView.get_isForm()&&(u.echoInitialized?u.echoChanged&&iu(u.echoId):(u.echoId=t.attr("id"),n.pageInit(u.id,!1)&&iu(u.id+"_echo")))},i==null?o:i);o+=50}),y(".app-echo-controls.app-stale").each(function(){var n=yi($(this).removeClass("app-stale")),t=n.attr("id"),i=c(t.substring(0,t.length-5));cs(i.dataView,n)}))}function pd(){}function ac(n,t,i){var r=n.find("h3").empty().text(t.get_view().Label||i.text),u=t._totalRowCount;return n.length&&u>0&&($("<span> (<\/span>").appendTo(r),$('<span class="app-echo-count"><\/span>').appendTo(r).text(u),$("<span>)<\/span>").appendTo(r),o||r.attr("title",r.text())),r}function de(n){var i=ye(n),t=n.session(i);return t||(t=dh(),t.text("."+i+"frozen_{display:none!important}"),n.session(i,t)),t}function ff(n,t,i){if(arguments.length>=2)n.session("grid-is-fitted",t),i&&n.viewProp("grid-is-fitted",t?null:!1);else{var r=n.session("grid-is-fitted");return r!=null&&n.session("window-width")!=f.width&&(r=null),r==null&&(r=n.viewProp("grid-is-fitted"),r==null&&(r=!n.tagged("grid-fit-none")),n.session("grid-is-fitted",r)),r}}function av(n,t){var r=n.session("grid-avail-width"),i,u=ff(n);r!=null&&(t.find(".app-hscrollbar-inner").width(r),tt.height&&yi(t).length&&(i=t.parent(),i.parent().width()>=r?i.hide():i.show()))}function wd(n,t){var r=n.session("grid-avail-width"),i=t.find(".app-hscrollbar");yi(t).length||i.css("margin-right",tt.width);av(n,i);ge(t)}function ef(n){var t;n||(n=y(),t=!0);n.find(".app-grid-header").each(function(){var u=$(this),s=u.height(),e=u.find("[data-field-name]").first(),o,n,r,f;s&&e.length&&(o=u.attr("data-for"),n=i.find(o),r=n.session("grid-header-style"),r||(r=dh(),n.session("grid-header-style",r)),(t||n.session("reset-grid-header"))&&(r.text("").data("text",""),n.session("reset-grid-header",null)),f=".app-grid-header-cv-"+n._id+"-"+n._viewId+" > span {height:"+(u.height()-parseFloat(e.css("padding-top"))*2)+"px}",r.data("text")!=f&&r.data("text",f).text(f))})}function of(n,t,i,r){function f(){vv(n,t)}function e(){ut.scrollingAnimationFrame=null;i&&(t=-1*n.session("scroll-left"));var c=o+"-last-scroll-left",h=n.session(c),l=n.session("scroll-left-margin")||0,a=Math.abs(Math.abs(t)-Math.abs(h));i&&h!=null&&a==0||(r&&t<(h||0)&&f(),u.html("."+o+"{margin-left:"+(t?t+l+"px!important":"inherit")+";transition:margin-left "+(r?s+"ms ease-out":"0 linear")+"}"),n.session(c,t),r?setTimeout(function(){f();of(n,t)},s+64):f());i&&(ut.scrollingAnimationFrame=requestAnimationFrame(e))}var u=n.session("scroll-style"),o=ye(n),h=+new Date,s=384;if(u||(u=dh(),n.session("scroll-style",u)),arguments.length>=2)if(i){if(ut.scrollingAnimationFrame)return;ut.scrollingAnimationFrame=requestAnimationFrame(e)}else e();return u}function git(){var t=$(this),r,n;t.data("ignore-scrolling")||(r=i.find(t.attr("data-view")),n=-t.scrollLeft(),of(r,n),n=t.scrollLeft(),r.session("scroll-left",n),vv(r,n))}function vv(n,t){var i=de(n),r=t?"inline-block":"none",u=n.session("grid-frozen-width")||0;if(i&&(i.data("display")!=r||i.data("width")!=u))return i.html("."+ye(n)+"frozen_{display:"+r+"!important;width:"+u+"px}"),i.data("display",r).data("width",u),!0}function nrt(n){n.session("scroll-left",0);var t=n.session("scroll-style");t&&(t.remove(),n.session("scroll-style",null))}function ge(n,t){n||(n=y());n.find(".app-hscrollbar").each(function(){var u=$(this),n=i.find(u.attr("data-view")),r=n?n.session("scroll-left"):null,f=u.closest(".app-grid");de(n);f.length||(f=y(".app-grid"));(n.session("grid-avail-width")<f.width()||t)&&(r=0,n.session("scroll-left",r));av(n,u);r!=null&&(u.data("ignore-scrolling",r>0).scrollLeft(r),t?of(n,r,!1):vv(n,r),setTimeout(function(){u.removeData("ignore-scrolling")},100))})}function bd(n,t,i){var r=n.extension(),u=r.aggregateLabels(),f=$('<div class="app-bar-aggregate-list"><\/div>').appendTo(t);$(n._fields).each(function(t){var o=this,h=n._allFields[o.AliasIndex],s=u[t],r,e,c;s&&(r=i[o.Index],r=String.localeFormat(o.DataFormatString||"{0:n0}",r),e=$('<a class="ui-btn ui-inline app-calculated app-btn-static"/>').appendTo(f),$('<span class="app-calculated-label"/>').text(h.HeaderText).appendTo(e),c=$('<span class="app-calculated-value"/>').text(r).appendTo(e),$('<div class="app-static-text"><\/div>').text(s).insertBefore(c.contents()),e.attr({title:h.HeaderText+"\n"+s+" "+r,"data-tooltip-location":"above"}))})}function kd(t,i){if(!t._checkedStartCommand){t._checkedStartCommand=!0;var r=t.get_lastCommandName(),u=t.get_lastCommandArgument();function f(){var t=[];n.navContext(t);$(t).each(function(){var n=this;if(n.command==r&&(!u||u==n.argument))return n.callback(n.context),!1})}r&&(i?f():ri(f))}}function iu(t,u){function uu(){ri&&(bd(e,ni.show().empty(),ri),y(".app-echo:visible").length==1&&d.prev().is(".app-page-header,.app-tabs")&&(it-=ni.outerHeight()))}function fu(){$(h).each(function(n){var t=this;if(e.rowIsSelected(t))return et=n,v.commandRow()||(v.tap(t,"none"),v.currentPageIndex(dt)),!1});ot=h.length}function ur(){var n;u?(et=null,u.action=="prev"?(w=u.rowIndex-l+1,w<0&&(w=0),lastPageRowIndex=u.rowIndex%ti,n=lastPageRowIndex-l+1,n>0?h=h.slice(n,lastPageRowIndex+1):(h=h.slice(0,lastPageRowIndex+1),u.pageIndex&&(ut=v.visibleDataRows(u.pageIndex-1),ut&&(h=ut.slice(ut.length+n).concat(h))))):(w=u.rowIndex,n=u.rowIndex%ti,h=h.slice(n,n+l+1),h.length<l&&(ut=v.visibleDataRows(u.pageIndex+1),ut&&(h=h.concat(ut)))),fu()):et!=null&&l<at&&(yi=Math.floor(l/2),vt=w+et-yi+1,at-(w+et)<yi&&(vt-=yi-(at-(w+et))),vt<0&&(vt=0),vt!=w&&(vt>w?(h=h.slice(0),h.splice(0,vt-w),et-=vt-w,w=vt,h.length<l&&dt<v.pageCount()-1&&(ut=v.visibleDataRows(dt+1),ut&&(h=h.concat(ut)))):dt>0&&(ut=v.visibleDataRows(dt-1),ut&&(ut=ut.slice(0),ut.splice(0,ti-(w-vt)),et+=ut.length,w=vt,h=ut.concat(h)))),ot=ti)}function pi(n,t,i){n.empty().removeClass("ui-btn-icon-left");var u=$('<span class="app-btn-prev"/>').appendTo(n).text(r.Prev).attr("title",wu.Previous);return t||u.addClass("app-btn-disabled"),u=$('<span class="app-btn-next"/>').appendTo(n).text(r.Next).attr("title",wu.Next),i==at-1&&u.addClass("app-btn-disabled"),$('<span class="app-info"/>').appendTo(n).attr({"data-start-index":t,"data-end-index":i}).html(String.format(wu.ShowingItems,t+1,i+1,at)),n}function yu(n){if(u){var r=n.offset().top,t=Math.ceil(u.pageY)-Math.ceil(r),i;t>0&&t+n.outerHeight(!0)<rt.height()&&(i=n.parent().prev("li").first().find("a"),i.length&&$('<div class="app-listview-stub"><\/div>').height(t).appendTo(i))}}var d,ci,fr,er,or,ui,hr,cr,ft,ct,lt,vr,gt,pr,su,wr;if(!kf&&(d=$("#"+t),d.length)){ci=d.is(".app-echo-embedded");d.removeClass("app-density-condensed app-density-compact");var rt=b(d),hu=rt.scrollTop(),cu=d.outerHeight(),s=d.find(".app-echo-inner").show(),ni=s.next().hide(),lu=d.attr("data-for"),bt=c(lu),e=bt.dataView,ki=la(e),at=e._totalRowCount,v=e.extension(),dt=u?u.pageIndex:v.currentPageIndex()||0,ti=v.pageSize(),w=dt*ti,li,vt,h=v.visibleDataRows(dt),ut,f,a,g,ii,ai,fi=e.get_showRowNumber()==!0,di=$(d).find(".app-echo-toolbar"),au=di.find(".app-echo-controls"),br=di.find(".app-echo-see-all"),kr,dr=s.prev(),gi=v.instruction(!1),yt=v.viewStyle(),vi=v.itemMap(yt=="List"),vu=k.getScreenHeight(),it=rt.height()*.55,ei,et,ot,l,yi,st,kt,gr,oi,tr=e.get_selectedKey().length>0,si,tu,ir,ri=v.aggregates(),ru,rr;if(e._checkedAutoSelect||(e._checkedAutoSelect=!0,v._autoSelect&&(si=v._autoSelect,v._autoSelect=null,si&&!n.busy()&&(bt.echoChanged=!0,n.contextScope(e._id),v.tap(si.row,si.action),e._selectedKeyList=[e._createRowKey(si.row)],n.contextScope(null),tr=!0))),kd(e,!0),!d.is(":visible")){bt.echoChanged=!0;return}if(bt.echoChanged=!1,pd(d),!h||u&&ti*u.ensurePageIndex<at&&!v.visibleDataRows(u.ensurePageIndex)){e.goToPage(u&&u.pageIndex||0,!0);v.echoCallback=function(){v.echoCallback=null;iu(t,u)};return}if(kr=ac(di,e,bt),bt.echoInitialized||(bt.echoInitialized=!0,bt.refreshed=!1),ci||(d.css("padding-bottom",""),kt=rt.find(".app-stub,.app-stub-main"),kt.length||(kt=$("<div><\/div>").appendTo(rt).addClass("app-stub"+(gk()?"-main":""))),kt.height(kt.outerHeight()+s.outerHeight(!0))),gi&&(h.length||gi.match(/"app-filter"/))?dr.html(gi).show():dr.hide(),ei=s.scrollLeft(),s.find(".app-hscrollbar").off(),ke(s),ru=s.find('div[data-role="presenter"]').detach(),s.empty(),ru.appendTo(s),n.presenter("hide",{container:s}),h.length||e.get_searchOnStart()&&yt=="Grid"){if(s.removeClass("app-no-scrolling app-horizontal-scrolling"),e._filterSource||rt.find(".app-echo").filter(ar).length!=1?o||rt.css("overflow",""):(it=vu-s.offset().top,o||(it-=p(d,"padding-top")+p(d,"padding-bottom"),yt&&yt.match(/List|Grid|Cards/)?(rt.css("overflow",""),tu=!0):rt.css("overflow",""))),bv(e,s),n.presenter("supports",yt)&&(fr=[],er=!1,n.presenter("enumerate",{id:e._id,list:fr}),$(fr).each(function(){if(this.name==yt)return er=!0,!1}),s.addClass("app-no-scrolling").height(""),er&&n.presenter("show",{name:yt,id:e._id,container:s,maxHeight:Math.ceil(it)})?rr=!0:yt=vb()?"Grid":"List"),!rr)if(u||fu(),or=ah(),it+=or.is(":visible")?-or.outerHeight():0,yt=="Grid"){s.addClass("app-no-scrolling").height("");ke(s);f=$('<ul class="app-listview app-grid" data-role="listview"/>').addClass(sc(e)).appendTo(s);a=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(f);sv(e,a);a=$('<li data-icon="false" class="dv-item"/>').appendTo(f);h.length&&ss(e,h[0],null,$("<a/>").appendTo(a));f.listview().listview("refresh");ii=a.outerHeight();yr(f);ef(f);it-=a.prev().outerHeight()+1;l=Math.ceil(it/(ii+1));ri&&(l-=2);a.remove();l<4&&(l=4);ur();var ht=[],pt=[],hi=0,wt,sr;$(h).each(function(n){var i=this,u=w+n+1,t=$('<li data-icon="false" class="dv-item"/>').appendTo(f),r=$('<a class="ui-btn"/>').appendTo(t).data("data-context",{row:this.slice(0),pageIndex:0});return ss(e,i,fi?u:null,r),n==et&&(oi=i,r.addClass("app-selected")),oe(e,i,t,ki),li=w+n,!et||n<et?ht.push(t):pt.push(t),l<ot&&l-1==n?!1:void 0});ri&&(a=$('<li data-icon="false" class="dv-item"/>').appendTo(f),g=$('<a class="app-divider app-calculated"/>').appendTo(a),ss(e,ri,null,g,v.aggregateLabels()));function eu(){st=$('<a class="dv-action-see-all"/>').appendTo($("<li/>").appendTo(f)).html("text")}if(ui=$('<li class="app-echo-grid-hscrollbar"><div class="app-hscrollbar"><div class="app-hscrollbar-inner"><\/div><\/div><\/li>').height(tt.height),hr=ui.find(".app-hscrollbar").attr("data-view",e._id),de(e),ui.appendTo(f),tt.height){hr.on("scroll",git);av(e,hr);requestAnimationFrame(function(){wd(e,ui)});it-=ui.outerHeight()}else ui.hide();(l<ot||ot<at)&&eu();f.listview().listview("refresh");st&&(it-=st.outerHeight());f.find(".dv-item").each(function(){hi+=$(this).outerHeight()});function ou(){wt&&(hi-=wt.outerHeight(),wt.find(".ui-btn").removeData(),wt.remove())}if(hi>it){if(st||(eu(),it-=st.outerHeight()),pt.length)while(ht.length+pt.length+1>3&&hi>it)wt=null,sr=="before"?(sr="after",ht.length>1&&ht.length>=pt.length&&(wt=ht[0],ht.splice(0,1),w++)):(sr="before",pt.length>1&&pt.length>ht.length&&(wt=pt[pt.length-1],pt.splice(pt.length-1,1),li--)),ou();else while(ht.length>3&&hi>it)u&&u.action=="prev"?(wt=ht[0],ht.splice(0,1),w++):(wt=ht[ht.length-1],ht.splice(ht.length-1,1),li--),ou();f.listview("refresh")}st&&(pi(st.toggleClass("ui-btn-icon-right ui-btn-icon-left"),w,li),yu(st))}else if(yt=="List"){for(l=30,ur(),s.addClass("app-no-scrolling").height(""),ke(s),uu(),f=$('<ul class="app-listview app-onecolumnview" data-role="listview"/>').addClass(sc(e)).appendTo(s).listview(),cr=0,ft=et==null?0:et,yr(f),kv(e,f),u&&(ft=u.action=="next"?0:h.length-1),ct=ft,lt=ft,st=$('<li data-icon="false" class="dv-item"><a class="ui-btn dv-action-see-all"/><\/li>').appendTo(f),it-=st.outerHeight(),st.remove();ft>=0&&ft<h.length;){var bi=h[ft],pu=w+ft+1,a=$('<li data-icon="false" class="dv-item"/>'),g=$('<a class="ui-btn"/>').appendTo(a).data("data-context",{row:bi.slice(0),pageIndex:0});if(u&&u.action=="prev"&&pr?a.insertBefore(pr):a.appendTo(f),pr=a,rf(e,bi,vi,fi?pu:null,a,g,!0),ft==et&&(oi=bi,g.addClass("app-selected")),f.listview("refresh"),oe(e,bi,a,ki),cr+=a.outerHeight(),cr>=it&&lt-ct>=3){su=!0;break}u?u.action=="next"?(lt++,ft=lt):(ct--,ft--):gt=="up"?(a.insertBefore(vr),vr=a,lt<h.length-1?(gt="down",lt++,ft=lt):(ct--,ft=ct)):gt=="down"?ct>0?(gt="up",ct--,ft=ct):(lt++,ft=lt):(vr=a,ct>0?(ct--,gt="up",ft=ct):(lt++,gt="down",ft=lt))}lt-ct<at&&(gt=="down"||u&&u.action=="next"?lt--:ct++,su&&(g.removeData(),a.remove()),a=$('<li data-icon="false" class="dv-item"/>').appendTo(f),g=pi($("<a/>").appendTo(a).addClass("dv-action-see-all"),w+ct,w+lt),f.listview("refresh"),g.toggleClass("ui-btn-icon-left ui-btn-icon-right"))}else{if(l=30,ur(),ot=h.length,f=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').hide().appendTo(s),a=$('<li data-icon="false" class="dv-item"/>').appendTo(f),g=$('<a class="ui-btn"/>').appendTo(a),uu(),rf(e,h[0],vi,fi?1:null,a,g),f.listview().show(),ii=a.outerHeight(!0),ai=Math.floor(s.innerWidth()/a.outerWidth(!0)),l=Math.floor(it/ii),l<1&&(l=1),f=ni.find(".app-echo-container-see-all").hide(),at>ot&&(ni.show(),f.length?(f.show(),g=f.find(".ui-btn")):(f=$('<div class="app-echo-container-see-all"><\/div>'),ri?f.insertBefore(ni.find(".app-bar-aggregate-list")):f.appendTo(ni),g=$('<a class="ui-btn-icon-left ui-btn-icon-right ui-btn dv-action-see-all"/>').appendTo(f)),st=pi(g,w,w+ot-1),it-=f.outerHeight(!0),o||(it-=8),l=Math.floor(it/ii),l<1&&(l=1)),ai*l>=h.length&&(l=Math.ceil(h.length/ai),s.addClass("app-no-scrolling")),at>ot&&ai*l>=ot&&s.addClass("app-no-scrolling"),s.is(".app-no-scrolling")||(s.addClass("app-horizontal-scrolling"),o||(l=Math.floor(it/ii),l<1&&(l=1))),ke(s),$(h).each(function(n){if(n>=ot)return!1;f&&n%l!=0||(f=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').addClass(sc(e)).appendTo(s),bv(e,f),kv(e,f));var t=this,u=w+n+1,i=$('<li data-icon="false" class="dv-item"/>').appendTo(f),r=$('<a class="ui-btn"/>').appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});rf(e,t,vi,fi?u:null,i,r);n==et&&(oi=t,r.addClass("app-selected"));oe(e,t,i,ki)}),ot>l&&(wr=l-ot%l,wr<l))while(wr-->0)a=$('<li data-icon="false" class="dv-item"/>').appendTo(f),g=$("<a/>").appendTo(a),rf(e,h[0],vi,fi?1:null,a,g),g.css("visibility","hidden").parent().addClass("app-hidden");l==at&&f.addClass("app-list-one-column");yr(s.find(".app-listview").listview());f=s.find(".app-listview").first();f.length&&!o&&s.height(f.height()+tt.height+8);g=s.find(".app-selected");g.length&&(gr=g.offset().left-s.offset().left+g.outerWidth(),gr>s.width()&&(ei=g.offset().left-s.offset().left-(s.width()-g.outerWidth())/2));u&&(u.action=="next"?ei=0:(f=s.find(".app-listview").last(),ei=f.offset().left+f.outerWidth()-s.offset().left));s.scrollLeft(ei);st&&pi(st,w,w+ot-1)}}else $('<div class="app-echo-empty"><\/div>').appendTo(s.height("")).text(wi.NoRecords);ci||(d.prev().is(".app-echo")||d.next().is(".app-echo")||d.css("padding-bottom",0),bk(rt,kt),(rt.scrollTop()||tu&&kt.first().prev().offset().top+kt.first().prev().height()>rt.offset().top+rt.height())&&rt.css("overflow",""));rr||(tr?oi||u?e.rowIsSelected(v.commandRow())||(v.clearSelection(),v.tap(oi,"none")):v.clearSelection():v.commandRow()&&v.clearSelection());br.css("visibility",at==0?"hidden":"");cs(e,d,tr,au,kr,br);ci&&lr(rt);ir=nt();ir.length&&!nr&&ir.offset().top>d.offset().top?rt.scrollTop(hu+d.outerHeight()-cu):nu(rt,null,!0);e.get_searchOnStart()&&i.search("show",e._id)}}function cs(n,t,i,r,u,f){if(i==null&&(i=n.get_selectedKey().length>0),!r){if(t||(t=fs(n)),!t.length)return;r=t.find(".app-echo-toolbar .app-echo-controls");u=r.parent().find("h3");f=r.next()}var e=u.next().css("visibility",""),o=e.offset().left+e.outerWidth(),s=f.offset().left-16;dd(n,r,o,s)}function dd(t,i,r,u,f,e){function v(n){return n.offset().left+n.outerWidth()>d+p-1}var b=[],y=[],k,d,p,s=[],w=[],l,a={},o,h,c;if(r==0||u==0)i.addClass("app-stale");else if(u-r>=28){if(i.find(".ui-btn").data("data-context",null),i.hide().contents().remove(),k=n.contextScope(),n.contextScope(t._id),t.extension().context(b,["ActionBar"]),n.contextScope(k),$(b).each(function(){var n=this;n.system?n.icon!="search"||f||y.push(n):n.text&&!n.isStatic&&y.push(n)}),$(y).each(function(){var r=this,n,t=r.icon,u;l=r.group;e&&t==e||(n=$('<a class="ui-btn"/>').appendTo(i).data("data-context",r).attr("title",ta(r)),t=="dots"||r.transition?n.addClass("app-has-children ui-mini").text(r.text):(n.addClass("ui-mini ui-btn-icon-left"),t=="search"?n.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):n.text(r.text),t=ro(t),u=ic(t),u&&et(t,n),t==!1&&n.removeClass("ui-btn-icon-left"),o=a[l],o||(o=a[l]=[]),o.push(n)))}),p=u-r,i.width(p).show(),d=i.offset().left,i.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&w.push(n);v(n)&&s.push(n)}),s.length)for(w.reverse();s.length;){if(h=s[0],c=v(h),c&&(isGeneric=h.is(".ui-icon-carat-r"),isGeneric?s.push(h):h.is(".ui-btn-icon-left")&&(h.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h)),!isGeneric&&c&&$(w).each(function(){var n=this;if(s.indexOf(n)==-1&&n.is(".ui-btn-icon-left")&&(n.is(".ui-icon-carat-r")?n.hide():n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h),!c))return!1}),c)){$(s).each(function(){this.hide()});break}s.splice(0,1)}else for(l in a)o=a[l],o.length>1&&($(o).each(function(){$(this).addClass("app-group-item")}),o[0].addClass("app-group-first"),o[o.length-1].addClass("app-group-last"));$('<a class="ui-btn ui-btn-icon-notext ui-corner-all"/>').appendTo(i).css("visibility","hidden")}else i.hide()}function trt(n,t){var i=$('<div class="app-bar-actions ui-header ui-bar-inherit ui-header-fixed"><\/div>').insertBefore(t),u=$("<h3/>").appendTo(i).text(c(n).text),r;return $('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots app-btn-more"/>').appendTo(i),r=$('<div class="app-bar-controls"><\/div>').appendTo(i),i.data({selector:u,controls:r}),i}function irt(){var n=lt||rt;return n==!0}function cu(n,t){var i;if(lt||rt||ut.dragged())return!1;if(nr)if(i=$(n).closest("a"),i.data("scroll-check")==!0)i.data("scroll-check",!1);else{kf=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),f=r.scrollTop();return u&&uc()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");f==r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(cu(i,t),gt())},10),!1)}return!0}function bt(t,i,r){function u(){var u,f;if(rt||g&&g.data("busy"))bt(t,dt,r);else{if(oo=null,u=y(),u.is(".app-page-modal")){f=[];n.navContext(f);n.refreshAppButtons(f,{toolbar:!1,actionBar:!0,promo:!0,buttonBars:u.find(".app-bar-buttons")});return}var e=wt(),i=us(),o=i.data("page-id"),s=n.contextScope();o==e&&iv(i);n.contextScope(null);i.find(".app-show-request").removeClass("app-show-request").show().trigger("show.sidebar.app");i.find(".app-hide-request").removeClass("app-hide-request").hide().trigger("hide.sidebar.app");n.refreshTitleState();n.refreshContextMenu(i.data("page-id",e));n.contextScope(s);n.refreshMenuStrip();r&&r()}}stt||(i==null&&(i=htt),oo&&(clearTimeout(oo),oo=null),t||(i?oo=setTimeout(u,i):u()))}function gd(n,t){if(arguments.length==1)return i.cache[n];i.cache[n]=t}function lu(n,t){var i=location.pathname,r;if($app.host&&(r=i.match(/apps\/(.+?)\/(.+?)(\.html)?$/),r&&(i=r[2])),n=i.replace(/\W/g,"_").toLowerCase()+"_"+n,arguments.length==1)return ct(n);ct(n,t)}function ct(n,t){if(il||(il=kt.appInfo.replace(/\W/g,"_")),$app.host||(n=il+"_"+n),arguments.length==1){try{return t=i.storage.get(n),t!=null&&(t=JSON.parse(t)),t}catch(r){}return null}if(t==null)i.storage.remove(n);else try{i.storage.set(n,JSON.stringify(t))}catch(r){}}function ng(n,t){var u={text:t,resolved:!0,description:null,type:null},r=n.attr("data-activator"),o,f,s,h=$(n).prev(".DataViewHeader").text(),e;return r||(s=n.closest("div[data-activator]"),r=s.attr("data-activator"),n=s),r&&(o=n.parent(),f=o.attr("id"),f||(f="aid"+ott++,o.attr("id",f)),u.container=f),r||(r=h),r&&r!="false"?(r=i.eval(r),e=vn.exec(r),e?(u.text=e[4]||e[2],u.type=e[1]):u.text=r):u.resolved=!1,u.description=n.attr("data-activator-description"),u}function yv(n,t){return wv(n,t,"call",bn)}function pv(n,t){return wv(n,t,"email",kn)}function rrt(n,t){return wv(n,t,"url",dn)}function wv(n,t,i,r){var u=r&&n.Name.match(r);return t?!n.tagged("action-"+i+"-disabled")&&(n.tagged("action-"+i)||u):n.tagged("action-"+i,"field-"+i)||u}function bv(n,t){n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard")?t.addClass("app-thumb-person"):t.removeClass("app-thumb-person")}function kv(n,t){n.get_showMultipleSelection()?t.addClass("app-listview-multiselect"):t.removeClass("app-listview-multiselect")}function vc(n,t,i){n.data("scrolling",!0).animate({scrollTop:t},"swing",function(){rt=!1;i&&i();setTimeout(function(){n.removeData("scrolling")},100)})}function tg(t,i,r){var u,e,o;if(r||(r={}),u=$(t),e=r.position||"right",ni(),bf=null,u.length)o=u.find("ul"),!u.is(".ui-panel-open")&&o.length>1&&(o.first().parent().css({transition:"none",transform:"none"}).removeClass("app-list-container-reverse"),o.slice(1).remove());else{u=$(String.format('<div data-position-fixed="true" data-role="panel" data-draggable="panel" data-theme="a" data-display="overlay" class="app-popup-icon-left ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-{0}"><ul/><\/div>',e)).appendTo(s).panel({animate:fc(),position:e,beforeopen:function(){if(ai()?u.css({top:f.top,height:f.height,minHeight:f.height,right:e=="right"?f.right:"",left:e=="right"?"":f.left}):u.css({top:"",height:"",minHeight:"",right:""}),tt.width){var n=u.find(".ui-panel-inner").css({width:"","overflow-y":"scroll"});n.width(n.width()+tt.width)}u.find(".ui-panel-inner").attr("tabindex",0);ur(!1);ku=!0;so&&(clearTimeout(so),so=null);i&&i()},open:function(){setTimeout(function(){ku=!1;gt();r&&r.afteropen&&r.afteropen();$(".ui-panel-open .ui-panel-inner").focus();ur(!0)})},beforeclose:function(){ur(!1);ku=!0;iv(u)},close:function(){setTimeout(function(){u.css("visibility","");ur(!0);ku=!1;bf&&bf();n.contextScope()&&(so=setTimeout(function(){n.contextScope(null);so=null},1e3));bf=null;sr();r&&r.close&&r.close()})}});fc(u);r.className&&u.addClass(r.className);wk(u);t.match(/^#/)&&u.attr("id",t.substring(1));u.find("ul").listview();u.on("vclick",function(n){var t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(ku||!t.length||!cu(t))return!1;if(i=t.data("context-action"),i&&!yp){if(i.dataRel)return!0;i.feedback==!1?(gt(),i.keepOpen==!0||i.transition?(rr(i,t,!0),nv(t)):(u.panel("close",r!="dots"&&r!=ot),bf=function(){setTimeout(function(){rr(i,t)},10)})):i.keepOpen==!0||i.transition?it(t,function(){rr(i,t,!0);nv(t)}):it(t,function(){var n,f,o,e;i.icon==ot&&(n=t.closest(".ui-panel-inner").find("ul"),f=n.first());n&&n.length>1?(ur(!1),o=f.parent().addClass("app-list-container-reverse").css({transition:"",transform:"translate3d("+-(-p(f,"margin-right")+f.closest(".ui-panel").outerWidth()*(n.length-2))+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){n.last().remove();o.removeClass("app-list-container-reverse");kk($(n[n.length-2]).find(".app-focus"));ur(!0)})})):(e=t.attr("href"),e?v.location.href=e:(u.panel("close",r!="dots"&&r!=ot),bf=function(){setTimeout(function(){rr(i,t)},fc()?10:dt)}))})}return yp=!1,!1}).on("swipe",function(){});po(u,!1);r&&r.resetScrolling&&u.addClass("app-reset-scrolling")}return u}function au(){n.contextScope()=="_contextMenu"?n._menuPanel.panel("toggle"):n.toggleContextPanel("#app-panel-context")}function vu(t){return n.stickyHeaderBar(t)}function no(t){t!=null?(clearTimeout(wp),wp=setTimeout(function(){n.fetchOnDemand()},t)):n.fetchOnDemand()}function ru(t){n.stickyHeader(t)}function urt(n){vu(n).hide()}function frt(n){urt(n);ru(n)}function ft(t,i,r){var u=$(".ui-panel-open"),s,f,e,c,l,o,h;if(u.length){ur(!1);f=u.find(".ui-panel-inner").addClass("app-multi-list");e=f.find(".app-list-container");e.length||(f.contents().wrap('<div class="app-list-container"><\/div>'),e=f.find(".app-list-container"));s=u.outerWidth();h='[data-panel="'+i+'"]';o=f.find(h);o.length||(o=$("<ul/>").attr("data-panel",i).appendTo(e).listview());c=u.find("ul").width(s);l=c.first();yt=t;n.refreshContextMenu(u,yt,h);e.css({transition:"",transform:"translate3d("+-(-p(l,"margin-right")+s*o.prevAll("ul").length)+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){o.nextAll("ul").remove();r&&r.afteropen&&r.afteropen();ur(!0);$(".ui-panel-open .ui-panel-inner").focus()})})}else return yt=t,(n.contextScope()&&(!r||r.position!="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),tg(i,function(){n.refreshContextMenu(i,yt)},r).panel("toggle")}function dv(n){var r=new Sys.StringBuilder,o=n._fields,i,f,u=n.get_sortExpression(),e=ds,t;if(u)for(t=e.exec(u);t;)i=n.findField(t[1]),f=!t[3]||t[3].match(/^asc/)?"asc":"desc",i&&i.AllowSorting&&(r.isEmpty()||r.append(", "),r.appendFormat("{0} ({1})",i.HeaderText,sf(i,f))),t=e.exec(u);return r.toString()}function gv(n){var i=new Sys.StringBuilder,o=n._fields,r,e,u=n.get_groupExpression(),f=ds,t;if(u)for(t=f.exec(u);t;)r=n.findField(t[1]),e=!t[3]||t[3].match(/^asc/)?"asc":"desc",r&&r.AllowSorting&&(i.isEmpty()||i.append(", "),i.appendFormat("{0}",r.HeaderText)),t=f.exec(u);return i.toString()}function to(n){n.extension()._instructed=!1;c(n).stickyHeader.find(".app-bar-text").removeData("html")}function ny(t,u){var h=t.groupExpression(),f=t.get_sortExpression(),o,e=0,s;if(h&&f){for(f=f.split(i._simpleListRegex);e<f.length;)o=f[e].match(/(\w+)(\s+\w+)?/),!f[e]||o&&h.indexOf(o[1])!=-1?f.splice(e,1):e++;f=f.join(",");t.set_sortExpression(f);t.viewProp("sortExpression",f)}t.viewProp("groupExpression",u);t.set_groupExpression(u);to(t);t._keepKeyList=!0;t.AutoPivots=null;ls(t);s=gv(t);n.notify({dataView:t,text:s?r.Grouped+" - "+s:r.UnGrouped});t.sync()}function ty(n){n.session("reset-grid-header",!0)}function ls(n){$(n._views).each(function(){var i=this,t=i.Id;i.Type!="Form"&&(n.session("grid-style-changed",!0,t),n.session("grid-avail-width",null,t),n.session("window-width",null,t))})}function yc(){var t=n.contextDataView(),i;ki!=null&&(t.set_sortExpression(ki),ki=null,to(t),t._keepKeyList=!0,ty(t),i=dv(t)||"",n.notify({dataView:t,text:i?r.Sorted+" - "+i:r.SortedDefault}),t.sync())}function yu(n,t,r){var e=ki==null?n.get_sortExpression()||"":ki,o=e.split(i._simpleListRegex),u,f;if(r==null){if(e)for(u=0;u<o.length;u++)if(f=o[u].match(gn),f&&f[1]==t)return f[3]||"asc";return null}ki=r?String.format("{0} {1}",t,r):"";n.viewProp("sortExpression",ki)}function sf(n,t){var i=bi.GenericSortAscending,r=bi.GenericSortDescending;switch(n.FilterType){case"Text":i=bi.StringSortAscending;r=bi.StringSortDescending;break;case"Date":i=bi.DateSortAscending;r=bi.DateSortDescending}return t=="asc"?i:r}function oi(n,t){yt=n;t?setTimeout(t,500):vs()}function ert(n,t){var s=$app.find(n),u=s._controller,f="",l=t.closest("ul").find(".app-layout-size").filter(function(){return $(this).find(".app-icon").length>0}),e=s._survey,i,h,r,o;if(e&&e.layout?(u=u.replace(/__search/,"._search"),f+=String.format("<!--\r\n\t~/js/surveys/{0}.html\r\n-->\r\n{1}",u,e.layout)):(u+="."+s._viewId,l.each(function(){var n=$(this).data("context-action");f+="\r\n<!--  "+n.text+" -->\r\n";f+=eb(s,pt(n.context));f+="\r\n"}),f=String.format("<!--\r\n\t~/views/{0}.html\r\n-->\r\n{1}",u,f.replace(/<span\s+class=\"app-control-inner\">([\s\S]+?)<\/span>/g,"$1").replace(/\n\s*>/g,">"))),hv(u+".html.txt",f,"text/plain"),e){i=JSON.stringify(e);i=JSON.parse(i);i.text&&typeof i.text!="string"&&(i.text=i.text[0]);for(h in i)["options","text","text2","topics","controller",].indexOf(h)==-1&&delete i[h];i.layout="#ref";i.cache=!1;r=[];o="    ";function c(n,t){for(var s,u="",i="",f=[],e=0;e<t;e++)i+=o;for(s in n)f.push(s);f.forEach(function(e,s){u=i+e+": ";var h=n[e],l=s==f.length-1?"":",";h!=null&&h instanceof Array?(u+="[",r.push(u),h.forEach(function(n,u){var f=u==h.length-1?"":",";typeof n=="object"?(r.push(i+o+"{"),c(n,t+2),r.push(i+o+"}"+f)):r.push(i+o+JSON.stringify(n)+f)}),r.push(i+"]"+l)):typeof h=="object"?(u+="{",r.push(u),c(h,t+1),r.push(i+"}"+l)):r.push(u+JSON.stringify(h)+l)})}c(i,1);i=String.format("//\r\n//\t~/js/surveys/{0}.js\r\n//\r\n({{\r\n{1}\r\n}})();",u,r.join("\r\n"));hv(u+".js.txt",i,"text/plain")}}function ort(){function i(n){var t=ti&&(ti.height==null||ti.width<ti.height)?"Portrait":"Landscape";ti=JSON.parse(JSON.stringify(n));n.width==null?f.isVirtual=!1:(f.isVirtual=!0,t=="Landscape"?(f.width=n.height,f.height=n.width):(f.width=n.width,f.height=n.height),n.width=f.width,n.height=f.height);bl(n);du();gi(!0)}function e(n){if(f.isVirtual){var t=Math.min(ti.width,ti.height),i=Math.max(ti.width,ti.height);f.deviceWidth=null;f.deviceHeight=null;n=="Portrait"?(f.width=t,f.height=i):(f.width=i,f.height=t)}ti.width=f.width;ti.height=f.height;bl(ti);du();gi(!0)}var o=yt,t=ti.name,u=ti&&ti.width>ti.height?"Landscape":"Portrait",n=[{text:r.Back,icon:ot,callback:function(){oi(o)}}];ti.width&&(n.push({text:r.Orientation,instruction:!0}),n.push({text:r.Portrait,icon:u=="Portrait"?"check":!1,context:"Portrait",callback:e}),n.push({text:r.Landscape,icon:u=="Landscape"?"check":!1,context:"Landscape",callback:e}));n.push({text:r.Device,isStatic:!1,instruction:!0});n.push({text:"Responsive",icon:t=="Responsive"?"check":!1,context:{name:"Responsive"},callback:i});n.push({text:"iPhone SE",icon:t=="iPhone SE"?"check":!1,context:{name:"iPhone SE",width:320,height:568},callback:i});n.push({text:"iPhone 7",icon:t=="iPhone 7"?"check":!1,context:{name:"iPhone 7",width:375,height:667},callback:i});n.push({text:"iPhone 7 Plus",icon:t=="iPhone Plus"?"check":!1,context:{name:"iPhone Plus",width:414,height:736},callback:i});n.push({text:"iPad Mini",icon:t=="iPad Mini"?"check":!1,context:{name:"iPad Mini",width:768,height:1024},callback:i});ft(n,"#app-panel-developer-tools-device")}function srt(){function u(n,t){var i=t.find(".app-icon");i.length?(i.remove(),t.removeClass("app-has-material-icon")):et("material-icon-check",t)}var f=yt,t=[{text:r.Back,icon:ot,callback:function(){oi(f)}},{text:wf.FormLayout,isStatic:!1,instruction:!0},],e=n.dataView(),i;t.push({text:r.Download,icon:"material-icon-file-download",context:e._id,keepOpen:!0,callback:ert});i=nf(kr(b()));t.push({text:wf.FormLayoutInstr,instruction:!0});t.push({text:"Tiny (tn)",icon:i=="tn"?"check":!1,keepOpen:!0,context:"tn",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Extra Small (xxs)",icon:i=="xxs"?"check":!1,keepOpen:!0,context:"xxs",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Small (xs)",icon:i=="xs"?"check":!1,keepOpen:!0,context:"xs",linkClassName:"app-layout-size",callback:u});t.push({text:"Small (sm)",icon:i=="sm"?"check":!1,keepOpen:!0,context:"sm",linkClassName:"app-layout-size",callback:u});t.push({text:"Medium (md)",icon:i=="md"?"check":!1,keepOpen:!0,context:"md",linkClassName:"app-layout-size",callback:u});t.push({text:"Large (lg)",icon:i=="lg"?"check":!1,keepOpen:!0,context:"lg",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Large (xl)",icon:i=="xl"?"check":!1,keepOpen:!0,context:"xl",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Extra Large (xxl)",icon:i=="xxl"?"check":!1,keepOpen:!0,context:"xxl",linkClassName:"app-layout-size",callback:u});ft(t,"#app-panel-developer-tools-form-layout")}function hrt(){var u=yt,t=[{text:r.Back,icon:ot,callback:function(){oi(u)}},{text:wf.Tools,isStatic:!1,instruction:!0},],i=n.dataView();t.push({text:wf.Explorer,icon:"material-icon-build",shortcut:"Ctrl+Shift+D",callback:ii});i&&i.get_isForm()&&t.push({text:wf.FormLayout,icon:!1,transition:!0,callback:srt});t.push({text:r.Device,icon:!1,transition:!0,callback:ort});ft(t,"#app-panel-developer-tools")}function crt(){function t(n){n=="OnHover"&&s.addClass("app-show-system-buttons-on-hover");n=="Always"&&s.removeClass("app-show-system-buttons-on-hover");ct("showSystemButtons",n);e("ui.showSystemButtons",n)}var i=yt,u=[{text:r.Back,icon:ot,callback:function(){oi(i)}},{text:r.ShowSystemButtons,isStatic:!1,instruction:!0},{text:r.OnHover,icon:e("ui.showSystemButtons")=="OnHover"||e("ui.showSystemButtons")=="Auto"&&!o?"check":!1,context:"OnHover",callback:t},{text:r.Always,icon:e("ui.showSystemButtons")=="Always"?"check":!1,context:"Always",callback:t},];n.contextScope("_contextMenu");ft(u,"#app-panel-settings-showsystembuttons")}function ig(){function t(t){ck();n.contextScope(null);e("ui.sidebar.when",t);ct("sidebar",t);ns();gi(!0)}var u=yt,i=e("ui.sidebar.when"),f=[{text:r.Back,icon:ot,callback:function(){oi(u)}},{text:r.Sidebar,isStatic:!1,instruction:!0},{text:r.Landscape,icon:i=="Landscape"?"check":!1,context:"Landscape",callback:t},{text:r.Always,icon:i=="Always"?"check":!1,context:"Always",callback:t},{text:r.Never,icon:i=="Never"?"check":!1,context:"Never",callback:t}];n.contextScope("_contextMenu");ft(f,"#app-panel-settings-sidebar")}function iy(n){var n=n.toLowerCase();return n=="tiny"&&(n="condensed app-font-tiny"),"app-density-"+n}function ry(n){return"app-theme-"+n.toLowerCase()}function rg(t,i){var r=kt.ui.theme,u=r.name,f=r.accent;t.theme?r.name=t.theme.name:t.accent&&(r.accent=t.accent.name);i.closest(".ui-panel-inner").find(".app-item-theme-"+(t.theme?"name":"accent")+" i").remove();et("material-icon-check",i);setTimeout(function(){e("ui.theme.name",r.name);e("ui.theme.accent",r.accent);n._changeThemeLink(u+"."+f,r.name+"."+r.accent,function(){u&&s.removeClass(ry(u));s.addClass(ry(r.name));var n=$(".ui-panel-open").css("transition","opacity 500ms");setTimeout(function(){n.css("opacity",0);setTimeout(function(){n.css("opacity","");setTimeout(function(){n.css("transition","")},600)},r.preview||1e3)},32)})},200)}function lrt(){function o(){$(u.themes).each(function(){var n=this;t.push({text:bu.List[n.name]||n.text||n.name,icon:i.name==n.name?"check":!1,keepOpen:!0,context:{theme:n},callback:rg,linkClassName:"app-item-theme-name",color:n.color})});t.push({text:bu.Accent,isStatic:!1,instruction:!0});$(u.accents).each(function(){var n=this;t.push({text:bu.List[n.name]||n.text||n.name,icon:i.accent==n.name?"check":!1,keepOpen:!0,context:{accent:n},callback:rg,linkClassName:"app-item-theme-accent",color:n.color})})}var f=yt,s=e("ui.theme.name"),t=[{text:r.Back,icon:ot,callback:function(){oi(f)}},{text:bu.Label,isStatic:!1,instruction:!0}],i=kt.ui.theme,u=i.config;t.push({text:er,icon:"material-icon-refresh",animate:!0,keepOpen:!0,callback:ii});ft(t,"#app-panel-settings-theme");n.getThemes().done(function(i){u=kt.ui.theme.config=i;var r=$('.ui-panel-open [data-panel="#app-panel-settings-theme"] .ui-btn.app-animated').closest(".ui-panel");r.length&&(t.splice(t.length-1,1),o(),n.refreshContextMenu(r,t,'[data-panel="#app-panel-settings-theme"]'))})}function art(){function i(t){t!=n&&(e("ui.transitions.style",t),ct("transitions",t))}var u=yt,n=e("ui.transitions.style"),t=[{text:r.Back,icon:ot,callback:function(){oi(u)}},{text:r.Transitions.Label,isStatic:!1,instruction:!0},];t.push({text:r.Transitions.List.none,icon:"none"==n?"check":!1,context:"none",callback:i});t.push({text:r.Transitions.List.slide,icon:"slide"==n?"check":!1,context:"slide",callback:i});ft(t,"#app-panel-settings-theme")}function vrt(){var u=yt,n=e("ui.displayDensity.value"),i=[{text:r.Back,icon:ot,callback:function(){oi(u)}},{text:r.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var t in r.DisplayDensity.List)i.push({text:r.DisplayDensity.List[t],icon:t==n?"check":!1,context:t,callback:function(t){t!=n&&(eu.trigger("resize"),s.removeClass(iy(n)),e("ui.displayDensity.value",t),s.addClass(iy(t)),ui(),ct("displayDensity",t),te=null,gi())}});ft(i,"#app-panel-settings-display-density")}function yrt(){var t=yt,f=e("ui.list.labels.display"),u=[{text:r.Back,icon:ot,callback:function(){oi(t)}},{text:r.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in r.LabelsInList.List)u.push({text:r.LabelsInList.List[n],icon:n==f?"check":!1,context:n,callback:function(n){e("ui.list.labels.display",n);ct("labelsInList",n);i.confirm(r.ConfirmReload,function(){va()},function(){oi(t)})}});ft(u,"#app-panel-settings-labels-in-form")}function ug(){function u(n){e("ui.actions.promote",n);ct("promoteActions",n);bt();oi(t,ug)}var t=yt,i=e("ui.actions.promote"),n=[{text:r.Back,icon:ot,callback:function(){oi(t)}},{text:r.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:ih,icon:i!=!1?"check":!1,context:!0,callback:u});n.push({text:th,icon:i==!1?"check":!1,context:!1,callback:u});ft(n,"#app-panel-promote-actions")}function prt(){var t=yt,f=e("ui.list.initialMode"),u=[{text:r.Back,icon:ot,callback:function(){oi(t)}},{text:r.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in r.InitialListMode.List)u.push({text:r.InitialListMode.List[n],icon:n==f?"check":!1,context:n,callback:function(n){ct("initialListMode",n);i.confirm(r.ConfirmReload,function(){va()},function(){oi(t)})}});ft(u,"#app-panel-settings-default-list-mode")}function wrt(){function f(n){e("ui.smartDates",n);ct("smartDates",n);i.confirm(r.ConfirmReload,function(){va()},function(){oi(t)})}var t=yt,u=e("ui.smartDates"),n=[{text:r.Back,icon:ot,callback:function(){oi(t)}},{text:r.Dates.SmartDates,isStatic:!1,instruction:!0},];n.push({text:ih,icon:u!=!1?"check":!1,context:!0,callback:f});n.push({text:th,icon:u==!1?"check":!1,context:!1,callback:f});ft(n,"#app-panel-smart-dates")}function brt(){function u(n){n.selected||Web.Membership._instance.changeCulture(n.value)}var t=yt,n=[{text:r.Back,icon:ot,callback:function(){oi(t)}},{text:wr.ChangeLanguageToolTip,isStatic:!1,instruction:!0},];$(i.cultureList).each(function(){var t=this;n.push({text:t.text,icon:!1,selected:t.selected,context:t,keepOpen:t.selected,callback:u})});ft(n,"#app-panel-languages")}function as(){return f.width>=pt("md")}function krt(){vs("left")}function vs(n){var t=[],f,u;n||t.push({text:r.Back,icon:ot,callback:au});t.push({text:r.Settings});st("settings.options.displayDensity")&&t.push({text:r.DisplayDensity.Label,icon:"material-icon-blur-on",transition:!0,callback:vrt,desc:r.DisplayDensity.List[e("ui.displayDensity.value")]});st("settings.options.theme")&&(f=e("ui.theme.name"),u=e("ui.theme.accent"),t.push({text:bu.Label,icon:"material-icon-brush",transition:!0,callback:lrt,desc:(bu.List[f]||i.prettyText(f))+(u=="None"?"":" "+(bu.List[u]||i.prettyText(u)))}));st("settings.options.transitions")&&t.push({text:r.Transitions.Label,icon:"material-icon-swap-horiz",transition:!0,callback:art,desc:r.Transitions.List[e("ui.transitions.style")]});st("settings.options.sidebar")&&as()&&t.push({text:r.Sidebar,icon:"material-icon-view-quilt",transition:!0,callback:ig,desc:e("ui.sidebar.when")=="Landscape"?r.Landscape:e("ui.sidebar.when")=="Always"?r.Always:r.Never});st("settings.options.labelsInList")&&t.push({text:r.LabelsInList.Label,icon:"material-icon-text-format",transition:!0,callback:yrt,desc:r.LabelsInList.List[e("ui.list.labels.display")]});st("settings.options.showSystemButtons")&&!o&&t.push({text:r.ShowSystemButtons,icon:"material-icon-more-"+(tr?"vert":"horiz"),transition:!0,callback:crt,desc:e("ui.showSystemButtons")=="OnHover"||e("ui.showSystemButtons")=="Auto"&&!o?r.OnHover:r.Always});st("settings.options.promoteActions")&&t.push({text:r.PromoteActions,icon:"material-icon-add-circle",transition:!0,callback:ug,desc:st("ui.actions.promote")?ih:th});st("settings.options.smartDates")&&t.push({text:r.Dates.SmartDates,icon:"material-icon-event",transition:!0,callback:wrt,desc:e("ui.smartDates")!=!1?ih:th});st("settings.options.initialListMode")&&t.push({text:r.InitialListMode.Label,icon:"material-icon-list",transition:!0,callback:prt,desc:r.InitialListMode.List[e("ui.list.initialMode")]});$(i.cultureList).each(function(){var n=this;if(n.selected)return t.push({text:n.text,icon:"material-icon-language",transition:!0,callback:brt}),!1});ft(t,"#app-panel-settings",n?{position:n}:null)}function uy(t){function p(n){var t=0;return n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&(t=n.index)}),t}function w(n,t){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&n.index--})}function b(n){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this),t=n.data("context-action").context;n.find(".ui-li-count").remove();t.index&&$('<span class="ui-li-count ui-body-inherit"/>').appendTo(n).text(t.index)})}var u=n.contextDataView(),i=u.get_groupExpression(),l=u.get_view().Label,a=u._fields,v=u._allFields,s=[],f=[],h,e,y=1,c,o={};if(t||f.push({text:r.Back,icon:ot,callback:au}),i&&f.push({text:r.GroupedBy+" "+gv(u)+"."},{text:fl,icon:"delete",callback:function(){ny(u,null)}}),f.push({},{text:r.Apply,icon:"material-icon-check",callback:function(n,t){var r=[];$(t).closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&r.push(n)});r.sort(function(n,t){return n.index-t.index});i="";$(r).each(function(){var n=this;i&&(i+=",");i+=n.field});ny(u,i)}},{text:String.format(r.GroupByField,l)}),i)for(h=ds,e=h.exec(i);e;)c=u.findField(e[1]),c&&(o[c.Name]={field:e[1],index:y++}),e=h.exec(i);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&s.push(n)});s.sort(function(n,t){var i=o[n.Name],r=o[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(s).each(function(){var t=this,n;n=o[t.Name];f.push({text:t.HeaderText,keepOpen:!0,icon:!1,context:n||{field:t.Name},count:n?n.index:null,callback:function(n,t){n.index?(w(t,n.index),n.index=null):n.index=p(t)+1;b(t)}})});ft(f,"#app-panel-group-fields")}function drt(){function c(n){var t,r=0;$(i).each(function(){var i=this,r=i.context;if(r&&r.field==n.field)return t=i,!1});n.order?(t.context.order||($(i).each(function(){var n=this.context;n&&n.index>r&&(r=n.index)}),t.context.index=r+1,t.count=r+1),t.icon=n.order=="asc"?"arrow-u":"arrow-d",t.context.order=n.order):($(i).each(function(){var i=this,n=i.context;n&&n.index>t.context.index&&(i.count--,n.index--)}),t.context.order=null,t.context.index=null,t.count=null,t.icon=!1);ft(i,"#app-panel-sort-fields")}var t=n.contextDataView(),f=t.get_sortExpression(),l=t.get_view().Label,a=t._fields,v=t._allFields,o=[],i=[{text:r.Back,icon:ot,callback:au}],s,u,y=1,h,e={};if(f&&i.push({text:dv(t)},{text:fl,icon:"delete",callback:function(){ki="";t.viewProp("sortExpression",ki);yc()}}),i.push({text:r.Apply,icon:"material-icon-check",callback:function(n,i){var r=[];$(i).closest("ul").find(".ui-btn").each(function(){var n=$(this).data("context-action").context;n&&n.order&&r.push(n)});r.sort(function(n,t){return n.index-t.index});ki="";$(r).each(function(){var n=this;ki&&(ki+=",");ki+=n.field+" "+n.order});t.viewProp("sortExpression",ki);yc()}},{text:String.format(r.SortByField,l)}),f)for(s=ds,u=s.exec(f);u;)h=t.findField(u[1]),h&&(e[h.Name]={field:u[1],index:y++,order:u[3]&&u[3].match(/^desc/i)?"desc":"asc"}),u=s.exec(f);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&o.push(n)});o.sort(function(n,t){var i=e[n.Name],r=e[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(o).each(function(){var u=this,n,f=t.groupExpression();n=e[u.Name];i.push({text:u.HeaderText,icon:n?n.order=="asc"?"arrow-u":"arrow-d":!1,context:n||{field:u.Name},count:n?n.index:null,transition:!0,callback:function(n){var u=t.findField(n.field),e=[{text:r.Back,icon:ot,callback:function(){ft(i,"#app-panel-sort-fields")}},{text:String.format(r.SortByOptions,t.get_view().Label,u.HeaderText)},{text:sf(u,"asc"),icon:n.order=="asc"?"check":!1,transition:!0,reverse:!0,context:{order:"asc",field:n.field},callback:c},{text:sf(u,"desc"),icon:n.order=="desc"?"check":!1,transition:!0,reverse:!0,context:{order:"desc",field:n.field},callback:c}];f&&f.indexOf(n.field)!=-1||e.splice(2,0,{text:r.None,icon:n.order?!1:"check",transition:!0,reverse:!0,context:{field:n.field},callback:c});ft(e,"#app-panel-sort-field-options")}})});ft(i,"#app-panel-sort-fields")}function grt(n){var t=n.find(".app-group"),i=t.length?t.first().outerHeight(!0):0;return t.remove(),i}function nut(n,t){var r=n.groupExpression(),o=[],v=n.get_showFirstLetters()&&!r,s,i=0,u,f,e,c,l,h,a;if(r){while(i<r.length)s=n.findField(r[i]),s?r[i++]=n._allFields[s.AliasIndex]:r.splice(i,1);t.find("li a").each(function(){var s=$(this),k=s.data("data-context"),t=[],y=[],p=[],w,b=[],d,n,g;k?($(r).each(function(l){var it=this,nt=k.row[it.Index],a,rt,tt,ft,ut;if(nt!=null&&(a=v?nt.substring(0,1):it.text(nt)),t.push(a),y.push(it.HeaderText),p.push(it.Type),b.push(nt),o.length&&o[l]==a||(o[l]=a,d=!0),d&&l==r.length-1){for(u&&($('<span class="app-group-count"/>').appendTo(u).text(f+(h?"+":"")),h=!1),n=$('<li class="app-group"/>').insertBefore(s.parent()),$('<span class="glyphicon glyphicon-menu-up"/>').appendTo(n),tt=null,rt=null,w=p[p.length-1].match(/^Date/),nt!=null&&p.length==1&&w&&(nt=b[b.length-1],rt=uu.DayNames[nt.getDay()]+" "+nt.getDate(),tt=uu.MonthNames[nt.getMonth()],ft=nt.getFullYear()),tt&&(e=$('<span class="app-group-info"/>').appendTo(n),$('<span class="app-group-info-value"/>').appendTo(e).text(tt),$('<span class="app-group-info-value-muted"/>').appendTo(e).text(ft),c!=tt?c=tt:e.addClass("app-group-info-duplicate")),w&&n.addClass("app-group-fixed"),f=0,i=0;i<t.length-1;)ut||(ut=$('<span class="app-group-path"/>').appendTo(n)),g=$('<span class="app-group-path-value"/>').appendTo(ut),a=t[i],a||(a=bi.BlankValue),g.text(a).attr("title",y[i]+":\n"+a),i++;a=rt||t[t.length-1];u=$('<span class="app-group-title"/>').appendTo(n).text(a);a||(a=bi.BlankValue);u.text(a).attr("data-text",a).attr("title",y[y.length-1]+":\n"+a)}}),f++):s.is(".dv-load-at-bottom")?a=!0:!l&&s.is(".dv-load-at-top")&&(h=!0,l=!0)});u&&$('<span class="app-group-count"/>').appendTo(u).text(f+(a?"+":""))}}function tut(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length||ce(n).length}function fg(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function iut(n){var t=n.is(".app-include");n.find(".app-icon").text(t?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",t).toggleClass("material-icon-check-box-outline-blank",!t)}function rut(n,t){var f=fy(t),u=ey(t),r,i;t.toggleClass("app-include");r=u.filter(".app-include").length;i=u.length==r;iut(t);f.find(".app-icon").text(i?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",i).toggleClass("material-icon-check-box-outline-blank",!i);fg(r>0)}function fy(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function ey(n){return fy(n).parent().nextAll().find("a")}function uut(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function fut(n,t){var r=i.find(n.dataViewId),u=n.field,e=r.findField(u),o=r._allFields[e.AliasIndex],f=eg(r,u,t);r.removeFromFilter(o);f&&r._filter.push(f);le(r)}function eg(n,t,i){function s(t){r=[];o.each(function(){var i=$(this),u=i.is(".app-include");(u&&t||!u&&!t)&&r.push(n.convertFieldValueToString(f,f._listOfValues[uut(i).context]))})}var f=n.findField(t),h=n._allFields[f.AliasIndex],u=[],r,e,o=ey(i);return o.filter(":not(.app-include)").length&&(s(!0),r.length&&(u.push(h.Name+":"),r.length==1?u.push("="+r[0]):(e=r.length<=10||r.length<=r.length/2,u.push(e?"$in$":"$notin$"),e||s(!1),$(r).each(function(n){n>0&&u.push("$or$");u.push(this)})))),u.join("")}function hf(t){function s(n,t,f){var e=n._dataView,o=e._allFields[n.AliasIndex],s=e.get_fieldFilter(o,!0);u||(t.push({text:r.Back,icon:ot,callback:l}),t.push({text:o.HeaderText}));t.push({});s&&t.push({text:fl,context:o.Name,callback:function(){e.removeFromFilter(o);le(e)},icon:"material-icon-clear"});t.push({text:wi.Filters[o.FilterType].Text,context:{id:e._id,field:e._allFields[n.OriginalIndex].Name},desc:s!="$in"&&s!="$notin"?f:null,callback:function(n){i.search("show",n)},transition:!1,icon:"material-icon-filter-list"});u||t.push({text:String.format(r.FilterByOptions,e.get_view().Label,o.HeaderText,r.Apply)})}function h(n,t){var e,i,y,u=n._dataView,c=n._listOfValues||[],l=u._allFields[n.AliasIndex],s=u.get_fieldFilter(l,!0),a=[],p,v,o,f,h=s=="$notin";for(s&&(s=="="||s=="$in"||h)&&(v=(u.get_fieldFilter(l)||"").split(/\$or\$/)),p={text:r.Apply,icon:"material-icon-check",disabled:!0,itemClassName:"app-btn-apply",context:{dataViewId:u._id,mappedId:u._mappedId,field:n.Name},callback:fut},t.push(p,{}),c.length>1&&t.push({text:ul.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:"material-icon-check-box-outline-blank",callback:function(n,t){var r=ey(t),i=r.filter(".app-include").length==r.length;fy(t).find(".app-icon").text(i?"check_box_outline_blank":"check_box").toggleClass("material-icon-check-box",!i).toggleClass("material-icon-check-box-outline-blank",i);i?r.removeClass("app-include").find(".app-icon").text("check_box_outline_blank").removeClass("material-icon-check-box").addClass("material-icon-check-box-outline-blank"):r.addClass("app-include").find(".app-icon").text("check_box").addClass("material-icon-check-box").removeClass("material-icon-check-box-outline-blank");fg(!i)}}),e=0;e<c.length;e++)i=c[e],f=v&&v.indexOf(u.convertFieldValueToString(n,i))!=-1,h&&(f=!f),y=i==null?bi.EmptyValue:typeof i=="string"&&i==""?bi.BlankValue:l.text(i),o={text:y,icon:"material-icon-"+(f?"check-box":"check-box-outline-blank"),keepOpen:!0,context:e,callback:rut,linkClassName:f?"app-include":""},f?h?a.push(o):t.push(o):h?t.push(o):a.push(o);return t.concat(a)}function c(t,r){var u=[],e=n.contextDataView(),f=e.findField(t),a=e._allFields[f.AliasIndex],c=$(r).data("contextAction"),l=c?c.desc:null;s(a,u,l);o&&u.splice(0,1);f._listOfValues&&f._listOfValues.length?u=h(f,u):u.push({text:er,icon:"material-icon-refresh",animate:!0,context:{id:e._id,field:t},keepOpen:!0,callback:ii});ft(u,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var f=wb().data("context-action"),u=f&&f.context,r,e,t;u&&(r=i.find(u.id),t=r.findField(u.field),e=r._allFields,r._loadListOfValues(null,t.Name,e[t.AliasIndex].Name,function(){var u=wb(),f=u.length&&u.data("context-action").context,i=[];u.length&&f.id==r._id&&f.field==t.Name&&(s(t,i,l),o&&i.splice(0,1),i=h(t,i),n.refreshContextMenu(u.closest(".ui-panel"),i,'[data-panel="#app-panel-filter-field"]'))}))}})}function l(){var t=n.contextDataView(),u=e?[]:[{text:r.Back,icon:ot,callback:au}],f={},o=t&&t._filter;if(tut(t)){if(e&&ce(t).length){if(!t._filter.length){i.search();return}u.push({text:fk(t)});u.push({text:vf.ShowAdvancedSearch,icon:"search",toolbar:!1,system:!0,context:{dataViewId:t._id},callback:kb})}t._filter.length&&(u.push({text:t.extension().filterStatus(!1,!0)}),u.push({text:r.ClearFilter,icon:"delete",callback:function(){var t=n.contextDataView();pa(t,!0)}}))}u.push({text:String.format(r.FilterByField,t.get_view().Label)});$(t._filter).each(function(){var n=this,t=n.match(/^\w+/);t&&(f[t[0]]=n)});$(t._externalFilter).each(function(){f[this.Name]=null});$(t._fields).each(function(){var e=this,i,r,n;i=t._allFields[e.AliasIndex];r=f[i.Name];r&&(t._filter=[r],n=t.extension().filterStatus(!0,!0),n.indexOf(i.HeaderText)==0&&(n=n.substring(i.HeaderText.length).trim(),n.length>2&&(n=n.charAt(0).toUpperCase()+n.slice(1))));!e.Hidden&&i.AllowQBE&&i.Type!="DataView"&&u.push({text:i.HeaderText,context:e.Name,icon:r?"filter":!1,desc:n,transition:!0,callback:c});t._filter=o});ft(u,"#app-panel-filter")}var e,o,u,f;if(typeof t=="object"&&(t._dataView?u=t:t.scopeField?u=t.scopeField:t.mode=="everything"?e=!0:t.mode=="field"&&(o=!0)),u)return f=[],s(u,f),t.samples!=!1&&(u._listOfValues&&u._listOfValues.length?f=h(u,f):f.push({text:er,icon:"refresh",animate:!0,context:{id:u._dataView._id,field:u.Name},keepOpen:!0,callback:ii})),f;t&&t.mode=="field"?c(t.field):l()}function oy(n,t,i,r,u){i||(i=c());var f=i&&i.dataView,o=f&&f.get_view(),s=0,e,h=[];return f&&f.get_isGrid()&&f.get_showViewSelector()&&($(f.get_views()).each(function(){var n=this;t&&n.Id==o.Id||(n.Type!="Form"&&n.ShowInSelector||n.Id==o.Id)&&h.push(n)}),h.length>1&&$(h).each(function(){var h=this,c=h.Label,l=c==o.Label;e={text:c,radio:!0,icon:l?"check":t?"":!1,context:s,callback:function(n){var t=$.find("#"+i.id+" .ui-content > .app-tabs-views .ui-btn");r&&t.length?$(t[n]).trigger("vclick",{selectedTab:c}):(f._forceSync(),f.extension()._commandRow=null,f._requestedSortExpression=f.pageProp(h.Id+"_sortExpression"),f._requestedFilter=f.pageProp(h.Id+"_filter"),f.executeCommand({commandName:"Select",commandArgument:h.Id}),f.pageProp("viewId",h.Id),r&&!t.length&&lu(i.id+"_viewTabs",c),i.id==wt()&&(i.headerText!=!1&&ir(c),lb(),to(f),bt()))}};u&&(e.radio=!1,e.selected=e.icon=="check",e.icon="material-icon-folder"+(e.icon=="check"?"-open":""),e.depth=1);n.push(e);s++})),s}function io(t){var r=t.url,u=r.match(/^((\_\w+)\:)/),f;u?v.open(r.substring(u[0].length),u[2]):(r.match(/^http(s)?\:/)&&(f=n.openExternalUrl(r)),f?f():(i._navigated=!0,v.location.href=r))}function og(n,t,i){return n.selected&&(i.selected=!0,$(n.children).each(function(){if(this.selected)return i.selected=!1,!1}),i.selected&&t&&(i.linkClassName=t,i.selected=!1)),i}function pr(n,t,i,r,u){var e,f,o;if(i)$(i).each(function(){var i=this,u=i.children,f=og(i,null,{text:i.title,context:i,icon:!1,depth:r,icon:t&&i.icon?i.icon:!1,callback:i.url?io:ii,keepOpen:!i.url,tooltip:i.description});n.push(f);u&&pr(n,t,u,r+1)});else if(i=at.nodes,i)if(st("ui.menu.apps.tiles")&&t)if(e=at.nodesWithIcons,f=e.length,$(e).each(function(){var i=this,r=i.icon;i=i.node;n.push(og(i,"app-item-selected",{text:i.title,context:i,icon:r,icon:t&&i.icon?i.icon:!1,callback:i.url?io:ii,keepOpen:!i.url,itemClassName:"app-item-tile",tooltip:i.description}))}),f){if(f%3)for(o=f%3;o<3;o++)n.push({text:" ",icon:!1,callback:ii,itemClassName:"app-item-tile app-item-tile-stub"});f<at.nodeCount&&u!=!1&&n.push({},{text:fi,icon:"material-icon-apps",transition:!0,callback:gut,itemClassName:"app-item-tile-more"})}else pr(n,t,i,1);else pr(n,t,i,1)}function sg(t,i,u){var e=n.contextDataView(),f=e.extension();if(f){var o=f.viewStyle(),h=e!=n.dataView(),s=[];oy(t,null,n.contextPageInfo(),!0)==1&&t.splice(t.length-2,2);e.get_isGrid()&&e.get_showViewSelector()&&(i==!1?t.length&&t.push({}):t.push({text:r.PresentationStyle}),(u==null||u==!0)&&(f.tagged("view-style-grid-disabled")||t.push({text:r.Grid,icon:o=="Grid"?"check":!1,radio:!0,callback:function(){f.viewStyle("Grid")}}),f.tagged("view-style-list-disabled")||t.push({text:r.List,icon:o=="List"?"check":!1,radio:!0,callback:function(){f.viewStyle("List")}}),f.tagged("view-style-cards-disabled")||t.push({text:r.Cards,icon:o=="Cards"?"check":!1,radio:!0,callback:function(){f.viewStyle()!="Cards"&&f.viewStyle("Cards")}}),h||f.tagged("view-style-map-disabled")||f.tagged("supports-view-style-map")&&t.push({text:r.Map,icon:o=="Map"?"check":!1,radio:!0,callback:function(){f.viewStyle("Map")}}),n.presenter("enumerate",{id:e._id,list:s}),$(s).each(function(){var n=this;f.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.icon=n.name==o?"check":!1,n.radio=!0,t.push(n))})));dit(e,t)}}function hg(n){n||(n={});var t=[];n.position!="left"&&t.push({text:r.Back,icon:ot,callback:au});t.push({text:r.AlternativeView});sg(t);ft(t,"#app-panel-view-options",n)}function cg(t,i,r){var e=t.extension(),o=t._id,s=t._allFields[t._fields[0].AliasIndex],f=i.length,u;r&&r.length&&!e.inserting()&&i.isSideBar==!1&&(n.enumerateFields(t,i,null,r),f<i.length&&(u=i[f],u.icon="material-icon-info-outline",u.transition=!0,u.context={id:o},u.callback=pw))}function sy(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=yv(r,!0),e=pv(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"email",href:"mailto:"+u,system:!0})))})}function ro(n){var t=lg[n];return t?"material-icon-"+t:n}function eut(n){var t=null,i=n.CssClass;if(i&&ic(i)&&(t=i),!t){switch(n.CommandName){case"Delete":t="delete";break;case"New":t="add";break;case"Edit":t="edit";break;case"Insert":case"Update":case"Confirm":t=n.CommandArgument=="SaveAndNew"?"add":"check";break;case"Cancel":t="undo";break;case"Duplicate":t="content-copy";break;case"Select":t="arrow-forward";break;case"ExportCsv":t="file-download";break;case"ExportRowset":t="grid-on";break;case"ExportRss":t="rss-feed";break;case"ReportAsPdf":t="picture-as-pdf";break;case"ReportAsImage":t="collections";break;case"ReportAsExcel":t="filter-none";break;case"ReportAsWord":t="library-books";break;case"Search":t="search";break;case"BatchEdit":t="done-all";break;case"Import":t="file-upload";break;default:t=!1}t&&(t="material-icon-"+t)}return t}function ag(n){var u=i.find(n.dataViewId),o=n.row,f=n.action,e=f.CommandName,r;u.editing()&&(r=f.CausesValidation&&e!="Cancel",t.cancel(r),r&&!t.valid())||(ni(),e=="Edit"&&ee(u),u.extension().command(o,e,n.argument,r,f.Path))}function out(t){n.contextScope(null);t=t.action;var r=i.find(t.dataViewId),u=t.action,f=t.group,e=t.groupIndex,o=t.actionIndex;r._busy()||(String.isNullOrEmpty(u.Confirmation)?ag(t):r._confirm({action:u,scope:f.Scope,actionIndex:o,rowIndex:0,groupIndex:e},function(n){i.confirm(n,function(){ag(t)})}))}function ys(n,t,i,u,f){function b(n){for(var r=t._views,i=0;i<r.length;i++)if(r[i].Id==n)return r[i].Type!="Form";return!1}var y=t.rowIsSelected(u),e,l=[],k=t.get_viewId(),a=t.get_isGrid(),v={},h,s,c,p=t.get_showActionButtons()!="None",w=o?/^(DataSheet|Grid|Export(Rowset|Rss))$/:/^(DataSheet|Grid)$/;$(t.actionGroups(n)).each(function(o){var k=this,d=k.Scope;d!="ActionBar"||k.Flat||k.Id==n?(!k.Scope.match(/Grid|ActionColumn/)||y&&a||k.Flat)&&$(this.Actions).each(function(n){var r=this,y=r.CommandName,g=r.CommandArgument,tt=r.Key,it=y+"/"+g+"/"+r.HeaderText,nt=l.indexOf(it)==-1&&(!y||!y.match(w))&&(!k.Flat||r.HeaderText);c=y?out:null;s=null;nt&&(h=y&&y.match(/^(Select|Edit|New|Duplicate)$/),h&&a&&(!g||b(g))?f&&y=="Edit"?g=f:(v[y]=i[i.length-1],nt=!1):h&&(s=v[y]));nt&&(!c&&k.Scope.match(/Grid|ActionColumn/)||k.Scope=="Form"&&!p)&&(nt=!1);nt&&(l.push(it),e={text:r.HeaderText,callback:c,icon:eut(r),uiScope:d,group:k.Id,path:r.Path,command:y,argument:g,tooltip:r.Description,context:{action:{dataViewId:t._id,row:u,group:k,groupIndex:o,action:r,actionIndex:n,argument:g}}},tt&&(e.shortcut=tt),s?Array.insert(i,i.indexOf(s)+1,e):i.push(e))}):i.push({text:k.HeaderText,icon:!1,transition:!0,uiScope:d,group:k.Id,context:{group:k,isSideBar:i.isSideBar},callback:function(n){yt=[];n.isSideBar||yt.push({text:r.Back,icon:ot,callback:au});yt.push({text:k.HeaderText});ys(n.group.Id,t,yt,u);ft(yt,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})});t._editing=null}function sut(n,t){function s(n,t){$(e).each(function(i){var r=e[i],u=r.AliasIndex,o=e[u];r.Hidden||o.GroupBy||!(f||r.tagged(n))||t.call(r,u)})}function h(n){s(n,function(t){var e=this,h=e.tagged(n+"desc"),c=e.tagged(n+"para"),l=e.tagged(n+"column"),a=e.tagged(n+"nolabel"),o=(e.tagged(n+"label")||h||c||l)&&!a,s=i.tagSuffix,v=e.tagged(n+"count"),y=e.tagged(n+"aside"),p=e.tagged(n+"heading"),w=e.tagged(n+"thumb"),b;e.tagged(n+"none")||(!f||p||h||v||y||a||c||l||(r.heading==null?r.heading=t:r.thumb==null&&e.OnDemand&&e.OnDemandStyle!=1?r.thumb=t:(h=!0,o=!0)),p&&(r.heading=t),(!o||v||y)&&!a||(r.desc.push(t),u=r.desc.length-1,i.tagSuffix&&(r.descRwd[u]=i.tagSuffix),o&&(r.descLabels[u]=!0,s&&(r.descLabelsRwd[u]=s)),c&&(r.descPara[u]=!0),l&&(r.descColumn[u]=!0,b=e.Columns,r.descColumnCount++)),v&&(r.count=t,r.countRwd=i.tagSuffix,r.countLabel=o,r.countLabelRwd=s),y&&(r.aside=t,r.asideRwd=i.tagSuffix,r.asideLabel=o,r.asideLabelRwd=s),w&&(r.thumb=t))})}function c(){f=!0}var w=n._fields,e=n._allFields,r=t&&n._listItemMap&&n._listItemMap[n._viewId]||!t&&n._cardItemMap&&n._cardItemMap[n._viewId]||{heading:null,thumb:null,aside:null,count:null,desc:[],descOriginal:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[],descColumn:[],descColumnCount:0},f,u;if(r.cached)return r;if(t?(s("list-",c),f&&h("list-")):(s("card-",c),f&&h("card-",!0)),f||(s("item-",c),f&&h("item-")),f)r.heading==null&&(r.heading=w[0].AliasIndex);else{var l,a,b=0,o=[],v=3,y;function p(n){var i,s,h;if(!this.Hidden&&!this.GroupBy&&this.Type!="DataView")if(this.OnDemand)r.thumb==null&&this.OnDemandStyle!=1&&(r.thumb=n);else if(!l||this.ShowInSummary){if(n=this.AliasIndex,i=e[n],s=i.Type.match(/^Date/),i.GroupBy)return;h=i.Type!="String"&&!i.OnDemand;r.heading==null?(r.heading=n,t&&(r.desc.push(n),u=r.desc.length-1,r.descLabels[u]=n,o.push(u))):r.aside==null&&s&&r.count==null&&!t?r.aside=n:r.count!=null||!h||s||r.aside!=null||t?(r.desc.push(n),u=r.desc.length-1,r.descLabels[u]=n,t?(o.push(u),!i.ItemsLookupStyle&&(i.Rows>1||i.TextMode==3)?(r.descPara[u]=!0,a=!0):a&&(r.descPara[u]=!0,a=!1)):b++%3==0&&(r.descPara[u]=!0)):r.count=n;f=!0}}t&&(l=!1);$(e).each(p);t&&!r.descPara.length&&o.length>3&&(o.length<7&&(v=2),y=Math.ceil(o.length/v),$(o).each(function(n){n%y==0&&(r.descColumn[this]=!0,r.descColumnCount++)}));f||(l=!1,$(e).each(p))}return r.desc.length&&$(e).each(function(){var n=this,t=r.desc.indexOf(n.AliasIndex);t!=-1&&n.Index!=n.AliasIndex&&(r.descOriginal[t]=n.Index)}),r.cached=!0,t?(n._listItemMap||(n._listItemMap={}),n._listItemMap[n._viewId]=r):(n._cardItemMap||(n._cardItemMap={}),n._cardItemMap[n._viewId]=r),r}function vg(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function hut(n){var t=ho||ct("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address==n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),ho||(ho=t),i}function yg(n,t,i){var r=ho||ct("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>itt&&r.splice(0,1);ho=r;setTimeout(function(){ct("geoLocations",r)},0)}function cut(n,t,i){var r=new Sys.StringBuilder;return nr?r.append("http://maps.apple.com/?"):r.append("https://maps.google.com/?"),i=="q"?r.append("q="):i=="to"?r.append("daddr="):r.append("saddr="),t.latitude!=null&&t.longitude!=null?r.appendFormat("{0},{1}",t.latitude,t.latitude):$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(",+"),r.append(i.trim().replace(/\s+/g,"+")))}),r.toString()}function lut(n,t){var u,f,r,e,i;return t.latitude!=null&&t.longitude!=null?(u=n[t.latitude],f=n[t.longitude]):(r=new Sys.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(","),r.append(i))}),e=r.toString(),i=hut(e),i?typeof i!="string"&&(u=i.lat,f=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(u,f)),i}function pg(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function hy(n){if(n.fit!=!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length==1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function pc(){if(!!(__tf!=4)){var n=".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse(),t=i.alert,r=Math.random()*1e4;setTimeout(function(){$(".ui-popup-active .ui-popup").popup("close");setTimeout(function(){t(n.join(""))},250)},r)}}function cy(t){t.items||(t.items=[]);var l=t.dataView,p=l.extension(),w=[],s=go(),i=$('<div class="ui-content app-popup-message app-map-info"><\/div>').popup({transition:pb(),history:o,arrow:s?null:t.x?o?"b,t,l,r":"t,b,l,r":null,theme:"a",overlayTheme:"b",tolerance:s?0:5,positionTo:s?null:t.x?"origin":"window",afteropen:function(){bg(null,i);yr(i.find(".ui-listview"));t.afteropen&&t.afteropen(i);rt=!1},afterclose:function(){i.find(".ui-btn").data("data-context",null);v.listview("destroy").remove();ly(i);rt=!1;t.afterclose&&t.afterclose(i);setTimeout(function(){u&&u.callback&&u.callback(u.context)},50)}}),a=s?{x:f.width/2,y:f.height-1}:{x:t.x,y:t.y},v=$('<ul class="app-listview"/>').appendTo(i),b=$('<li data-icon="false"/>').appendTo(v),y=$("<a/>").appendTo(b),d=$('<div class="app-map-info-toolbar"><\/div>').appendTo(i),u,g,k,h,c;rf(l,p.commandRow(),p.itemMap(!1),null,b,y,null,!0);y.find(".app-btn-check").remove();v.listview();f.width<640&&(e("ui.displayDensity.value")=="Comfortable"?i.addClass("app-density-compact"):e("ui.displayDensity.value")=="Compact"&&i.addClass("app-density-condensed"));$(t.items).each(function(){w.push(this.icon)});context=[];n.contextScope(l._id);n.navContext(context,!1);$(context).each(function(){var n=this;n.icon=="eye"&&(g=n.text);n.icon=="dots"||n.navigateTo||n.system||!n.callback||w.indexOf(n.icon)!=-1||(!k&&(n.icon||n.command=="Select")&&(k=n,y.data("data-context",n)),n.command=="Edit"&&(h=n),n.command=="Delete"&&(c=n))});n.contextScope(null);t.hasMore||(t.items.splice(0,0,{text:fi,icon:"dots",callback:function(){a.itemsToAppend=[{text:r.Back,icon:ot,callback:function(){cy(t)}}];ps(t.anchor,a)}}),h&&t.items.push({text:h.text,icon:h.icon,callback:h.callback}),c&&t.items.push({text:c.text,icon:c.icon,callback:c.callback}),t.hasMore=!0);$(t.items).each(function(){var n=this,t=$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all"/>').appendTo(d).attr("title",n.text).addClass("ui-icon-"+n.icon).data("data-context",n);n.href&&t.attr("href",n.href);n.target&&t.attr("target",n.target)});s&&i.addClass("app-popup-panel").parent().css("minWidth","100%");rt=!0;i.popupopen(a).on("vclick",".ui-btn",function(n){var t=$(n.target),r=t.closest("a");if(!t.is("[data-href]"))if(u=r.data("data-context"),u.href)u.keepOpen||cf(i),u=null;else return it(r,function(){cf(i)}),!1}).on("vclick","li",function(n){if(!$(n.target).is("[data-href]"))return markerAction=!0,cf(i),!1})}function wg(n,t,i,u,f){var s=n,e=t.data("data-map"),h=s.dataView(),o=new google.maps.Marker({map:e.map,position:i,title:u});return google.maps.event.addListener(o,"click",function(){function a(n){google.maps.event.trigger(n||e.selected,"click")}function v(){if(e.fit=!1,o.setAnimation(null),n.getZoom()>=17){var t=n.getStreetView();t&&t.getVisible()?(t.setVisible(!1),a(o)):(e.fit=!0,hy(e));bc(o)}else n.setZoom(17),n.panTo(o.position),bc(o);a()}function y(t){var i=-1;$(u).each(function(n){if(this==o)return i=n,!0});i!=-1&&(t=="next"?i++:i--,i<0&&(i=u.length-1),i>=u.length&&(i=0),wc(e,u[i]),n.panTo(e.selected.position),a())}s.tap({row:f},"none");var n=e.map,u=e.markers,l=aut(o.position,n),c=l&&{x:l.x+t.offset().left,y:l.y+t.offset().top},i=[];n.getZoom()>=17?u.length>1&&i.push({text:r.ZoomOut,icon:"zoomout",callback:v}):i.push({text:r.ZoomIn,icon:"zoomin",callback:v});i.push({text:r.Directions,icon:"navigation",href:cut(f,vg(h),"to"),target:"_blank",keepOpen:!0});e.markers.length>1&&(i.push({text:wu.Previous,icon:"arrow-l",context:"prev",callback:y}),i.push({text:wu.Next,icon:"arrow-r",context:"next",callback:y}));cy({x:c&&c.x,y:c&&c.y,dataView:h,afteropen:function(){wc(e,o);bc(o)},items:i})}),e.markers.push(o),o}function wc(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function bc(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function aut(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function bg(t,i){var r=i.closest(".ui-popup-container"),u=n.promo();s.addClass("app-has-popup-open");i.is(".app-popup-panel")&&s.addClass("app-has-panel-open");su();po(i,!1)}function vut(n){n.popup("close")}function cf(n){n.data("mobilePopup")._currentTransition="none";vut(n)}function ly(n){ait(n);s.removeClass("app-has-popup-open app-has-panel-open");po(n,!0);n.data("position-options",null).popup("destroy").remove()}function uo(n){n.find("a").data("data-context",null);n.find("li").remove()}function yut(n){uo(n);n.off("vclick").listview("destroy")}function ps(n,t){function o(){i.length&&i[i.length-1].text&&i.push({})}function f(n){var t=[];$(r).each(function(){var r=this,u=r.icon;r.system?n&&(!r.system||u=="eye"||u=="phone"||u=="email")&&u!="dots"&&t.push(r):r.text&&!r.isStatic&&i.push(r)});n&&t.length&&(o(),$(t).each(function(){var n=this,r=n.href,t={text:n.text,icon:n.icon};t.href?t.callback=n.callback:t.href=r;i.push(t)}))}n=$(n);var s=yi(n),l=s.length?s.attr("data-for"):null,a=c(l),e=a.dataView,u=e.extension(),r=t&&t.context,i=[],h;u.lookupInfo()?(r=[],u.context(r),f()):(f(),t&&t.autoPopulate==!1||(r=[],u.context(r,["ActionColumn"]),r.length&&(o(),f()),o(),r=[],u.context(r,["Grid"]),f(!0)));t&&$(t.itemsToAppend).each(function(){i.push(this)});$(e._fields).each(function(){var r=this,f=e._allFields[r.AliasIndex],s=r.HyperlinkFormatString,o,n,t;s&&(n=u.commandRow(),n&&(t=n[f.Index],t!=null&&(o=lc(r,n),t=f.format(n[f.Index]),h||(h=!0,i.push({})),i.push({text:t,icon:"material-icon-info-outline",href:o}))))});hi({items:i,anchor:n,iconPos:"left",defaultIcon:"carat-r",x:t&&t.x||n.length&&n.offset().left+n.outerWidth()/2,y:t&&t.y||n.length&&n.offset().top+n.outerHeight(!0)*.66,y2:t&&t.y2||n.length&&n.offset().top+n.outerHeight(!0)*.33})}function kc(t){function u(){n.busy(!1);r.Handler?v.location=__baseUrl+"appservices/saas/"+r.Handler+"?username="+r.UserName:n.showAccountManager([{name:"UserName",value:r.UserName}])}var f=i.AccountManager.list(),r=f[t];t==i.userName()?$(".app-acc-man .app-acc-close").trigger("vclick"):r.Token?(n.busy(!0),i.switchUser(r,function(){i._navigated=!0;window.location.replace(n.returnUrl()||__baseUrl)},u)):u()}function ay(){Web.Membership._instance.logout();sessionStorage&&(sessionStorage.signedOut=!0)}function vy(t,u){function y(){gp&&h.match(/\blogout\b/)&&(t.push({text:wr.LogoutLink,icon:"power",callback:ay}),v=!0)}function p(){h.match(/\blogin\b/)&&l&&!bh()&&(t.length&&t.push({}),t.push({text:r.AddAccount,icon:"material-icon-add",callback:function(){sh?n.showAccountManager():n.showAccountManager(null,!0)}}),a&&t.push({text:r.ManageAccounts,icon:"material-icon-settings",callback:function(){dr().remove();n.showAccountManager(null,"switch")}}))}var s=i.userName(),h=e("membership.profile"),l=i.AccountManager.enabled(),f=i.AccountManager.list(),a,v,w,o,c;if(!sh){p();return}if(h.match(/\bview\b/)){if(w=f&&f[s]&&f[s].Email,o={text:s,desc:w,user:s,icon:!1,keepOpen:!0,callback:ii},t.push(o),u?(o.transition=!0,o.keepOpen=!1,o.callback=function(){var n=[{text:r.Back,callback:au,icon:ot},{}];vy(n);ft(n,"#app-panel-profile-context",{position:"left"})}):(o.selected=!0,o.depth=1,nw&&t.push({text:wr.MyAccount,icon:"account",callback:function(){n.show({controller:"MyProfile",startCommand:"Edit",startArgument:"myAccountForm"})}})),u)return;y();t.push({})}if(h.match(/\bswitch\b/)&&l&&f)for(id in f)f[id].UserName&&(a=!0,id!=s&&t.push({text:id,context:id,icon:!1,desc:f[id].Email,user:id,count:f[id].Token?null:r.SignedOut,callback:kc}));p();v||y();c=$.Event("beforeusercontextshow.app");c.items=t;$(document).trigger(c)}function put(n){var t=[];vy(t);t.length&&hi({anchor:n,y:n.offset().top+n.outerHeight(),title:t.length>1?"":i.userName(),items:t})}function kg(n,t){var i=yi(n),r=i.length?i.attr("data-for"):null,u=c(r);return t&&t.dataView||u.dataView}function yy(t,u){function nt(n,t){$(n).each(function(i){var r=this,u=r.itemClassName;return u&&u.indexOf("app-btn-apply")!=-1?(n.splice(0,i),this.callback=t,!1):r.animate?(n.splice(0,i),!1):void 0})}function tt(t){n.contextScope(e._id);yu(e,s,yu(e,s)==t?!1:t);yc();n.contextScope(null)}function rt(){var n=yi(t),i=n.length?n.find(".app-grid.app-listview"):null;e.pageProp("frozenField",p==s?"_none_":s);e.extension()._reset=!0;ls(e);e.sync()}function ut(){i.alert("hidden")}var e=kg(t,u),s=u.field||t.attr("data-field-name"),w=t.offset(),k=go(),h=e.findField(s),y=e.findFieldUnderAlias(h),d=(yu(e,s)||"").toLowerCase(),a=[],c=[],v,g=h.AllowSorting&&!u.valuesOnly,it=h.AllowQBE,p=gh(e),b,l;(g&&(c=[{text:sf(h,"asc"),icon:d=="asc"?"check":"false",context:"asc",callback:tt},{text:sf(h,"desc"),icon:d=="desc"?"check":"false",context:"desc",callback:tt},],c.push({text:r.Group,icon:"material-icon-group-work",callback:function(){ny(e,h.Name)}})),$(e._fields).each(function(){var n=this;n.Hidden||n.GroupBy||n.OnDemand||(b=n.Name,p=="_first_"&&(p=b))}),s==b||u.valuesOnly||(u.hide&&c.push({}),c.push({text:vf.Freeze,icon:s==p?"check":null,callback:rt})),u.hide&&c.push({text:r.Hide,callback:ut}),it&&(h.AllowSamples==!1&&(u.samples=!1),v=hf({scopeField:y,samples:u.samples}),g&&v.splice(0,0,{}),u.valuesOnly&&nt(v,u.callback)),c&&(a=a.concat(c)),v&&(a=a.concat(v)),a.length)&&(l={x:u&&u.x||w.left+t.outerWidth()/2,y:u&&u.y||w.top+t.outerHeight(!0)*3/4,y2:u&&u.y2||w.top},hi({items:a,anchor:t,x:l.x,y:l.y,scope:e._id,afteropen:function(n){bb().length&&e._loadListOfValues(null,y.Name,h.Name,function(){var i=bb(),t=i.closest(".ui-listview"),r=i.length&&i.data("data-context"),h=!o,a=f.height,s;r&&e._id==r.context.id&&y.Name==r.context.field&&(h&&t.hide(),s=hf(y),u.valuesOnly&&nt(s,u.callback),uo(t),dg(t,c.concat(s),u),t.listview("refresh"),h&&t.show(),!k&&l.y+5+gw(n)>a&&l.y2&&(l.y=l.y2,n.popup("option","arrow","t,b,l,r")),n.popup("reposition",k?{x:f.width/2,y:a-8}:l))})},afterclose:function(){u.afterclose&&u.afterclose()}}))}function dg(n,t,i){var r;$(t).each(function(){var t=this,e=t.text,f,u,o,h,c,l=t.icon,s=l,a=t.itemClassName;e=="$separator"&&(e=null);e?(r=!1,c=l=="check",c&&(s="false"),f=$("<li/>").appendTo(n),s||s==!1||(s=i.defaultIcon),o=s||"false",f.attr("data-icon",!1),t.disabled&&f.addClass("ui-disabled"),a&&f.addClass(a),t.callback?(u=$("<a/>").appendTo(f).text(e).data("data-context",t),t.keepOpen&&(u.addClass("app-keep-open"),t.animate||u.addClass("app-btn-icon-transparent")),c&&(et(t.radio&&!1?"material-icon-radio-button-checked":"material-icon-check",u),f.addClass("app-checked")),t.linkClassName&&u.addClass(t.linkClassName),t.animate&&u.addClass("app-animated app-animation-spin"),t.count&&$('<span class="ui-li-count"/>').text(t.count).appendTo(u),t.desc&&$('<p class="app-item-desc"/>').appendTo($("<p/>").appendTo(u)).text(t.desc)):t.href?u=$("<a/>").appendTo(f).text(e).attr("data-href",t.href):f.text(e).addClass("app-list-instruction ui-li-divider ui-bar-a"),t.visible&&(f.attr("data-visible","true"),u.addClass("app-selected")),t.selected&&t.depth&&u.addClass("app-item-selected"),o=ro(o),ic(o)&&et(o,u),h=t.user,h&&yh(h,$('<i class="app-icon-avatar"/>').appendTo(u.addClass("app-avatar")).text(ph(h))),t.depth&&(f.addClass("app-has-depth"),u.addClass("app-depth"+t.depth)),t.color!=null&&$('<span class="app-event"> <\/span>').insertBefore(u.contents()).addClass("app-event-color-"+t.color),t.tooltip&&u.attr("title",t.tooltip).addClass("app-btn-tooltip")):r||(r=!0,$('<li data-role="list-divider"/>').appendTo(n))});r&&n.find("li").last().remove()}function wut(n){var t,i=$(document.activeElement);return i.is(":input")&&i.blur(),tw!=null&&+new Date-tw<300&&o&&(setTimeout(n,300),t=!0),t}function hi(t){function ct(){return uit({x:t&&t.x||i&&i.length&&i.offset().left+i.outerWidth()/2,y:t&&t.y||i&&i.length&&i.offset().top+i.outerHeight(!0)*.8,y2:t&&t.y2||i&&i.length&&i.offset().top+i.outerHeight(!0)*.2})}function et(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}var ft,y;if(!rt&&!wut(function(){hi(t)})){if(vw()){setTimeout(function(){hi(t)},100);return}var l=!o,h=f.height,r=$('<div class="app-popup app-popup-listview" data-theme="a"><\/div>'),i=$(t.anchor),u,c,e,a,b,k,nt=t.items||[],ut=i.is(".app-btn-promo"),v,s=go(),p=s?0:t.tolerance!=null?t.tolerance:5;if(!i||(currentPage=$(i).closest(".ui-page"),!currentPage.length||currentPage.is(".ui-page-active"))){su();ni();gt();typeof t.x=="number"&&(t.x=Math.ceil(t.x));typeof t.y=="number"&&(t.y=Math.ceil(t.y));i.length&&(t.x==null&&(t.x=Math.ceil(i.offset().left+(t.xOffset?t.xOffset:i.outerWidth()/2))),t.y==null&&(t.yOffset=="bottom"?t.y=Math.ceil(i.offset().top+(l?i.outerHeight():i.outerHeight()/2)):typeof t.yOffset=="number"&&(t.y=Math.ceil(i.offset().top+i.outerHeight()*(l?t.y:1-t.y)))));(t.iconPos=="left"||!0)&&r.addClass("app-popup-icon-left");$(t.items).each(function(){if(this.icon)return ft=!0,!1});ft||r.addClass("app-no-icons");t.title&&$('<h1 class="ui-title"/>').appendTo($('<div class="ui-header ui-bar-a"><\/div>').appendTo(r)).text(t.title);u=$('<div class="ui-panel-inner" tabindex="0"><\/div>').appendTo($('<div class="ui-content"><\/div>').appendTo(r));c=$('<ul class="app-listview"/>').appendTo(u);dg(c,nt,t);c.listview().on("vclick",function(n){var i=$(n.target),t=i.closest("a");return i.is("[data-href]")?(k=i.attr("data-href"),k&&ts(k),it(t,function(){cf(r)})):t.length&&!b&&cu(t)&&(b=!0,it(t,function(){e=t.data("data-context");a=t;e.keepOpen?(et(e,a),nv(a),e=null,a=null,b=!1):cf(r)})),!1});if(rt=!0,ur(!1),"arrow"in t||!i.length||(t.arrow=l||t.dropDown?"t,b,l,r":"b,t,l,r"),vo(!0),r.popup({history:!l,arrow:s?null:t.arrow,tolerance:p,transition:o?pb():"none",afteropen:function(){bg(null,r);t.afteropen&&t.afteropen(r);u.focus();rt=!1;ur(!0)},afterclose:function(){rt=!1;i&&(!(i.data("data-context")||{}).row||i.is(".app-calendar-selected"))&&i.removeClass("app-selected");t.afterclose&&t.afterclose(r,e);setTimeout(function(){t.autoFocus!=!1&&sr();e&&et(e,a);e=null;a=null;uo(c);yut(c);ly(r)},100)},beforeposition:function(){if(tt.width&&u[0].scrollHeight>u.height()){u.css({width:"","overflow-y":""}).parent().width("");var n=c.width();u.css({"overflow-y":"scroll"}).css({width:n+tt.width}).parent().css({width:n,overflow:"hidden"})}}}),wk(r),nt.length==0&&(r.find(".ui-content").hide(),r.find(".ui-header").css({"border-bottom-width":0,"margin-bottom":".25em"})),v=s?{x:f.width/2,y:h-8}:ct(!0),i&&i.length){ut||t.highlightAnchor==!1||i.is(".app-calendar-selected")||i.addClass("app-selected");var ot=i.offset(),lt=f.height,st=ue(),w=ot.top,d=lt-(ot.top+i.outerHeight()),ht=s?h*.6:Math.max(w-st*2,d-st*2,50),g=gw(r),at=r.outerHeight()>h?ht:Math.max(ht,u.height());s||(!l&&w-p<g?r.popup("option","arrow","b,t,l,r"):v.y2&&(w>d&&g>d-p||!l&&g<w-p)&&(v.y=v.y2,r.popup("option","arrow","b,t,l,r")));u.css({minHeight:s?Math.min(h*.4,h-156):null,maxHeight:s?Math.min(h*.6,h-156):at})}kit(r);y=c.find('li[data-visible="true"]');y.length&&u.offset().top+u.outerHeight()<y.offset().top+y.outerHeight()&&u.scrollTop(y.offset().top-u.offset().top-(u.outerHeight()-y.outerHeight())/2);ut&&n.promo().show();s&&r.addClass("app-popup-panel");r.data("position-options",v).popupopen(v)}}}function but(n){var t=[];$(n).closest(".app-bar-buttons").find(".ui-btn:not(:visible):not(.app-btn-more)").each(function(){var n=$(this);t.push({text:n.text(),callback:function(){n.trigger("vclick")}})});hi({anchor:n,items:t,y:n.offset().top+n.outerHeight()/4*3,tolerance:3})}function kut(n){return{overlayTheme:"b",history:!0,transition:n||"pop",positionTo:"window",afteropen:function(){$(this).attr("tabindex",0).focus();var n=vp;n&&setTimeout(function(){n()},200);vp=null},afterclose:function(){sr();var n=sl;n&&setTimeout(function(){n()},100);sl=null}}}function gg(n){var t=i.find(n.id),u=t.findField(n.field),r=n.op;t.removeFromFilter(u);r!="$clear"&&(r.startsWith("$")&&(r+="$"),t._filter.push(n.field+":"+r+(r.match(/\$(true|false)/)?"":t.convertFieldValueToString(u,n.value))));le(t)}function nn(t,u){function o(n,r){var u=f.Name+":"+n;n.startsWith("$")&&(u+="$");u+=t.convertFieldValueToString(f,y);g!=u&&h.push({text:i.filterDef(d,n).Text+(r?" "+r:""),context:{id:t._id,field:e,op:n,value:y},callback:gg})}function it(i){var r=n.contextScope();n.contextScope(t._id);yu(t,e,yu(t,e)==i?!1:i);yc();n.contextScope(r)}function rt(n){var i=yi(l),r=l.data("data-context");r&&(hc(t).removeClass("app-selected"),i.length&&cv(i),l.addClass("app-selected"),ee(t,l),t.extension().tap(r,"none"),i.length?tf(t,i):c(t).echoChanged=!0,n())}function p(){rt(function(){ps(l,ut)})}var a=$(u.target).closest(".app-field"),l=a.closest("a"),f,e,y,s,v,b,k=r.LookupViewAction,d,g,h=[],nt,tt,ut={x:vi(),y:gu()},w;if(a.length){if(w=l.data("data-context"),!w)return;e=a.attr("class").match(/app\-field\-(\w+)/);e&&(e=e[1]);e&&(u.preventDefault(),f=t.findField(e),nt=f.AllowQBE,tt=f.AllowSorting,v=t.findFieldUnderAlias(f.Name),v.ItemsDataController||(b=new RegExp("\\b"+e+"\\s*=\\s*\\w+"),$(t._fields).each(function(){var n=this;if(n.Copy&&b.exec(n.Copy))return v=n,k=String.format(pf.DetailsToolTip,t._allFields[n.AliasIndex].HeaderText),!1})),v.ItemsDataController&&!v.ItemsTargetController&&h.push({text:k,icon:"material-icon-arrow-forward",callback:function(){rt(function(){n.details({field:v})})}}),tt&&(h.length&&h.push({}),h.push({text:sf(f,"asc"),icon:yu(t,e)=="asc"?"check":!1,context:"asc",callback:it},{text:sf(f,"desc"),icon:yu(t,e)=="desc"?"check":!1,context:"desc",callback:it})),nt&&(h.length&&h.push({}),d=wi.Filters[f.FilterType].List,y=w.row[f.Index],$(t._filter).each(function(){var n=this;if(n.startsWith(e+":"))return g=n,h.push({text:String.format(bi.ClearFilter,f.HeaderText),icon:"material-icon-clear",context:{id:t._id,field:e,op:"$clear"},callback:gg},{}),!0}),y==null?(o("$isempty"),o("$isnotempty")):(s=f.text(y),f.FilterType=="Text"&&(s='"'+s+'"'),f.FilterType=="Text"?(o("=",s),o("<>",s),o("$contains",s),o("$doesnotcontain",s)):f.FilterType=="Boolean"?(o("$true"),o("$false")):(o("=",s),o("<>",s),o("<=",s),o(">=",s),o("<",s),o(">",s)))),h.length?(h.push({},{text:fi,icon:"material-icon-more-horiz",callback:function(){p(a)}}),hi({anchor:a,title:f.HeaderText,items:h,x:vi(u.pageX),iconPos:"left"})):p(a))}else{if($(u.target).closest(".app-grid-header").length)return;if($(u.target).closest(".app-presenter").length)return;l=$(u.target).closest(".ui-btn");l.length?p(l):u.preventDefault()}return!1}function tn(t){var r=$(t.target).closest(".ui-btn"),u=r.data("icon"),o,f,e;return r.is(".app-btn-promo")&&(o=r.data("icon-list"),o)?(it(r,function(){var i=[],e=r.attr("data-icon"),t,u;if(r.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;$(o.icons).each(function(){t=this;t.match(tl)||(u=o.labels[t].split(/\n/),i.push({text:u[0],desc:u[1],icon:t,context:t,callback:function(t){n.executeInContext(t)}}))});f=i[i.length-1];f&&f.callback?f.callback(f.context):(r.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(e),hi({anchor:n.promo(),items:i,iconPos:"left",y:r.offset().top-1,afterclose:function(){r.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(e)}}))}),!1):(e=ii,u=="search"?e=i.search:u=="user"?e=function(){put(r)}:u=="phone"&&tr?n.executeInContext(u):e=u=="apps"?function(){dc("right")}:function(){n.executeInContext(u=="check"?"ok":u)},it(r,e),!1)}function rn(t,i,r){var f,u;pi()||(t=k.path.convertUrlToDataUrl(k.path.makeUrlAbsolute(t,k.path.documentBase)),f=s.find("> div[data-url]").filter(function(){return $(this).attr("data-url")==t}),r?(pe(),location.href=t):f.length?(f.appendTo(s),u=c(f.attr("id")),u?(n.makeModalOrPanel(u),u.navigateInfo={href:t,transition:i},n.changePage(u.id)):k.navigate(t,{transition:i})):(pi(!0),$.ajax({url:t,dataType:"html"}).done(function(r){var u,c,l;if(pi(!1),u=r.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),u||(u=r.match(/<div\s+id\s*=\s*"PageContent".+?>([\s\S]+)?<\/div>\s*<footer /i)),u&&!r.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var f=u[1],e,a=new Sys.StringBuilder,v=/<script.+?>([\s\S]+?)<\/script>/ig,y,o,h,p=1;y=v.exec(f);)a.append(y[1]);for(f=f.replace(v,""),f.match(/data-content-framework="bootstrap"/)&&!$('[data-content-framework="bootstrap"]').length&&(c=$("link.app-theme"),l=c.attr("href"),l&&(l.match(/\&_cf=$/)?c.attr("href",l+"bootstrap"):$('<link href="'+__baseUrl+'css/sys/bootstrap.css" rel="stylesheet" type="text/css"/>').insertBefore(c))),e=$("<div><\/div>").appendTo(s).hide().attr("data-href",t),e.html(f).data("scripts",a.toString()),h=aa(t);n.pageInfo(h);)h=aa(t)+p++;o={pageId:h,selector:e,transition:i,dynamic:!0};n.pageInfo({id:o.pageId,text:o.pageId,url:t,root:!0});n.start(o);e.data("scripts",null).remove()}else pe(),location.href=t}).fail(function(){pi(!1)})))}function dut(n){var t=$(n.target);if(t.is(".app-btn-toggle"))return t.addClass("ui-btn-active"),s.focus(),setTimeout(function(){function u(){i.removeClass("app-text-expanded");t.attr("title",fu.Maximize).toggleClass("ui-icon-carat-u ui-icon-carat-d");ru()}t.removeClass("ui-btn-active");var i=t.prev(),r,n;i.is(".app-text-expanded")?(r=i.closest(".dv-item,.ui-field-contain"),r.length?(n=b(t),vc(n,r.offset().top-(n.offset().top-n.scrollTop())-n.height()*.33,u)):u()):(i.addClass("app-text-expanded"),t.attr("title",fu.Minimize).toggleClass("ui-icon-carat-u ui-icon-carat-d"))},dt),!1}function un(t){if(h.left.visible){var i;arguments.length||(t=!h.left.mini,i=!0,e("ui.sidebar.mini",t),ct("minisidebar",t),n.busy(!0));h.left.mini=t;s.toggleClass("app-has-minisidebar-left",h.left.mini);nk();rc(!0);g&&g.is(":visible")&&!g.is(".app-bar-notify-left,.app-bar-notify-center")&&g.css("left",h.left.width);gi(!0);$(document).trigger("sidebarstatechanged.app");bt(!1,0,function(){if(h.left.visible){var i=h.left.inner;i.css({transform:"translate3d("+(t?"100":"-66")+"%,0,0)"});setTimeout(function(){i.css({transition:"transform 96ms ease-in-out"});setTimeout(function(){i.css("transform","").one("transitionend",function(){i.css("transition","")});n.busy(!1)})})}})}}function gut(){dc(null,!0)}function dc(n,t,i){var u=[],f;t&&(f=yt,u=[{text:r.Back,icon:ot,callback:function(){yt=f;ft(u,"#app-panel-apps")}},{}]);bo()&&!i?pr(u,!0,at.nodes,1):pr(u,!0,t?at.nodes:null,t?1:0,!i);ft(u,"#app-panel-apps"+(t?"-all":""),{position:n||"left"})}function nft(t){var i=$(t.target);if(!lt)return ia(),gt(i,!1),ni(),i.attr("data-action")=="#app-back"?(n._backText.addClass("ui-btn-active"),it(i,function(){n._backText.removeClass("ui-btn-active");di()})):(yo(!0),it(i,function(){if(h.left.visible)un();else{var t=[{text:wl(),itemClassName:"app-logo"}],i=$("#app-panel-menu-scope.ui-panel-open");i.length?i.panel("close"):(n._toolbar.find(".app-icon-avatar").parent().is(":visible")||vy(t,!0),t.length&&t.push({}),(!ok()||at.nodesWithIcons.length&&st("ui.menu.tiles")||!h.left.visible&&e("ui.menu.location")!="toolbar")&&(bo(n.pageInfo())?pr(t,!0,at.nodes,1):pr(t,!0),t.push({})),st("settings.enabled")&&t.push({text:r.Settings,icon:"material-icon-settings",transition:!0,callback:vs}),ft(t,"#app-panel-menu",{position:"left"}))}})),!1}function tft(t){var a,f,p,u,h,l,w;if(!t.isDefaultPrevented()){var o=$(t.target),i=o.is("a")?o:o.closest("a"),e=i.attr("href")||(i.attr("data-action-path")?"#app-action":""),r;if(!rt){switch(e){case"#app-menu":r="#app-btn-menu";break;case"#app-context":r="#app-btn-context";break;case"#app-back":r=di;break;case"#app-details":r=function(){var n=c(),t;n&&n.dataView&&(t=n.dataView.extension(),t.command(t.commandRow(),"Select"),uh=i.attr("data-field-text"),n.dataView._viewDetails(i.attr("data-field-name")))};break;case"#app-refresh":r=function(){var n=c();n&&n.dataView&&n.dataView.sync()};break;case"#app-clear-filter":r=function(){var n=c();n&&n.dataView&&pa(n.dataView,!1)};break;case"#app-filter":r=function(){var n=c();n&&n.dataView&&hf({mode:"everything"})};break;case"#app-action":if(i.is(".app-btn-disabled"))return i.removeClass("ui-btn-active"),!1;r=function(){var r=i.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"],t=i.attr("data-action-path");t=="wizard-next"?setTimeout(function(){ou("next",{container:b()})}):t=="wizard-prev"?setTimeout(function(){ou("prev",{container:b()})}):i.is(".app-btn-more")?but(i):r&&(r[1]=="carat-r"?n.executeInContext(null,i.text(),t):n.executeInContext(r[1],null,t))};break;case"#close-popup":r=function(){$(".app-popup-image").popup("close")};t.preventDefault();break;default:if(e)if(e.match(/^tel/))ts(e),r=ii;else if(i.attr("target"))v.open(e,i.attr("target"));else if(a=i.attr("data-content-type"),a&&a.match(/^image/))r=function(){if(f=$("#app-popup-image"),!f.length){f=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#close-popup" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-close-circle ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(s).popup(kut("none")).popup("option","history",!0);f.find(".app-image-preview").one("load",function(t){var i=$(t.target);setTimeout(function(){pi(!1);i.width("").height("");var o=f.find(".app-image-preview-box"),s=n.screen(),r=i.width(),e=s.width*.9,t=i.height(),u=s.height*.9;r>e?(t*=e/r,r=e,t>u&&(r*=u/t,t=u)):t>u&&(r*=u/t,t=u);i.hide();o.css({background:"",width:r+"px",height:t+"px"}).show();f.popup("reposition",{positionTo:"window"});o.css({background:String.format("url({0})",i.attr("src")),"background-size":String.format("{0}px {1}px",r,t)})},100)})}pi(!0);f.find(".app-image-preview-box").hide();f.find(".app-image-preview").attr("src","").width(100).height("").show().attr("src",e+"&_ticks="+(new Date).getTime());sl=function(){ly(f)};f.popupopen()};else if(r=n.openExternalUrl(e,i.is('[rel="external"]')),!r&&!i.closest(".ui-panel-inner").length)if(p=k.path.parseUrl(e),u=p.hash,u)if(i.closest(".app-content-framework").length){if(o.data("app-click-test"))return;o.data("app-click-test",!0);k.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);o.data("app-click-test",null);k.linkBindingEnabled=!0;t.isDefaultPrevented()||(u=="#"?r=function(){vc(b(),0)}:(h=u&&u.length>1&&y(u+',a[name="'+u.substring(1)+'"]'),l=b(),r=h&&h.length?function(){w=h.offset().top-(l.offset().top-l.scrollTop());it(i,function(){vc(l,w)})}:function(){$(u).is(".ui-page")&&n.changePage(u.substring(1))}));r&&t.preventDefault()}else u!="#"&&(r=function(){k.navigate(u)});else r=function(){rn(e,i.attr("data-transition"),i.attr("rel")=="external")}}if(r&&!n.busy()){if(i.attr("download")){i.click();return}return it(i,function(){if(n.busy(!1),typeof r=="string"){var t=r;r=function(){$(t).trigger("vclick")}}r()}),!1}}}}function fn(t){var f=t.message,e=f!=null?f.toString():"",r=t.cancel,u=$.Deferred();return n.busy(!1),ri(function(){var t=n.pageInfo();wo(function(){var i=t.dataView.survey(),n;i&&(n=i._cancel,t._canceled||(n==!1&&(n=i._submit),n?n():u.resolve()))})}),i.survey({_submit:t.submit,_cancel:r,_promise:u,controller:t.name,questions:[{name:"Message",value:e,text:!1,readOnly:!0,rows:3,htmlEncode:!e.match(/<\/\w+>/)}],options:{modal:{fitContent:!0,always:!0,max:"xxs",buttons:{more:!1},gapRequired:!0},contentStub:!1,promo:!1},submit:"alertconfirmed.app",cancel:r!=!1?"alertnotconfirmed.app":r,layout:'<div data-container="panel"><span data-control="field" data-field="Message">[Message]<\/span><\/div>'}),u}function py(n,t,i){$(n).each(function(){var n=this,r=n.url,f=$("<li/>").appendTo(t).addClass("app-depth"+i),u,e;r?(u=r.match(fp),u&&(r=u[2],e=u[1]),$("<a/>").appendTo(f).data("node",n).attr({href:r,target:e,rel:"external"}).text(n.title)):$("<span/>").appendTo(f).text(n.title);n.children&&py(n.children,t,i+1)})}function ift(){var i,t;for(i in at.Nodes){at.nodes=at.Nodes[i];break}at.nodes&&(t=$("#app-btn-context").on("vclick",function(){if(!n.busy()&&!t.data("skipClick"))return it(t,function(){if(($(".ui-panel-open").attr("id")||"").match(/^app-panel-context/))yo();else{yo(!0);var t=s.is(".app-has-panel-right")?"left":"";n.showContextMenu({position:t,scope:t?n.dataView():null})}}),!1}),$('[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function u(){var n=$('<li><a rel="external"/><\/li>').appendTo(t).find("a");$("#app-welcome").length&&!i?n.attr("href","#app-welcome").text(wr.LoginButton):fr.loginStatus(n)}var f=$(this),t=$('<ul data-inset="false" />').appendTo(f),i=fr&&fr.loggedIn();fr&&!i&&u();py(at.nodes,t,1);fr&&i&&u();t.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),f=i.attr("target"),u=r.match(/^#/);return cu(i)?(u||f||pe(),it(i,function(){u?n.changePage(r.substring(1)):io(i.data("node"))}),!1):!1}).filterable({filterPlaceholder:r.FilterSiteMap})}))}function pu(n){var i=n.originalEvent,t=i;return t.pageY==null&&(t=i.touches[0]||i.changedTouches[0]),{x:t.pageX,y:t.pageY}}function fo(){clearTimeout(wy);lf&&(lf.data("touch-start",null),lf=null)}function ws(n){var i=n.type,t;if(w&&(i=="pointercancel"||i=="touchcancel")&&w.cancelable==!1){w.cancelable=!1;return}fe(n);w&&(t=w.moved&&(w.originalX!=w.x||w.originalY!=w.y),t&&(w.swipeLeft=w.originalX>w.x,w.swipeRight=w.originalX<w.x,w.swipeUp=w.originalY>w.y,w.swipeDown=w.originalY<w.y,w.swipeHorizontalDistance=Math.abs(w.originalX-w.x),w.swipeVerticalDistance=Math.abs(w.originalY-w.y)),n.type!="touchcancel"&&(n.type!="mousemove"||w.moved)||(ut._keepTap=!0),$(document).trigger($.Event(t?"dragend.app":"dragcancel.app",{drag:w})),t||n.type=="taphold"?ut.dragged(!0):w.dir=="all"&&n.type=="touchend"&&(cr={x:w.x,y:w.y},$(document.elementFromPoint(w.x,w.y)).trigger("vclick")),w.target=null,w.data=null,w=null);vt&&(w=vt,vt=null,ws(n));$(document).off("pointermove mousemove touchmove",dy).off("pointerup pointercancel mouseup touchend touchcancel",ws)}function dy(n,t){var i;if(vt){var i=pu(n),u=Math.abs(i.x-vt.x),r=Math.abs(i.y-vt.y),f=vt.dir=="horizontal",e;if(u<1&&r<1&&(w&&(w.moved=!1),!t))return;f&&(e=ut[vt.type],e.canScroll&&!e.canScroll(vt.target,"vertical")&&(r=0));vt.dir=="all"||f&&u>r&&u>(vt.mouse?3:vt.pointer?5:1)&&r<(vt.pointer&&vt.touch?10:9)?(fo(),w=vt,(n.type=="touchmove"||n.type=="pointermove")&&(w.cancelable=!1,n.preventDefault()),vt=null,ur(!1)):(f&&(u||r)&&fo(),(!f||r)&&ws(n))}w&&(n.preventDefault(),su(),i=pu(n),w.moved||(w.moved=!0,w.originalX=w.x,w.originalY=w.y),(w.x!=i.x||w.y!=i.y)&&(w.lastX=w.x,w.lastY=w.y,w.x=i.x,w.y=i.y,w.dropTarget=n.type.match(/^touch|pointer/)?document.elementFromPoint(i.x,i.y):n.target,$(document).trigger($.Event("dragmove.app",{drag:w}))))}function ur(n){o||(s[0].style.pointerEvents=n?"":"none")}function en(n){n?n.find('[data-control="dataview"]').each(function(){var t=$(this).attr("id"),n,i;t&&(n=c(t.substring(0,t.length-3)),i=$("#"+n.id+"_echo"),i.is(":visible")&&n.echoId&&!n.dataView._busy()&&cs(n.dataView,i))}):y(".app-echo-toolbar").each(function(){echo=$(this).parent();echo.is(":visible")&&(pageId=echo.attr("data-for"),pageInfo=c(pageId),pageInfo.echoId&&!pageInfo.dataView._busy()&&cs(pageInfo.dataView,echo))})}function rft(){gy||(gy=!0,ck(),ni(),t.methods.lookup._hidePopup(),fa().length&&n.promo(!1),$(document).trigger("resizing.app"))}function on(n){n||(n=y());var i=hr.indexOf(nf(n.width())),r=[],t;for(i==0&&i++,i==hr.length-1&&i--,t=1;t<=i;t++)r.push("app-min-"+hr[t]);for(n.addClass(r.join(" ")),r=[],t=i+1;t<hr.length-1;t++)r.push("app-min-"+hr[t]);n.removeClass(r.join(" "))}function gi(i,r){var e,l,u,o,s;rt||(lt=!1,e=c(),i&&(gy=!1,ns(),$(".ui-panel-dismiss").height(f.height),ui(),l=fa(),l.length&&(ui(l),he(e?e.dataView:null),oa()),bt(!1,null,function(){yr();ef();ru();vr();ge(null,!0);no()})),ni(),u=b(r),on(r),lr(u),db(u),i||no(null,r),he(),ns(!0),h.left.visibile&&h.left.inner.trigger("scroll"),gl(),bo(e,!0),frt(u),i?rs(u):setTimeout(function(){rs(u)}),clearTimeout(pp),pp=setTimeout(function(){if(!rt){hu();n.refreshMenuStrip();var t=wt();$(n._pages).each(function(){var i=this,n;i.echoId&&(n=$("#"+i.echoId),n.length&&n.closest(".ui-page").attr("id")!=t&&(i.echoChanged=!0,n.find(".app-echo-controls").addClass("app-stale")))});ak(b())}},1e3),uft(u),i&&(en(),vr(),o=$(".ui-popup"),o.is(".app-popup-message,.app-popup-listview")?cf(o):o.popup("reposition",{positionTo:"window"}),lt=!1,$(document).trigger("resized.app"),t.restoreLastPopup(),ht&&ht.is(".app-tooltip-message")&&(s=ht.data(),s&&s.fieldName&&setTimeout(function(){t.focus(s)},100))))}function ni(){ht&&ht[0].style.display!="none"&&ht.hide();ne&&(clearTimeout(ne),ne=null)}function np(n,t,i,r,u){var v,w,p;if(!o||u){v=i.split(/\n/g);ht||(ht=$('<div class="app-tooltip"><\/div>').appendTo(document.body).hide(),dw()&&ht.addClass("app-large"));ht.css({left:"",top:""}).text(i);v&&(i.match(/\t/)?(w=$("<table/>").appendTo(ht.empty()),$(v).each(function(){var n=this.split(/\t/g),t=$("<tr/>").appendTo(w);$(n).each(function(){var n=this,i=$("<td/>").appendTo(t);n.match(/\"/)?i.html(n.replace(/"(.+?)"/g,"<b>$1<\/b>")):i.text(n)})})):(ht.empty().removeClass("app-tooltip-message"),$(v).each(function(n){var t=this;n&&$("<br/>").appendTo(ht);t.match(/\"/)&&(t=t.replace(/"(.+?)"/g,"<b>$1<\/b>"));$("<span/>").appendTo(ht).html(t)})));ht.show();var y=eu.scrollLeft(),b=eu.scrollTop(),s=ht.outerWidth(),l=ht.outerHeight(),k=f.width,e,c,d,a=r&&r[0].className,g;u&&(t+=2);a&&typeof a=="string"&&(p=r.attr("data-tooltip-location"),a.match(/\bapp-btn-float\b/)?(e=r.offset(),n=r.css("right")!="auto"?e.left-s-8:e.left+r.outerWidth()+12,t=e.top+r.outerHeight()/2-l/2+1,c=!0):a.match(/\bapp-btn-tooltip\b/)?(e=r.offset(),d=r.outerWidth(),g=n,n=e.left+d+12,n+s>f.width?(n=e.left-12-s,n>=0?c=!0:n=g):c=!0,c&&(t=e.top+r.outerHeight()/2-l/2+1)):a.match(/\bui-btn\b/)&&r.closest(".app-sidebar").length&&(h.left.mini?(n=h.left.width+6+f.left,t=r.offset().top+r.outerHeight()/2-l/2+1,c=!0):r.parent().is(".app-bar-toolbar-bottom")&&(p="above")),p=="above"&&(e=r.offset(),t=e.top-l-6,n=e.left+r.outerWidth()/2-s/2,n<0&&(n=2),n+s>f.width&&(n=f.width-s-2),c=!0));c||(y+n+s>=y+k+f.left&&(n=y+k+f.left-s-2),b+t+l>=b+f.height+f.top&&(t=t-24-l));ht.css({left:c?n:n-5,top:t});u&&ht.addClass("app-tooltip-message")}}function uft(n){var i=nt(n);if(i.length){var t=i.offset(),f=i.outerHeight(),r=n.offset(),u=n.height(),e=n.scrollTop();r.top+u<t.top?n.scrollTop(t.top+e-u-(f>u?0:f)):r.top>t.top&&n.scrollTop(t.top+e-r.top)}}function sn(){nt().removeData("keepFocus").trigger("blur")}function nt(n){return n?$(n).find(".app-data-input"):$(".app-data-input")}function hn(n){var t=0,r=n[0].style,i={};return ntt.forEach(function(u){var e=r[u.name],f=u.ignore;f&&n.is(f)||(t++,i[u.name]=e)}),t?i:null}function fft(n){var i,ft,f,y,e,r,p,u,w,h,c,it,rt,b,k,et,a,ut,g,tt;if(!t.valid()||(w=nt(),u=d(n),w.length&&(u.data("hitTest",!0),d(w).data("hitTest")||(w=null),u.removeData("hitTest"),sn()),u.find("[data-input-hotspot]").length&&!n.is("[data-input-hotspot]")))return!1;if(r=$.Event("getvalue.input.app"),u.trigger(r),h=r.inputRows,c=r.rtf,c?(i=$(' <iframe class="app-data-input"><\/iframe>'),h=h||1):(i=h?$('<textarea class="app-data-input" rows="'+(parseInt(h)+1)+'"/>'):$('<input class="app-data-input"/>').attr("type",r.inputIsPassword?"password":"text"),it=hn(u),it&&i.css(it)),o||h||u.attr("data-spell-check")=="false"||i.attr("spellcheck","true"),y=t.createContainer(u.addClass("app-has-focus")),c||i.appendTo(y),h&&(y.addClass("app-has-textarea"),c&&y.addClass("app-has-rtf")),f=r.inputAltValue||r.inputValue||"",r.inputMaxLength&&i.attr("maxlength",r.inputMaxLength),i.val(f).data("original",f),c){rt=[];b=i[0];i.appendTo(y);i.load(function(){l.handlers(i,!0)});function v(n){rt.push(n)}v('<html><head><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/><meta charset="utf-8">');v("<style>b,strong{font-weight:600}body{white-space:pre-line;margin:0;padding:0;overflow:hidden;font-size:"+i.css("font-size"));v(";font-family:"+s.css("font-family"));v(';}<\/style><\/head><body contenteditable="true">');v(f);v("<\/body><\/html>");b.contentWindow.document.open();b.contentWindow.document.write(rt.join(""));b.contentWindow.document.close()}if(r.placeholder&&(ft=$('<span class="app-data-input-placeholder"/>').insertAfter(i).text(r.placeholder).css("display",f?"none":""),i.data("placeholder",ft)),r.change&&(i.data({change:r.change,last:f}),r.change=null,i.attr({autocomplete:"false",autocorrect:"false",autocapitalize:"false",spellcheck:"false"})),e=u.attr("data-type"),!e){switch(r.inputDataType){case"DateTime":e="datetime";break;case"Date":e="date"}u.attr("data-type",e)}k=u.find(".app-control-inner");switch(e){case"datetime":k.attr("data-smart-value")&&k.data("last-smart-text",k.text()).text(i.val());break;default:e&&o&&(i.attr("type",e),e=="number"&&(f=r.inputValueRaw,f!=null&&i.val(JSON.stringify(f))))}if(p=$.Event("beforefocus.input.app",{inputElement:i}),u.trigger(p),p.inputElement=null,p.isDefaultPrevented())return!1;try{g=vi();tt=gu();c&&(a=i.offset(),a.left<=g&&g<=a.left+i.outerWidth()&&a.top<=tt&&tt<a.top+i.outerHeight()&&(et=l.range("select",{x:g-a.left,y:tt-a.top})));et?l.document("focus"):c?(l.document("focus"),l.range("save"),l.focus()):(ut=i.focus()[0],ut.setSelectionRange&&ut.setSelectionRange(u.attr("data-select-on-focus")=="false"||o&&st("ui.input.touch.autoSelect")==!1||!o&&st("ui.input.mouse.autoSelect")==!1?f.length:0,f.length))}catch(ot){}return!0}var gc="app-transition",af=navigator.userAgent,nl=navigator.platform,nr=/iPhone|iPad|iPod/.test(nl)&&af.indexOf("AppleWebKit")>-1,tp=nr?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d+)_\d+/)[1]):null,tr=/Android/i.test(af),eft=/chrom(e|ium)/i.test(af),ip=!!af.match(/Trident\/7\./),cn=/safari/i.test(af),o,bs=96,ks=100,oft=nl.match(/Mac/i)!=null,ln=nl.match(/Win/i)!=null,an=Sys.CultureInfo.CurrentCulture,uu=an.dateTimeFormat,vn=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,yn=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=\".+?\")/g,pn=/(<(\/*(b).*?>))/g,wn=/\" ([\.;])/g,rp=/\b(((material\-icon|glyphicons|glyphicon|fa|ion)\-([\w\-]+?)))(\s|$|,)/,bn=/phone/i,kn=/email/i,dn=/\burl/i,gn=/^\s*(\w+)(\s+(\w+)\s*)?$/,ds=/\s*(\w+)(\s+(asc|ascending|desc|descending))?\s*(,|$)/gi,tl=/(delete|clear|trash|remove|undo|erase)/,up=/^(Byte|Currency|Decimal|Double|Int16|Int22|Int64|Single|SByte|UInt16|UInt32|UInt64)$/,fp=/^(_\w+):(.+)$/,fr,il="",at,ci=Web.DataViewResources,ep=ci.Views,op=ci.Menu,wi=ci.Data,rl=wi.Filters,ul=rl.Labels,sp=ul.And,fl=ul.Clear,wu=ci.Pager,el=ci.ModalPopup,bi=ci.HeaderFilter,er=bi.Loading,r=ci.Mobile,hp=ci.Device,fi=r.More,vf=ci.Grid,yf=vf.PerformAdvancedSearch,fu=ci.Form,gs=ci.Actions,nh=ci.Validator,pf=ci.Lookup,wr=Web.MembershipResources&&Web.MembershipResources.Bar,cp=gs.Scopes.Grid,sft=ci.InfoBar,bu=r.Themes,ei=r.Import,wf=r.Develop,th=wi.BooleanDefaultItems[0][1],ih=wi.BooleanDefaultItems[1][1],ol=ci.Editor,or={cache:{},list:[],keyCodes:[]},l,ntt=[{name:"fontWeight"},{name:"color",ignore:".app-null"},{name:"backgroundColor"},{name:"textTransform"},{name:"fontStyle",ignore:".app-null"}],eo=wi.NullValueInForms,lp,ap,vp,sl,ku,bf,yp,oo,rh,pp,so,wp,lt,hl,kf,rt,bp={},yt,ki,ttt,kp={},itt=500,rtt=500,hr=["tn","xxs","xs","sm","md","lg","xl","xxl"],df,gf,utt="http://www.w3.org/2000/svg",ht,ne,ftt=500,ett,g,cl=[],ott=0,dp,stt,ll,uh,ho,fh,al,co,kt,eh={},h,i=$app,t,v=window,oh=history,br=v.parent!=v,vl,s,eu=$(v),f={isVirtual:!1,top:0,left:0,width:0,height:0,physicalWidth:0,physicalHeight:0},ti,k=$.mobile,si=k.navigate.history,dt=34,htt=450,yl=1e3,te,tt,gp,ie,nw,sh,ctt,hh,lo,cr,tw,pl,ut,w,vt,ot="material-icon-chevron-left",lg,n,lf,wy,by,ky,gy;i.keyCode={backspace:8,tab:9,enter:13,esc:27,space:32,insert:45,"delete":46,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};$(document).on("searchperform.dataview.app",function(t){var h=t.dataView,f=t.survey,l=f.context.field,v=f.context.start,r=h.data(),c=r.QuickFind,a=f.context.id,o,u,s;"QuickFind"in r&&(u=y("li.app-selected").data("text"),u!=null&&(s=c?c.match(/(\"?(\S+)\:)\S*/):null,r.QuickFind=s?'"'+s[2]+":"+u.substring(1):u));o=i.search("parse",{id:a,data:r,field:l,showErrors:!0});o.errors.length?t.preventDefault():(n.pageInfo(h)._canceled=!0,uf(!1),e("ui.transitions.style","none"),ri(function(){uf(!0);i.search("execute",o)}))}).on("searchgenerate.dataview.app",function(n){i.search("generate",{id:n.survey.context.id,survey:n.survey})}).on("searchreset.dataview.app",function(n){return i.confirm(r.ResetSearchConfirm,function(){i.search("reset",{id:n.survey.context.id})}),!1}).on("searchcalculate.dataview.app",function(n){var u=n.rules.trigger(),e,a=n.dataView,p=n.survey,f=a.data(),t,o,r,s,h=f[u],c,l,v,y;if(u){if(u.match(/_op$/)){o=u.substring(0,u.length-3);r=f[o];t=a.findField(o);t&&(c=t.ItemsTargetController,v=t.ItemsStyle,t.ItemsStyle=t.lov("static")?t.Extended.itemsStyle:h&&h.match(/^(=|<>|\$in|\$notin)$/)&&t.FilterType=="Text"&&t.Extended.autoComplete!=!1?"AutoComplete":null,t.ItemsTargetController=h=="$in"||h=="$notin"?"_basket":null,l=t.ItemsTargetController!=c,y=t.ItemsStyle!=v,l&&(r=f[o],c?(t.Items=[],r!=null&&(r=i.csv.toArray(r),r.length&&(r=r[0]))):r!=null&&(t.Items=[[r,r]],t.is("lookup-distinct")&&t.Items[0].push(null))),(y||l)&&i.input.execute({values:[{name:o,value:r}]}));return}if(s=p.context.id,e=u.match(/^_Match(\d+)_addCondition$/),e){setTimeout(function(){i.search("addCondition",{id:s,match:parseInt(e[1]),condition:f[u]})});return}if(e=u.match(/^_Match(\d+)(_filters)?$/),e){setTimeout(function(){var n=parseInt(e[1]);i.search("changeMatch",{id:s,match:n,type:f["_Match"+n],filters:f["_Match"+n+"_filters"]})});return}if(u=="_Match_addGroup"){setTimeout(function(){i.search("addGroup",{id:s,type:f[u]})});return}}}).on("quickfindshow.dataview.app",function(n){return i.search("toggle",n.survey.context.id),!1}).on("quickfindautocomplete.dataview.app",function(t){var r=t.inputData;i.search("autoComplete",{id:n.dataView().survey().context.id,dataInput:d(r.input),value:r.value,keyboard:r.keyboard})}).on("vclick",".app-bar-history",function(n){var t=$(n.target).closest("li"),r=t.data("text");return r!=null&&($(document.activeElement).blur(),t.closest("ul").find(".app-selected").removeClass("app-selected"),t.addClass("app-selected"),setTimeout(function(){i.action({path:"form/submit"})},dt)),!1});i.search=function(u,e){function ot(){return se()==12||f.width<480?"xs":""}function it(n,t){var i=t._dataView._allFields[t.OriginalIndex].SearchOptions,r={field:t.Name,operator:i?i[0]:"="};n.fields.push(r)}function tt(n){return n.is("search-mode")!="forbidden"&&!n.OnDemand&&n.AllowQBE!=!1&&n.Type!="DataView"}function st(n){var t=s._allFields,i=n.fields,u=n.available,r;i.length||$(s._fields).each(function(){var r=this;if(tt(r)){if(r=t[r.AliasIndex],i.length==3)return!1;it(n,r)}});r={};i.forEach(function(n){r[n.field]=!0});t.forEach(function(i){var e=i.is("search-mode"),f;(e&&e!="forbidden"||!e&&!i.Hidden&&tt(i))&&(i=t[i.AliasIndex],f=i.Name,!r[f]&&u.indexOf(f==-1)&&n.available.push(f))})}function w(n,t,i){var r={id:t,type:i||"$matchall",filters:"$showfilters",fields:[],available:[]},u=n?s._allFields[s.findField(n).AliasIndex]:null;return s._allFields.forEach(function(t){var i=t.is("search-mode");(n&&u==t||!n&&(i=="required"||i=="suggested")&&tt(t))&&(t=t._dataView._allFields[t.AliasIndex],it(r,t))}),n||st(r),r}function lt(n,t){var r=[],e=1,u,o,f=n["_Match1"],c=s._allFields,h,i;if(t)r.push(w(t,1));else if(f)while(f)u={id:e,type:f,filters:"$showfilters",fields:[],available:[]},h={},c.forEach(function(t){tt(t)&&(t=c[t.AliasIndex],i=t.Name,o=n["_Match"+e+"_"+i+"_op"],o&&!h[i]&&(u.fields.push({field:i,operator:o}),h[i]=!0))}),st(u),r.push(u),f=n["_Match"+(++e).toString()];else r.push(w(null,1));return r}function at(){var c=s._allFields,r=e.data,u=e.field,f={id:e.id,data:r,field:u,start:e.start,filter:[],find:r.QuickFind,errors:[]},a=f.filter,o=[],v=[],h,y,l;for(h in r)h.match(/^_match\d+$/i)?o.push(h):v.push(h);return o.length||o.push(""),o.forEach(function(n){var t=new RegExp("^("+(n?n+"_":"")+".+?)_op$"),f=r[n]||"$matchall";n||u||c.forEach(function(n){n=c[n.AliasIndex];var t=n.Name;r[t]!=null&&r[t+"_op"]==null&&(r[t+"_op"]="=")});v.forEach(function(e){var w=e.match(t),h,b,nt=1,o,l,d,g,p,v,k;if(w){for(b=w[0];r[b]!=null;)h=r[b],b=w[0]+(++nt).toString();h&&(d=ra(h),p=w[1],o=r[p],l=r[p+"_v2"],g=n?p.substring(n.length+1):p,v=s.findField(g),!v||u&&c[v.OriginalIndex].Name!=u||d&&o==null&&l==null||(d?(h=="$between"?o==null?(h="<=",o=l):l==null?h=">=":l<o&&(l=[o,o=l][0]):o==null&&(o=l),h=="$in"||h=="$notin"?(o=i.csv.toArray(o.toString()),o.forEach(function(n,t){o[t]=s.convertFieldValueToString(v,n)}),o=o.join("$or$")):(o=s.convertFieldValueToString(v,o),h=="$between"&&(o=o+"$and$"+s.convertFieldValueToString(v,l)))):o="",h.match(/^\$/)&&(h+="$"),y!=n&&(u||(k=f.match(/(match|donotmatch)(all|any)/),k&&a.push("_"+k[1]+"_:$"+k[2]+"$")),y=n),a.push(v.Name+":"+h+o)))}})}),u||(l=n.dataView(),l!=s&&l._allFields.forEach(function(n){if(n.Extended&&n.Extended.required){var t=r[n.Name+"_op"];t&&ra(t)&&r[n.Name]==null&&f.errors.push({field:n.Name,error:nh.Required})}})),e.showErrors&&f.errors.length&&t.focus({fieldName:f.errors[0].field,message:f.errors[0].error}),f}function vt(){var u=e.id,i=e.data,f=e.start,r=e.field,n=e.filter,t;r?(s.removeFromFilter(s._allFields[s.findField(r).AliasIndex]),n.forEach(function(n){s._filter.push(n)}),le(s)):(e.keepFilter||s.clearFilter(),n=n.length?n:null,s.viewProp("advancedSearchFilter",n),s.viewProp("useAdvancedSearch",n!=null),"QuickFind"in i?(t=i.QuickFind,t==null&&f?hs(u):eit(s,t),uk(s)):le(s))}function yt(){var r=n.dataView(),u=r.survey().context,f=JSON.parse(u.base),h=u.model,t=h[e.match-1];t.available.splice(t.available.indexOf(e.condition),1);it(t,s.findField(e.condition));e.survey=f;k(h,r.data());i.survey("refresh",f,function(n){ui();o||n.find('[data-control="label"][data-field="_Match'+e.match+"_"+e.condition+'"]').trigger("vclick")})}function pt(){var r=n.dataView(),u=r.survey().context,f=JSON.parse(u.base),t=u.model;t.push(w(null,t.length+1,e.type));e.survey=f;k(t,r.data());i.survey("refresh",f,function(n){ui();rt(n,t.length)})}function ht(){var n=[],t=s._allFields;return t.forEach(function(t){t.is("search-option-top-values")&&n.push(t)}),n.length||t.forEach(function(i){var r=t[i.AliasIndex];i.ItemsDataController&&n.length<3&&r.Type=="String"&&!(i.AllowAutoComplete==!1||i.AllowMultipleValues==!1)&&n.push(r)}),n}function kt(){var f=n.dataView(),s=f.survey().context,h=JSON.parse(s.base),c=s.model,t=c[e.match-1],u=e.filters,r,o,l;if(t.type=e.type,t.fields.forEach(function(n){var i=f.findField("_Match"+t.id+"_"+n.field);i.Extended&&i.Extended.context&&(i.ContextFields=t.type.match(/any/)?null:i.Extended.context,i._dataView.sessionRemove(re(i)))}),u&&u!=t.filters){t.filters=u;r=f.data();for(o in r)o.startsWith("_Match"+t.id+"_")&&delete r[o];delete r["_Match"+t.id];u=="$showfilters"?(l=w(),t.fields=l.fields):(t.fields=[],ht().forEach(function(n){t.fields.push({field:n.Name,operator:"$in"})}));e.survey=h;k(c,r);i.survey("refresh",h,function(n){ui();rt(n,t.id)})}}function rt(n,t){o||n.find('[data-field="_Match'+t+'"]').closest("[data-container]").next().find('[data-control="label"]').first().trigger("vclick")}function dt(){var t=n.dataView().survey().context,r=JSON.parse(t.base);e.survey=r;k(t.model=[w(null,1)],{});i.survey("refresh",r,function(n){ui();rt(n,1)})}function k(n,t){var f=e.survey,c=f.context,l=s._allFields,p=ht(),u=c.field,v,a,i=[],o=[],y,h;return t||(t=s.data(u?"filter":"search")),c.base||(c.base=JSON.stringify(f)),n||(n=lt(t,u)),c.model=n,u&&(v=t[u+"_op"],a=t[u],u&&(v=="$in"||v=="$notin")&&s.findField(u).FilterType!="Text"&&(t[u+"_op"]="=",t[u]=a instanceof Array?a[0]:a)),i.push('<div data-layout="form" data-layout-size="tn">'),i.push('<div data-container="'+(u?"simple":"collapsible")+'" data-wrap="false" data-header-text="none">'),n.forEach(function(n){var f=u?"":"_Match"+n.id,e=n.filters,h;u||(i.push('<div data-container="row" style="padding:1em">'),i.push('<span data-control="field" data-field="'+f+'" data-size="auto" style="font-weight:bold;">[_Match]<\/span>'),p.length&&i.push('<span data-control="field" data-field="'+f+'_filters" data-size="auto" style="text-transform:lowercase">[_Match_Filters]<\/span>'),i.push("<\/div>"),o.push({name:f,required:!0,value:t[f]||n.type,text:!1,placeholder:"add matching group",causesCalculate:!0,items:{list:[{value:"$matchall",text:r.MatchAll},{value:"$matchany",text:r.MatchAny},{value:"$donotmatchall",text:r.DoNotMatchAll},{value:"$donotmatchany",text:r.DoNotMatchAny}]},options:{lookup:{openOnTap:!0,nullValue:!1}}}),p.length&&o.push({name:f+"_filters",required:!0,value:t[f+"_filters"]||n.filters,text:!1,placeholder:"filters",causesCalculate:!0,items:{list:[{value:"$showfilters",text:r.WithSpecifiedFilters},{value:"$showtop5",text:r.WithSelectedValues5},{value:"$showtop10",text:r.WithSelectedValues10}]},options:{lookup:{openOnTap:!0,nullValue:!1}}}));n.fields.forEach(function(r,h){function ft(n,i){var f=0,r,u=i.items.list;return n.List.forEach(function(i){if(i){var e=i.Function,o=w.SearchOptions;e?o&&o.indexOf(e)==-1||(y!="text"||w.AllowAutoComplete==!1||w.AllowMultipleValues==!1)&&e.match(/^\$(in|notin)$/)||(r&&(u.push({value:"$separator"}),r=!1),et&&["=","<>","$isnotempty","$isempty"].indexOf(e)==-1||(u.push({value:e,text:i.Text}),f++)):i.List&&(d={name:v+"_op2",text:a.HeaderText,value:t[v+"_op2"],items:{list:[]},placeholder:n.Text.toLowerCase(),options:{openOnTap:!0,lookup:{autoCompleteAnywhere:!0,nullValue:!1},clearOnHide:!0},visibleWhen:"$row."+v+'_op=="all-dates-in-period"'},ft(i,d)&&u.push({value:"all-dates-in-period",text:i.Text}))}else r=!0}),f}var a=s.findField(r.field),w=l[a.OriginalIndex],b=a.Name,rt=a.FilterType,y=rt.toLowerCase(),k=rl[rt],v=f?f+"_"+b:b,nt=t[v+"_op"]||r.operator,c={name:v,type:y,text:a.HeaderText,placeholder:k.Kind.toLowerCase(),format:a,value:t[v],extended:{required:l[a.OriginalIndex].is("search-mode")=="required"},visibleWhen:"["+(y=="date"?'"=","<>","<",">","<=",">=","$between","$in","$notin"':'"$isnotempty","$isempty"')+"].indexOf( $row."+v+"_op) "+(y=="date"?"!":"=")+"= -1"},ut,p={name:v+"_op",text:a.HeaderText,required:!0,items:{list:[]},value:nt,causesCalculate:!0,options:{openOnTap:!0,lookup:{autoCompleteAnywhere:!0,nullValue:!1,autoAdvance:"row"}}},d,et=a.lov("static"),tt,g,it;e=="$showfilters"?(i.push('<div data-container="row" style="padding-left:3em">'),i.push(String.format('<span data-control="label" data-field="{0}" data-size="'+(u?"fit":"auto")+'">{1}<\/span>',v,a.HeaderText)),i.push(String.format('<span data-control="field" data-field="{0}_op" data-size="auto" style="text-transform:lowercase">{0}_op<\/span>',v)),y!="boolean"&&i.push(String.format('<span data-control="field" data-field="{0}" data-size="auto" data-focus="true" data-visibility="f:{0}">[{0}]<\/span>',v)),y=="date"&&i.push(String.format('<span data-control="field" data-field="{0}_op2" data-size="auto" data-focus="true" data-visibility="f:{0}_op2">{0}_op<\/span>',v)),y=="boolean"||a.lov("static")||i.push(String.format('<span data-control="text" data-visibility="f:{0}_v2">{1}<\/span><span data-control="field" data-field="{0}_v2" data-size="auto" data-visibility="f:{0}_v2">[{0}]<\/span>',v,sp)),i.push("<\/div>")):(h==0&&i.push('<div data-container="row" style="padding-left:3em">'),i.push('<span style="display:inline-block;vertical-align:top">'),i.push(String.format('<span data-control="label" data-field="{0}" data-size="auto">{1}<\/span>',v,a.HeaderText)),i.push(String.format('<span data-control="field" data-field="{0}" data-size="auto" data-focus="true" data-visibility="f:{0}">[{0}]<\/span>',v)),i.push("<\/span>"),h==n.fields.length-1&&i.push("<\/div>"));ft(k,p);o.push(p);d&&o.push(d);y=="date"&&(c.options={smartDatesDisabled:!0,clearOnHide:!0});y=="text"&&(tt=w.AllowAutoComplete!=!1,g=nt.match(/^(=|<>|\$in|\$notin)$/)!=null&&tt,c.items={controller:s._controller,view:s._viewId,dataValueField:b,dataTextField:b,style:g?"AutoComplete":null,disabled:!g},c.context=[],n.fields.forEach(function(n){r!=n&&c.context.push(String.format("{1}={0}_{1}",f,n.field))}),c.extended.context=c.context.join(","),tt||(c.extended.autoComplete=!1),n.type.match(/any/)&&(c.context=null),u&&(c.extended.filter=s.get_filter(),c.extended.search=s._combinedFilter([])),c.options={lookup:{distinct:s._fields[0]!=a||!!l[a.OriginalIndex].ItemsStyle,acceptAnyValue:!0,multiple:t[v]instanceof Array||!!nt.match(/\$(in|notin)/),autoCompleteAnywhere:g&&w.AutoCompleteAnywhere==!0},clearOnHide:!0});y=="number"&&(c.options={clearOnHide:!0});y=="boolean"?(p.required=!1,p.options.lookup.autoCompleteAnywhere=!1,p.items.list.splice(0,0,{value:null,text:wi.AnyValue}),p.placeholder=k.Kind.toLowerCase()):(o.push(c),a.lov("static")?(it=a.ItemsStyle,c.extended.itemsStyle=it,c.placeholder=rl.Text.Kind.toLowerCase(),c.items={style:it,list:[]},a.Items.forEach(function(n){c.items.list.push({value:n[0],text:n[1]})}),c.options.lookup={nullValue:!1,openOnTap:!0}):(ut={name:v+"_v2",type:y,text:a.HeaderText,format:a,placeholder:k.Kind.toLowerCase(),visibleWhen:"$row."+v+'_op=="$between"',value:t[v+"_v2"],options:{smartDatesDisabled:!0,clearOnHide:!0}},o.push(ut)));e!="$showfilters"&&c.items&&c.options&&(c.items.style="CheckBoxList",c.options.lookup={distinct:!0,anyValue:!0,top:parseInt(e.substring(8))})});!u&&n.available.length&&e=="$showfilters"&&(i.push('<div data-container="row" style="padding-left:3em">'),i.push('<span data-control="field" data-field="'+f+'_addCondition" data-size="auto">[_AddCondition]<\/span>'),i.push("<\/div>"),h={name:f+"_addCondition",text:!1,placeholder:vf.AddConditionText.toLowerCase(),causesCalculate:!0,items:{list:[]},options:{lookup:{nullValue:!1,openOnTap:!0,autoCompleteAnywhere:!0}}},n.available.forEach(function(n){var t=s.findField(n);t=l[t.AliasIndex];h.items.list.push({value:t.Name,text:t.HeaderText})}),o.push(h))}),u||(i.push('<div data-container="row" style="padding:1em">'),i.push('<span data-control="field" data-field="_Match_addGroup" data-size="auto">[_addGroup]<\/span>'),i.push("<\/div>"),o.push({name:"_Match_addGroup",text:!1,placeholder:r.AddMatchingGroup.toLowerCase(),causesCalculate:!0,items:{list:[{value:"$matchall",text:r.MatchAll},{value:"$matchany",text:r.MatchAny},{value:"$donotmatchall",text:r.DoNotMatchAll},{value:"$donotmatchany",text:r.DoNotMatchAny}]},options:{lookup:{nullValue:!1,openOnTap:!0}}})),i.push("<\/div>"),i.push("<\/div>"),f.questions=o,f.layout=i.join("\r\n"),f.options||(f.options={discardChangesPrompt:!1,modal:{always:!0,max:ot(),fitContent:!0,dock:"top",autoGrow:!0},materialIcon:"search"}),u?(f.submitText=r.Apply,y=f.options,y.modal={always:!0,max:"xxs",fitContent:!0,autoGrow:!0},y.materialIcon="filter-list",f.text2="Filter",f.text=s.get_view().Label):(f.text||(f.text=s.get_view().Label,f.text2=r.AdvancedSearch),h=f.buttons,h||(h=f.buttons=[]),h.push({id:"resetSearch",text:vf.ResetAdvancedSearch,icon:"material-icon-clear-all",click:"searchreset.dataview.app",key:"Ctrl+R"}),s.get_showQuickFind()!=!1&&h.push({},{id:"showQuickFind",scope:"context",text:r.ShowLess,click:"quickfindshow.dataview.app"})),f}function gt(){var n=e.value||"",tt=/(\"?(\S+)\:)\S*/g,l=tt.exec(n),k,o,t,v,it,y=n=="",f=y?null:new RegExp(RegExp.escape(n.toString()),"i"),rt=y?null:new RegExp("^"+RegExp.escape(n.toString()),"i"),ut=s.viewProp("quickFindHistory")||[],i,p=e.dataInput,ft=p.closest('[data-container="row"]'),h=ft.next(),d,a=6,et=a,w=[],b=[],ot=e.keyboard,g=s._allFields,u,nt;if(p.closest(".app-bar-search").toggleClass("app-null",y).find("input"),i=[],ot?ut.forEach(function(n){(!f||n.toString().match(f))&&i.push(n)}):i=ut.splice(y?0:1),n){while(l)k=l[1],w.indexOf(l[2])==-1&&w.push(l[2]),l=tt.exec(n);w.length&&w.forEach(function(n){var t=[],i=n.replace(/\s/g,"").toLowerCase();g.forEach(function(n){var r=g[n.AliasIndex],u=r.HeaderText||r.Label||"";n.AllowQBE&&!n.Hidden&&u.replace(/\s/g,"").toLowerCase().startsWith(i)&&(t.push('"'+u+'"'),o||(o=r.Name))});t.length&&b.push('"'+n+':" = '+t.join(", "))});k&&(n=n.substring(k.length),f=n.length?new RegExp(RegExp.escape(n.toString()),"i"):null,rt=n.length?new RegExp("^"+RegExp.escape(n.toString()),"i"):null)}if(i.length<a&&f&&!s.tagged("search-suggestions-none")&&ot){et=i.length;t=s.viewProp("searchData");t||(t={});p.data("scannedDataItems")||(v=$("#"+s._id).find("li.dv-item a"),v.length||(v=$('[data-for="'+s._id+'"]').find("li.dv-item a")),v.each(function(){var i=$(this),n=i.data("data-context");n&&s._fields.forEach(function(i){var r,u,f;i=g[i.AliasIndex];i.AllowQBE&&i.Type=="String"&&(r||(r=t[i.Name],r||(t[i.Name]=r=[])),u=n.row[i.Index],u!=null&&(f=i.format(u),r.indexOf(f)==-1&&(r.push(f),it=!0)))})}),it&&p.data("scannedDataItems",!0),s.viewProp("searchData",t));var c=[],r=[],st=0;for(u in t)u=="_list"||o&&u!=o||t[u].forEach(function(n){n.match(rt)&&c.indexOf(n)==-1&&c.indexOf('"'+n+'"')==-1&&c.push(n)});if(c.sort(),c.length<a){for(u in t)u=="_list"||o&&u!=o||t[u].forEach(function(n){n.match(f)&&r.indexOf(n)==-1&&r.indexOf('"'+n+'"')==-1&&r.push(n)});r.sort()}for(r=c.concat(r);st<r.length&&i.length<a;)nt=r[st++],i.indexOf(nt)==-1&&i.push(nt)}i.length||b.length?(h.is(".app-bar-history")||(h=$('<div data-container="row" class="app-bar-history"><\/div>').insertAfter(ft)),h.show().empty(),d=$("<ul/>").appendTo(h),b.length&&$('<li class="app-hint"/>').text(b.join("; ")).appendTo(d),$(i).each(function(t){if(t==a)return!1;var i=this,e=t>=et,r=f?i.match(f):null,u=$("<li/>").attr("data-text",e?'"'+i+'"':i).appendTo(d);r?($("<span/>").appendTo(u).text(i.substring(0,r.index)),$("<b/>").appendTo(u).text(i.substring(r.index,r.index+n.length)),$("<span/>").appendTo(u).text(i.substring(r.index+n.length))):u.text(i);$('<i class="app-icon material-icon"/>').appendTo(u).text(e?"search":"history")}),ui()):h.length&&(h.remove(),ui())}var h,nt,s,d,et,g,v,l,p;if(u&&typeof u=="string"||(u="show"),s=e?typeof e=="string"?i.find(e):e._controller?e:i.find(e.id):n.contextDataView(),u=="mode")return h=s.viewProp("searchMode"),h||"quickfind";if(u=="toggle"&&(h=i.search("mode",s),h=h=="quickfind"?"advanced":"quickfind",s.viewProp("searchMode",h)),u=="enumerate"){var c=[],a,ut=b(y()),ct=ut.offset();return ut.find(".app-echo").each(function(){var t=$(this),n=$app.find(t.attr("data-for")),r=n._totalRowCount,u=t.offset();r!=-1&&u.top>=ct.top-1&&u.top<=ct.top+ut.height()-1&&c.push({text:n.get_view().Label,icon:"search",desc:be(n.extension().instruction(!1)),count:r,callback:function(){i.search("show",n)}})}),c.length&&(a=function(){c.length==1?c[0].callback():(c.splice(0,0,{text:yf}),ft(c,"#app-panel-search-menu",{position:"right"}))}),a||(n.navContext(c),$(c).each(function(){var n=this;if(n.icon=="search")return a=function(){n.callback(n.context)},!1})),a&&setTimeout(a),a!=null}if(u=="generate"&&i.survey("show",k()),u=="parse")return at();(u=="execute"&&(e.filter||(e=search("parse",e)),vt(e)),u=="addCondition"&&yt(),u=="changeMatch"&&kt(),u=="addGroup"&&pt(),u=="reset"&&dt(),u=="autoComplete"&&gt(),u=="show"||u=="toggle")&&(d=s.get_searchOnStart(),et=y(),d&&(s._totalRowCount=0,wt()!=s._id?cs(s):bt(!1,0),s._requiresContextRefresh=!0,s.set_searchOnStart(!1)),h=s.viewProp("searchMode")||"quickfind",e||(e={}),g=n.contextDataView(),v={id:s._id,start:d,search:!0,field:e.field},g&&g!=s&&i.read(g,"_survey.context.search")&&(n.pageInfo().deleted=!0,v=g.survey().context,d=v.start),d&&(u!="toggle"&&(nt=s.tagged("search-on-start-simple")?"quickfind":"advanced",h!=nt&&s.viewProp("searchMode",nt),h=nt),ri(function(){var t=n.pageInfo(),i=t.dataView.survey().context;wo(function(){i&&!t._canceled&&hs(i.id)})})),h=="advanced"||e.field?(l={controller:s._controller+"._search",parent:s._id,context:v,dynamic:!1},l.submit="searchperform.dataview.app",l.submitText=yf,l.submitIcon="material-icon-search",l.create="searchgenerate.dataview.app",l.calculate="searchcalculate.dataview.app",l.tryLoad=!v.field,i.survey(l),pc()):(p=s.extension().quickFind(),p==""&&(p=null),ri(function(){i.search("autoComplete",{id:s._id,dataInput:y().find('[data-field="QuickFind"]'),value:p})}),i.survey({parent:s._id,controller:s._id+"-quickfind",context:v,topics:[{questions:[{name:"QuickFind",text:!1,placeholder:"Search in "+s.get_view().Label,value:p}]}],options:{modal:{fitContent:!0,always:!0,max:et.is(".app-page-modal")&&!et.is(".app-page-modal-dock")?"":ot(),title:!1,tapOut:!0,dock:"top"},actionButtons:!1,discardChangesPrompt:!1,contentStub:!1},layout:'<div class="app-container-search" data-container="simple" data-header-text="none" data-wrap="true"><div data-container="row" class="app-bar-search'+(p==null?" app-null":"")+'" data-density="'+(o?"comfortable":"relaxed")+'"><i class="app-icon material-icon material-icon-search" title="'+yf+'">search<\/i><span data-control="field" data-field="QuickFind" data-notify="quickfindautocomplete.dataview.app" data-spell-check="false">[Query]<\/span><i class="app-icon material-icon material-icon-cancel" title="'+r.ClearText+'">cancel<\/i><i class="app-icon material-icon material-icon-more app-btn-more" title="'+r.ShowMore+'"/><\/div><\/div>',submitText:"Search",submit:"searchperform.dataview.app"})))};i.import=function(u,f){function l(n){return n.match(/\.(\w+)$/)[1].toLowerCase()}function h(n){var e=i.import.state.queues.errors,o=f.data[n.index-1],u,t;if(!e.length){t=[r.Line,r.Error];for(u in o)t.push(u);e.push(i.csv.toString(t))}t=[n.index+1,n.error];for(u in o)t.push(o[u]);e.push(i.csv.toString(t))}function a(n,t){for(var i,u=f.data,e=t.DataFormatString,r=0;r<Math.min(u.length,100);r++)if(i=u[r],i&&(i=i[n]),i)break;return i&&t.Type.match(/^Date/)&&typeof i=="number"&&(i=e?String.format(e,k(i)):i.toString()),i}function g(n){for(var r="",t=0,i=10240;t<n.byteLength/i;++t)r+=String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i,t*i+i)));return r+String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i)))}function v(n){var t=n[n.length-1];return t=="Z"?n.length-1>0?v(n.substring(0,n.length-1))+"A":"AA":n.substring(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)}function p(n){this.message=n}function nt(){var n=f.dataView,u=f.view,e=n.get_parentDataView();ri(pc);i.survey({text:n.get_view().Label,text2:gs.Scopes.ActionBar.Import.HeaderText,parent:n._id,context:{id:n._id,controller:n._controller,view:u},controller:"import_from_file",topics:[{description:ei.SelectFile,wrap:!0,questions:[{name:"file",text:!1,type:"blob"}]}],options:{materialIcon:"file-upload",discardChangesPrompt:!1,modal:{fitContent:!0,max:"xs",always:!0}},submitText:r.Submit,submit:function(n){function e(){o||t.focus({fieldName:"file"})}var f=n.dataView,u=f.data(),s=f.survey().context;u.file?i.import("supports",{name:u.file[0].name})?ri(function(){i.import("parse",{file:u.file[0],callback:function(n){i.import("map",{data:n,name:u.file[0].name,context:s})}})}):(n.preventDefault(),i.alert(String.format(ei.NotSupported,u.file[0].name),e)):(n.preventDefault(),i.alert(r.Files[o?"Tap":"Drop"],e))}})}function w(){var h,i,a;try{if(h=s.result,l(f.file.name)=="csv")i=$.csv.toObjects(h);else{i=[];var nt=g(h),y=XLSX.read(btoa(nt),{type:"base64"}),c=y.Sheets[y.SheetNames[0]],w=c["!ref"],r=w?w.match(/(([A-Z]+)(\d+))\:(([A-Z]+)(\d+))/):null,b,k,t,u,e,o=[],d=[];if(!r)throw new p(wi.NoRecords);if(b=r[2],k=r[5],u=parseInt(r[3]),lastRow=parseInt(r[6]),u<lastRow){for(e=u+1,t=b;t!=k;)o.push(t),t=v(t);for(o.push(t),o.forEach(function(n){var t=c[n+u];d.push(t?t.v:null)});e<=lastRow;)a={},i.push(a),o.forEach(function(n,t){var i=c[n+e],r=d[t];r&&(a[r]=i?i.v:null)}),e++}}if(i.length)n.busy(!1),f.callback&&f.callback(i);else throw new p(wi.NoRecords);}catch(tt){n.busy(!1);$app.alert(tt.message)}}function b(t){function nt(n,t){var i=g[n.Name];i.value=t;i.items.list.push({value:t,text:t});r.splice(r.indexOf(t),1)}var u=f.context,c,l,e;if(!arguments.length){i.execute({controller:u.controller,view:u.view||"createForm1",requiresData:!1,success:function(n){b(n)}});return}var s=$app.find(u.id),p=(s._filterFields||"").split(","),w=t.fields,h=[],r=[],v,o=[],k=s.get_view().Label,y=[],g={};for(v in f.data[0])h.push(v.toLowerCase()),r.push(v);if(u.importColumns=r.slice(0),w.forEach(function(n){var e=n;if(n=w[n.AliasIndex],!e.Hidden&&!n.OnDemand&&!e.ReadOnly&&e.Type!="DataView"){var i=n.Name,l=n.HeaderText,t={name:i,text:l,causesCalculate:!0,items:{style:"DropDownList",list:[{value:null,text:ei.NotMatched}]},value:null,columns:30,placeholder:ei.NotMatched,required:!n.AllowNulls&&!n.HasDefaultValue},f=h.indexOf(l.toLowerCase()),a=p.indexOf(e.Name);if(a!=-1){if(a>0)return;delete t.items;var b=s.context(),c=b.headerField(),v=s.context("data");t.value=c?c.format(v[c.Name]):eo;t.readOnly=!0;u.masterKey=[];p.forEach(function(n){u.masterKey.push({field:n,newValue:v[n],modified:!0})})}else f==-1&&(f=h.indexOf(i.toLowerCase())),f==-1?o.push(n):(i=r[f],t.value=i,t.items.list.push({value:i,text:i}),h.splice(f,1),r.splice(f,1));y.push(t);g[t.name]=t}}),o.length){for(c=0;c<r.length;)e=r[c],l=null,$(o).each(function(n){var t=this;if(t.HeaderText.indexOf(e)!=-1||t.Name.indexOf(e)!=-1)return l=t,o.splice(n,1),!1}),l?nt(l,e):c++;o.length&&o.forEach(function(n){e=null;$(r).each(function(){var t=this;if(t.indexOf(n.HeaderText)!=-1||t.indexOf(n.Name)!=-1)return e=t.toString(),!1});e&&nt(n,e)})}y.forEach(function(n){r.forEach(function(t){n.items&&n.items.list.push({value:t,text:t})});var i=n.value,u;i&&(u=t.map[n.name],n.footer=a(i,u))});u.availableColumns=r;u.metadata=t;i.survey({controller:"import_map",text:k,text2:gs.Scopes.ActionBar.Import.HeaderText,description:String.format(ei.FileStats,f.data.length,f.name),questions:y,options:{modal:{max:"xs",fitContent:!0,always:!0},materialIcon:"settings_input_component"},context:u,submit:function(t){f.fieldMap=t.dataView.data();for(var r in f.fieldMap)t.dataView.findField(r).ReadOnly&&delete f.fieldMap[r];t.dataView.tag("discard-changes-prompt-none");ri(function(){ri(function(){var t=n.pageInfo();wo(function(){t._canceled||t.dataView.survey().cancel()});d("init")});i.survey({controller:"import_status",options:{modal:{max:"xxs",fitContent:!0,always:!0,buttons:{more:!1,fullscreen:!1}},contentStub:!1},questions:[],layout:String.format('<div style="padding:1em"><div>{0} <b>{1}<\/b> {2} <b>{3}<\/b>...<\/div><div class="app-import-status">&nbsp;<br/>&nbsp;<br/>&nbsp;<br/>&nbsp;<\/div><\/div>',ei.Importing,f.name,ei.Into,k),submit:!1,cancel:function(){i.import.state=null}})})},submitText:ei.StartImport,calculate:function(n){var r=n.dataView,e=r._fields,o=r.survey(),s=o.context,u=s.importColumns.slice(0),f=r.data();e.forEach(function(n){if(!n.ReadOnly){var r=f[n.Name],e=n.FooterText;r!=null?(u.splice(u.indexOf(r),1),n.FooterText=a(r,t.map[n.Name])):n.FooterText=null;e!=n.FooterText&&setTimeout(function(){i.input.execute({values:[{name:n.Name,value:f[n.Name]}]})})}});e.forEach(function(n){if(!n.ReadOnly){var t=n.Items,i=f[n.Name];n.ItemCache=null;t.splice(1);i!=null&&t.push([i,i]);u.forEach(function(n){t.push([n,n])})}})}})}function e(){return(new Date).getTime()}function k(n){var e=Math.floor(n-25568),o=e*86400,i=new Date(o*1e3),s=n-Math.floor(n)+1e-7,t=Math.floor(86400*s),r=t%60,u,f;return t-=r,u=Math.floor(t/3600),f=Math.floor(t/60)%60,new Date(i.getFullYear(),i.getMonth(),i.getDate(),u,f,r)}function d(){var t=i.import.state,vi,v,ot,it,ht,wt,bt,kt,c,w,ft,tt,dt,gt,ni,ai;if(arguments[0]=="init"){i.import.state=t=f;var ti=t.context.metadata,yi=t.fields={},ii=t.fieldMap,it=t.columnMap={};for(v in ii)ot=ii[v],ot&&(it[ot]=v);t.duplicate={test:[],accept:[]};ti.fields.forEach(function(n){yi[n.Name]=n;var i=n.Tag;i&&(i.match(/\bimport-duplicate-test\b/)&&t.duplicate.test.push(ti.fields[n.AliasIndex]),i.match(/\bimport-duplicate-accept\b/)&&t.duplicate.accept.push(n.Name))});t.status=y(".app-import-status");t.dataView=i.find(t.context.id);t.index=0;t.count=0;t.lookupCache={};t.queues={lookup:[],nextLookup:0,test:[],submit:[],errors:[]};t.started=e();t.mode="scan"}else if(t){var u=t.queues,pi=e(),p=t.data,st=t.context.controller,ri=t.context.view;if(t.mode=="scan"){if(it=t.columnMap,p.length)while(t.index<p.length){ht=p[t.index++];var g=[],v,s,nt,o,l,a=[],ct,rt=[],lt=[],ui=t.duplicate.test;for(v in it)if(o=ht[v],s=t.fields[it[v]],s&&f.fieldMap[s.Name]==v)if(nt=s.Name,l=s.OriginalIndex!=s.Index?t.fields[t.context.metadata.fields[s.OriginalIndex].Name]:null,o==null)l&&(s=l),g.push({field:s.Name,newValue:o,modified:!0}),ui.indexOf(s)!=-1&&rt.push(nt+": "+nh.RequiredField);else{if(l)if(nt=l.Name,o==="")o=null;else{var fi=l.ItemsDataController,oi=l.ItemsDataView,at=l.ItemsDataTextField,vt=l.ItemsDataValueField,yt=fi+"_"+oi+"_"+vt+"_"+at,ut=t.lookupCache[yt],b,pt;ut||(ut=t.lookupCache[yt]={});b=ut[o];b&&b.v!=null?o=b.v:vt&&(ct={controller:fi,view:oi,filter:[{field:at,value:o}]},ct.fieldFilter=[vt,at],pt={valueIndex:g.length,args:ct,entryKey:yt},a.push(pt),b?pt.resolve=!0:b=ut[o]={v:null},o=null)}else o===""?o=null:typeof o=="number"&&s.Type.match(/^Date/)?o=k(o):typeof o=="string"&&o&&s.Type!="String"&&(wt={NewValue:o},bt=t.dataView._validateFieldValueFormat(t.fields[nt],wt),bt?rt.push(s.HeaderText+": "+bt):(o=wt.NewValue,typeof o=="number"&&s.Type.match(/^Date/)&&(o=new Date(o))));g.push({field:nt,newValue:o,modified:!0});ui.indexOf(s)!=-1&&lt.push({field:s.Name,value:ht[v]})}if(kt=t.context.masterKey,c={index:t.index,type:"submit",command:"Insert",values:g},kt&&kt.forEach(function(n){g.push(n)}),rt.length?(c.error=rt.join("\n"),h(c)):lt.length?(a.length&&(c.requests=a),c.filter=lt,u.test.push(c)):a.length?(c.type="lookup",c.requests=a,u.lookup.push(c)):u.submit.push(c),e()-pi>8)break}t.mode="send"}else if(t.mode=="send"){if(!t.busy){function si(n){var t=i.import.state;t.busy=!1;t.mode="error";t.error=n.get_message()}if(u.submit.length)t.busy=!0,w=[],ft=0,$(u.submit).each(function(n){if(n>9)return!1;for(var t=this,u=[],r,f,i=0;i<t.values.length;i++)r=t.values[i],r&&(u.push(r),r.newValue!=null&&(f=!0));f?w.push({command:t.command,controller:st,view:ri,values:u,_src:t}):ft++}),u.submit.splice(0,w.length+ft),t.count+=ft,w.length?(t.message=ei.InsertingRecords,i.execute({batch:w,done:function(n){var t=i.import.state;t.busy=!1;t.count+=w.length;w.forEach(function(t,i){var r=n[i];r.errors.length&&(t._src.error=r.errors.join("\n"),h(t._src))})},fail:si})):t.busy=!1;else if(u.test.length)t.busy=!0,t.message=ei.TestingRecords,tt=[],dt=t.duplicate.accept,$(u.test).each(function(n){if(n>9)return!1;var t=this;tt.push({controller:st,view:ri,filter:t.filter,requiresRowCount:!1,fieldFilter:["_pk_only"],_trc:t})}),u.test.splice(0,tt.length),i.execute({batch:tt,done:function(n){var t=i.import.state;t.busy=!1;n.forEach(function(n,t){var f=n[st],i=tt[t]._trc,e,s,c,r,o,l;if(f.length==0)i.requests?(i.requests.forEach(function(n){n.resolve=!1}),u.lookup.push(i)):u.submit.push(i);else if(dt.length)if(f.length==1){if(i.command="Update",e=i.values,c=0,e.forEach(function(n,t){dt.indexOf(n.field)==-1?e[t]=null:c++}),c){r=i.requests;for(s in f[0])e.push({field:s,oldValue:f[0][s],modified:!1});if(r)for(o=0;o<r.length;)l=r[o],l.resolve=!1,e[l.valueIndex]?o++:r.splice(o,1);r&&r.length?u.lookup.push(i):u.submit.push(i)}}else i.error=ei.Duplicates+": "+f.length,h(i)})}});else if(u.nextLookup<u.lookup.length){t.busy=!0;for(var a=[],hi=[],wi=u.nextLookup,ci,et,bi=10;bi-->0;)if(et=u.nextLookup++,u.lookup[et].requests.forEach(function(n){n.args._ilc={lookupIndex:et,valueIndex:n.valueIndex,entryKey:n.entryKey};n.resolve?hi.push(n.args):a.push(n.args)}),et==u.lookup.length-1)break;ci=u.nextLookup-1;t.message=ei.ResolvingReferences;function li(){var n,i;for(hi.forEach(function(n){var r=u.lookup[n._ilc.lookupIndex],i=t.lookupCache[n._ilc.entryKey][n.filter[0].value];i.v!=null&&(r.values[n._ilc.valueIndex].newValue=i.v)}),n=wi;n<=ci;n++)i=u.lookup[n],i.error?h(i):u.submit.push(i)}a.length?i.execute({batch:a,done:function(n){var t=i.import.state,u=t.queues;t.busy=!1;n.forEach(function(n,i){var f=a[i],e=n[f.controller],s=f._ilc.lookupIndex,o=u.lookup[s],h=t.lookupCache[f._ilc.entryKey][f.filter[0].value];e&&e.length?h.v=o.values[f._ilc.valueIndex].newValue=e[0][n.primaryKey[0].Name]:o.error=String.format('{0}: {1} = "{2}"',r.DidNotMatch,n.map[f.filter[0].field].Label,f.filter[0].value)});li()},fail:si}):(t.busy=!1,li())}else u.test.length&&(t.mode="done");t.index<p.length?t.mode="scan":!u.submit.length&&u.nextLookup>=u.lookup.length&&!u.test.length&&!t.busy&&(t.mode="done")}}else t.mode=="error"&&(vi=t.error);gt=e();ni=new Date(e()-t.started);t.status.html(String.format("{0:N1}% {1}<br/>{2}...<br/>{3}: {4}<br/>{5}: {6}",t.count/p.length*100,ei.Complete,t.message||ei.TestingRecords,ei.Expected,ni<6e4?r.Dates.InAMin:ad(new Date(gt+Math.round(ni/(t.count||1)*(p.length-t.count))),new Date(gt)),ei.Remaining,p.length-t.count));t.mode=="done"&&(n.pageInfo()._canceled=!0,ai=t.dataView,di(function(){u.errors.length&&hv("errors_"+f.name+".csv",u.errors.join("\r\n"));setTimeout(function(){i.alert(String.format("{0} <b>{1}<\/b> {2} <b>{3}<\/b>.",ei.Done,f.name,ei.Into,ai.get_view().Label),function(){hs(f.context.id)})})}),t=null)}t&&t.mode!="error"&&requestAnimationFrame(d)}if(u=="upload")nt();else{if(u=="supports")return extension=f.name.match(/\.(\w+)$/),extension&&!!extension[1].match(/^(csv|xlsx|xls)/i);if(u=="parse"){n.busy(!0);$(".app-glass-pane").addClass("app-glass-pane-reject");var s=new FileReader,c=f.file;l(c.name)=="csv"?s.readAsText(c):s.readAsArrayBuffer(c);s.onload=function(){try{$.csv?w():$.getScript(__baseUrl+"js/lib/import.min.js",w)}catch(t){n.busy(!1);$app.alert(t.message)}};s.onerror=function(t){n.busy(!1);$app.alert(t.message)}}else u=="map"&&b()}};$(document).on("vclick",".app-bar-actions h3, .app-echo-toolbar h3",function(t){var e=$(this).closest(".app-echo"),s=e.length?e.attr("data-for"):c().id,r=$(t.target).closest("h3"),h=r.offset(),f=[],l=n.contextScope(),a,u;return r.addClass("app-selected"),a=gk(),n.contextScope(s),sg(f,!1,!0),u=$.Event("viewselector.dataview.app"),u.items=f,u.dataView=i.find(s),$(document).trigger(u),n.contextScope(l),hi({anchor:r,items:f,iconPos:"left",dropDown:!o,y:h.top+r.outerHeight(),y2:h.top}),!1}).on("vclick",".app-bar-actions .ui-btn, .app-echo-toolbar .ui-btn",function(t,i){function s(){var t=u.context&&u.context.group,i=[],n;t?(n=c(h).dataView,ys(t.Id,n,i,n.extension().commandRow()),hi({items:i,iconPos:"left",defaultIcon:"carat-r",scope:n._id,anchor:r,y:e.top+r.outerHeight(!0)/4*3,y2:e.top,dropDown:!o})):u.callback(u.context)}var f=$(this).closest(".app-echo"),h=f.length?f.attr("data-for"):c().id,r=$(t.target).closest("a"),e=r.offset(),u=r.data("data-context");if(u)return r.length&&!n.busy()&&(i!=!1?it(r,s):s()),!1});lg={plus:"add",edit:"edit",trash:"delete",duplicate:"content-copy",search:"search",phone:"phone",email:"email",power:"power-settings-new",user:"account-circle",account:"perm-identity",refresh:"refresh",apps:"apps"};$.fn.popupopen=function(n){return s.focus(),this.popup("open",n),this};typeof Web=="undefined"&&(Web={DataView:{}});Web.DataView.MobileBase=function(){Web.DataView.MobileBase.initializeBase(this)};Web.DataView.MobileBase.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},notify:function(){},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().inserting()},editing:function(){return this.dataView().editing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){var i=this,r,t;return arguments.length==0?i._commandRow:n?(r=i._commandRow=n.slice(0),t=i.dataView(),t._rows=[r.slice(0)],t.get_isForm()||(t._editRow=null,t._originalRow=null),r):n},command:function(n,t,i,r,u){var e=this,f=e.dataView(),o=0,s=f._keyFields,h;n&&!n.length&&(s.length&&s[0].Name in n?(h=n,n=[],$(f._allFields).each(function(){n.push(h[this.Name])})):(n=null,o=null));e.commandRow(n);f.executeRowCommand(n?o:null,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView().a;arguments.length==1?(a=arguments[0],this.executeRowCommand(0,a.CommandName,a.CommandArgument,a.CausesValidation,a.Path)):e.executeAction(0,t,i,r,u,f)},itemMap:function(n){return sut(this.dataView(),n)},stateChanged:function(){bt()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!=!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(ep.DefaultDescriptions[n],!0,n):"",n?n.replace(/\n/g,"<p/>"):null},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u==n&&(t==null||i.argument==t))return f=i,r||rr(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n,t){var u=this,i=u.dataView(),r,f=ce(i),e=i?i.get_filter():null,o=f.length>0,s=i&&e.length>0&&!i.filterIsExternal();return(s||o)&&u.options().filterDetails?(r=new Sys.StringBuilder,o&&!t&&i._renderFilterDetails(r,f,!1),s&&i._renderFilterDetails(r,e,!n),r.toString().replace(yn,"").replace(pn,'"').replace(wn,'"$1')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},_disposeSession:function(){var r=this.dataView(),t=r._pageSession,n,i;if(t){for(i in t)n=t[i],n&&typeof n=="object"&&(n.length==1&&n[0]&&n[0].tagName=="STYLE"&&n.remove(),delete t[i]);delete r._pageSession}},focus:function(n,i){var u=this,r=y('[data-input-container="'+u._dataView._id+'"]');r.length&&t.focus({container:r,fieldName:n,message:i})}};Web.DataView.Extensions={};Web.DataView.prototype.pageProp=function(n,t){if(n=this._id+"_"+n,arguments.length==1)return lu(n);lu(n,t)};Web.DataView.prototype.viewProp=function(n,t){if(n=(this._viewId||"grid1")+"_"+n,arguments.length==1)return this.pageProp(n);this.pageProp(n,t)};Web.DataView.prototype.session=function(n,t,i){var u=this,r=u._pageSession;if(r||(r=u._pageSession={}),n=(i||u._viewId||"grid1")+"_"+n,arguments.length==1)return r[n];t?r[n]=t:delete r[n]};Web.DataView.prototype.sessionRemove=function(n){var r=this,t=r._pageSession,u=[],i;if(t){n=r._viewId+"_"+n;for(i in t)i.indexOf(n)==0&&u.push(i);u.forEach(function(n){delete t[n]})}};Web.DataView.prototype.mobileUpdated=function(){var t=this,f,e,s,r;t.tagged("history-search-none")&&lu(t._id+"_*",{viewTabs:null,viewId:null,filter:null,advancedSearchFilter:null,quickFind:null});t._startPage||t.get_useCase()||t.get_lastCommandName()||(f=t.pageProp("viewId"),f&&(t._viewId=f),e=t.viewProp("sortExpression"),s=t.viewProp("groupExpression"),r=t.viewProp("filter"),e&&(t._sortExpression=e),s&&(t._groupExpression=s),r&&r.length&&(t._filter=(t._filter||[]).concat(r)));var l=$(t._element),u=ng(l,document.title),a=i.eval(l.attr("data-page-header")),v=n._dataText,h={id:t.get_id(),text:a||u.text,headerText:v||a||u.text,dataView:t,activator:u};v&&(h.headerTextLocked=!0);n._dataText=null;t._pageSize=af.match(/iPad;.*CPU.*OS \d_\d/i)||!o?30:30;c(h);t._hidden||t._filterSource||n._appLoaded||$('<a class="app-action-navigate"/>').attr("href","#"+h.id).appendTo($("<li>").appendTo(n.pageMenu())).text(u.text);$(t._element).remove();t._element=null};Web.DataView.prototype.gridSettings=function(n){var t=this,i,r;if(arguments.length){if(n){for(i in n.width);for(r in n.hidden);n.sequence.length||i||r||(n=null)}t.viewProp("gridSettings",n)}else return n=t.viewProp("gridSettings"),n||(n={sequence:[],width:{},hidden:{}}),n};Web.DataView.prototype.gridChanged=function(){var n=this;ls(n);ty(n);yr();ef();ge();lr();no()};Web.DataView.Extensions.Grid=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.Extensions.DataSheet=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.MobileGrid=function(n){Web.DataView.MobileGrid.initializeBase(this);this.dataView(n)};Web.DataView.MobileGrid.prototype={initialize:function(){var n=this,t=n.dataView().pageProp("viewStyle");t||(n.tagged("view-style-map")&&!n.tagged("view-style-map-disabled")?t="Map":n.tagged("view-style-cards")&&!n.tagged("view-style-cards-disabled")?t="Cards":n.tagged("view-style-list")&&!n.tagged("view-style-list-disabled")?t="List":n.tagged("view-style-grid")&&!n.tagged("view-style-grid-disabled")?t="Grid":n.tagged("view-style-charts")&&!n.tagged("view-style-charts-disabled")?t="Charts":n.tagged("view-style-calendar")&&!n.tagged("view-style-calendar-disabled")?t="calendar":(t=f.width>480?"Grid":"List",$(n._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle!=1)return t="Cards",!1}),$(n._dataView._fields).each(function(){if(this.Rows>1)return t="List",!1})));n._viewStyle=t},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(t){var i=this,r=i.dataView(),u=i._viewStyle,f,e;if(arguments.length==0)return u;f=y();e=u;i._viewStyle=t;f&&(r.pageProp("viewStyle",t),i._instructed=!1,n.presenter("supports",t)||(i._reset=!0),t=="Grid"&&nrt(r),r.sync());bt()},tap:function(t,i){var u,e,o;if(t){var r=this.dataView(),s=c(r),f=t.row||t;r._busy()||n.busy()||(r._hasKey()?(this.command(f,"Select"),u=r.headerField(),e=f[u.Index],e&&(n._dataText=u.format(e),u.TextMode==2&&(n._dataText=be(n._dataText))),t.pageIndex!=null&&this.currentPageIndex(t.pageIndex),i&&hc(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1}),i&&i!="select"||(this.lookupInfo()?this.executeInContext("Select"):(o=[],n.navContext(o),$(o).each(function(){var n=this;if(n.text&&n.icon!="dots"&&!n.system&&!n.isStatic)return rr(n),!1})))):n.infoView(r,!0,f),bt())}},clearSelection:function(n){var r=this,t=r.dataView(),u=t._selectedKey,i;if(u&&u.length){if(t.multiSelect()&&t._selectedKeyList.length){uv(t);return}i=$.Event("clear.dataview.app");t._clearSelectedKey();t._forgetSelectedRow(!0);r._commandRow=null;r.currentPageIndex(null);i=$.Event("clear.dataview.app");i.dataView=t;$(document).trigger(i);n&&(fs(t).find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),c(t).page.find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected ui-btn-active"),tf(t));bt()}},quickFind:function(n){var i=this.dataView(),t,u,r;if(arguments.length){if(n&&st("search.quickFind.history.enabled")){for(t=i.viewProp("quickFindHistory"),u=e("search.quickFind.history.depth")||100,t||(t=[]),r=t.indexOf(n),r>-1&&t.splice(r,1),t.splice(0,0,n);t.length>u&&t.length;)t.splice(t.length-1,1);i.viewProp("quickFindHistory",t)}i.viewProp("quickFind",n);i._executeQuickFind(n);ek(i)}else return i.viewProp("quickFind")||""},dispose:function(){var u=this,i=u.dataView(),r=i._lookupInfo,f=c(i),t=f?b(f.page):null;t&&(n.presenter("dispose",{id:i._id,container:t}),ke(t),t.prev().find("h3, .app-bar-controls").off(),t.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(pg(n),n.map=null,t.data("data-map",null))}));r&&(r.field=null,r.callback=null);u._disposeSession()},refresh:function(){function or(r){if(s.requiresInitCallback)return s.initCallback=function(){t.get_searchOnStart()?ri(function(){setTimeout(function(){i.search("show",t._id)},100)}):r()},s.requiresInitCallback=!1,n.navigate(s.id),!0;r()}function li(n){n?(fr=l.css("display")!="block",fr&&(l.css({display:"block","z-index":-10}),ui(l))):fr&&(da(l),l.css({display:"","z-index":""}))}function fu(){if(!gu){var n=t.get_selectedKey();t._selectedKeyList=n.length?[n.join(";")]:[];to(t)}}function eu(){var i=t.get_master(),u,n,r;i&&(i.inserting()?ir(s.text,nt):(u=i.extension().commandRow(),n=i._fields[0],n=i._allFields[n.AliasIndex],r=n.format(u[n.Index]),n.TextMode==2&&(r=be(r)),ir([r,s.text],nt)));t._lookupInfo&&s.headerText!=!1&&(ir(s.headerText,nt),ii!=0&&(l.attr("data-page-header",!1),ir(!1,nt)))}function su(n){var i=$('<li data-icon="false" class="dv-item"/>').appendTo(n),r=$('<a class="ui-btn app-divider app-calculated"/>').appendTo(i);return ss(t,ct,null,r,u.aggregateLabels()),i.find(".app-field").attr("data-tooltip-location","above"),i}function of(){var c;if(li(!0),n.bar(d?"show":"hide",ni),ct&&(d&&at?h[0].scrollHeight-p(at,"margin-bottom")<h.height()?n.bar("hide",b):(at.prev().addClass("ui-last-child"+(at.is(".app-has-promo")?" app-has-promo":"")),at.remove(),n.bar("show",b)):(n.bar(ct?"show":"hide",b),c=!0)),d&&(de(t),wd(t,ni),ef(o)),c||ui(l),g||!u._synced){if(lk(t,l,d),eu(),w.length){var i=h.offset().top,f=h.height(),e,r=Math.ceil(w.offset().top),a=w.outerHeight(!0);function y(n,t){var i=n.find("p");t+=p(n,"height");n.css("height",t);i.css("margin-top",(t-i.outerHeight())/2)}ot=h.scrollTop();ut&&ut>0&&ut+a<f?(r-i<ut?y(o.find(".dv-load-at-top"),ut-(ot+r-i)):(e=h[0].scrollHeight,e-(ot+r-i-ut)<f&&y(o.find(".dv-load-at-bottom"),f-(e-(ot+r-i-ut)))),gr(h,ot+r-i-ut)):gr(h,ot+r-i-(f-a)/2);g&&t.raiseSelected()}else if(u._synced||!t.get_selectedKey().length||t._lookupInfo)u.clearSelection();else{function k(){wt()!=s.id||rt?setTimeout(k,50):t.sync()}k()}u._synced=!0;w&&w.length&&t.multiSelect()&&tu(!0,fv(o),od(t),w.find(".app-btn-check"))}else w&&w.length&&!g&&!v&&ci!=null&&gr(h,h.scrollTop()+w.offset().top-h.offset().top-ci);vr(l);l.find(".ui-header-fixed").length&&l.addClass("app-has-fixed-bar");li(!1);pi(!1)}var u=this,tt=u.pageIndex(),bu=u.pageCount(),t=u.dataView(),gt=t._totalRowCount,s=c(t),ku=t._fields,du=t._allFields,st=u.content(),l=s.page,lt=u.visibleDataRows(tt),o=st.find('ul[data-role="listview"]').show(),gi,ni=l.find(".app-bar-hscrollbar"),b=l.find(".app-bar-aggregates"),at,ct=u.aggregates(),ti=this.pageSize(),g=u._reset,gu=t._keepKeyList,br=tt>0,dr=tt<bu-1,si,nr,ru=t.get_showRowNumber()==!0,y=u.viewStyle(),d,h=st,ot=h.scrollTop(),hi,ci,ut,nt=h.find(".app-page-header"),rr,ur,fr,nf,uu,vt=st.prevAll(".app-bar-actions"),sr,hr,cr,lr,ft,ar,au,kt,ht,yi,bi,vu,ei,yu,oi,ki,di,pu;if(u.echoCallback){u.echoCallback();return}if(!lt){g&&uo(o);t.goToPage(tt,!0);return}if(sr=t._pendingNotification,sr&&(n.notify(sr),t._pendingNotification=null),s.echoId&&!s.echoInitialized){iu(s.echoId);s.displayed||(s.initialized=!1);return}if(t._keepKeyList=!1,g&&(s.echoChanged=!0,u.currentPageIndex(tt)),!rt&&s.id!=wt()&&s.id!=dp&&!t._lookupInfo){fu();hu();t._keepKeyList=!0;return}if(s.initialized=!0,s.displayed=!0,n.makeModalOrPanel(s),hr=t.tagged(/\bpage\-header\-(\w+)\b/),hr&&(hr[1]=="none"?(s.headerText=!1,ir(!1,nt)):l.addClass("app-page-header-show")),s.headerText!=!1&&yd(t,l,nt),kd(t),u._autoSelect&&(cr=u._autoSelect,u._autoSelect=null,ri(function(){u.tap(cr.row,cr.action)})),s.loading&&(s.loading=!1,l.find(".app-page-loading").remove()),w=o.find("a.app-selected").first(),w.length&&(ci=w.offset().top-h.offset().top),g&&(ut=ci,fu()),t._requiresContextRefresh&&(t._requiresContextRefresh=!1,bt()),u._checkedViews||(u._checkedViews=!0,!t._lookupInfo&&t.get_showActionBar()?vt=trt(t,st):(rr=[],oy(rr,!1,s)>1&&(ur=[],$(rr).each(function(){var n=this;ur.push({text:n.text,active:n.icon=="checked",callback:n.callback})}),n.tabs("create",{tabs:ur,className:"ui-header-fixed app-tabs-views",id:t._id+"_viewTabs",scope:"page",placeholder:st}),s.headerText=!1,ir(!1,nt),nf=!0))),vt.length&&nt.addClass("app-has-action-bar"),n.presenter("supports",{name:y,id:t._id})){function tf(){return t._rows.forEach(function(n){if(t.rowIsSelected(n))return u.commandRow()?u.commandRow(n):(t._forgetSelectedRow(!0),u.command(n,"Select")),!1}),ac(vt,t,s),wa(h,u),n.bar("hide",ni),n.bar("hide",b),result=n.presenter("show",{name:y,id:t._id,container:h,reset:g}),eu(),result}or(tf);u._reset=!1;return}if(y.match(/Grid|Cards|List|Map/)||(y=u._viewStyle=vb()?"Grid":"List",t.pageProp("viewStyle",y)),t.groupBy(),d=y=="Grid",nr=u.itemMap(y=="List"),he(t,nr.thumb!=null),rk(h,u,y=="Map"),y=="Map"){if(n.bar("hide",ni),n.bar("hide",b),st.find('ul[data-role="listview"]').hide(),lb(l),!u.tagged("supports-view-style-map")){u.viewStyle(f.width>480?"Grid":"List");bt();return}if(pc(),g){u._reset=!1;u._mapPageWindow=null;lr=!1;$(lt).each(function(){if(t.rowIsSelected(this))return lr=!0,u.tap(this,"none"),!1});lr?t.raiseSelected():u.clearSelection();u.refresh();return}ir(!0);li(!0);wa(h,u);ac(vt,t,s);ft=h.find("> .app-map");ft.length||(ft=$('<div class="app-map"><\/div>').appendTo(h).attr("data-map-for",t._id).hide());n.registerAPI("Map")||(h.find(".app-presenter-instruction").hide(),$('<div class="app-api-error">Google MAP API Key is required. Specify a valid key in <i>Settings | Features | Touch UI<\/i> section of your project properties.<br/><br/><a href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="external">Get The Key Now!<\/a><\/div>').appendTo(ft.empty().show()));vr(l);li(!1);function uf(i){function f(){var c=s!=n.asyncJob(),o,l,e,h;if(r.length&&!c)o=r[0],l=new Date,i.geocoder.geocode({address:o.address},function(n,e){var s,h,c,a;if(e==google.maps.GeocoderStatus.OK)s=n[0].geometry.location,h=wg(u,ft,s,o.title,o.row),t.rowIsSelected(o.row)&&wc(i,h),yg(o.address,s.lat(),s.lng()),hy(i),bc(h,750,google.maps.Animation.DROP);else if(e==google.maps.GeocoderStatus.ZERO_RESULTS)yg(o.address);else if(e==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(f,1e3);return}r.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(function(){f()},a-c):f()});else{if(!c&&r.length==0&&i.markers.length<rtt&&(e=u._mapPageWindow,e||(e=u._mapPageWindow={top:tt,bottom:tt,dir:"up"}),e.dir=="up"?e.bottom<u.pageCount()-1?(e.bottom++,e.dir="down"):e.top--:e.top>0?(e.top--,e.dir="up"):e.bottom++,h=e.dir=="down"?e.bottom:e.top,h>=0&&h<u.pageCount()-1)){u.pageIndex(h);u.refresh();return}c||(pi(!1),u._mapPageWindow=null)}}var o=vg(t),r=[],s=n.nextAsycJob(),e;i.fit=!0;u._mapPageWindow==null&&pg(i);$(lt).each(function(){var n=this.slice(0),f=lut(n,o),s=du[ku[0].AliasIndex],h=s.text(n[s.Index]);typeof f=="string"?f!="ZERO_RESULTS"&&(r.push({address:f,title:h,row:n}),i.geocoder||(i.geocoder=new google.maps.Geocoder)):(e=wg(u,ft,f,h,n),t.rowIsSelected(n)&&wc(i,e))});hy(i);pi(!0);f()}function ou(){var t=ft.data("data-map");t?(ft.show(),ba(h),uf(t)):n.supports("Map")?(t={map:new google.maps.Map(ft.get(0),{zoom:8}),geocoder:null,markers:[]},ft.data("data-map",t).show(),u.refresh()):setTimeout(ou,100)}or(ou);u._reset=!1;nu(st);return}ip||(hi=$('<div class="app-scrollable-cover"><\/div>').appendTo(h.parent()).css({position:"absolute",left:h.offset().left,top:h.offset().top,width:kr(h),height:h.outerHeight(),zIndex:2,backgroundColor:tr?"transparent":"#fff"}));o.length||(o=$('<ul data-role="listview" class="app-listview"/>').addClass(sc(t)).appendTo(st).listview().on("taphold",function(n,i){if(i&&(n=i),irt())return!1;if(!t._busy()){var e=$(n.target),r=e.closest("a"),h=r.data("data-context"),f=t.multiSelect()&&!1;return r.closest("li").is(".dv-item")&&!r.is(".app-divider")&&(r.is(".app-selected")?(r.removeClass("app-selected"),f||(u.clearSelection(),u.lookupInfo()?it(r,function(){u.executeInContext("Clear")}):it(r,function(){}))):t._hasKey()&&(f||cc(o),r.addClass("app-selected"),u.tap(h,"none"),s.echoChanged=!0,it(r)),si=!0),!1}}).on("vclick",function(i){function p(n){t._busy()||(u._loadAtTop=!n,u.pageIndex(u.pageIndex(n?"bottom":"top")+(n?1:-1)),u.refresh())}var f=$(i.target),r=f.closest("a").removeClass("ui-btn-active"),c,l,a,y,h,v,e,w;if(!f.is(".app-btn-toggle,[data-href]")){if(l=f.closest(".app-field"),l.length&&(a=l.find("[data-href]"),a.length))return setTimeout(function(){a.trigger("vclick")},10),!1;if(r.length&&!r.is(".app-divider")){if(r.is(".dv-load-at-bottom"))p(!0);else if(r.is(".dv-load-at-top:visible"))setTimeout(function(){p(!1)},50);else{if(si){si=!1;return}if(!cu(f)||n.busy())return!1;if(i.ctrlKey)return o.trigger("taphold",i),si=!1,!1;if(r.is(".dv-action-none")||ud(i,t))return!1;c=t.multiSelect();c&&rv(i)?ov(t,r):(h=r.data("data-context"),v=fd(i),h?(c&&r.find(".app-btn-check").addClass("app-btn-check-selected"),o.find("a.app-selected").removeClass("app-selected ui-btn-active"),v?(f=ed(f),e=function(){ee(t,r);u.tap(h,"none");ps(f)}):e=function(){t._hasKey()?(r.addClass("app-selected"),v||(ee(t,r),u.tap(h)),s.echoChanged=!0):u.tap(h)}):r.is(".dv-action-refresh")?e=function(){hs(t._id)}:r.is(".dv-action-new")?e=function(){u.executeInContext("New",null,!1)}:r.is(".dv-action-filter-clear")&&(e=function(){pa(t,!0)}),e&&(e(),it(f)))}return!1}if(y=f.closest(".app-group"),y.length)return f.is(".app-group")||(w=f.closest(".app-group").find(".app-group-path,.app-group-title").addClass("ui-btn-active"),setTimeout(function(){w.removeClass("ui-btn-active");uy(!0)},dt)),!1}}).contextmenu(function(n){return nn(u.dataView(),n)}),bv(t,o),!b.length&&ct&&(gi=n.bar("create",{type:"footer",page:l}),ar=gi.find('[data-location="bottom"]'),b=$('<div class="app-bar-aggregates"><\/div>'),ar.length?b.insertBefore(ar.first()):b.appendTo(gi)),ni.length||y!="Grid"||de(t));g&&uo(o);g!=!1&&b.length&&ct&&(d?su(aggregateListView=$('<ul class="ui-listview app-listview app-grid"/>').appendTo(b.empty())):bd(t,b.empty(),ct));oit(o,y);y=="Grid"&&de(t);ac(vt,t,s);kv(t,o);var et=o.find(".dv-item"),yt=et.length>ti*2,pt=o.find("li").last(),a,ii,v=u._loadAtTop,w,fi,pr,wr=pt&&pt.length&&pt.prev(),ff=wr&&wr.position().top,lu,ai,vi;lu=grt(o);(br&&pt.length==0||yt&&!v&&!o.find("li.dv-load-at-top-parent").length)&&(nt.hide(),a=$(String.format('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"><p>{0}<\/p><\/a><\/li>',er)),yt?(a.insertBefore(et.get(0)),br=!0):a.appendTo(o));v?(a=o.find("li").first(),a.is(".app-list-instruction")&&(a=a.next()),fi=a.length&&a.next(),pr=fi&&fi.position().top+lu,lt=lt.slice(0).reverse()):pt.remove();ii=tt*ti;au=la(t);$(lt).each(function(n){var i=this,r=$('<li class="dv-item" data-icon="false"/>'),e=v?ii+ti-n:ii+n+1,f=$('<a class="ui-btn"/>').appendTo(r).data("data-context",{row:this.slice(0),pageIndex:tt});t.rowIsSelected(i)&&(f.addClass("app-selected"),u.commandRow()?u.commandRow(i):(t._forgetSelectedRow(!0),u.command(i,"Select")));v?r.insertAfter(a):r.appendTo(o);d?ss(t,i,ru?e:null,f):rf(t,i,nr,ru?e:null,r,f,y=="List");oe(t,i,r,au)});(dr&&!v||yt&&v&&!o.find(".dv-load-at-bottom-parent").length)&&(pt=oi=$(String.format('<li data-icon="false" class="dv-load-at-bottom-parent"><a class="dv-load-at-bottom"><p>{0}<\/p><\/a><\/li>',er)).appendTo(o));v&&tt==0&&a.remove();(!gt||t.get_searchOnStart())&&(ai=$('<li><a class="dv-action-refresh ui-btn ui-btn-icon-left ui-icon-refresh"><p/><\/a><\/li>').appendTo(o).find("a"),ai.attr("title",wu.Refresh).find("p").text(wi.NoRecords),t._filter&&t._filter.length&&!t.filterIsExternal()&&(vi=$('<li><a class="dv-action-filter-clear  ui-btn ui-btn-icon-left ui-icon-clear"><p/><\/a><\/li>').appendTo(o).find("a"),vi.attr("title",r.ClearFilter).find("p").text(r.ClearFilter)));dr||(ct&&d&&gt>0&&(at=su(o)),e("ui.actions.promote")?uu=!0:vt.length||(kt=u.executeInContext("New",null,!1,!0),kt&&(yi=$('<li class="dv-action-new">').appendTo(o).attr("data-icon",kt.icon),ht=$('<a class="dv-action-new"/>').appendTo(yi).attr("title",r.LookupNewAction),d?$("<p>").appendTo(ht).text(kt.text):($("<h3>").appendTo(ht),bi=yi.prev(),bi.is(".dv-item")&&(ht.html(bi.find("a").html()).find("p,img,span").css("visibility","hidden"),bi.is(".ui-li-has-thumb")&&yi.addClass("ui-li-has-thumb")),ht.find("h3").text(kt.text),gt||$("<p>").appendTo(ht.html("")).text(kt.text)))));v&&(l.attr("data-page-header",""),s.headerText!=!1&&ir(ii==0,nt));vu=o.find("li").first();ei=u.instruction();(ei||d)&&!o.find(".app-list-instruction").length&&(oi=$('<li data-role="list-divider" class="app-list-instruction"/>').insertBefore(a?a:vu),ei&&$('<span class="app-view-instruction"/>').appendTo(oi).html(ei),d&&!!gt&&(yu=sv(t,oi),ei||yu.addClass("app-grid-header-no-description")),oi.toggleClass("app-no-records",gt<1));v&&a&&a.find(".ui-btn").css("height","").find("p").css("margin-top","");yt&&(v?(et=et.slice(ti*(tr?2:2)),et.find("a").data("data-context",null),et.remove(),o.find("li.dv-action-new").remove()):(nt.hide(),ki=$(String.format('<li style="clear:left;height:{0}px"><\/li>',k.getScreenHeight()*10)).appendTo(o),o.find("li.app-li-card").remove(),et=et.slice(0,ti),et.find("a").data("data-context",null),et.remove().empty()));nut(t,o);yr(o);o.listview("refresh");uu&&o.find("li.dv-item").last().addClass("app-has-promo");w=o.find("a.app-selected");ut==null&&(yt?v?(di=fi.position().top,gr(h,ot+di-pr)):(pu=wr.position().top,gr(h,ot+pu-ff)):v?(di=fi.position().top,gr(h,ot+di-pr)):v==null&&gr(h,0));ki&&setTimeout(function(){ki.prev().addClass("ui-last-child");ki.remove()},100);d&&(ai&&ai.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),ht&&ht.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),vi&&vi.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));of();or(function(){no(g?10:200)});hi&&(tr&&yt?setTimeout(function(){hi.remove()},300):hi.remove());u._reset=!1;u._loadAtTop=null},reset:function(){var r=this.dataView(),n=c(r),u="#"+n.id,t=k.navigate.history,i;this._reset=!0;$(t.stack).each(function(n){return n>t.activeIndex?!1:this.hash==u?(i=!0,!1):void 0});i||(n.initialized=!1,n.echoInitialized=!1,n.echoId=!1)},visibleDataRows:function(n){var u=this._dataView,i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},currentPageIndex:function(n){return arguments.length&&(this._currentPageIndex=n),this._currentPageIndex},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n=="bottom"&&(i=this.content().parent().find("ul li.dv-item").last().find("a").data("data-context"),i)?i.pageIndex:n=="top"&&(r=this.content().parent().find("ul li.dv-item").first().find("a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var e=this,o=e.lookupInfo(),i,u=e.dataView(),c=e.viewDescription()||"",t=c?[c]:[],h=e.filterStatus(),s=u.groupExpression(),f;return o&&(t.length&&t.push(" "),i=o.field,t.push(String.format(i.ItemsDescription||r.LookupInstruction,i._autoAlias?i.AltHeaderText||i.HeaderText:i._dataView._allFields[i.AliasIndex].HeaderText)),o.value&&(f=o.text,f&&f.length>50&&(f=f.substring(0,50)+"..."),t.push(String.format(r.LookupOriginalSelection,f)))),u.multiSelect()&&t.push('<span class="app-multi-select-instruction">'+sd(u)+"<\/span>"),n!=!1&&(t.length||h||s)&&u._totalRowCount>1&&(t.length&&(t.push(" "),t.push(String.format(r.ShowingItemsInfo,u._totalRowCount))),$(s).each(function(n){var i=u.findField(this);i&&(n==0&&(t.length&&t.push(" "),t.push(r.GroupedBy," ")),n&&(n==s.length-1?t.push(" ",sp," "):t.push(", ")),t.push(i.HeaderText),n==s.length-1&&t.push("."))})),h&&(t.length&&t.push(" "),t.push(String.format('<span class="app-filter" title="{1}">{0}<\/span>',h,r.Filter))),t.join("")},context:function(n,i){var s=this,u=s.dataView(),y=u.extension(),h=u._totalRowCount,p=u.get_view().Label,w=u.get_sortExpression(),f=s.commandRow()||[],e=this.lookupInfo(),o,l=f&&f.length,v;if(h!=-1)if(u.get_showViewSelector()&&n.push({text:p,count:String.format("{0:N0}",h),icon:"gear",system:!0,toolbar:!1,transition:!0,callback:hg}),(u.get_showQuickFind()&&(h>1||u._busy()||u.get_filter().length>u.get_externalFilter().length)||ce(u).length)&&n.push({text:yf,desc:fk(u),descInTooltip:!1,icon:"search",toolbar:!1,system:!0,context:{dataViewId:u._id},callback:kb}),n.push({text:r.Sort,icon:"sort",transition:!0,desc:dv(u),toolbar:!1,system:!0,callback:drt}),n.push({text:r.Filter,icon:"filter",transition:!0,desc:y.filterStatus(!0,!0),toolbar:!1,system:!0,callback:hf}),n.push({text:r.Group,icon:"group",transition:!0,desc:gv(u),toolbar:!1,system:!0,callback:uy}),e&&e.value==null||n.push({}),cg(u,n,f),e||sy(u,n,f),e){o=e.field;function a(n,i,r){var u=t.methods.lookup._rowToValues(n,i,r);u&&di(function(){c(n._dataView._id).autoFocus=!1;e.change(u)})}l&&n.push({text:r.LookupSelectAction,icon:"material-icon-arrow-forward",command:"Select",callback:function(){a(o,c().dataView,f)}});e.value&&n.push({text:r.UnSelect,icon:"material-icon-clear",command:"Clear",callback:function(){a(o,c().dataView,null)}});String.isNullOrEmpty(o.ItemsNewDataView)||n.push({text:r.LookupNewAction,icon:"material-icon-add",command:"New",system:!0,callback:function(){s.executeInContext("New",o.ItemsNewDataView,!0)}});n.push({});l&&!o.tagged("lookup-details-hidden")&&n.push({text:r.LookupViewAction,icon:"material-icon-info-outline",callback:function(){Web.DataView._defaultUseCase="ObjectRef";s.executeInContext("Select","editForm1",!0)}});sy(u,n,f)}else i||(i=["Grid","ActionColumn","ActionBar"]),i.length==1&&i[0]=="Grid"&&$(u._views).each(function(){var n=this;if(n.Type=="Form"&&n.Id.match(/edit/))return v=n.Id,!1}),ys(i,u,n,f,v)}};Web.DataView.Extensions.Form=function(n){return new Web.DataView.MobileForm(n)};Web.DataView.MobileForm=function(n){Web.DataView.MobileForm.initializeBase(this);this.dataView(n)};Web.DataView.MobileForm.prototype={initialize:function(){this._editors={};this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose();this._disposeSession()},_disposeLayout:function(n){function t(n){var r,i;if(n)for(r=0;r<n.length;r++)i=n[r],t(i.children),i.children=null,i.self.removeData(),i.self=null}n=$(n);n.find(".app-data-list").remove();n.find(".app-drop-box").each(function(){i.upload("destroy",{container:this})});t(n.data("rootNodes"))},_disposeForm:function(n){var t=this;return n||(n=t.content()),n.find('[data-layout="form"]').each(function(){t._disposeLayout(this)})},_dispose:function(t){var u=this,e=u._dataView,r=this.content(),o,f;u._newValues=null;u._disposeForm(r);$(e._allFields).each(function(){var r=this,t;r._dataViewId&&(t=i.find(r._dataViewId),t._filterSource==e._id&&n.deletePage(t._id))});r.find(".app-status-bar, .app-bar-buttons,.app-stub,.app-form-grid").remove();o=r.parent().find('div[data-role="header"]');ke(r);f=r.find(".app-echo").each(function(){var t=$(this).attr("data-for"),n=c(t);n&&(n.echoId=null,n.echoInitialized=!1)});f.find(".app-echo-inner").off();f.find(".app-echo-footer").off();f.remove();n.tabs("destroy",{container:r});t&&bt();u._disposeSession()},viewStyle:function(){return"Form"},refresh:function(){function lt(){v&&gb(v);db(u);n.bar("show",w);n.refreshTitleState();n.refreshAppButtons(p,{buttonBars:f!="None"?w:[],layout:h,toolbar:!1,dataView:t})}var r=this,t=r.dataView(),at=r.editing(),i=c(t),yt=t._fields,pt=t._allFields,h,wt=t._categories,u=r.content(),l,a=[],p,v,d,w,et=this.inserting(),vt=this._reset,f=t.get_showActionButtons(),ot=t._confirmContext,e=i.page,g=e.find(".app-page-header"),st,y,s,nt,tt,it,ht,ut,k,ft;if(r._skipRefresh){r._skipRefresh=!1;return}if(vt&&(r._dispose(),r._commandRow=null),l=at?t.editRow():r.commandRow()||r._initRow()||[],n.makeModalOrPanel(i),bit(t,e,l),y=r.viewDescription(),y&&$('<div class="app-view-description"><\/div>').appendTo(g).html(y),s=ot&&ot.WindowTitle||t.get_view().Label,s&&(i.headerTextLocked?typeof i.headerText=="string"&&(i.headerText=typeof s=="string"&&!t.inserting()?[i.headerText,s]:s):(t.inserting()&&t._filterSource&&(nt=b(t._filterSource).find(".app-page-header h1").text()),i.headerText=nt?[s,nt]:s)),et&&g.attr("data-locked","false").data("data-text",null),tt=t.tagged(/page\-header\-(\w+)/),tt&&tt[1]=="none"&&(i.headerText=!1),!i.headerText==!1&&yd(t,e,g),e.is(".app-page-modal")||i.headerText==!1||$('<div class="app-page-header-placeholder dv-heading" data-selector=".app-page-title"><span class="app-static-text app-page-title"><span class="app-text"/><\/span><\/div>').appendTo(u),h=ob(t,kr(u)),d=t.statusBar(),d&&(v=$('<div class="app-status-bar"><\/div>').html(d).appendTo(u),it=v.find("li.Segment"),ht=it.length+10,it.each(function(n){this.style.zIndex=ht-n}),o&&v.css("overflow-x","auto")),y&&i.headerText==!1&&(ut=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(u),$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(ut).html(y),ut.listview()),t.tagged("action-buttons-none")&&(f="None"),(f=="TopAndBottom"||f=="Top")&&$('<div class="app-bar-buttons"><\/div>').appendTo(u),h.appendTo(u),(i.isModal||i.isPanel)&&f!="None"?f="Auto":f!="Auto"||aw()||(f="None"),f=="Auto"?w=$('<div class="app-bar-buttons"><\/div>').appendTo(n.bar("create",{type:i.isPanel?"header":"footer",page:e})):((f=="TopAndBottom"||f=="Bottom")&&$('<div class="app-bar-buttons"><\/div>').appendTo(u),w=u.find(".app-bar-buttons")),p=[],r.context(p),!et){a=[];function ct(){n.tabs("create",{tabs:a,className:"app-tabs-echo",scope:t.get_selectedKey(),change:function(){}})}$(n._pages).each(function(){var r=this,i,n,e,f=r.dataView,o=f&&f._filterSource;o&&o==t._parentDataViewId&&!f._dataViewFieldName&&(n=r.activator,n&&n.type=="Tab"&&($(a).each(function(){if(n.text==this.text)return i=this,!1}),i||(k!=n.container&&(k&&(ct(),a=[]),k=n.container),i={text:n.text,content:[]},a.push(i))),e=lv(r.id,u),i&&i.content.push(e))});k&&ct()}st=$('<div class="app-stub"><\/div>').appendTo(u);t.tagged("promo-none")&&st.addClass("app-hidden");r.stateChanged();r._reset=!1;i.requiresInitCallback?(ft=e.css("display")!="block",ft&&e.css({display:"block","z-index":-10}),t._unchangedRow=l.slice(0),f!="None"&&f!="Auto"&&n.refreshAppButtons(p,{buttonBars:u.find(".app-bar-buttons"),toolbar:!1,dataView:t}),sb(t,l,h),oe(t,l,h),t._isWizard&&ou("start",{layout:h}),lr(u),vr(e),ft&&e.css({display:"","z-index":""}),i.requiresInitCallback=!1,rt=!1,i.initCallback=lt,n.navigate(i.id)):lt()},collect:function(){var t=this,i=[],n=t.dataView(),f=n._allFields,r,e=t.inserting(),u;return u=n.editRow(),r=n._originalRow,$(f).each(function(n){var t=this,f=u[n],o=r[n];t.Type.match(/^Date/)&&(f=f!=null?new Date(f):null);t.Type=="DataView"||t.OnDemand||i.push({Name:t.Name,NewValue:f,OldValue:o,Modified:f!=o||f==null&&!t.AllowNulls&&!t.IsPrimaryKey,ReadOnly:!!(t.ReadOnly&&!(t.IsPrimaryKey&&e))})}),i},stateChanged:function(n){var r=this,u=r.dataView(),e=r.content(),i=e.find("[data-layout]"),f;i.data("prepared")?(f=u.editRow(),t.evaluate({dataView:u,row:f,container:i}),t.render({container:i,dataView:u,row:f}),n!=!1&&(bt(!1,0),gi(),r.editing()&&!o&&t.focus({container:i}))):bt()},context:function(n){var t=this,i=t.dataView(),r=t.commandRow(),u=t.editing();n.isSideBar||cg(i,n,r);u||sy(i,n,r);ys(["Form","ActionBar","Context"],i,n,r)}};i.alert=function(n,t){return fn({name:"_alert",message:n,submit:t,cancel:!1})};i.confirm=function(n,t,i){return fn({name:"_confirm",message:n,submit:t,cancel:i||ii})};$(document).on("alertconfirmed.app alertnotconfirmed.app",function(t){var r=t.rules.dataView(),i=r.survey(),u=t.type=="alertconfirmed",f=u?i._submit:i._cancel,e=i._promise;n.pageInfo(r)._canceled=!0;uf(!1);ri(function(){uf(!0);f?f():u?e.resolve():e.reject()})});at=Web.Menu={};at.Nodes={};v.$nextTabIndex=v.$closeHovers=ii;typeof Web.Membership!="undefined"&&(Web.Membership.prototype.initialize=function(){var n=this,t;if(gp=n.get_authenticationEnabled(),nw=n.get_displayMyAccount(),sh=n.loggedIn(),ctt=n.get_user(),t=n.get_cultures(),!String.isNullOrEmpty(t)&&!(__tf!=4)){var r={value:"Detect,Detect",text:wr.AutoDetectLanguageOption,selected:!1},u=[r];$(t.split(/;/)).each(function(){if(this.length){var n=this.split("|"),t={value:n[0],text:n[1],selected:n[2]=="True"};u.push(t);t.selected&&(r=t)}});i.cultureList=u}},Web.Membership.prototype.dispose=function(){},Web.Membership.prototype.updated=function(){if(fr=this,ve(),this.get_idleTimeout())$(document).on("awake.app",function(){return!fr.idle()});this.idleInterval(!0);n&&this.mobileUpdated()},Web.Membership.prototype._idle=function(){var n=this;n.idleInterval(!1);ay()},Web.Membership.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?wr.LogoutLink:wr.LoginLink).on("vclick",function(){return it(r,function(){i?ay():t.showLogin()}),!1})},Web.Membership.prototype.mobileUpdated=function(){var t=this;$(document).one("start.app",function(){t._allowLoginInMenu=t.get_displayLogin()});if(this.loginStatus('a[data-app-role="loginstatus"]'),!i.AccountManager.enabled())$(document).one("start.app",function(){n.returnUrl()&&!bh()&&n.showAccountManager(null)})},Web.Membership.prototype.showLogin=function(){n.showAccountManager(null,!0)});Web.Mobile=function(){var n=this,t;n._asyncJob=0;n._pageMap={};n._pages=[];t=$("#app-bar-toolbar");br&&t.css("visibility","hidden");n._toolbar=t;n._logo=t.find(".app-logo");n._actionButton=$(".app-btn-promo");n._toolbarButtons=t.find(".app-btn");n._title=t.find("h1").addClass("app-hidden");n._menuButton=$("#app-btn-menu");n._backText=t.find(".app-back-text").hide().attr("title",r.Back);n._contextButton=$("#app-btn-context");n._modalDataViews=[];n._modalStack=[];n._pagesToDelete=[]};Web.Mobile.prototype={settings:function(n,t){if(arguments.length==1)return e(n);e(n,t)},appName:function(){var t=this;return t._appName||(t._appName=n._logo.text()||$("#PageHeaderBar").text()||$('head meta[name="application-name"]').attr("content")),t._appName},height:function(){var n=f.height;return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},page:function(n){var t,i,r;return n||(n="Main"),t=$("#"+n),t.length||(t=$(String.format('<div data-role="page" id="{0}"><div data-role="content"><\/div><\/div>',n)).appendTo(s).page(),i=c(t),r=$('<div id="app-bar-heading" class="app-bar-heading"><div class="app-bar-text"><\/div><\/div>').hide().appendTo(t),i&&(i.page=t,i.stickyHeader=r,i.scrollable=oc(t).data("sticky-header",r),i.home&&i.dataView&&i.dataView.get_isForm()&&!i.dataView._selectedKey.length&&r.remove()),ui(t)),t},makeModalOrPanel:function(t){var u=t.page,i=t.dataView,et=t.home,w,o=!1,k,h,d,l,v,y,e,nt,tt,p,ft,it;if(i&&(i.tagged("content-stub-none")&&u.addClass("app-content-stub-hidden"),k=i&&i.tagged(/\bmodal\-dock\-(top|left|right|bottom)\b/),k&&(i.tagged("modal-fit-content")||!$(".app-page-modal-background").filter(ar).length)&&u.addClass("app-page-modal-dock app-page-modal-dock-"+k[1]),i.tagged("modal-gap-required")&&u.addClass("app-page-modal-gap-required"),i.tagged("modal-fullscreen")&&(u.addClass("app-page-modal-fullscreen"),w=!0)),!et&&($(".app-page-modal-root").length?o=!0:hh?(i.tag("modal-never-"+i.get_viewId()),t.headerText=!1,i.get_view().Label!=n.title()&&(t.backText=n.title())):(h=i&&i.tagged(/\bmodal\-(never|always|(when\-(tn|xxs|xs|sm|md|lg|xl|xxl)))\b/),h?(u.addClass("app-page-"+h[0]),o=h[1]=="always"||!(h[1]=="never"||f.width<pt(h[3])),o||h[1]!="never"||(d=i.tagged(/\bmodal-never\-(\w+)\b/),d&&d[1]!=i.get_viewId()&&(o=wh()))):(o=i&&wh(),t.backText=n.title())),l=i&&i.tagged(/\bsplit(\-(single|multiple))?\-(right|bottom|top|left)(\d+)?\b/),l&&(v=i.get_parentDataView(),v))){y=v._panels;y||(y=v._panels=[]);var a=l[3],rt=l[2]||"single",g=l[4]?parseInt(l[4]):a=="top"?33:66,e,ut=c(v).page;$(y).each(function(){var n=this;if(n.location==a)return e=n,!1});a=="right"&&pt("md")<f.width&&(o=!1,e?(e.size<g&&(e.size=g),e.accepts=="single"&&(n.deletePage(c(e.pages[0].attr("id"))),e.pages=[])):e={pages:[],location:a,size:g,accepts:rt},e.pages.push(u),y.push(e),i._panelContainer=ut,u.appendTo(s),$(e.pages).removeClass("app-page-panel-active"),u.addClass("app-page-panel app-page-panel-active app-page-panel-"+a+" app-page-panel-"+rt),b(u).css("top",ue()-1),t.isPanel=!0,nt=n._modalDataViews,tt=nt.indexOf(t.id),tt!=-1&&nt.splice(tt,1),ut.addClass("app-has-panel app-has-panel-"+a))}o&&!u.is(".app-page-modal")?(u.find(".app-page-header-fixed").remove(),u.addClass("app-page-modal"),i&&i.tagged("modal-title-none")||(p=$('<div class="app-page-modal-title"><span class="app-text"/><\/div>').insertBefore(b(u)),$('<a class="app-btn app-btn1 app-btn-search"/>').appendTo(p).hide().attr("title",yf),i&&i.tagged("modal-buttons-more-none")||$('<span class="app-btn-context app-btn app-btn2 ui-icon-dots"/>').appendTo(p).attr("title",fi),i&&i.tagged("modal-buttons-fullscreen-none")||(ft=$('<span class="app-btn app-btn3 app-btn-fullscreen"/>').appendTo(p).attr("title",w?r.ExitFullscreen:r.Fullscreen),w&&ft.addClass("app-btn-fullscreen-exit")),$('<span class="app-btn app-btn4 app-btn-close"/>').appendTo(p).attr("title",el.Close)),it=i&&i.tagged(/\bmodal\-max\-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),it&&u.addClass("app-page-"+it[0])):!o&&u.is(".app-page-modal")&&(u.removeClass("app-page-modal").css({left:"",top:"",width:"",minWidth:"",maxWidth:"",paddingTop:""}),u.find(".app-page-modal-title").remove(),t.scrollable.css({left:"",top:"",width:"",minWidth:"",maxWidth:""}));!!t.isModal!=o&&(t.isModal=o,ui(u))},activeLink:function(n,t){if($(k.activeClickedLink).is(".app-tab-active")||k.removeActiveLinkClass(!0),n){var i=$(n).closest("a");i.length&&(n=i);n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(k.activeClickedLink=n))}},blink:function(n,t){gt(n);setTimeout(function(){gt();setTimeout(function(){gt(n);setTimeout(function(){gt();t&&t()},200)},200)},200)},content:function(t){var i=c(t),r=i&&i.page?i.page:n.page(t),u=i&&i.scrollable?i.scrollable:b(r);return u.length?u:r.find('[data-role="content"]')},showContextPanel:function(n,t,i){ft(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");$(n).panel("toggle")},causesCalculate:function(){},pageVar:function(n,t){if(arguments.length==1)return lu(n);lu(n,t)},userVar:function(n,t){if(arguments.length==1)return ct(n);ct(n,t)},callWithFeedback:function(n,t){n=$(n);n&&n.length&&it(n,t)},progress:function(n,t){function r(){i.length||(i=$('<div class="app-progress-screen"><div class="app-progress-text"><\/div><div class="app-progress-bar"><div class="app-progress-indicator"><\/div><\/div><\/div>').appendTo(s));var n=i.find(".app-progress-text"),u=i.find(".app-progress-bar"),r=u.find(".app-progress-indicator");t.text?n.text(t.text).show():n.hide();t.progress!=null?r.width((t.progress*100).toString()+"%").removeClass("app-progress-marquee"):r.css({width:"100%","margin-left":"-100%"}).addClass("app-progress-marquee")}function u(){i.remove()}var i=$(".app-progress-screen");switch(n){case"show":r();break;case"hide":u()}},pageHeader:function(n){var t=c(n.id),i=[n.text];n.text2&&(i[1]=n.text2);t&&(t.headerText=i,t.id==wt()&&ir(i))},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},prevPageInfo:function(){var n=k.navigate.history.stack,t,i;return n.length>1&&(t=n[n.length-2].pageUrl,t&&(i=c(t))),i},pageInfo:function(n){if(n?n._id&&n._controller?n=n._id:n.selector!=null&&n.length!=null&&(n=n.attr("id")||""):n=wt(),typeof n=="string")return this._pageMap[n];if(n)this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n);else return null},scrollable:function(){var n=b();return arguments[0]=="refresh"&&rs(n,!1),n},unloading:function(){pe()},refresh:function(n,t,i){bt(n,t,i)},refreshEchoToolbarWithDelay:function(n,t){tf(n,t)},listPopup:function(n){hi(n)},cardPopup:function(n){cy(n)},busyIndicator:function(n){pi(n)},viewStyle:function(n,t,i){ae(n,t,i)},bar:function(t,i){function h(){var t,n;f=r.prevAll(".app-bar-actions");t=f.parent().find(".app-page-header-fixed");f.is(".app-bar-actions")&&f.is(":visible")?(n=f.position().top+f.height(),r.css("top",n),t.css("top",n+r.outerHeight()-1).closest(".ui-page").addClass("app-has-header-bar")):r.css("top","")}function c(){var t=!0;r.children().each(function(){var n=$(this);n.css("display")!="none"&&(t=!1)});t?(r.hide(),r.is(".app-bar-footer")?n.promo().css("margin-bottom",""):r.parent().find(".app-page-header-fixed").closest(".ui-page").removeClass("app-has-header-bar"),l()):r.show()}function l(){ui(r.closest(".ui-page"))}var r,f,u;if(t=="create"){var e=i.type,a=i.page,o=b(a),s;return r=a.find(".app-bar-"+e),r.length||(e=="header"?(r=$('<div class="app-bar-header ui-header ui-bar-inherit ui-header-fixed"><\/div>').hide().insertBefore(o),h()):e=="footer"&&(s=o.next(),r=$('<div class="app-bar-footer ui-footer ui-bar-inherit ui-footer-fixed"><\/div>').hide().insertAfter(s.is(".app-vscrollbar")?s:o))),r}(u=i,u&&u.length)&&(r=u.parent(),t=="show"?(r.is(".app-bar-header")&&h(),r.show(),u.show(),l(),vr()):t=="hide"?(u.hide(),c()):t=="remove"&&(u.remove(),c()))},promo:function(n,t){function f(){var o;if(i.is(".ui-disabled")||!e("ui.actions.promote"))i.hide();else{r=$(".ui-page-active").is(".app-page-modal");var t=i.is(":visible"),n,f=i.attr("data-icon"),s=lh();if(!t){n=c();n&&f&&(n._promo||(n._promo={}),n._promo[f]?t=!0:n._promo[f]=!0);i.one("transitionend",function(){lt=!1});g&&g.is(":visible")&&(i.show(),s=lh(),i.hide());i.css({"margin-bottom":r?0:"",transform:t?"none":"scale(.5)",transition:t?"none":"transform 200ms"}).show()}i.css("margin-bottom","");o=p(i,"margin-bottom");s&&(o=p(i,"margin-bottom")+(g.is(":visible")?g.outerHeight():0));u=y(".app-bar-footer");i.css({"margin-bottom":r?0:o+(u.is(":visible")?u.outerHeight():0)});t||setTimeout(function(){lt=!0;i.css("transform","none")},50)}}var i=this._actionButton,r,u;return arguments.length==0?i:typeof n=="boolean"?(n?f():i.hide(),i):typeof n=="string"?(i.find(".app-icon").remove(),n=ro(n),et(n,i.attr({title:t,"data-icon":n})),n.match(tl)?(i.hide().addClass("ui-disabled"),!1):(i.removeClass("ui-disabled"),f(),!0)):void 0},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"&&(n?t.show():t.hide()),t},stickyHeaderBar:function(n){var t=b(n);return t.data("sticky-header")||$()},enumerateFields:function(n,t,i,r){var f=n._allFields,u=i==null;r||(r=n.extension().commandRow());u?(i=[],$(f).each(function(){this.ShowInSummary&&!this.Hidden&&i.push(this)})):t.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(i).each(function(){var i=f[this.AliasIndex],e=r[i.Index],o=e==null?"":i.TextMode==2?be(e):i.text(e);e!=null&&(i.OnDemand?i.OnDemandStyle!=1&&e&&typeof e=="string"&&!e.match(/^null/)&&t.push({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",n.resolveClientUrl(n.get_appRootPath()),i.OnDemandHandler,e,i.OnDemandStyle==2?"&_nocrop":""),desc:i.HeaderText,display:"before"}):(o==""&&(o=eo),!u&&yv(i)&&e?t.push({text:o,desc:i.HeaderText,href:"tel:"+o,icon:"phone"}):!u&&pv(i)&&e?t.push({text:o,desc:i.HeaderText,href:"mailto:"+o,icon:"material-icon-email"}):t.push({text:o,desc:i.HeaderText,isStatic:!0,display:"before"})))});i.length&&t.push({})},infoView:function(n,t,u,f){var o=[],c=t?"left":f||"",h,s,e,l;for(t||o.push({text:r.Back,callback:au,icon:ot});n;)l=o.length,h=n.extension().itemMap(),s=n._allFields,e=[s[h.heading]],t||$(h.desc).each(function(){e.push(s[this])}),$(n._fields).each(function(){this.Hidden||e.indexOf(s[this.AliasIndex])!=-1||e.push(this)}),this.enumerateFields(n,o,e,u),n=i.find(n._filterSource);ft(o,"#app-panel-info-view"+(c?"-standalone":""),{position:c,className:"app-panel-info-view"})},deletePage:function(t){var r,u,i,f,e;typeof t=="string"&&(t=c(t));r=t.page;u=t.dataView;u&&u.dispose();r&&(f=t.scrollable,f&&f.removeData().off(),r.page("destroy").remove().empty());i=n._modalDataViews.indexOf(t.id);i!=-1&&n._modalDataViews.splice(i,1);i=n._pages.indexOf(t);i!=-1&&n._pages.splice(i,1);e=si.stack;$(e).each(function(n){var i=this;if(i.hash=="#"+t.id)return e.splice(n,1),n<si.activeIndex&&si.activeIndex--,!1});t.dataView=null;t.page=null;t.scrollable=null;delete n._pageMap[t.id]},garbageCollector:function(t){var i=n._pagesToDelete;arguments.length?i.push(t):i.length&&setTimeout(function(){$(i).each(function(){n.deletePage(this)});i.splice(0,i.length)},32)},modalDataView:function(n,t){var i=this,u,r,f;t!=!1&&i.busy()||(n&&i.busy(!0),t&&setTimeout(function(){n!=wt()&&i.modalDataView(n,!1)}),u=[],n?(r=i.pageInfo(n),f=i.page(n),uh&&(r.text=uh,uh=null),r.dataView._lookupInfo||(r.dataView._isModal=!0),i._modalDataViews.indexOf(n)==-1&&i._modalDataViews.push(n),i.changePage(n)):($(i._modalStack).each(function(){i.deletePage(this)}),i._modalStack=[]))},unloadPage:function(n,t){function s(){r._modalStack.indexOf(u)==-1&&r._modalStack.push(u)}var r=this,u=r.pageInfo(n),e;if(u&&(e=r._modalDataViews.indexOf(u.id),e>=0)){var h=u.dataView,c=i.find(h._parentDataViewId),f=r.pageInfo(t),o=f?r._modalDataViews.indexOf(f.id):-1;(f&&(c==f.dataView||f.home)||t.attr("id")=="Main"||o>=0&&e>o)&&s()}},sidebar:function(){return us()},desktop:function(){return!o},rowContext:function(n,t){ps(n,t)},animate:function(){return fc()},clearHtmlSelection:function(n){su(n)},lastTouch:function(){return cr},syncEmbeddedViews:function(n){lr(n)},animatedScroll:function(n,t,i){vc(n,t,i)},scroll:function(n,t){gr(n,t)},configureFilter:function(t){n.contextScope(t.scope);hf(t);n.contextScope(null)},pointer:function(){return o?"touch":"mouse"},busy:function(n){var i=this,r=i._busy==!0,t;if(arguments.length==1)i._busy=n,t=i._glassPane,t||(t=i._glassPane=$('<div class="app-glass-pane"><\/div>')),n?t.is(".app-glass-pane-active")||t.addClass("app-glass-pane-active").appendTo(s):t.parent().length&&t.detach().removeClass("app-glass-pane-reject app-glass-pane-active");else return i._busy==!0},executeInContext:function(t,i,r){if(!n.busy()){var u=[];n.navContext(u);$(u).each(function(){var n=this;if(!r&&(t&&n.icon==t||!t&&n.text==i)||r&&r==n.path)return rr(n),!1})}},navigate:function(t){typeof t=="string"?(t.match(/^#/)&&(t=t.substring(1)),n.changePage(t)):t.id&&$("#"+t.id).length?($("#"+t.id).trigger("navigating.app"),n.changePage(t.id)):t.href&&rn(t.href,t.transition)},changePage:function(t,i){wt()!=t&&n.busy(!0);var c=y(),b,o=c&&this.pageInfo(c.attr("id")),r=this.pageInfo(t),p=$.Event("navigating.app");if(r){if(r.isPanel){h.left.mini||e("ui.sidebar.mini")==!1||un(!0);tb({toPage:r.page,toPageInfo:r,prevPage:c});return}r.navigating?r.navigating=!1:r.page&&(r.page.trigger(p),p.isDefaultPrevented()&&(r.initialized=!1,r.navigating=!0))}if(dk(!0),this.pageInit(t)){b=this.page(t).css("padding-top",c.css("padding-top"));var d=kt.pageTransition,u=this.pageInfo(t),w=u.home,f,s,l,a=u.navigateInfo;if(a){u.navigateInfo=null;k.navigate(a.href,{transition:a.transition});f=si.stack;f[f.length-1].hash="#"+u.id;return}s=u.replaceUrl;o&&o.deleted&&(v.location.replace("#"+t),ri(function(){var t=n.dataView();t._doneCallback=o.dataView._doneCallback;t._cancelCallback=o.dataView._cancelCallback;n.deletePage(o);oa(y())}));k.changePage("#"+t,{changeHash:!(i==!1)&&!w,transition:"none"});f=si.stack;l=f[f.length-1];s&&(u.replaceUrl=null,$("#"+t).attr("data-url",decodeURIComponent(s)),l.hash!="#advanced-search"&&k.navigate.navigator.squash(s),l.url=decodeURIComponent(k.path.makeUrlAbsolute(s,k.path.documentBase)));w&&(l.transition=d,k.path.documentBase.hrefNoHash=k.path.documentBase.hrefNoSearch,k.path.documentBase.href=k.path.documentBase.hrefNoSearch+k.path.documentBase.hash)}},title:function(){return document.title},navContext:function(n,t){var e=this,f=e.contextPageInfo(),p=f,u=f&&f.dataView,h=u,o=h&&h.extension(),y=u&&u.get_useCase(),s=u&&u.extension(),l=!0,a=-1;ie&&n.push({text:hp.Exit,icon:"material-icon-exit-to-app",toolbar:!0,system:!0,callback:ltt},{});s&&(t||s&&s.context(n),f.dataView._parentDataViewId&&(f=e.pageInfo(f.dataView._parentDataViewId),u=f.dataView,a--));!o||o.inserting()||o.lookupInfo()||$(e._pages).each(function(){var s=this,f=s.dataView,v=f&&f.extension(),h,o=!1;f&&(h=!f._hidden&&!f._parentDataViewId,h&&(u&&u._filterSource?(h=i.find(u._filterSource)==f,o=h,h||(h=i.find(f._filterSource)==u)):h=f._filterSource?i.find(f._filterSource)==u:!1));!h||y||s.external||(l&&(t||n.push({}),l=!1),o||e.contextScope()&&o||f._autoHide==0&&!u.extension().commandRow()||n.push({text:o?r.Back:s.text,icon:o?"back":null,count:o?null:v&&(!v._reset||c(f).echoInitialized)?f._totalRowCount:null,callback:o?function(){oh.go(a)}:function(){e.changePage(s.id)},system:!0,navigateTo:o?"master":"detail",pageTransition:!o,sidebarCollapse:o?null:"detail",context:s&&s.id,activator:s&&s.activator}))});n.isSideBar||n.isTaskAssistant||(n.length&&n.push({}),st("help.enabled")&&!v.location.pathname.match(/\/help(\/|$)/)&&fr&&(ll||(ll={text:wr.HelpLink,system:!0,toolbar:!1,icon:"material-icon-info",callback:function(){fr.help()}}),n.push(ll)));or.list.length&&(or.list.splice(0),or.keyCodes.splice(0));$(n).each(function(){var t=this.shortcut,n;t&&(n=or.cache[t],n||(n=cw(t),or.cache[t]=n),n.which&&!t.invalid&&(or.keyCodes.push(n.which),or.list.push(n)))});iw()&&!n.isSideBar&&n.push({text:wf.Tools,system:!0,icon:!1,toolbar:!1,transition:!0,callback:hrt})},refreshAppButtons:function(t,u){var lt=this,at=lt._title,vi=Math.max(p(n._toolbar,"width")/2,at.offset().left+(at.is(".app-hidden")?0:at.outerWidth()-1)),pi=lt._logo,a,o,gt=n._contextButton,rt=[],g,l=[],tt={search:yf,user:it,apps:r.Apps},ni={},d,vt,k=[],ut=[],ti,ii,ri,ui,ei,s=u&&u.dataView||n.dataView(),yt=0,w,oi=u&&u.buttonBars||y(".app-bar-buttons"),ft=u&&u.layout||y("[data-layout]"),nt=s&&n.content(s._id).prevAll(".app-bar-actions"),wt,si,hi,ot,bt,ci,li,kt,yi,ht,it,ct,b,dt;if(u&&u.promo&&s&&(ci=c(s).page.find(".app-page-modal-title .app-btn1").hide(),ot=!s||!s.get_showActionBar()||s.get_isForm(),$(t).each(function(){var t=this,i;o=t.icon;i=t.toolbar!=!1&&o&&!o.match(/more|back|undo/);o&&(ot||t.uiScope=="ActionBar"&&(o=="material-icon-add"||o=="material-icon-edit")||t.system&&o!="material-icon-info-outline")&&(o=="search"?ci.show():(o.match(/^(refresh|phone|email|eye)$/)||i)&&!s.get_isForm()&&d!="material-icon-add"&&(n.promo(o,t.text),d=o))})),(!u||u.toolbar)&&(gt.attr("title",fi).removeClass("ui-icon-carat-u").addClass("ui-icon-dots"),t.length&&gt.show(),fit(),lt._toolbarButtons.each(function(){a=$(this).show();li||(li=a.show()[0].offsetWidth);a.offset().left>vi-(ai()?f.left:0)&&rt.push(a);a.hide()}),g=rt.length,g>0)){for(ot=!s||!s.get_showActionBar()||s.get_isForm(),$(t).each(function(){var n=this,t;o=n.icon;t=n.toolbar!=!1&&o&&!o.match(/more|back|undo/);o&&(ot||n.uiScope=="ActionBar"&&(o=="material-icon-add"||o=="material-icon-edit")||n.system&&o!="material-icon-info-outline")&&(o=="search"?ei=!0:o=="refresh"?ii=!0:o=="phone"?ti=!0:o=="email"?ui=!0:o=="eye"&&t?ri=!0:t&&l.indexOf(o)==-1?l.push(o):o=null,o&&(tt[o]=ta(n)+(n.desc&&n.descInTooltip!=!1?"\n"+n.desc:"")),n.path&&(ni[o]=n.path),n.uiScope=="ActionBar"&&ut.push(o))}),ui&&l.push("email"),ti&&l.push("phone"),ri&&l.push("eye"),ii?l.push("refresh"):!l.length||s&&(s.editing()||s.get_isForm()&&aw())||!e("ui.actions.promote")?n.promo(!1):(s&&(kt=s.get_isForm()?"material-icon-edit":"material-icon-add",bt=l.indexOf(kt),bt>0&&(l.splice(bt,1),l.unshift(kt))),$(l).each(function(){var n=this;if(!n.match(tl))return d=n.toString(),!1}),s&&(c(s).loading||s.get_searchOnStart()||s._requiresContextRefresh)||!n.promo(d,tt[d])||(n.promo().data("icon-list",{icons:l.slice().reverse(),labels:tt}),k.push(d),l.splice(l.indexOf(d),1))),ei&&(l.length<g?l.push("search"):l[g-1]="search"),br||f.width>=pt("md")&&(i.odp.offline()&&(l.push(vt=i.odp.offline("icon")),tt[vt]=i.odp.offline("tooltip")),e("ui.menu.apps.location")=="toolbar"&&l.push("apps"),sh&&l.push("user"));ut.length>0;)o=ut[0],ut.splice(0,1),l.indexOf(o)!=-1&&l.splice(l.indexOf(o),1);for(l.length<g&&(yt=g-l.length),w=0;w<yt;w++)$(rt[w]).hide();while(w<g)a=$(rt[w]),o=l[w-yt],yi=a.data("icon"),a.attr("title",tt[o]),a.data("action-path",ni[o]),k.push(o),a.empty().removeClass("app-avatar"),o=="user"?(ht=v._userLetters,it=i.userName(),ht||(v._userLetters=ht=ph(it)),yh(it,$('<i class="app-icon-avatar"/>').text(ht).appendTo(a.addClass("app-avatar").attr("title",it)))):et(ro(o),a),a.data("icon",o).show(),w++;n._usedToolbarIcons=k.slice(0)}for(oi.length&&oi.each(function(){var i=$(this),n,h,f,u,o,l,a,c;if(i.is(":visible"))if(i.children().remove(),ct)i.append(ct.html()).toggleClass("app-bar-buttons-md",ct.is(".app-bar-buttons-md"));else{if(ct=i,o=s&&s._isWizard,b||(b=[],$(t).each(function(){var n=this,t=n.icon;!n.system&&t!="dots"&&n.text&&n.uiScope=="Form"&&(b.push(n),n.command=="Cancel"&&(f=b.length-1))})),o&&(b=b.reverse(),f!=null&&(f=b.length-1-f)),u=i.width(),o&&(b.splice(0,0,{text:r.Prev,path:"wizard-prev"},{text:r.Next,path:"wizard-next"}),f!=null&&(f+=2,cancelButton=b[f],b.splice(f,1),u>375&&b.splice(0,0,cancelButton))),$(b).each(function(){var n=this,t=n.path,r=$('<a class="ui-btn ui-mini"/>').text(n.text).attr("data-action-path",n.path).appendTo(i);n.shortcut&&r.attr("title",ta(n));t&&t.match(/^wizard/)&&r.addClass("app-btn-has-icon")}),ou("status",{layout:ft}),n=i.toggleClass("app-bar-buttons-md",u>=pt("md")).find(".ui-btn").last(),n.length&&(l=i.offset().left+u,a=n.offset().left+n.outerWidth()-p(n,"margin-right")-1,n.position().left+n.outerWidth()-1>u+2&&(i.find(".ui-btn").css("min-width","8em"),n.length&&n.position().left+n.outerWidth()-1>u+2&&(i.find(".ui-btn").css("min-width","4em"),n.length&&n.position().left+n.outerWidth()-1>u+2&&o&&i.find(".app-btn-has-icon").addClass("app-btn-icon-notext"),n.length&&n.position().left+n.outerWidth()-1>u+2))))for(h=$('<a data-action-path="more" class="ui-btn ui-corner-all ui-mini app-btn-more app-btn-icon-notext"/>').html("&nbsp;").attr("title",fi).appendTo(i);n.length&&h.position().left+h.outerWidth()-1>u+2;)n=n.hide().prev();s&&(c=e("ui.actions.reverse")==!0,ln&&!c||o||s._controller=="MyProfile"&&s._viewId.match(/^(pas|ide)/)||!(st("ui.actions.autoReverse")||c)||i.append(i.find(".ui-btn").get().reverse()))}}),ft.length&&(dt={},ft.find('[data-control="action"]').each(function(){var r=$(this),u=ft.attr("data-input-container"),n,f,t;n=dt[u];n||(n=i.find(u),dt[u]=n);n&&(f=n.findAction(r.attr("data-action")),f||(r.css("visibility","hidden"),t=r.closest('[data-container="row"]'),t.length&&!t.find("[data-control]").filter(function(){return $(this).css("visibility")!="hidden"}).length&&t.remove()))}));k.length;)if(w=0,k[0]=="user"||k[0]=="apps"||k[0]==vt)k.splice(0,1);else while(w<t.length)k.length&&t[w].icon==k[0]?(t.splice(w,1),k.splice(0,1)):w++;(!u||u.toolbar!=!1||u.actionBar==!0)&&nt&&nt.length&&(wt=nt.find("h3").next(),si=Math.floor(wt.offset().left)+wt.outerWidth(!0),hi=Math.floor(nt.offset().left)+kr(nt)-8,nt.data("selector").toggleClass("app-hidden",!s.get_showViewSelector()||h.left.visible&&e("ui.sidebar.views.collapsed")==!0),dd(s,nt.data("controls"),si,hi,!0,d))},endModalState:function(t,i){if(!rt){rt=!0;var r=n.page(i._id);di()}},renderContext:function(n,t,i){var c=!1,l,u=t.isSideBar,f=u&&h.left.mini,r,s,e={};$(t).each(function(){var k,rt,w;if(!i||i(this)){var t=this,l=t.text,d=t.shortcut,g=t.count||d,a=f&&t.miniIcon||t.icon,v=ic(a),nt=a=="check"||v?"false":a=="ok"?"check":a,b=t.href,y=t.itemClassName,s,r,p=t.sidebarCollapse,tt=!1,it;u&&h.left.mini&&!a&&(l&&!t.transition||t.src)||(s=$("<li/>").attr({"data-icon":!nt&&t.pageTransition&&!v?"false":nt,"data-theme":t.theme||"a"}).appendTo(n),t.callback||t.dataRel||b?(r=$("<a/>").appendTo(s).data("context-action",t),f?(r.html("&nbsp;").attr("title",l),l&&t.transition&&$("<span/>").text(l.substring(0,1)).appendTo(r)):r.text(l),b&&r.attr({rel:"external",href:b}),!g||(u||o)&&d||$('<span class="ui-li-count"/>').appendTo(r.addClass("ui-li-has-count")).html(g),t.dataRel&&r.attr("data-rel",t.dataRel),t.isStatic&&r.addClass("app-summary-btn")):t.isStatic?s.html(l):t.src?$('<img class="ui-li-thumb"/>').appendTo(s.addClass("ui-li-has-thumb")).attr({src:t.src}):(c?s.remove():(it=s.attr("data-role","list-divider").html(l),!t.isStatic&&l&&t.instruction!=!1&&it.addClass("app-list-instruction")),c=!0,tt=!0),tt||(c=!1),t.desc&&!f&&(k=t.display=="before",k&&$('<p class="app-item-desc app-item-desc-before"/>').insertBefore((r?r:s).contents()).text(t.desc),rt=$('<p class="app-item-desc"/>').appendTo(r?r:s).text(t.desc),k&&rt.addClass("app-item-desc-after")),t.wrap&&s.addClass(t.callback?"app-wrap-text":"app-wrap"),t.disabled&&s.addClass("ui-disabled"),y&&s.addClass(y),t.linkClassName&&r.addClass(t.linkClassName),t.keepOpen&&(r.addClass("app-keep-open"),t.animate||t.count||r.addClass("app-btn-icon-transparent")),t.animate&&r.addClass("app-animated app-animation-spin"),t.selected||a=="check"?(u?r.addClass("app-option-selected"):t.depth||et(t.radio&&!1?"material-icon-radio-button-checked":"material-icon-check",r),t.depth&&(r.addClass("app-item-selected"),v&&et(a,r))):v&&et(a,r),t.state&&r.addClass("app-selected"),t.tooltip&&(r.attr("title",t.tooltip),y&&y.indexOf(/tile$/)||r.addClass("app-btn-tooltip")),p&&u&&(e[p]||(e[p]=[]),e[p].push(s)),w=t.user,w&&yh(w,$('<i class="app-icon-avatar"/>').appendTo(r.addClass("app-avatar")).text(ph(w))),t.depth&&(s.addClass("app-has-depth"),r.addClass("app-depth"+t.depth)),(t.transition&&!t.reverse||t.pageTransition)&&et(f?"material-icon-navigate-next":"material-icon-chevron-right",r.addClass("app-group-actions")),t.popOut&&!f&&et("material-icon-chevron-right",r),t.color&&$('<span class="app-color-block"/>').appendTo(r).css("background-color",t.color))}});for(l in e)if(r=e[l],r.length>4){for(s=3;s<r.length;s++)r[s].hide();$("<a/>").appendTo($('<li data-icon="false" data-theme="a"/>').insertBefore(r[3])).text("+"+(r.length-3)+" "+fi.toLowerCase()).data("context-action",{callback:iit})}},tabs:function(n,i){function u(n,t){if(!n||n=="page"||n=="user")return null;var u=gd(i.id)||[],r,f;if(n=n.toString(),$(u).each(function(t){var i=this;if(i.oid==n)return r=i,f=t,!1}),arguments.length==1)return r?r.tab:null;r?u.splice(f,1):r={oid:n};r.tab=t;u.push(r);u.length>10&&u.splice(0,1);gd(i.id,u)}function e(){var t=i.tabs,o=i.scope,s=i.placeholder||$((t[0].content||[])[0]),e=i.container||$('<div class="app-tabs ui-header ui-bar-inherit"><\/div>').insertBefore(s).addClass(i.className),h=$("<ul/>").appendTo(e),n=t[0].text;$(t).each(function(){var t=this;t.active&&(n=t.text);$(t.content).each(function(){$(this).addClass("app-tab-content")})});i.id||(i.id=s.attr("id"),i.id&&(i.id+="_tabs"));i.id&&(e.attr("id",i.id),n=u(o)||o=="page"&&lu(i.id)||o=="user"&&ct(i.id)||n);$(t).filter(function(){return this.text==n}).length||(n=t[0].text);$(t).each(function(t){var i=this,f=$('<a class="ui-btn"/>').appendTo($("<li/>").appendTo(h)).text(i.text).attr("data-text",i.text),r=i.content,u;i.active=i.text==n;i.active&&(t>0&&(r&&r.length&&$(r[0]).is('[data-container="tab"]')&&(r=r.children()),$(r).each(function(){var n=this.style;if(n&&n.display!="none")return u=!0,!1})),u&&t!=0?(n=null,i.active=!1):f.addClass("ui-btn-active app-tab-active"))});n||(t[0].active=!0,h.find(".ui-btn").first().addClass("ui-btn-active app-tab-active"));i.forceSelectedTab=arguments.length!=2?null:arguments[1].selectedTab;e.data({"data-tabs":i.tabs,options:i});f(e);r(e,!1)}function o(n){n||(n=i.container?i.container.find(".app-tabs"):b().find(".app-tabs"));n.find("ul").off();n.data({"data-tabs":null,options:null}).remove()}function f(n){n||(n=b().find(".app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){$(this).toggleClass("app-tab-active",n.active)})})})}function r(n){n||(n=(i&&i.page||y()).add($(".ui-page.ui-page-active .app-bar-header.ui-header-fixed")));var t=n.find(".app-tabs");t.find("ul").css("visibility","");t.each(function(){var t=$(this),r=t.width(),h=t.data("data-tabs"),u=t.offset().left+p(t,"padding-left"),i,n,s,e,o,f;if(r||t.data("dynamic"))if(t.find(".app-tab-more").parent().remove(),i=t.find(".ui-btn").css({"padding-left":"","padding-right":"","min-width":"","max-width":"",display:""}).removeData("hidden"),$(h).each(function(n){var r=this,f=0,t=Array.isArray(r.content)?$(r.content).map(function(){return this.toArray()}):$(r.content),u;t.length==1&&$(t[0]).is('[data-container="tab"]')&&(t=$(r.content).children());t.length&&(t.each(function(){var t=this,n=t.style;n&&n.display=="none"&&f++}),t.length==f&&(u=$(i[n]),u.css("display","none").data("hidden",!0),u.is(".app-tab-active")&&(o=!0)))}),f=i.filter(function(){return this.style.display!="none"}),f.length<2)t.css("display","none").data("dynamic",!0),o&&$(f[0]).trigger("vclick");else{if(t.css("display")=="none"&&(r=t.css("display","").width(),u=t.offset().left+p(t,"padding-left"),o=!1),t.find("li").removeClass("app-first-child app-last-child"),$(f[0]).parent().addClass("app-first-child"),n=$(f[f.length-1]).parent().addClass("app-last-child"),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","8em"),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","4em"),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":"1em","padding-right":"1em"}),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":".5em","padding-right":".5em"}),n.offset().left-u+n.outerWidth()>r)))))for(n.parent().removeClass("app-last-child"),n=$('<a class="ui-btn app-tab-more"/>').appendTo($('<li class="app-last-child"/>').appendTo(n.closest("ul"))).text(fi).css({"min-width":"4em","padding-left":"0.5em","padding-right":"0.5em"}),e=i.length-1;n.offset().left-u+n.outerWidth()>r;){if(!e){$(i.get(0)).css("max-width",r-n.outerWidth()-12);break}s=$(i.get(e)).css("display","none");s.is(".app-tab-active")&&n.addClass("ui-btn-active");e--}o&&$(f[0]).trigger("vclick")}})}if(!this._initialized){this._initialized=!0;$(document).on("vclick",".app-tabs .ui-btn",function(n){function w(){o.find(".app-tab-active").is(":visible")||o.find(".app-tab-more").addClass("ui-btn-active")}var e=$(n.target).closest("a"),h=e.closest(".app-tabs"),i=h.data("options"),o=h.find("ul"),ut=o.find(".app-tab-active"),l=b(h),s=l.find(".app-stub,.app-stub-main"),k=i.forceSelectedTab,tt=i.tabs,c=i.selectedTab||i.forceSelectedTab||e.attr("data-text"),d=y(),a,v=0,g,p,nt;if(t.cancel()){if(k&&(i.selectedTab=k),e.length)if(!i.selectedTab&&e.is(".app-tab-more"))nt=o.find(".ui-btn").removeClass("ui-btn-active"),it(e,function(){e.addClass("ui-btn-active");p=[];$(i.tabs).each(function(n){var t=this;$(nt[n]).data("hidden")||p.push({text:t.text,icon:t.active?"check":!1,wrap:!0,context:{text:t.text,index:n},linkClassName:"app-btn-icon-transparent",callback:function(n){e.removeClass("ui-btn-active");i.selectedTab=n.text;$(o.find(".ui-btn")[n.index]).trigger("vclick")}})});hi({items:p,anchor:e,afterclose:function(){setTimeout(function(){e.removeClass("ui-btn-active");o.find(".app-tab-active").addClass("ui-btn-active");w()},50)}})});else{if(o.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),e.addClass("app-tab-active ui-btn-active"),$(tt).each(function(){var n=this;n.active&&(c==n.text&&(g=!0),$(n.content).each(function(){v+=Math.ceil($(this).outerHeight(!0))}));n.active=n.text==c;n.active&&(a=n)}),g){i.selectedTab=null;w();return}i.scope=="page"?lu(i.id,c):i.scope=="user"?ct(i.id,c):u(i.scope,c);v&&s.length&&s.offset().top+s.outerHeight()-v<l.offset().top+l.height()&&s.height(v+s.outerHeight());da(d);i.selectedTab&&(i.selectedTab=null,r(h));function rt(){f(h);w();a.callback&&a.callback();i.change&&(kf=!1,i.change(a),hu(),i.restoreScrolling!=!1&&yk(d));i.stickyHeader&&ru();bk(l,s)}setTimeout(function(){rt()})}return!1}})}switch(n){case"create":i.tabs&&i.tabs.length>1&&e(i);break;case"destroy":o();break;case"fit":r()}},refreshTitleState:function(){n._title.toggleClass("app-hidden",n._menuButton.is(".ui-icon-bars"))},refreshMenuStrip:function(){var u;at.nodes||ift();var t=this._menuStrip,i=t&&t.strip,st=this._title,b=n._logo,k=p(b,"left")+b.outerWidth(),v=h.left.visible?(h.left.mini?k:h.left.width)+1:k,y=n._toolbar,d=y.find(".app-btn-cluster-right .ui-btn").filter(ar).first(),w=(d.length?d.offset().left:kr(y))-16,g=at.nodes,c,a,o,et,nt,s,tt=e("ui.menu.location")=="toolbar",r,rt,ut;if(!i)if(t=this._menuStrip={strip:$('<div class="app-menu-strip"><\/div>').appendTo(y)},i=t.strip,tt){for(c=$("<ul/>"),u=0;u<g.length;u++){var l=g[u],r=$("<li/>").appendTo(c),ft=$('<a class="ui-btn"/>').appendTo(r).text(l.title).attr({title:l.description}).data("data-node",l);l.children&&ft.addClass("app-has-children");l.selected&&ft.addClass("app-selected")}t.links=c.find(".ui-btn");t.items=t.links.parent();t.more=$('<a class="ui-btn app-has-children"/>').appendTo($("<li/>").appendTo(c)).text(fi);function ot(n){io(n)}c.appendTo(i).on("vclick contextmenu",function(n){var t=$(n.target).closest(".ui-btn"),f=t.is(".app-selected"),r=t.data("data-node"),u=r&&r.url&&!r.children;if(t.length==0||t.data("selected"))return!1;if(u){if(n.type=="contextmenu")return!1;r.url&&!r.url.match(fp)&&pe();i.find(".app-selected").removeClass("app-selected");t.addClass("app-selected")}return it(t,function(){if(u)ot(r);else{if(t.data("selected"))return;var f=[],n=[];r?n.push(r):(depth=0,r={children:[]},i.find("li:hidden a").each(function(){n.push($(this).data("data-node"))}));pr(f,!0,n,1);hi({anchor:t.data("selected",!0),items:f,afteropen:function(n){var t=n.addClass("app-popup-menu").find(".ui-panel-inner"),i=t.find(".app-item-selected");i.length&&t.offset().top+t.height()<i.offset().top+i.outerHeight()&&t.scrollTop(i.offset().top-t.offset().top-(t.height()-i.outerHeight())/2)},afterclose:function(){t.removeData("selected")}})}}),!1})}else t.title=$('<span class="app-menu-strip-title"/>').appendTo(i.addClass("app-menu-strip-has-title")).text(at.currentNode?at.currentNode.title:document.title);if(s=w-v,tt){if(s!=i.data("tested-width")||!i.is(":visible"))if(i.data("tested-width",s),f.width>414&&s>=200&&i.attr("data-enabled")!="false"&&n._menuButton.is(".ui-icon-bars"))for(i.removeClass("app-hidden"),is(!0),i.width(s).css({left:v}),a=t.items,o=t.more.removeClass("app-selected").parent(),et=o.find(".ui-btn").text(fi),o.hide(),a.show(),u=a.length-1;u>=0;u--){if(r=$(a[u]),ut=r.outerWidth(),rt=r.offset().left,rt+ut-1>=w&&(o.show(),nt=o.outerWidth(),r.hide()),r.is(":hidden")&&r.find(".app-selected").length&&t.more.addClass("app-selected"),!o.is(":visible")||o.offset().left+nt-1<w){u<=1&&!r.is(":visible")&&is(!1);break}else r.hide(),r.find(".app-selected").length&&t.more.addClass("app-selected");if(u<=1){is(!1);break}}else is(!1)}else i.width(s).css({left:v}),is(s>=100)},refreshSideBar:function(t,u){function ht(){var f,o,t,w;if(b=!1,f=st("ui.sidebar.views.styles"),o=st("ui.sidebar.views.names"),s.dataView().get_showViewSelector()&&(f||o)){var a=[],c=e("ui.sidebar.views.collapsed")==!0,i=p.dataView,k=i.get_view().Label,y,d;sk(u);o&&i.get_showActionBar()&&oy(a,!1,p,null,!0)>1&&(h.left.mini||c||($(a).each(function(){u.push(this)}),u.push({})));t=[];s.tagged("view-style-grid-disabled")||t.push({text:r.Grid,icon:"grid",selected:tt,callback:function(){tt||ae(l,"Grid")}});s.tagged("view-style-list-disabled")||t.push({text:r.List,icon:"bullets",selected:rt,callback:function(){rt||ae(l,"List")}});s.tagged("view-style-cards-disabled")||t.push({text:r.Cards,icon:"cards",selected:it,callback:function(){it||ae(l,"Cards")}});s.tagged("supports-view-style-map")&&!s.tagged("view-style-map-disabled")&&t.push({text:r.Map,icon:"location",selected:ut,callback:function(){ut||ae(l,"Map")}});n.presenter("enumerate",{id:l,list:ft});$(ft).each(function(){var n=this;s.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.name==v&&(n.selected=!0),t.push(n))});f&&t.length>1&&(c?$(t).each(function(){var n=this;if(n.selected)return y=n.text,d=n.icon,!1}):($(t).each(function(){u.push(this)}),sk(u)));c&&(w=i._totalRowCount>0?" ("+String.format("{0:N0}",i._totalRowCount)+")":"",u.push({text:k+w,desc:y,icon:"material-icon-folder-open",context:{position:"left"},popOut:!0,itemClassName:"app-view-selector",callback:hg}))}}var ct=this,lt=us().find(".ui-panel-inner"),p=c(),f=p&&p.dataView,d=f,l=f&&f._id,o=f&&f.get_parentDataView(f),a=[],g=f&&f.get_showActionBar(),w=$('.TaskBox.About .Inner .Value, head meta[name="description"]'),nt=o&&!o._parentDataViewId,b=f&&f.get_isGrid(),s=f&&f.extension(),v=b&&s.viewStyle(),tt=v=="Grid",it=v=="Cards",rt=v=="List",ut=v=="Map",ft=[],at={items:u},et=[],ot=["material-icon-undo","check","info"],k,y;if(nt){while(f&&a.indexOf(f)==-1){if(o&&o._dataViewFieldName)break;(f.get_showInSummary()||o&&f!=o&&o.get_showInSummary())&&!f.inserting()&&f.extension().commandRow()&&a.unshift(f);f.get_isForm()&&(f=o);f=i.find(f._filterSource)}k=u.length;$(a).each(function(){n.enumerateFields(this,u)});u.length>k&&(f=a[a.length-1],y=u[k],y.icon="material-icon-chevron-right",y.miniIcon="material-icon-info-outline",y.context=f._id,y.callback=pw,u.push({}))}g&&d&&(d.extension().context(et,["ActionBar"]),$(et).each(function(){var t=this,n=t.icon;t.uiScope=="ActionBar"&&n&&n!="dots"&&n!="carat-r"&&ot.push(n)}));$(t).each(function(){var n=this;ot.indexOf(n.icon)!=-1||n.system&&n.toolbar==!1||n.command=="Select"||n.icon=="eye"&&(!o||o.get_showInSummary())||(n.text||u.length)&&(n.navigateTo&&b&&ht(),n.theme=null,n.uiScope=="ActionBar"&&g||u.push(n))});b&&ht();h.left.mini||e("ui.menu.location")!="sidebar"||(u.length&&u[u.length-1].callback&&u.push({}),pr(u),!st("ui.sidebar.toolbar")&&st("settings.enabled")&&u.push({},{text:r.Settings,icon:"material-icon-settings",transition:!0,callback:krt}));w.length&&nt!=!1&&(u.length&&u[u.length-1].text&&u.push({}),u.push({text:w.is("meta")?w.attr("content"):w.html(),isStatic:!0,wrap:!0}))},contextPageInfo:function(){return c(this._contextScope)},refreshContext:function(){bt()},contextScope:function(n){if(arguments.length==0)return this._contextScope;this._contextScope=n},contextDataView:function(n){var t,r;return n!=null&&(t=yi(n),t.length)?i.find(t.attr("data-for")):(r=this.contextPageInfo(),r?r.dataView:null)},showContextMenu:function(t){t||(t={scope:""});var r=t.position||"left",i="#app-panel-context-"+r;t&&(this.contextScope(t.scope),t.scope&&(i+="-scope",t.position=r));tg(i,function(){n.refreshContextMenu(i)},t).panel("toggle")},refreshContextMenu:function(t,i,r){var a=this,e=$(t),v=e.find(r||"ul"),u=v.length?v:e.find("ul"),d=u.outerHeight(),y,p,c=e.is(".app-sidebar"),w,b,o,k;if(c&&!e.is(":visible")){i=[];a.navContext(i);a.refreshAppButtons(i);return}if(c&&!ip&&(p=$("<div><\/div>").appendTo(s).css({"z-index":2e3,position:"absolute",left:0,top:e.find(".ui-panel-inner").offset().top,width:e.outerWidth(),height:f.height,"background-color":"#fff"})),d&&(y=$("<div><\/div>").height(d).insertAfter(u)),uo(u),u.find("a").removeData(),u.find("li").remove(),i||(i=[],i.isSideBar=c,a.navContext(i)),c&&(a.refreshAppButtons(i),b=[],o=0,this.refreshSideBar(i,b),i=b,i.isSideBar=!0,h.left.visible&&h.left.mini))while(o<i.length)if(k=i[o].icon,k&&n._usedToolbarIcons.indexOf(k)!=-1)for(i.splice(o,1);o<i.length&&!i[o].text;)i.splice(o,1),o>0&&o--;else o++;var l=v.data("panel"),g=e.attr("id").match(/^app-panel-(\w+)/),nt=c?"sidebar":g&&g[1];for(l&&l.match(/^\#app-panel-/)&&(l=l.substring(11)),w=$.Event("before"+nt+"panelshow.app"),w.panel={type:nt,id:l,items:i},$(document).trigger(w);i.length&&!i[i.length-1].text&&!i[i.length-1].src;)i.splice(i.length-1);this.renderContext(u,i);u.listview("refresh");u.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");u.find("li.app-wrap").addClass("ui-li-static ui-body-a").find("a").attr({"class":""});u.prev().find(".app-focus").length&&u.find(".ui-btn").first().addClass("app-focus ui-btn-active");e.is(".app-reset-scrolling")?e.find(".ui-panel-inner").scrollTop(0):pit(e);y&&y.remove();p&&p.remove();c&&h.left.inner.trigger("scroll")},pageShown:function(n){ri(n)},isWebView:function(){return nr&&!v.navigator.standalone&&!cn},isHosted:function(){return br},screen:function(){return f},icon:function(n,t){return et(ro(n),t)},notify:function(t){function f(n,t){var e=n._filterSource,r,u,f;return e&&(u=i.find(e),u&&(r=n._dataViewFieldName?n:n.get_parentDataView(),r&&(f=u.findField(r._dataViewFieldName),f&&(t=f.HeaderText+": "+t)))),t}function e(n){var e=n._lastArgs,r,u,t;return e&&(r=n.findAction(e.Path),r&&r.Notify&&(t=r.Notify,t&&t!="$none"&&(t.match(/\{/)?t=n._parseText(t,n.row()):(u=i.touch.pageInfo(n),u&&(t+=" - "+u.text)),t=f(n,t)))),t}var u,r;if(t!=null){if(u=st("ui.notify.enabled"),t._controller)return u?e(t):null;if(!u){t.force&&i.alert(t.text);return}typeof t=="string"&&(t={text:t});r=t.dataView;r?(delete t.dataView,t.text=f(r,t.text),r._pendingNotification=t):t.text&&(cl.push(t),setTimeout(n.notify,150))}else lt?setTimeout(dl,100):dl()},details:function(r){var u=r.field,f=u._dataView,o=f._allFields[u.AliasIndex],h=f.editing()?f.editRow():f.extension().commandRow(),e=r.key,s=o.format(h[o.Index]);e=e!=null?e:h[u.Index];u.ItemsTargetController&&$(u.DynamicItems||u.Items).each(function(){var n=this;if(n[0]==e)return s=n[1],!1});n.show({controller:u.ItemsDataController,view:r.view||"editForm1",filter:[{name:u.ItemsDataValueField,value:e}],headerText:s!=null?s:o.HeaderText,done:function(e){var s,o;wt()==f._id?f.get_isForm()?(e._newRow&&e._newRow.length||(s=i.input.methods.lookup._rowToValues(u,e,e.editRow()),t.execute({dataView:f,values:s})),r.done&&r.done(e)):f.sync():(o=n.dataView(),o&&!o.get_isForm()&&o.sync())},cancel:r.cancel})},lookup:function(i){var s;if(ni(),i.field&&kl(i.field),i.create){var r=i.field,d=i.dataInput,h=i.value,a=r.ItemsDataTextField,f=r._dataView;h==eo&&(h=null);n.show({controller:r.ItemsDataController,startCommand:"New",startArgument:r.ItemsNewDataView,filter:f.get_contextFilter(r,f.extension().collect()),defaultValues:h!=null&&a?[{name:a,value:h}]:null,done:function(n){var o=t.methods.lookup._rowToValues(r,n,n.editRow()),i=[];$(o).each(function(){i.push(this.value)});var f=0,e=r.DynamicItems||r.Items,u=i[1]?i[1].toString().toLowerCase():"undefined";if(r.ItemsStyle.match(/AutoComplete|Lookup/))for(;;){if(r._dataView.session(re(r)+u,null),!u.length)break;u=u.substring(0,u.length-1)}else $(e).each(function(n){if(this[0]==null||this[1].toString().toLowerCase()<u)f=n;else return!1}),e.splice(f+1,0,i);r.ItemsStyle.match(/AutoComplete|Lookup|DropDownList/)?(t.methods.lookup.focus(d.data("autoComplete",!1)),t.methods.lookup._useItemValue(r,i)):t.methods.listbox._useItemValue(r,i,!0)}});return}var e,u=i.field,o=u._dataView,v=[],y=ua(o,u,v),c,f,l,p=i.query,g=o._allFields[u.AliasIndex],w=g.HeaderText,b=w!="&nbsp;"?w:u.AltHeaderText,nt=o.editRow();if(es(),!u.ContextFields&&(e=n._modalStack.length&&n._modalStack[0].dataView,s=k.navigate.history,e&&e._lookupInfo&&e._lookupInfo.field==u&&s.activeIndex<s.stack.length-1&&s.stack[s.activeIndex+1].hash=="#"+e._id)){e._lookupInfo=i;oh.go(1);return}this.modalDataView();c=u.ItemsDataController.toLowerCase();$find(c)&&(c+=Sys.Application.getComponents().length);f=$create(Web.DataView,{id:c,baseUrl:o.get_baseUrl(),servicePath:o.get_servicePath(),controller:u.ItemsDataController,viewId:u.ItemsDataView,externalFilter:y,filter:v,filterSource:y.length>0?"options":null,showSearchBar:!0,tag:st("history.lookup.search")?null:"history-search-none",showFirstLetters:u.ItemsLetters,searchOnStart:u.SearchOnStart,description:u.ItemsDescription},null,null,$("<p>")[0]);l=this.pageInfo(f);p&&f.viewProp("quickFind",p);l.headerText=i.value?[i.text,b]:b;l.resolved=!0;f._lookupInfo=i;i.value==null||u.ItemsValueSyncDisabled||kw(f,[i.value]);f._parentDataViewId=o._id;this.modalDataView(l.id,!0)},show:function(t){var h=t.controller,v=t.view||"grid1",f,l=JSON.stringify(t),i,r,e,o=n._modalStack,u,s,a;if(e=o.length&&o[o.length-1],u=k.navigate.history,e&&e.showSign==l&&t.cache!=!1&&u.activeIndex<u.stack.length-1&&u.stack[u.activeIndex+1].hash=="#"+e.id){oh.go(1);return}for(es(),$(t.filter).each(function(){var n=this;n.name&&(n.Name=n.name);n.value&&(n.Value=n.value)}),this.modalDataView(),s=h.toLowerCase(),a=1,f=s;$find(f);)f=s+a++;return i=$create(Web.DataView,{id:f,baseUrl:__baseUrl,servicePath:__servicePath,controller:h,viewId:v,externalFilter:t.filter,showSearchBar:!0,startCommandName:t.startCommand,startCommandArgument:t.startArgument,showActionButtons:t.showActionButtons,exitModalStateCommands:["Cancel"],tag:t.tags},null,null,$("<p>")[0]),i._doneCallback=function(n){c(n).showSign=null;dtt(n);di(function(){t.done&&t.done(n)})},i._ditto=t.defaultValues,i._cancelCallback=t.cancel||di,r=this.pageInfo(i),r.headerText=t.headerText,r.headerText&&(r.headerTextLocked=!0),r.resolved=!0,r.showSign=l,t.key&&kw(i,[t.key]),this.modalDataView(r.id,!0),i},pageInit:function(n,t){var i=this.pageInfo(n),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!=!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,t!=!1&&pi(!0),i.refreshed==!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(n){var t;if(y()&&(t=this.pageInfo(n),t!=null)){var i=t.dataView,r=i?i.extension():null,u=this._modalStack.indexOf(t);u>=0&&this._modalStack.splice(u,1);t.initialized||(t.initialized=!0,i&&i._loadPage());r&&r._reset&&r.refresh()}},screen:function(){var n=0,t=ue(),i=k.getScreenHeight();return{top:n+t,bottom:n+k.getScreenHeight(),height:i-t,width:f.width}},callWhenVisible:function(n,t){var i=typeof n=="string"?y(n):n;i.each(function(){var n=$(this);if(n.is(":visible")&&n[0].style.visibility!="hidden"){var i=n.offset().top,u=i+n.outerHeight(),e=b(n),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)}})},whenPageShown:function(n){ri(n)},whenPageCanceled:function(n){wo(n)},goBack:function(n){di(n)},asyncJob:function(){return this._asyncJob},nextAsycJob:function(){return++this._asyncJob},resetPageHeight:function(){ui()},supports:function(n){switch(n){case"Map":return this._supportsMap==!0}return!1},mapsApiKey:function(){var n=!!v.location.host.match(/^localhost\b/);return e("map.apiKey")||(n?"key=AIzaSyAhggwxCKiA2oEdxaRqap4t4-_96ajw_uw":"")},registerAPI:function(t,i){var r=this,u,e,f;if(t=="Map")return r._mapAPI?i&&i():(e=!!v.location.host.match(/^localhost\b/),f=n.mapsApiKey(),u="https://maps.googleapis.com/maps/api/js?&callback=appFactoryCallback",f?(u+="&"+f,r._mapAPI=!0,v.appFactoryCallback=function(){r._supportsMap=!0;$(document).trigger($.Event("map.init.app"));i&&i();v.appFactoryCallback=null},$.getScript(u)):i&&i()),r._mapAPI;t!="Charts"||r._chartsAPI||n.registerAPI("Map",function(){$.getScript("https://www.google.com/jsapi",function(){$.getScript("https://www.gstatic.com/charts/loader.js",function(){r._chartsAPI=!0;$(document).trigger($.Event("charts.init.app"));i&&i()})})})},fetchOnDemand:function(){function t(n){n.trigger("vclick")}if(!kf){var i=n.dataView();this.callWhenVisible(".dv-load-at-bottom",t);this.callWhenVisible(".dv-load-at-top",t)}return this},keyboard:function(){return vw()},callInAnimationFrame:function(n){if(requestAnimationFrame)var t=requestAnimationFrame(function(){n();cancelAnimationFrame(t)});else n()},stickyHeader:function(n){var g=this,nt=v._stickyHeaderHideInstruction;v._stickyHeaderHideInstruction=!1;var l=b(n),h=l.closest(".ui-page"),a=nc(h),r=a.attr("data-selector"),i=r?h.find(r):a.find(".app-static-text"),t=vu(n),u,e=!0;if(t&&t.length){if(!rt&&(i.length||r)){var y=h.is(".app-page-modal"),w=p(l,"top"),k=Math.ceil(i.length?i.offset().top:-1),s,c,tt=0;k<w&&(r||i.height()>0)&&(t.is(":visible")&&t.data("screen-width")==f.width?e=!1:(e=!1,y?t.is(".app-bar-heading-modal")||t.addClass("app-bar-heading-modal"):t.is(".app-bar-heading-modal")&&t.removeClass("app-bar-heading-modal"),t.data("screen-width",f.width),t.show()[0].style.width=kr(l)-p(t,"padding-left")-p(t,"padding-right")-(y&&o?-1:0)+"px",h.find(".ui-content").children().each(function(){var n=$(this);n.is(".app-tabs,.app-bar-actions,.app-bar-header")&&n.css("display")!="none"&&(tt+=n.outerHeight())}),u=t.css({top:w+(y?-1:-1)}).find(".app-bar-text"),r?(c=a.html(),c!=u.data("html")&&(u.data("html",c).html(c).css("white-space","normal"),nt&&t.find(".app-view-instruction,.app-group:not(.app-group-fixed)").addClass("app-hidden").parent().addClass("app-bar-text-instruction-hidden"))):(s=i.text().trim(),s?s!=u.data("text")&&u.data("text",s).text(s).css("white-space",""):e=!0),t.outerHeight()+p(t,"top")<i.outerHeight()+k&&(t.hide(),e=!0)))}return(e||d(document.activeElement).length)&&t.hide(),g}},wait:function(){},start:function(t){function tt(n){return $(n).each(function(){return this.selected?(l=this,!1):this.children&&(tt(this.children),l)?!1:void 0}),null}function ut(){var i=t&&$(t.selector).data("scripts");i&&eval(i);$(document).trigger($.Event("start.app"));n._started=!0;ie&&n.notify({text:hp.DeviceLoginPrompt,duration:"long"})}function ft(){n.tabs("create",{tabs:p,className:"app-tabs-echo",scope:"page",change:function(){}})}var et=n._appLoaded&&n._pageCreated,nt,l;if(!t&&!et){setTimeout(function(){n.start()},16);return}k.ignoreContentEnabled=!0;var r=n.pageMenu(t&&t.pageId),d=0,h,g=$(t&&t.selector||"#PageContent"),u=g.attr("data-href"),ot=n._pages.length>1,b=g.find('div[data-app-role="page"]').each(function(f){var e=$(this),a=e.find('> div[data-role="content"]'),c=e.attr("data-content-framework");c&&e.attr("data-enhance","false");a.length||(a=$('<div data-role="content"><\/div>'),e.contents().appendTo(a),a.appendTo(e));e.attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable").appendTo(s);var h=i.eval(e.attr("data-page-header")),l=ng(e),o={text:(h!="false"?h:"")||l.text||n.title(),description:l.description,activator:l,url:u,transition:t&&t.transition},y=e.attr("id")||aa(u||location.pathname)+(f>0||u?f+1:"")||"_root",p,v;h=o.text.split(/\s*\|\s*/);o.headerText=h.length>1?h:h[0];e.find('div[data-role="content"]').contents().wrapAll('<div class="app-page-content'+(c?" app-content-framework app-"+c:"")+'"><\/div>');e.page().attr("id",y);o.id=y;o.page=e;o.dynamic=t&&t.dynamic;n.pageInfo(o);v=(o.scrollable=oc(e,!1)).find(".app-page-content");c&&(e.attr("data-page-header","false"),i.configureFramework(c,v,function(n){co=n}));t&&t.dynamic||ha();ot&&n.makeModalOrPanel(o);e.each(function(){$.each(this.attributes,function(){var t=this,n;t.specified&&(n=t.name,n.match(/^data\-/)&&!n.match(/^(data-(content-framework|page-header|app-role|role|activator|enhance))$/)&&v.attr(n,t.value))})});i.dataBind(v,[]);l.text&&(d++,p=$('<a class="app-action-navigate" />').attr("href","#"+y).text(l.text).appendTo($("<li/>").appendTo(r)),o.description&&$("<p/>").appendTo(p).text(o.description))});b.length&&(h=b.first(),d==0&&h.attr("data-activator")!="false"&&$('<a class="app-action-navigate" />').attr("href","#"+h.attr("id")).text(h.attr("data-page-header")||op.SeeAlso).appendTo($("<li/>").appendTo(r)),r.is(".ui-listview")&&r.listview().listview("refresh"));nt=at.nodes;t||tt(nt);l&&!b.length&&r.find("a").length==0&&py(l.children,r,1);var it=this,f=t?n.page(t.pageId):y(),a=f.find("a.app-action-navigate"),st=location.href.match(/#(.+)$/),o,p=[],w,rt=it._pages[0];a.length==1&&(t||e("ui.list.initialMode")=="SeeAll"||!rt.dataView||rt.dataView.get_lastCommandName()||v.location.href.match(/_controller=.+_commandName=.+/))?$(this._pages).each(function(){var t=this,i=t.dataView;if(dp=i&&i._id,(!u||t.url==u&&!t.root)&&(!i||!i._hidden)){u||(t.home=!0,u=k.path.documentBase.pathname+v.location.search);ut();k.navigate.history.clearForward();u&&(t.replaceUrl=u);i&&(oc($("#Main")),$('<h1 class="app-page-loading"/>').appendTo(n.content().empty()).text(er),ha());fh=!0;it.changePage(t.id);$(document).one("pageready.app",function(){fh=!1});return!1}}):f.attr("id")=="Main"&&(a.length&&f.find('a[rel="external"]').parent().remove(),a.show(),o=oc(f),ha(),f.addClass("app-page-scrollable"),ir(document.title),$(a).each(function(){var r=$(this),u=r.attr("href"),i=u&&c(u.substring(1)),t,f,n;i&&i.dataView&&i.activator.type!="Button"&&(n=i.activator,n&&n.type=="Tab"&&($(p).each(function(){if(this.text==n.text)return t=this,!1}),t||(w!=n.container&&(w&&(ft(),p=[]),w=n.container),t={text:n.text,content:[]},p.push(t))),f=lv(i.id,o),t&&t.content.push(f),r.parent().remove())}),w&&ft(),r=n.pageMenu(),r.find('a.app-action-navigate,a[rel="external"]').length?r.listview().show():r.remove(),ui(),o.find(".app-tabs").length>1&&$('<div class="app-stub-main"><\/div>').appendTo(o),vr(),ut(),hu(),rd(),nu(o),sr())},pageMenu:function(n){var r=this,i=this.content(n),t=i.find("ul.app-page-menu");return t.length||(t=$('<ul data-role="listview" data-inset="false" class="app-page-menu"/>').appendTo(i).hide().on("vclick",function(n){var t=$(n.target),i,u;return t.is("a")||(t=t.closest("a")),t.length&&(i=t.attr("href"),u=i.match(/^#/),u||pe(),it(t,function(){u?r.changePage(i.substring(1)):(gt(t,!1),v.location.href=i)})),!1})),t},initialize:function(){function ut(n){$(n).each(function(){var n=this,i=n.cssClass,t=i&&i.match(rp);t&&(f.push({node:n,icon:t[0]}),n.icon=t[0]);n.children&&ut(n.children);Web.Menu.nodeCount++})}function ft(n){return $(n).each(function(){var n=this,i=(n.url||"").toLowerCase();return(i.startsWith("../")&&(i=i.substring(3)),u.indexOf(i)!=-1||n.selected)?(t=n,t.selected=!0,Web.Menu.currentNode=t,!1):n.children&&(ft(n.children),t)?(n.selected=!0,!1):void 0}),null}function lt(){var n=uc(),t;if(n-ht>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=uc()}ht=n;setTimeout(lt,1250)}var t,u,f,ot,w,it,a,y,rt;ktt();u=v.location.pathname+v.location.search.replace(/(\_(\w+)=(.*?)(&|$))/,"");f=Web.Menu.nodesWithIcons=[];u.match(/\?$/)&&(u=u.substring(0,u.length-1));Web.Menu.nodeCount=0;for(ot in at.Nodes){w=at.Nodes[ot];ft(w);ut(w);t&&t.cssClass&&(t.showPageHeaderTitle=!!t.cssClass.match(/\bpage-header-title\b/),t.showPageHeaderDescription=!!t.cssClass.match(/\bpage-header-description\b/),t.showPageHeaderIcon=!!t.cssClass.match(/\bpage-header-icon\b/));break}var pt=this,ht=uc(),b=k.path.parseUrl(location.href),d=b&&b.hash,g,ct=$("head"),o=$('<div class="app-scrollbar-info"><div><\/div><\/div>').appendTo(s);tt={width:o[0].offsetWidth-o[0].clientWidth,height:o[0].offsetWidth-o[0].clientWidth,gridColumnPadding:16};o.remove();lit();l.init();d&&(d.match(/\W/)||!$(d).length)&&(k.navigate.history.initialDst="",g=k.navigate.history.stack[0],g.url=b.hrefNoHash,g.hash="",k.path.documentBase.href=k.path.documentBase.hrefNoHash);nr?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(tp>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../images/logo-icon.png"/>').appendTo(ct):tr&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../images/logo-icon.png"/>').appendTo(ct);setTimeout(lt,10);kt.appInfo.match(/\|$/)||$("#app-welcome").remove();n._logo.html(wl());rc();n.refreshMenuStrip();ub();var i=h.left.toolbar,f=Web.Menu.nodesWithIcons,vt=st("settings.enabled"),yt=e("ui.menu.apps.location"),p=!yt||yt=="sidebar",nt=f.length<=4&&f.length==at.nodeCount||!p,c=Math.min(f.length,(nt?4:3)+(vt?0:1));if(at.nodeCountInSidebar=c,st("ui.sidebar.toolbar")){if(it=e("ui.menu.tabbar")==!0,st("ui.sidebar.icons")&&!it)for(a=0;a<c;a++)y=f[a],rt=$('<a class="ui-btn ui-btn-a app-btn-page app-btn'+a+'">&nbsp;<\/a>').appendTo(i).attr("title",y.node.title).data("context",y.node),et(y.icon,rt),y.node==at.currentNode&&rt.addClass("app-selected");else c=0,nt=!p;!nt&&p&&et("material-icon-apps",$('<a class="ui-btn ui-btn-a app-btn-apps">&nbsp;<\/a>').appendTo(i).attr("title",r.Apps));vt&&et("material-icon-settings",$('<a class="ui-btn ui-btn-a app-btn-settings">&nbsp;<\/a>').appendTo(i).text(r.Settings).attr("title",r.Settings));it?i.addClass("app-has-tabbar"):c&&i.addClass("app-has-icons");e("ui.menu.location")!="sidebar"&&p||c||i.addClass("app-has-optional-apps");tk();h.left.inner.closest(".ui-panel").addClass("app-has-toolbar-bottom");i.find(".ui-btn").length||i.css("visibility","hidden");fb()}else i.hide(),h.left.inner.css("bottom",0);po(h.left.inner,!1)},presenter:function(t,r){function f(){u[r.name]=r}function e(n){ae(n.id,n.name)}function o(){var n=u[typeof r=="string"?r:r.name];return n&&(typeof r=="string"||n.supports(i.find(r.id),r.config))}function s(){var e=i.find(r.id),s=e.extension(),o=r.container.is(".app-echo-inner"),t=pc(),f;if(o||e==n.dataView()){if(t=u[r.name],o&&t.echo&&!t.echo())return!1;o||(rk(r.container,s),r.container.find('ul[data-role="listview"]').hide(),wa(r.container,s));f=$(r.container).find('div[data-presenter="'+t.name+'"][data-scope="'+e._viewId+'"]');f.length||(f=$('<div data-role="presenter" class="app-presenter"><\/div>').appendTo(r.container).attr({"data-presenter":t.name,"data-scope":e._viewId}));f.show();r.container=f;t.show(r)}else iu(r.id+"_echo");return!0}function h(){$(r.container).find('div[data-role="presenter"]').each(function(){var n=$(this),i=n.attr("data-presenter"),t=u[i];t&&(r.container=n,t.hide(r),n.hide())})}function c(){$(r.container).find('div[data-role="presenter"]').each(function(){var n=$(this),i=n.attr("data-presenter"),t=u[i];t&&(r.container=n,t.dispose(r),n.remove())})}function l(){var o=i.find(r.id),s=n.contextDataView()!=n.dataView(),f,t;for(f in u)t=u[f],t.supports(o)&&(!s||!t.echo||t.echo())&&r.list.push({name:f,text:t.text(),icon:t.icon(),context:{id:o._id,name:f},callback:e})}function a(){return u[r.name]}var u=n._presenters;switch(t){case"supports":return o();case"enumerate":l();break;case"register":f();break;case"show":return s();case"hide":h();break;case"dispose":c();break;case"find":return a()}},showAccountManager:function(t,u){var o=i.AccountManager.list(),s=location.href.match(/(\?|&)_accMan=(\w+)/),f=[],e;if(Web.Membership._instance._rememberMeSet&&(t||(t=[]),t.push({name:"RememberMe",value:!0})),!i.AccountManager.enabled()){n.showLogin(t);return}for(e in o)e!="_lastUser"&&o[e].UserName&&f.push({text:e,callback:btt,context:o[e]});u&&(f.length||s&&s[2]!="login")?s||f.length?(f.push({text:r.AddAccount,callback:n.showLogin,icon:"material-icon-add"}),dr(f,"switch")):kc(f[0].context.UserName):n.showLogin(t)},showLogin:function(t){var u=Web.Membership&&Web.Membership._instance,r,i;!u||u.get_displayLogin()||bh()?(i=dr(),i.is(".app-acc-man-inactive")||i.is(".app-acc-man-splash")||i.appendTo(s).addClass("app-acc-man-inactive"),i.insertBefore($(".app-page-modal-background")),wh()||dr().fadeOut("slow"),n.show({controller:"MyProfile",startCommand:"New",startArgument:"loginForm",showActionButtons:"Bottom",defaultValues:t})):(r=__baseUrl+"login",v.location.href.indexOf(".aspx")!=-1&&(r+=".aspx"),v.location.href=r)},openExternalUrl:function(t,i){var u,r=k.path.parseUrl(t),f=r.hash;return r.host&&(u=function(){if(!pi())if(r.host=="maps.apple.com"||r.host=="maps.google.com"||i)ts(t);else{var u=r.pathname.replace(/\//g,"-").substring(1)||r.host.replace(/\W/g,"-"),s=r.filename.replace(/\W/g," "),o=n.pageInfo(u),f,e;o||n.pageInfo({id:u,external:!0,href:t});f=n.page(u);e=f.find("iframe");pi(!0);n.busy(!0);e.length&&e.remove();e=$('<iframe class="app-page-external"/>').attr("src",t).appendTo(b(f).addClass("app-wrapper-external")).load(function(){wt()==u?(pi(!1),n.busy(!1)):setTimeout(function(){n.changePage(u)})});nr&&b(f).css("overflow","auto")}}),u},getThemes:function(){var n=new $.Deferred;return $.ajax({url:__servicePath+"/Themes",method:"POST",cache:!1}).done(function(t){n.resolve(t.d||JSON.parse($(t).text()))}),n.promise()},returnUrl:function(){if(ie=sessionStorage.identityConfirmationRequested,ie)return ie;var n=v.location.href.match(/\?ReturnUrl=(.+?)(#.+)?$/);return n&&(n=decodeURIComponent(n[1])),n&&n.startsWith("/_invoke/getidentity")&&(sessionStorage.identityConfirmationRequested=ie=n),n},_changeThemeLink:function(n,t,i){var f=new Date,o=kt.appInfo.split("|")[1],r,u,e;f.setMonth(f.getMonth()+1);document.cookie=".COTTHEME"+o+"="+t+";expires="+f.toUTCString()+";path=/";u=$("link.app-theme");u.length&&(r=u.attr("href"),r.indexOf("appservices")>-1?r=r.replace(new RegExp(RegExp.escape(n),"i"),t):(e=t.split("."),r=r.substring(0,r.indexOf("Theme.ashx")+17)+e[0]+"&accent="+e[1]),$.ajax({url:r,dataType:"text"}).done(function(){u.attr("href",r);i()}))}},function(){var n,i,r;$.event.special.swipe.teardown();$.event.special.swipe.setup=function(){};$.event.special.tap.teardown();$.event.special.tap.setup=ii;$.mobile.autoInitializePage=!1;var h=/\b_touch_(\w+)=(\w+)\b/g.exec(location.href),c=k.focusPage;if(k.focusPage=ii,$.extend($.fn.buttonMarkup,{initSelector:"a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a"}),n=k.SerialTransition.prototype,n.toPreClass="",n.cleanFrom=function(){this.$from.removeClass(k.activePageClass)},n.doneIn=function(){this.deferred.resolve(this.name,this.reverse,this.$to,this.$from,!0)},n.hideIn=function(n){n.call(this)},n.scrollPage=ii,n.startIn=function(){this.hideIn(function(){this.$to.addClass($.mobile.activePageClass)});this.doneIn()},n.startOut=ii,n.toggleViewportClass=ii,n.transition=function(){var n="none",t="",i=$.mobile.getScreenHeight();return this.$from&&!n?this.startOut(i,t,n):this.doneOut(i,t,n,!0),this.deferred.promise()},k.resetActivePageHeight=function(){},s=$("body"),i=v.matchMedia("screen and (min-resolution: 144dpi)"),i.matches||(i=v.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)")),i.matches&&(bs=144,i=v.matchMedia("screen and (min-resolution: 240dpi)"),i.matches||(i=v.matchMedia("screen and (-webkit-min-device-pixel-ratio: 2.5)")),i.matches&&(screepDPI=432)),o="ontouchstart"in v,o){if(!nr&&!tr)$(document).on("mousemove touchstart",function(n){cr=null;n.type.match(/^touch/)?o||(o=!0,s.removeClass("app-desktop app-show-system-buttons-on-hover")):o&&(o=!1,kt&&e("ui.showSystemButtons")=="Always"||s.addClass("app-show-system-buttons-on-hover"),s.addClass("app-desktop"))})}else if(v.PointerEvent){o=!0;$(document).on("pointerdown pointermove",function(n){var t=n.originalEvent.pointerType;t=="touch"?o||(o=!0,s.removeClass("app-desktop app-show-system-buttons-on-hover")):t=="mouse"&&o&&(o=!1,kt&&e("ui.showSystemButtons")=="Always"||s.addClass("app-show-system-buttons-on-hover"),s.addClass("app-desktop"))})}o||s.addClass("app-desktop");$("#aspnetForm").hide();var t=$('<div id="app-bar-toolbar" class="app-bar-toolbar ui-header ui-bar-a ui-header-fixed" data-role="header" data-position="fixed" data-theme="a" class="app-bar-toolbar"><\/div>').appendTo(s),f=$('<div data-role="page" id="Main"><\/div>').appendTo(s),u='<a class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"/>',l=$('<a class="ui-btn ui-btn-a ui-btn-icon-notext app-btn-float app-btn-promo"/>').hide().appendTo(s).on("vclick",tn);iw()?(ti=bl(),du({isVirtual:ti.width!=null,width:ti.width,height:ti.height,toolbar:t})):du({isVirtual:!1,toolbar:t});$('<div data-role="content" class="app-content-main"><\/div>').appendTo(f);$('<span class="app-btn-menu-background"/>').appendTo(t);$('<a data-role="button" id="app-btn-menu" class="app-btn-menu ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars ui-btn-left"/>').appendTo(t);$('<span class="app-back-text"/>').appendTo(t);$('<span class="app-logo"/>').appendTo(t);$('<h1 class="ui-title"/>').appendTo(t);r=$('<div class="app-btn-cluster-right"><\/div>').appendTo(t);$(u).appendTo(r);$(u).appendTo(r);$(u).appendTo(r);$(u).appendTo(r);$(u).appendTo(r);$('<a id="app-btn-context" data-role="button" class="app-btn-context ui-btn-right ui-link ui-btn ui-icon-dots ui-btn-icon-notext ui-shadow ui-corner-all"/>').appendTo(r).attr("title",fi).hide();t.find(".app-btn").data("icon","gear").on("vclick",tn)}();n=i.touch=i.mobile=new Web.Mobile;n.activeLinkBlacklist=".ui-slider-handle,.dv-action-see-all,.app-do-not-activate";n._presenters={};n.calcWidth=kr;n.createLayout=ob;n.prepareLayout=sb;s.on("pagecontainercreate",function(){n.start()}).on("pagecontainerbeforeshow",function(t,i){var f=y(),u=c(),r=u?u.headerText:n.title();r&&typeof r!="string"&&(r=r[0]);r==!1&&(r="");n.toolbar(r);yw(u);n.pageShow(wt());n.unloadPage(i.prevPage,f);ve();n.contextScope(null)}).on("pagecontainerbeforehide",function(){t.ignoreErrors=!1;rt=!0;n.busy(!0)}).on("pagecontainerbeforechange",function(n,t){if(typeof t.toPage=="string"&&t.toPage.match(/^http/)&&fh)return fh=!1,!1}).on("pagecontainerbeforetransition",function(r,u){if(u.toPage&&u.prevPage){var o=$(u.toPage).attr("id"),s=c(o),h=$(u.prevPage),e=h.attr("id"),l=c(e),f=l&&l.dataView,p=f&&f.odp,a,v;if(o==e||s&&s.deleted)return!1;if(f&&(a=f._dismissAll,f._dismissAll=!1,u.options.reverse&&f.editing()&&(!t.cancel()||!f.changed("ignore"))))return v=h.attr("data-url"),setTimeout(function(){ptt(e);i.confirm(wi.DiscardChanges,function(){f.changed("ignore",!0);di()},function(){t.focus()})}),r.preventDefault(),!1}ni();n.promo(!1);da(y());iv(us())}).on("pagecontainershow",function(){y()&&yk(y())}).on("pagecontainertransition",function(n,t){tb(t)});i.dragMan=ut=new function(){return this.prototype={active:function(){return this._active==!0},call:function(t,i){if(i.drag){this._dragged=!1;var u=this,r=this[i.drag.type],s=r&&r[t],f=i.drag,o,e;clearTimeout(u._draggedTimeout);t=="start"?(ut._keepTap=!1,u._active=!0,e=f.target,o=n.contextDataView(e),f.dataView=o,r&&(!r.options||r.options.taphold!=!1)&&(u._tapholdTimeout=setTimeout(function(){if(u._tapholdTimeout=null,f){if(f.touch)$(document).one("vmouseup pointerup",function(n){n.preventDefault();n.stopPropagation();ia()});var n=$.Event("taphold.app",{drag:f});f.target=e;f.dataView=o;$(e).trigger(n);ws(n)}},750))):ut._keepTap||u._tapholdTimeout&&(clearTimeout(u._tapholdTimeout),u._tapholdTimeout=null);r&&s&&(!r.options||!r.options.dataView||f.dataView)&&r[t](i.drag);(t=="end"||t=="cancel")&&(i.drag.dataView=null,u._active=!1,ur(!0))}},dragged:function(n){var t=this;return arguments.length&&(t._dragged=n,n&&clearTimeout(t._draggedTimeout),t._draggedTimeout=setTimeout(function(){t._dragged=!1},200)),t._dragged==!0}}};$(document).on("mousedown pointerdown touchstart","[data-draggable]",function(n){var i;if(fe(n),i=n.type,(i!="mousedown"||n.which==1)&&!vt&&!w){su();ni();var f=cr,o=$(this),r=o.attr("data-draggable"),u=ut[r],e=n.originalEvent.pointerType,t=u&&u.options;if(e!="mouse"||n.which!=3)if(vt={x:f.x,y:f.y,lastX:f.x,lastY:f.y,target:o,type:r,data:null,cancel:!1,mouse:e=="mouse"||i=="mousedown",pointer:!!i.match(/^pointer/),touch:e=="touch"||!!i.match(/^touch/),pen:e=="pen",tooltip:t&&t.tooltip},$(document).trigger($.Event("dragstart.app",{drag:vt})),r!=vt.type&&(r=vt.type,u=ut[r],t=u&&u.options),vt.cancel)vt=null;else{(vt.dir=="all"||t&&t.immediate)&&(n.preventDefault(),t&&t.immediate&&dy(n,!0));$(document).on("pointermove touchmove mousemove",dy).on("pointerup pointercancel touchend touchcancel mouseup",ws);if(n.isDefaultPrevented())return!1}}}).on("dragstart.app",function(n){ut.call("start",n)}).on("dragmove.app",function(n){ut.call("move",n)}).on("dragend.app",function(n){ut.call("end",n)}).on("dragcancel.app",function(n){ut.call("cancel",n)}).on("taphold.app",function(n){ut.call("taphold",n)});ut.hscrollbar={options:{taphold:!1,immediate:!0},start:function(n){var t=this,i=n.target.parent().prev();i.css("overflow-x")!="auto"&&(i=i.children().first());n.dir="all";t._scrollable=i;n.target.parent().addClass("app-scrollbar-dragging");t._rect=n.target.parent()[0].getBoundingClientRect();t._ratio=t._scrollable[0].offsetWidth/n.target.width();t._offset=n.x-n.target.offset().left},move:function(n){var t=this;t._scrollable.scrollLeft((n.x-t._rect.left-t._offset)*t._ratio)},cancel:function(n){this.end(n)},end:function(n){n.target.parent().removeClass("app-scrollbar-dragging");n.target.parent().prev().focus()}};ut.vscrollbar={options:{taphold:!1,immediate:!0},start:function(n){n.dir="all";this._scrollable=n.target.parent().prev();n.target.parent().addClass("app-scrollbar-dragging");this._rect=n.target.parent()[0].getBoundingClientRect();this._ratio=this._scrollable[0].scrollHeight/this._scrollable.height();this._offset=n.y-n.target.offset().top},move:function(n){var t=this;t._scrollable.scrollTop((n.y-t._rect.top-t._offset)*t._ratio)},cancel:function(n){this.end(n)},end:function(n){n.target.parent().removeClass("app-scrollbar-dragging");sr()}};ut["grid-header"]={options:{dataView:!0},start:function(n){if(o){var t;n.target.find(".app-field-separator").each(function(){var i=$(this),r=i.offset(),u=n.x-r.left;Math.abs(u)<=22&&(t=i)});t&&(n.originalType=n.type,n.type="grid-header-separator",n.target=t,ut["grid-header-separator"].start(n))}}};ut["grid-header-field"]={options:{dataView:!0},start:function(n){var t=n.target,i,u=t.offset(),r;n.mouse||(i=t.width(),i>tt.gridColumnPadding*2&&(u.left+i-tt.gridColumnPadding<n.x?(n.target=t.next(),r=!0):u.left+tt.gridColumnPadding>n.x&&t.prev().is(".app-field-separator")&&(n.target=t.prev(),r=!0)));r?(n.originalType=n.type,n.type="grid-header-separator",ut["grid-header-separator"].start(n)):n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,e=n.dataView,i=t._lastDropTarget,r,c=t._dragLine,d=0,g,et,l=yi(n.target),a,ot,v,nt,st,w=o?30:20,h,u,it,k,rt=t._mirror;if(h=(l.length?l:y(".app-grid")).find(".dv-item").first(),u=h.offset(),k=e.session("grid-frozen-width")||0,!t._dragLine){g=b();et=g.offset();st=!0;i=t._lastDropTarget=n.target;t._targetFieldName=i.attr("data-field-name");a=l.length?l.find(".dv-item").last():null;ot=f.height-(a?a.offset().top+a.outerHeight():et.top+g.outerHeight());c=t._dragLine=$('<div class="app-drag-line"><\/div>').appendTo(s);c.css({top:i.offset().top,bottom:ot});n.target.css("color",c.css("background-color"));ut["data-item"]._scrollbar(n,!1);var ft=i.prevAll(".app-field-separator").first(),ht=i.nextAll(".app-field-separator").first(),ct=ft.length?ft.offset().left+Math.ceil(ft.outerWidth()/2):i.offset().left-(o?tt.gridColumnPadding/2:2),vt=ht.offset().left+Math.ceil(ht.outerWidth()/2),lt=i.css("padding-top"),at=i.css("padding-bottom");rt=t._mirror=$('<span class="app-drag-header-field"/>').appendTo(s).css({"font-size":i.css("font-size"),paddingLeft:tt.gridColumnPadding/2,paddingRight:tt.gridColumnPadding/2,paddingTop:lt,paddingBottom:at,textAlign:i.css("text-align")}).width(vt-ct-tt.gridColumnPadding).height(i.closest(".app-grid-header").height()-p(lt)-p(at)).text(i.text());t._mirrorDispX=n.x-ct;t._mirrorDispY=n.y-i.offset().top+(n.mouse?0:i.outerHeight());t._mirrorWidth=rt.outerWidth()}h.find(".app-field").each(function(){var t=$(this),i=t.offset();(t.is(".app-frozen")||i.left>u.left+k)&&n.x>=i.left-tt.gridColumnPadding/2&&n.x<i.left+t.width()+tt.gridColumnPadding/2&&(v=t)});v&&(nt=v.attr("class").match(/\bapp-field-([\w\_]+)\b/i),nt&&(i=v,t._targetFieldName=nt[1]));t._lastDropTarget=i;r=i.prev();r.is(".app-field-separator")?d=Math.ceil(r.outerWidth(!0)/2)+2:(r=i,d=-tt.gridColumnPadding/2);r.length&&c.css({transform:"translate3d("+(r.offset().left+d)+"px,0,0)",transition:st||n.instantFeedback?"":"transform 160ms ease-out"});t._mirror.css({left:n.x-t._mirrorDispX,top:n.y-t._mirrorDispY});n.instantFeedback=!1;clearTimeout(t._gridScrollTimeout);it=h.width();(u.left+it-(n.x-t._mirrorDispX+t._mirrorWidth-1)<=w||n.x-t._mirrorDispX-(u.left+k)<=w)&&(t._gridScrollTimeout=setTimeout(function(){var r=e.session("grid-avail-width"),o=Math.ceil(r-r*(h.width()/r)),i=e.session("scroll-left")||0,s=n.x-t._mirrorDispX,l=s+rt.outerWidth()-1,c=s-(u.left+k),f;i<o&&u.left+it-l<=w?(i=Math.min(i+32,o),f=!0):i>0&&c>0&&c<=w?(i=Math.max(i-32,0),f=!0):clearTimeout(t._gridScrollTimeout);f&&(e.session("scroll-left",i),of(e,-i,!1),n.instantFeedback=!0,n.dropTarget=document.elementFromPoint(vi(),gu()),t.move(n))},100))},end:function(n){var e=this,t=n.dataView,f=t._allFields,o=t.gridSettings(),i=o.sequence,r=n.target.attr("data-field-name"),u=e._targetFieldName;r=f[t.findFieldUnderAlias(r).Index].Name;u=f[t.findFieldUnderAlias(u).Index].Name;i.length||$(t._fields).each(function(){i.push(this.Name)});i.splice(i.indexOf(r),1);i.splice(i.indexOf(u),0,r);this._removeDragState(n);t.gridChanged()},cancel:function(n){this._removeDragState(n)},taphold:function(n){yy(n.target,{x:n.x,samples:!1,hide:!0})},_removeDragState:function(n){var t=this;clearTimeout(t._gridScrollTimeout);n.target.css("color","");t._lastDropTarget=null;t._dragLine&&(t._dragLine.remove(),t._dragLine=null,t._mirror.remove(),t._mirror=null);ut["data-item"]._scrollbar(n,!0)}};ut["grid-header-separator"]={options:{dataView:!0,taphold:!1,immediate:!0},start:function(n){var t=this,u=b(),i=n.target.prevAll("[data-field-name]").first(),e=yi(i),r=e.length?e.find(".dv-item").last():null,o=f.height-(r?r.offset().top+r.outerHeight():u.offset().top+u.outerHeight());t._columnHeader=i;t._left=Math.ceil(i.offset().left);t._minRight=t._left+se()+n.target.outerWidth()+2;i.next().is(".app-btn-more")&&(t._minRight+=i.next().outerWidth());t._maxRight=t._left+(i.closest(".app-bar-heading").length?b():i.closest(".app-grid")).width()*.75;t._dragLine=$('<div class="app-drag-line"><\/div>').appendTo(s).css({transform:"translate3d("+(n.target.offset().left+Math.floor(n.target.outerWidth()/2))+"px,0,0)",top:n.target.offset().top,bottom:o});t._leftLine=$('<div class="app-drag-line"><\/div>').appendTo(s).css({left:t._left-Math.ceil(tt.gridColumnPadding/2),top:i.offset().top,bottom:o});i.css("color",t._dragLine.css("background-color"));n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,i=n.x;i<t._minRight&&(i=t._minRight);i>t._maxRight&&(i=t._maxRight);t._right=i;t._dragLine.css("transform","translate3d("+i+"px,0,0)")},end:function(n){var t=this,o=t._dragLine,f=t._right-t._left-n.target.outerWidth()-2,i=n.dataView,r=i.gridSettings(),u=t._columnHeader,e=i.findField(u.attr("data-field-name"));u.next().is(".app-btn-more")&&(f-=u.next().outerWidth());r.width[e.Name]||u.parent(".app-grid-header").find("[data-field-name]").each(function(){var n=$(this),t=n.width();r.width[n.attr("data-field-name")]=t});r.width[e.Name]=f;i.gridSettings(r);ut.dragged(!0);t._removeLine(n);ff(i,!1,!0);i.gridChanged()},cancel:function(n){this._removeLine(n)},_removeLine:function(n){var t=this;n.target.prevAll("[data-field-name]").first().css("color","");t._dragLine.remove();t._leftLine.remove();t._columnHeader=null},canScroll:function(){return!1}};ut.dismiss={start:function(n){n.dir="all"},move:function(){},end:function(n){this.cancel(n)},cancel:function(n){n.target.trigger("vclick")}};ut.panel={start:function(n){var t=this;t._position=n.target.is(".ui-panel-position-right")?"right":"left";n.dir="horizontal";t._lastX=t._x=n.x;t._time=+new Date},move:function(n){var t=this,i=n.target,r=t._dir,u=n.x-t._x;t._dir||(r=t._dir=i.is(".ui-panel-position-right")?"right":"left",r=="right"?i.offset().left:i.outerWidth(),i.css({position:"absolute"}),t._animated=i.is(".ui-panel-animate"));t._displacement=u;t._movedBy=n.x-n.lastX;r=="right"?i.css({right:(ai()?f.right:0)+Math.min(0,-t._displacement)}):i.css({left:(ai()?f.left:0)+Math.min(0,t._displacement)});t._lastX=n.x},end:function(n){function c(){f?t.css("visibility","hidden").panel("close",!0):t.css({transform:"none",transition:"transform 0 linear",right:e=="right"?0:"",left:e=="left"?0:""});i._done(t)}var i=this,r=i._displacement,t=n.target,u=t.outerWidth(),e=i._dir,s=o?30:10,h=+new Date-i._time<=250,f;if(e=="right")if(p(t,"right")==0)i._done(t);else{f=i._movedBy>=0&&(h&&r>=s||Math.abs(r)>=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?u-r:-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}else if(p(t,"left")==0)i._done(t);else{f=i._movedBy<1&&(h&&-r>=s||Math.abs(u+r)<=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?-(u+r):-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}},cancel:function(n){this._done(n.target)},_done:function(n){var t=this;t._dir=null;n.css({position:"",transition:"",transform:"",left:ai()?t._position=="left"?f.left:"":"",right:ai()?t._position=="right"?f.right:"":""});t._animated&&setTimeout(function(){n.addClass("ui-panel-animate")},100)},canScroll:function(n,t){return t=="vertical"?n.height()<n[0].scrollHeight:!0}};ut["data-item"]={options:{dataView:!0},start:function(n){var t=this,i=n.dataView,s=i.extension().viewStyle(),h=n.target.closest(".app-listview"),r=i.session("grid-avail-width"),f=h.width(),u,e,o;if(s=="Grid"&&r>f){if(i.multiSelect()&&(u=n.target.closest(".ui-btn").find(".app-btn-check"),u.length&&n.x<u.offset().left+u.outerWidth()+8))return;e=f/r;o=Math.ceil(r-r*e);t._maxScroll=o;t._originalX=n.x;t._lastX=n.x;t._listViewWidth=f;t._scrollLeft=i.session("scroll-left")||0;n.dir="horizontal";t._minScroll=p($("span."+ye(i)),"margin-left")+t._scrollLeft;i.session("scroll-left-margin",t._minScroll)}},move:function(n){var t=this,r=n.dataView,u,i=t._scrollLeft;t._scrollbar(n);u=Math.ceil(t._originalX-n.x);i+=u;i<0?(i=0,t._originalX=n.x,t._scrollLeft=i):i>t._maxScroll&&(i=t._maxScroll,t._originalX=n.x,t._scrollLeft=i);n.time=+new Date;r.session("scroll-left",i);of(r,-i,!0)},end:function(n){this._stopAnimation(n);var r=this._scrollLeft,u=+new Date,f=n.time,e=(u-f)*100,i=n.x-n.lastX;if(e>0&&Math.abs(i)>5){var o=i<0?1:-1,t=r+this._listViewWidth*o;t<this._minScroll?t=0:t>this._maxScroll&&(t=this._maxScroll);n.dataView.session("scroll-left",t);of(n.dataView,-t,!1,!0)}},cancel:function(n){this._stopAnimation(n)},taphold:function(n){n.target.is(".app-btn-more")?n.target.trigger("vclick"):n.target.trigger("contextmenu")},_stopAnimation:function(n){ut.scrollingAnimationFrame!=null&&(cancelAnimationFrame(ut.scrollingAnimationFrame),ut.scrollingAnimationFrame=null);this._scrollbar(n,!0)},_scrollbar:function(n,t){t?n.hscrollbar&&(ge(n.hscrollbar.parent().parent()),n.hscrollbar=null):n.scrollbarHandled||(n.scrollbarHandled=!0,tt.height>0&&(n.hscrollbar=yi(n.target).length?n.target.closest(".app-grid").find(".app-hscrollbar-inner"):y(".app-bar-hscrollbar .app-hscrollbar-inner"),n.hscrollbar.width(1).parent().data("ignore-scrolling",!0),setTimeout(function(){n.hscrollbar&&n.hscrollbar.parent().removeData("ignore-scrolling",!0)},100)))}};$(document).ready(function(){kt=__settings;n.initialize()}).on("dragend",function(){$.event.special.swipe.eventInProgress=!1}).on("mousedown",function(n){fe(n)}).on("touchstart pointerdown",function(t){if(fe(t),!$(t.target).is(":input")){if(rt){t.preventDefault();return}var r=$(t.target),i=r.closest("a,.app-feedback"),u=by=pu(t);ky=!cr.isScrollable;i.length&&(lf=i.data("touch-start",u),i.is(n.activeLinkBlacklist)||(i.parent().is("li")?(clearTimeout(wy),wy=setTimeout(function(){lf&&gt(lf,!1)},250)):o&&gt(i,!1)))}}).on("touchmove pointermove",function(n){var u,f=$(n.target),i=$(lf),e=f.closest(".ui-panel-inner,.app-wrapper"),t=pu(n),r=i.length&&i.data("touch-start"),o;if(nr&&!i.length&&f.closest(".app-bar-toolbar").length){n.preventDefault();return}if(f.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}if(ky&&(ky=!1,e.length&&(t.y>by.y?u=e.scrollTop()==0:t.y<by.y&&(o=pk(e),u=o.height>=o.maxHeight-1)),u)){fo();gt();n.preventDefault();nr&&(kf=!1);return}i.length&&(r&&(r.scrollTop!=t.scrollTop||Math.abs(r.x-t.x)>0||Math.abs(r.y-t.y)>0)&&gt(),fo())}).on("touchend pointerup",function(n){fe(n);fo()}).on("touchcancel pointercancel",function(){gt();fo()}).on("scrollstart.app",function(){ve();t.methods.lookup._hidePopup()}).on("scrolldir.app scrollstop.app",function(n){if(n.relatedTarget){var i=$(n.relatedTarget),h=i.find("> .app-listview").filter(":visible"),u=h.find(".app-group"),f,l,a,e;u.length&&(f=nc(tc(i)),f.length&&(group=f.find(".app-group"),group.length||(group=$('<div class="app-group"><\/div>').appendTo(f),$(u[0]).is(".app-group-fixed")&&group.addClass("app-group-fixed")),l=i.offset().top+vu(i).outerHeight(!0),u.each(function(){var n=$(this);if(n.offset().top+n.outerHeight(!0)/2>l)return!1;a=n}),e=(a||$(u[0])).html(),e!=group.html()&&(group.html(e),vu(i).find(".app-group").html(e))));var c=i.data("scroll-dir"),y=h.filter(".app-grid"),p=h.find(".app-group-fixed").first(),o=y.length>0||p.length,s=i.data("sticky-header"),r=o?s.find(".app-view-instruction,.app-group:not(.app-group-fixed)"):null,w=r&&r.parent();c=="up"?(o&&r.length&&!r.is(":visible")&&r.removeClass("app-hidden"),es(s),ru(i)):(c=="down"||!c&&o)&&(o?(r.addClass("app-hidden"),w.addClass("app-bar-text-instruction-hidden"),v._stickyHeaderHideInstruction=!0,ru(i)):s&&s.hide());n.type=="scrollstop"&&(t.restoreLastPopup(),clearInterval(ap),ap=setTimeout(function(n){var t=pk(n);t.top<=0&&t.height<=t.maxHeight+1&&(no(),hu(null,null,i.find(".app-echo")))},250,i))}}).on("contextmenu MSHoldVisual selectstart",function(n){var t,i,r,u;o&&!$(n.target).is(":input")||rt?n.preventDefault():n.type=="contextmenu"?(t=$(n.target),t.is(".ui-popup-screen")?(i=$(".ui-popup-active .ui-popup.app-popup-listview"),i.length&&(cf(i),n.preventDefault(),r=pu(n),u=document.elementFromPoint(r.x,r.y),setTimeout(function(){var n=$(u);n.trigger(n.closest(".app-control-helper").length?"vclick":"contextmenu")},75))):t.closest(".ui-popup").length?n.preventDefault():t.is(".app-has-children")&&(n.preventDefault(),setTimeout(function(){t.trigger("vclick")},50))):n.type=="MSHoldVisual"&&n.preventDefault()}).one("pagecreate","#Main",function(){n._pageCreated=!0}).on("vclick","a",tft).on("vclick",".app-input-value",function(n){return $(n.target).prev().focus(),!1}).on("vclick",".app-btn-toggle",dut).on("vclick",".app-filter",function(t){var i=yi(t.target);return i.length&&n.contextScope(i.attr("data-for")),hf({mode:"everything"}),!1}).on("vclick","[data-href]",function(){var n=$(this),i=n.attr("data-href"),t=n.closest(".app-field");if(!n.is(".app-control-inner")||n.parent().attr("data-input")=="none")return t.addClass("app-selected"),setTimeout(function(){t.removeClass("app-selected");ts(i)},dt),!1}).on("vclick contextmenu",".app-grid-header",function(n){if(ut.dragged()||lt){n.preventDefault();n.stopPropagation();return}su();var t=$(n.target),i={x:n.pageX,y:null};if(!t.is(".app-btn-more"))return t.is(".app-icon,.app-grid-header-text")&&(t=t.parent()),rv(n)?uv(kg(t)):(t.attr("data-field-name")||$(this).find("span").each(function(){var i=$(this),r=i.offset().left;if(!i.is(".app-btn-check,.app-btn-more,.app-frozen-spacer")&&r<=n.pageX&&n.pageX<r+i.outerWidth(!0))return t=i,!1}),t.is(".app-frozen-spacer")&&(t=t.next()),t.is("span")&&!t.is(".app-btn-check,.app-field-separator")&&(t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),(n.type=="contextmenu"||n.type=="vclick"&&n.ctrlKey)&&(i.samples=!1),n.preventDefault(),setTimeout(function(){t.removeClass("ui-btn-active");yy(t,i)},dt))),!1}).on("vclick contextmenu",".app-bar-heading",function(n){var t=$(n.target);if(t.closest(".app-group").length&&!t.is(".app-group"))return uy(!0),!1});eu.on("resize",function(){du();rft()}).on("throttledresize",function(){du();gi(!0)}).on("orientationchange",function(){du();gi(!0)}).on("popstate",function(){t.ignoreErrors=!0});$(document).on("mousedown",function(){var n=ht&&ht[0];n&&n.display!="none"&&!n.className.match(/\bapp-tooltip-message\b/)&&ni()}).on("mousemove",function(n){n.pageX!=null&&(df=n.pageX,gf=n.pageY)}).on("vclick",".app-tooltip-message",function(){ni()}).on("mouseenter","[title]",function(n,t){var i=$(this),r=i.attr("title"),u=df,f=gf;if(r){if(ett){r&&(i.attr("title",null),setTimeout(function(){i.attr("title",r)},1e3));return}i.attr("title","").data("title",r);clearTimeout(ne);ne=setTimeout(function(){if(ne=null,t=10,!w||w.tooltip){var n=i.offset();i[0].namespaceURI==utt&&Math.abs(u-df)<=11&&Math.abs(f-gf)<=11||df>=n.left&&df<n.left+i.outerWidth()&&gf>=n.top&&gf<n.top+i.outerHeight()?np(df,gf+23,r,i):ht&&!ht[0].className.match(/\bapp-tooltip-message\b/)&&ht.hide()}},t!=null?t:ftt)}}).on("mouseleave","[title]",function(){var n=$(this),t=n.data("title");t&&n.attr("title",t).removeData("title");ht&&!ht[0].className.match(/\bapp-tooltip-message\b/)&&ni()});t=i.input={methods:{none:{render:ii},text:{render:function(n){var s=n.container,u=n.inner,c=n.row,i=n.field,l=i._dataView,o,a=n.originalField,h,e,r,f;a||i.Index==i.AliasIndex||(i=l._allFields[i.AliasIndex]);o=i.TextMode;e=c[i.Index];s.removeClass("app-has-helper");e==null?(r=n.editing?t.fieldToPlaceholder(a||i):"",s.addClass("app-null")):(i.ItemsStyle&&i.ItemsStyle!="Lookup"&&i.ItemsStyle!="AutoComplete"?(h=l._findItemByValue(i,e),h&&(r=h[1])):r=i.text(e),o==1&&(r=new Array(r.length+1).join("&#9679;")),s.removeClass("app-null"));o==2&&u.addClass("app-field-data-rtf");i.Rows&&!i.ItemsTargetController&&u.css({"min-height":i.Rows+"em"}).addClass("app-text-multiline");r?i.HtmlEncode&&o!=1?u.text(r):u.html(r):u.html("&nbsp;");os(u,i,e,r,!0)&&u.attr("title",r);n.editing?(i.Type.match(/^(Byte|Currency|Decimal|Double|Int16|Int32|Int64|Single|SByte|UInt16|UInt32|UInt64)$/)?f="number":yv(i)?f="tel":pv(i)?f="email":rrt(i)&&(f="url"),f&&n.container.attr("data-type",f)):i.HyperlinkFormatString&&u.attr("data-href",lc(i,c));this._createFooter(n)},focus:function(n){t.beforeFocus();var u=d(n),f=nt(u),i=t.elementToField(n),e=i.TextMode==2,r;if(e){if(r=i.is("rtf-editor"),r){l.editor({field:i.Name,type:r});return}l.toolbar("create",u)}else l.range("clear");if(f.length)f.focus();else return fft(n)},blur:function(n){var t=$(n.target),i=d(t),u=i.find(".app-control-inner"),r=t.data("restoreText");l.range("save");r!=null&&u.text(r);l.toolbar("remove",i)},setup:function(n){var i=$(n.target).data("notify");i&&(n.change=t.methods.text._textChange)},_textChange:function(n){var i=n.input.closest("[data-notify]").data("notify"),t=$.Event(i);t.inputData=n;$(document).trigger(t)},_createFooter:function(n){var i=n.container,f=n.inner,u=n.field,r=n.originalField,t;r||(r=u);r.FooterText?(t=i.find(".app-control-footer"),t.length||(t=$('<span class="app-control-footer"/>')),t.appendTo(i.addClass("app-has-footer")),t.html(r.FooterText)):i.is(".app-has-footer")&&i.removeClass("app-has-footer").find(".app-control-footer").remove()}},blob:{render:function(n){var c=n.container,s=n.inner.empty(),r=n.field,h=r._dataView,l=n.row,y=n.editing,a=l[r.Index],u,v;if(!a||a.match(/^null/))u=t.fieldToPlaceholder(r),c.addClass("app-null"),u&&(u==nh.Required&&(u=""),$('<span class="app-blob-placeholder"/>').text(u).appendTo(s));else{u=a;y||(v=s.find(".app-drop-box"),v.length&&i.upload("destroy",{container:v}));var p=h.resolveClientUrl(h.get_appRootPath()),f=$('<a rel="external"/>').appendTo(s).attr("href",String.format("{0}blob.ashx?{1}=o|{2}",p,r.OnDemandHandler,u)),e,w=r.Name.toLowerCase();r.OnDemandStyle!=1?(f.addClass("app-has-image"),$("<img/>").appendTo(f).attr({src:String.format("{0}blob.ashx?{1}=t|{2}&_nocrop",p,r.OnDemandHandler,u),title:wi.BlobDownloadHint}),$(h._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t==w+"contenttype"||t==w+"content_type")return e=l[n.Index],!1}),$(h._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t=="contenttype"||t=="content_type")return e=l[n.Index],!1}),e||(e="image"),e.match(/^image/i)?f.attr("data-content-type",e):o||f.attr("target","_blank")):(f.appendTo(s).addClass("app-link-blob").attr("title",wi.BlobDownloadHint),$('<span class="glyphicon glyphicon-download"> <\/span>').appendTo(f),$("<span/>").text(wi.BlobDownloadLink).appendTo(f),o||f.attr("target","_blank"))}y&&i.upload("create",{container:$('<div tabindex="0"><\/div>').appendTo(s).addClass("drop-box-"+r.Index),dataViewId:h._id,fieldName:r.Name,change:function(){var n=!!c.find(".app-drop-box.app-empty").length;c.toggleClass("app-null",n);t.execute({dataView:r._dataView,values:[{name:r.Name,value:n?null:"0"}],skipDrawingInput:c});gi(!1)}});t.methods.text._createFooter(n)},focus:function(n){return t.beforeFocus(),n.is(":input")?void 0:(nt().blur(),n.find(".app-drop-box").focus(),!0)}},checkbox:{render:function(n){var i=n.container,r=n.inner,u,e=n.field,o=e.Items,f,s=n.editing,h=n.row[e.Index];f=o[o.length-1][0]==h;h==null?r.html(eo):(et("material-icon-"+(f?"check-box":"check-box-outline-blank"),r.empty()).addClass("app-icon-checkbox"),i.addClass("app-has-checkbox"));r.css("visibility",s?"hidden":"");s?(u=$('<div class="app-checkbox-container" tabindex="0"><\/div>').appendTo(t.createContainer(i)),f&&u.addClass("app-checkbox-on"),$('<a class="app-checkbox-button" />').appendTo(u)):i.find(".app-data-input-container").remove();t.methods.text._createFooter(n)},focus:function(n,i){t.beforeFocus();nt().blur();var r=n.find(".app-checkbox-container").focus();return i&&i.is('[data-control="label"]')&&this._toggleState(r),!0},click:function(n){var i=vi(n.clientX),t=d(n.target,".app-checkbox-container");t.offset().left-8<=i&&i<=t.offset().left+t.outerWidth()+8&&(this._toggleState(t),n.preventDefault())},_toggleState:function(n){var r=n.is(".app-checkbox-on"),s=n.find(".app-checkbox-button"),u=d(n),e=u.attr("data-checkbox-style"),i,f;if(t.cancel()){if(ni(),n.toggleClass("app-checkbox-on"),i=t.elementToField(n),e!="circle"&&e!="square")if(r)n.addClass("app-checkbox-on app-animation").addClass("app-animate-off").one("transitionend",function(){setTimeout(function(){n.removeClass("app-animation").removeClass("app-checkbox-on app-animate-off")})});else n.addClass("app-animation").addClass("app-animate-on").one("transitionend",function(){n.removeClass("app-animation").removeClass("app-animate-on")});t.execute({dataView:i._dataView,values:[{name:i.Name,value:!r}],skipDrawingInput:u});o||r||(f=i.is("lookup-auto-advance"),f&&setTimeout(function(){t.move(u,"right",9,f)}))}}},lookup:{render:function(n){var u=n.originalField=n.field,y=u.ItemsTargetController,w,b;n.field=n.dataView._allFields[n.field.AliasIndex];var h=n.inner,e=n.container,o=e.find(".app-data-input-button"),k=e.data("node"),c=n.editing,v,s,l,f,a;!c&&y?t.methods.listbox.render(n):(c&&!o.is(".app-data-input-button")&&(o=$('<span class="app-data-input-button"><span class="app-caret"><\/span><\/span>').insertAfter(h).attr("title",cp.Select.HeaderText),v=u.ItemsStyle,v=="Lookup"?o.addClass("app-caret-r"):v=="DropDownList"&&($('<span class="app-caret app-caret2"><\/span>').appendTo(o.addClass("app-caret-u-d")),u.tagged("open-on-tap")&&e.css("cursor","pointer"))),c?h.css("max-width",e.attr("data-size")!=""?"none":k.self.width()-(o.outerWidth()||22)-p(h,"padding-left")*2):(o.length&&o.is(".app-data-input-button")&&o.remove(),h.find(".app-control-before").remove(),e.removeClass("app-null app-has-helper")),s=e.find(".app-control-before"),y?(s.length?a=s.find("ul"):(h.text(t.fieldToPlaceholder(u)),e.addClass("app-has-helper"),s=$('<span class="app-control-before app-control-helper" tabindex="0"/>').insertBefore(h),a=$("<ul/>").appendTo(s)),l=u.DynamicItems||u.Items,f=n.row[u.Index],f==null&&(f=""),typeof f!="string"&&(f=f.toString()),l.length?(f.length&&(w=a.find("li"),b=u.is("lookup-distinct"),f=i.csv.toArray(f),$(l).each(function(){var n=this,i=n[0],r;i!=null&&f.indexOf(i.toString())!=-1&&(r=$("<li/>").text(n[1]).attr("data-value",i).appendTo(a),b&&t.addCount(r,n[n.length-1]))}),w.remove()),s.css("visibility","")):s.css("visibility","hidden"),e.toggleClass("app-null",l.length==0)):(s.remove(),t.methods.text.render(n)),c||!u.ItemsDataController||n.row[u.Index]==null||u.tagged("lookup-details-hidden")||$('<span class="app-field-object-ref app-feedback"/>').appendTo(h).attr("title",r.LookupViewAction))},focus:function(n){var u,f,i,h,c;t.beforeFocus();var r=n.find(".app-control-helper"),e=r.data("focus")==!1,s=n.find("li");return(r.removeData("focus"),u=d(n),u.addClass("app-has-focus"),!e&&s.length)?t.valid()?(r.focus(),s.removeClass("app-focus").first().addClass("app-focus"),!0):!1:(f=t.methods.text.focus(n),e&&u.addClass("app-has-focus"),f&&(i=t.elementToField(n),h=i._dataView.editRow(),n.data("autoComplete")==!1?n.removeData("autoComplete"):h[i.Index]==null&&(t.elementToButton(n).removeClass("app-caret-r"),i.ItemsStyle=="Lookup"&&(c=nt(d(n)).focus(),setTimeout(function(){t.methods.lookup._showList({field:i,value:null,input:c})},o?300:10)))),f)},click:function(i){var e=t.eventToButton(i),c=e.offset(),l=vi(i.clientX),u=$(i.target),f=d(u),h;if(u.is("li,.app-muted")){if(u=u.closest("li"),!t.cancel())return i.preventDefault(),!1;if(nt(f).length){i.preventDefault();nt(f).blur();setTimeout(function(){u.trigger("vclick")},100);return}function a(){f.removeClass("app-has-focus");u.removeClass("app-focus")}u.is(".app-focus")||u.parent().find("li").removeClass("app-focus");nt(f).blur();var v=f.find(".app-control-helper").blur(),s=t.elementToField(u),y=[{text:cp.Delete.HeaderText,icon:"trash",callback:function(){t.methods.lookup._removeBasketItem(u,!0);v.focus()}}];s.is("lookup-details-hidden")||s.is("lookup-distinct")||y.push({text:r.LookupViewAction,icon:"carat-r",callback:function(){a();n.details({field:s,key:u.attr("data-value")})}});f.addClass("app-has-focus");u.addClass("app-focus");hi({anchor:u,items:y,autoFocus:!1,afterclose:function(n,t){o?a():t||v.focus()}});i.preventDefault()}else u.closest(".app-control-helper").length?u.closest(".app-control-helper").focus():f.attr("data-input")=="dropdownlist"&&!nt(f).length&&(o||t.elementToField(u).tagged("open-on-tap"))?(i.preventDefault(),h=nt(),h.length&&h.blur(),o?(lt=!0,setTimeout(function(){lt=!1;t.methods.lookup.lov(f)},100)):this.clickButton(i)):e.length&&c.left<=l&&l<c.left+e.outerWidth()+8&&this.clickButton(i)&&i.preventDefault()},clickButton:function(i,r){function y(){e.removeClass("ui-btn-active");s=u._dataView;c=s._allFields[u.AliasIndex];l=s.editRow();n.lookup({field:u,value:v?l[u.Index]:null,text:v?c.format(l[c.Index]):null,change:function(n){if(u.ItemsTargetController){if(n.length>=2)if(t.methods.lookup._useItemValue(u,[n[0].value,n[1].value]))o||f.find(".app-control-helper").data("focus",!1);else{f.addClass("app-has-focus").find(".app-control-helper").focus();return}}else t.execute({dataView:s,values:n});o||setTimeout(function(){a.focus(f)},100)}})}var e=t.eventToButton(i),a=t.elementToMethod(e),f=d(e),h=nt(f).length>0,u=t.eventToField(i),s,c,v=!u.ItemsTargetController,l;return!h&&!t.cancel()?!1:(h&&t.popup(":visible")?(t.popup("hide"),t.methods.lookup._buttonUp(e)):u.ItemsStyle!="Lookup"?(e.removeClass("ui-btn-active"),h||(f.find(".app-control-helper").data("focus",!1),a.focus(f)),nt(f).trigger($.Event("keydown",{ctrlKey:!0,which:32}))):r!=!1?(e.addClass("ui-btn-active"),setTimeout(y,dt)):y(),ia(),!0)},blur:function(n){var r=$(n.target),f=d(r),e=f.find(".app-control-inner"),i=r.data("restoreText"),u=t.eventToField(n);u.ItemsTargetController?(i=t.fieldToPlaceholder(u),e.text(i),t.fitContainer(f,null,i)):i!=null&&e.text(i);this._buttonUp(r);t.popup("hide");clearTimeout(u._showListTimeout)},setup:function(n){var i=t.eventToField(n);n.change=t.methods.lookup._lookupChange},_lookupChange:function(n){var i=n.input,r=t.elementToField(i),s=r._dataView,f,e,u,o;if(i.removeData("keepFocus"),n.value?r.AllowAutoComplete==!1&&(i.val(i.data("original")).select(),n.value=""):(t.popup(":visible")||r.AllowAutoComplete==!1||r.ItemsStyle=="DropDownList")&&(clearTimeout(r._showListTimeout),u=d(i),o=i.data("original")||"",i.val(""),i.removeData("restoreText"),t.popup("hide"),o!=""&&(t.methods.lookup._clearValue(r),f=!0),i.data("original",""),u.find(".app-control-inner").text(t.fieldToPlaceholder(r)),t.fitContainer(u)),e=t.elementToButton(i),e.removeClass("app-caret-r"),i.data("autoComplete")==!1)i.removeData("autoComplete"),clearTimeout(r._showListTimeout);else{if(!n.value&&(f||i.data("original")==""||t.methods.lookup._clearValue(r),r.ItemsTargetController&&n.keyCode))return;t.methods.lookup._showList({field:r,value:n.value,originalValue:i.data("original"),input:i,keyCode:n.keyCode})}},lov:function(u){function o(r){if(r=="Clear")t.methods.lookup._clearValue(f);else if(r=="New")n.lookup({field:f,create:!0,dataInput:u});else{var e=l[r];i.input.methods.lookup._useItemValue(f,e)}}var f=t.elementToField(u),h=f._dataView,c=h._allFields[f.AliasIndex],y=h.editRow(),l=f.DynamicItems||f.Items,a=y[f.Index],v,e=[],s;$(l).each(function(n){var t=this;e.push({text:c.format(t[1]),icon:a==t[0]?"check":!1,callback:o,context:n})});t.canCreateItems(f)&&(e.length&&(e.push({}),v=!0),e.push({text:pf.GenericNewToolTip,icon:"material-icon-add",callback:o,context:"New"}));a!=null&&f.AllowNulls&&(v||e.push({}),e.push({text:r.LookupClearAction,icon:"material-icon-cancel",callback:o,context:"Clear"}));s=c.HeaderText;hi({x:vi(),y:gu(),title:s!="&nbsp;"?s:null,anchor:u.find(".app-control-inner"),items:e})},_clearValue:function(n){var e=n._dataView,u=[{name:n.Name,value:null}],o=n.Copy,f,r;if(n.Index!=n.AliasIndex&&u.push({name:e._allFields[n.AliasIndex].Name,value:null}),o)while(r=i._fieldMapRegex.exec(o))r=r[1],f=n._dataView.findField(r),(f&&f.ReadOnly||r=="null")&&u.push({name:r,value:null});t.execute({dataView:e,values:u,skipPopulateField:n})},_hidePopup:function(){if(!o)if(t.popup(":visible")){var i=t._lastInputBeforeScroll=nt(),n=d(i,".app-data-input-button");n.length&&this._buttonUp(n);t.popup("hide")}else t._lastInputBeforeScroll=null},_buttonUp:function(n){var i=t.elementToField(n);n.is(".app-data-input-button")||(n=t.elementToButton(n));i&&i.ItemsStyle=="Lookup"&&n.addClass("app-caret-r");n.removeClass("app-caret-u app-caret-d")},_getCopyFields:function(n){var o=n.Copy,r,t,u,f,e;if(o&&(r=n._dataView,t=t=r.session(n.Name+"_copyFields"),!t)){for(t=[];u=i._fieldMapRegex.exec(o);)f=u[1],e=u[2],(r.findField(f)||e=="null")&&t.push({fromField:e,toField:f});r.session(n.Name+"_copyFields",t)}return t},_showList:function(n){function lt(){yt||(e.push({text:"$separator"}),yt=!0)}function at(e){var ui,fi,k,ei,at,oi,si,hi,ci;h=l.val();h==""&&u.ItemsStyle=="DropDownList"&&e.length&&e[0]instanceof Array&&e[0][0]==null&&(h=e[0][1]);var pt=h.length==0,w=v.data("ul"),ft=st.parent(),ai=hn(ft),k,ct,vi=l.outerHeight(),yi=b(l),fr=yi.offset(),nr=kr(yi),et,tt,pi=h&&RegExp.escape(h),ir=h?new RegExp(rt?pi:"^"+pi+".*","i"):null,a,bt=0,wi,kt,ki,lt,wt,dt,vt,gt,c,ti,rr=u.is("lookup-distinct"),di,ii,yt,ni,ri=0;if(v.data("list",e).css({width:"","max-width":"","min-width":"","max-height":"",height:""}).removeClass("app-wrap"),w.empty(),v.show(),ut&&(ni=i.csv.toArray(y.row()[u.Index])),$(e).each(function(i){var o=this,f,s,c;if(o.totalRowCount)h.length>=o.value.length&&bt<o.totalRowCount&&$('<li class="app-instruction"/>').appendTo(w).text(String.format(r.ShowingItemsRange,bt,o.totalRowCount));else if(o.text=="$separator")i>0&&$('<li class="app-instruction app-separator"/>').appendTo(w);else if(o.text)s=$("<li/>").appendTo(w).text(o.text),o.instruction&&s.addClass("app-instruction"),o.command&&(s.attr("data-command",o.command),o.command=="SeeAll"&&$('<span class="app-icon app-caret-r"><span class="app-caret"/><\/span>').appendTo(s)),o.selected&&s.addClass("app-selected"),kt||(kt=s);else if(f=o[1],f!=null&&typeof f!="string"&&(f=u.format(f)),a=f?f.toString().match(ir):null,f=="$separator")ki=$('<li class="app-instruction app-separator"/>').appendTo(w);else if((u.AllowNulls||o[0]!=null||pt||h==f)&&(it||pt&&(g=="AutoComplete"||g=="Lookup")||!pt&&f&&(a||f==h||h==n.originalValue))){if(bt++,ni){if(o[0]!=null&&ni.indexOf(o[0].toString())!=-1)return;ri++}s=$("<li/>").appendTo(w).attr("data-index",i);ai&&s.css(ai);!wi&&a&&(c=h.toLowerCase()==o[1].toString().toLowerCase(),(!et||c)&&(tt=f,et=s),wi=o[0]!=null&&(nt||c));a&&rt&&h!=n.originalValue?(a.index&&$("<span/>").text(f.substring(0,a.index)).appendTo(s),$("<b/>").text(f.substring(a.index,a.index+a[0].length)).appendTo(s),a.index+a.length<=f.length-1&&$("<span/>").text(f.substring(a.index+a[0].length)).appendTo(s)):a&&!rt?($('<span class="app-text-normal"/>').text(f.substring(0,h.length)).appendTo(s),$('<span class="app-text-bold"/>').text(f.substring(h.length)).appendTo(s)):s.text(f==null?bi.EmptyValue:f);f==di&&o.length>2?(yt=t.methods.lookup._itemToDetails(u,o),yt&&$("<i/>").text(yt).appendTo(s),ii||(yt=t.methods.lookup._itemToDetails(u,e[i-1]),yt&&$("<i/>").text(yt).appendTo(s.prev()),ii=!0)):ii=!1;rr&&f!=null&&t.addCount(s,o[o.length-1]);di=f}}),et||pt&&(!ni||ri!=0||g=="Lookup")||e[0].text==er||e[0].text==r.NoMatches||(ui=$('<li class="app-instruction"/>').text(r.NoMatches),fi=w.find("li:first"),fi.length?ui.insertBefore(fi):ui.appendTo(w),k=ft.find(".app-control-inner"),k.length&&l.data("restoreText")==null&&l.data("restoreText",k.text()),pt||(k.text(h+"  "),t.fitContainer(ft,st))),ut&&bt&&ri>1&&(li=$('<li data-command="SelectAll"/>').text(ol.SelectAll),kt?li.insertBefore(kt):(ki||$('<li class="app-instruction app-separator"/>').appendTo(w),li.appendTo(w))),ct=l.offset(),lt=Math.max(w[0].getBoundingClientRect().width+2,ht.length?ht.offset().left-ct.left+ht.outerWidth():0),lt=Math.min(lt,nr*.9),v.addClass("app-wrap"),v.css({width:lt,"max-width":lt,"min-width":lt}),wt=ct.left-1,vt=ct.top-1-f.top-s.scrollTop(),dt=ct.top+vi,gt=f.height-(ct.top+vi)-f.bottom,c=v.outerHeight(),o&&vt>100?(ti=!0,c=vt<c?vt:""):gt<c?vt>gt?(ti=!0,c=vt<c?vt:""):c=gt:c="",c&&(c-=4),c=c||v.outerHeight(),ti&&(dt=ct.top-c,ei=t.elementToButton(l),ei.is(".app-caret-u-d")||ei.addClass("app-caret-u")),wt+lt>f.width+f.left-10&&(wt=f.width+f.left-1-lt-10),v.css({left:wt,top:dt,"max-height":c,height:c}),et){if(et.addClass("app-selected"),at=et.position().top-(c-et.outerHeight())/2,tt=tt.trim(),oi=h.length<tt.length,oi&&!rt&&n.keyCode!=8)ft=d(l),k=ft.find(".app-control-inner"),k.length&&l.data("restoreText")==null&&l.data("restoreText",k.text()),tt=h+tt.substring(h.length),t.fitContainer(ft,l,tt),tr||(si=l.data("keyCode"),si!=8&&si!=46&&(l.data("autoComplete",!1),l.val(tt),l[0].setSelectionRange(h.length,tt.length),l.removeData("autoComplete")));else if(g=="DropDownList"&&!oi&&l[0].selectionStart==0&&l[0].selectionEnd==tt.length){at=v.css("left",-1e4).scrollTop(at).scrollTop();var ur=et.offset().top,ct=l.offset(),ot=dt-(ur-ct.top)-1,gi=v.outerHeight();ot<0?(ot-=4,v.find("li").last().css("margin-bottom",-ot),at=Math.ceil(at-ot),ot=4):ot+gi>f.height&&(hi=f.height-gi-4,ci=ot-hi,ot=hi,v.find("li").first().css("margin-top",ci),at=Math.floor(at-ci));v.css({top:ot,left:wt-p(et,"padding-left")})}v.scrollTop(at)}else l.val()||(ft=d(l),k=ft.find(".app-control-inner"),k.length&&l.data("restoreText")==null&&l.data("restoreText",k.text()),t.fitContainer(ft,l.closest(".app-data-input-container").width("")))}function kt(n){v.is(":visible")&&v.data("field")==y._id+"_"+u.Name&&(e.splice(0,1),at([[null,n.get_message()]].concat(e)))}function vt(){function g(n){if(o[k]=n,c(y)&&l.parent().length){l.data("ignoreContextFields",!0);var t=[],i=n[a];$(i).each(function(){var i=this,r=[i[tt||n.primaryKey[0]],i[f]],u=i.group_count_;pt&&$(pt).each(function(){r.push(i[this.fromField])});u!=null&&r.push(u);t.push(r)});y.session(re(u)+(s[ot.Index]==h?"":h).toLowerCase(),t);e.splice(0,1);e.length&&e[0].selected&&e.splice(0,1);i.length<n.totalRowCount&&t.push({totalRowCount:n.totalRowCount,value:h});v.is(":visible")&&v.data("field")==y._id+"_"+u.Name&&(u.ItemsStyle!="Lookup"||h?e=t.concat(e):(e.splice(0,1),e=t.concat(e),e.splice(0,0,{text:wt,instruction:!0})),e.length||(e=[{text:r.NoMatches,instruction:!0}]),at(e))}}var a=nt,f=u.ItemsDataTextField,tt=u.ItemsDataValueField,s=y.editRow(),o=y.session(u.Name+"_listCache"),p=[f],w=h!=n.originalValue&&h!=""?[f+":$"+bt+"$%js%"+i.serializer.serialize(h)]:[],it=ua(y,u,w);v.data("field",y._id+"_"+u.Name);$(t.methods.lookup._getCopyFields(u)).each(function(){this.fromField!="null"&&p.push(this.fromField)});o||y.session(u.Name+"_listCache",o={});var b={controller:a,view:u.ItemsDataView,sync:s[ot.Index]==h?s[u.Index]:null,lookupContext:{Controller:y._controller,View:y._viewId,FieldName:u.Name},_filter:w,sortExpression:f,format:!0,pageSize:ks,fieldFilter:p,pageIndex:0,pageSize:500,externalFilter:it,distinct:u.is("lookup-distinct")},k=JSON.stringify(b),d=o[k];d?g(d):i.execute(b).done(g).fail(kt)}var u=n.field,y=u._dataView,nt=u.ItemsDataController,g=u.ItemsStyle,ut=u.ItemsTargetController,it=g!="Lookup"&&g!="AutoComplete",yt,pt=this._getCopyFields(u),ft,et,wt=r.TypeToSearch,ot=y._allFields[u.AliasIndex],bt=ot.AutoCompleteAnywhere?"contains":"beginswith",rt=bt=="contains",a=n.value,h=a==null?"":a,v=t.popup(),l=n.input,st=l.parent(),ht=t.elementToButton(l),ct,w,k,tt,e=[];if(ni(),st.length){if(ut&&d(l,".app-control-before .app-focus").removeClass("app-focus"),it)e=u.DynamicItems||u.Items;else{if(u.AllowAutoComplete!=!1)if(h||u.ItemsStyle=="AutoComplete"){if(a=h.toLowerCase(),!u.ContextFields||l.data("ignoreContextFields")){for(l.data("ignoreContextFields",!1),tt=re(u),w=y.session(tt+a);!w&&a.length;)if(a=a.substring(0,a.length-1),w=y.session(tt+a),w&&w.length>=ks){w=null;break}while(w&&a.length){for(a=a.substring(0,a.length-1),k=y.session(tt+a);!k&&a.length;)if(a=a.substring(0,a.length-1),k=y.session(tt+a),k&&k.length>=ks){k=null;break}k&&k.length<ks&&(w=k)}}w?e=e.concat(w):(e.push({text:er,instruction:!0}),h&&e.push({text:h,selected:!0,command:"None"}),ct=!0)}else e.push({value:null,text:wt,instruction:!0});g=="Lookup"&&(u._doSearch?(u._doSearch=!1,w=l.data("ignoreContextFields")?y.session(re(u)):null,w?e=e.concat(w):(ct=!0,e.splice(1,0,{value:null,text:er,instruction:!0}))):h||e.push({text:r.ShowOptions,command:"ShowOptions"}),lt(),e.push({text:r.SeeAll,command:"SeeAll"}))}t.canCreateItems(u)&&(it&&(e=e.slice(0)),lt(),e.push({text:pf.GenericNewToolTip,command:"New"}));!it&&n.originalValue&&n.value&&(lt(),e.push({text:r.LookupClearAction,command:"Clear"}));e.length||e.push({text:r.NoMatches,instruction:!0});at(e);ct&&(clearTimeout(u._showListTimeout),u.ItemsDataValueField||(et=nt+"_"+u.ItemsDataView+"_DataValueField",u.ItemsDataValueField=i.cache[et]),u.ItemsDataTextField||(ft=nt+"_"+u.ItemsDataView+"_DataTextField",u.ItemsDataTextField=i.cache[ft]),u.ItemsDataTextField&&u.ItemsDataValueField?n.keyCode!=null?u._showListTimeout=setTimeout(vt,300):vt():i.execute({controller:nt,view:u.ItemsDataView,requiresData:!1,success:function(n){u.ItemsDataValueField=n.primaryKey[0].Name;u.ItemsDataTextField=n.fields[0].Name;i.cache[et]=u.ItemsDataValueField;i.cache[ft]=u.ItemsDataTextField;vt()},error:kt}))}},_itemToDetails:function(n,t){var e=[],f=2,o=n.Copy,r,s,u;if(o)while(s=i._fieldMapRegex.exec(o))r=n._dataView.findField(s[1]),r&&!r.Hidden&&!r.OnDemand&&r.Index==r.AliasIndex&&t&&t[f]!==undefined&&(u=t[f],u=u==null?u=eo:n.format(t[f]),e.push(u)),f++;return e.join("; ")},_rowToValues:function(n,t,r){var p=n._dataView._allFields[n.AliasIndex],y=n.Copy,o=n.ItemsDataValueField,s=n.ItemsDataTextField,e,u,c,h,l,a=null,v=null,f;if(o||$(t._allFields).each(function(){if(this.IsPrimaryKey)return o=this.Name,!1}),s||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return s=n.Name,!1}),e=t.findField(o),u=t.findField(s),r&&(v=r[u.Index],a=r[e.Index]),e)if(u){if(n.ItemsTargetController&&u)e&&(f=[{name:e.Name,value:a}]),u&&f.push({name:u.Name,value:v});else if(f=[{name:n.Name,value:a}],n.Index!=n.AliasIndex&&f.push({name:p.Name,value:v}),y)while(c=i._fieldMapRegex.exec(y))l=c[2],h=t.findField(l),(h||l=="null")&&f.push({name:c[1],value:h&&r?r[h.Index]:null})}else i.alert("Invalid text field "+s);else i.alert("Invalid value field "+o);return f},_removeBasketItem:function(n,r){if(n.length){var e=d(n),o=t.elementToField(n),s=o._dataView,h=s.editRow(),u=i.csv.toArray(h[o.Index]),f;r?(f=n.next(),f.length||(f=n.prev())):(f=n.prev(),f.length||(f=n.next()));f.addClass("app-focus");u.splice(u.indexOf(n.attr("data-value")),1);u=i.csv.toString(u);u.length||(u=null);n.remove();e.toggleClass("app-null",u==null);t.execute({dataView:s,values:[{name:o.Name,value:u}],skipDrawingInput:e});u||(e.find(".app-control-helper").hide(),t.methods.lookup.focus(e))}},_createItemFromText:function(r,u,f){function h(){n.lookup({field:r,create:!0,dataInput:u,value:f})}var c=r.ItemsDataController,s=r.ItemsNewDataView,e=r.ItemsDataValueField,o=r.ItemsDataTextField;r._dataView.sessionRemove(re(r));!n.busy()&&f&&r.ItemsDataController&&(s&&e&&o&&!r.Copy?(t.popup("hide"),i.execute({controller:r.ItemsDataController,view:s,command:"Insert",values:[{field:e},{field:o,newValue:f}],done:function(n){if(n.rowsAffected&&!n.errors.length){var i=n[r.ItemsDataController],u=[i[e],i[o]];nt().removeData("restoreText");t.methods.lookup._useItemValue(r,u)}else h()}})):h())},_useItemValue:function(n,r,u,f){var c=r[0],h=r[1]!=null?n.format(r[1]):"",p=n._dataView,w=p.editRow(),g=p._allFields[n.AliasIndex],s=nt(),e=d(s),rt=e.find(".app-control-inner"),tt,l,a,k,ft,v,ut;if(c==null){if(n.ItemsTargetController)return;if(w[n.Index]!=null&&(t.methods.lookup._clearValue(n),ft=t.fieldToPlaceholder(n),s=nt(e).val("").removeData("original").removeData("restoreText"),t.fitContainer(e,s.closest(".app-data-input-container")),e.find(".app-data-input-placeholder").css("display",""),s.length))try{s[0].setSelectionRange(0,ft.length)}catch(ct){}}else{if(n.ItemsTargetController){if(k=i.csv.toArray(w[n.Index]),c!=null&&(c=c.toString()),$(k).each(function(n){if(c==this)return tt=n,!1}),a=tt==null,a&&(k.push(r[0]),tt=k.length-1,l=i.csv.toString(k),l==""&&(l=null)),e.toggleClass("app-null",l==null),y('[data-input-container="'+p._id+'"] [data-control="field"][data-field="'+n.Name+'"]').each(function(){var u=$(this),i=u.find(".app-control-helper"),f,e;i.length&&(i.find("li").removeClass("app-focus"),a?(f=$("<li/>").text(h).attr("data-value",c).appendTo(i.show().find("ul")),n.is("lookup-distinct")&&t.addCount(f,r[r.length-1]),t.drawing(u,!1),n.ItemsStyle!="DropDownList"&&($(n.Items).each(function(){var n=this;if(n[0]==r[0])return e=!0,!1}),e||n.Items.push(r))):d(i.find('li:eq("'+tt+'")').addClass("app-focus")).addClass("app-has-focus"),i.css("visibility",""))}),f==!1){w[n.Index]=l;return}if(h="",s.length){s.data({original:h,last:h}).val(h)[0].setSelectionRange(0,0);e.find(".app-data-input-placeholder").show();rt.text(t.fieldToPlaceholder(n));rt.css("width","");t.fitContainer(e,s.closest(".app-data-input-container").width(""));a||e.addClass("app-has-focus").find(".app-control-helper").focus();var et=e.offset(),ot=e.outerHeight(),it=b(s),st=it.height(),ht=it.offset();et.top+ot>ht.top+st&&it.scrollTop(it.scrollTop()+(et.top+ot-(ht.top+st)+4))}return a&&t.execute({dataView:p,values:[{name:n.Name,value:l}],skipDrawingInput:e}),a}s.length&&s.data({original:h,last:h}).val(h)[0].setSelectionRange(0,h.length);rt.text(h);s.length&&t.fitContainer(e,s.closest(".app-data-input-container").width(""));e.removeClass("app-null").find(".app-data-input-placeholder").hide();(w[n.Index]!=c||n.Index!=g.Index&&w[g.Index]!=h)&&(v=[{name:n.Name,value:c}],n.Index!=g.Index&&v.push({name:g.Name,value:h}),$(t.methods.lookup._getCopyFields(n)).each(function(n){v.push({name:this.toField,value:this.fromField=="null"?null:r[n+2]})}),t.execute({dataView:p,values:v,skipDrawingInput:e}),o||(ut=n.is("lookup-auto-advance"),ut&&v.length&&v[0].value!=null&&setTimeout(function(){t.move(e,"right",9,ut)})))}}},autocomplete:{render:function(n){t.methods.lookup.render(n)},focus:function(n){return t.methods.lookup.focus(n)},click:function(n){t.methods.lookup.click(n)},clickButton:function(n,i){return t.methods.lookup.clickButton(n,i)},blur:function(n){t.methods.lookup.blur(n)},setup:function(n){t.methods.lookup.setup(n)}},dropdownlist:{render:function(n){t.methods.lookup.render(n)},focus:function(n){return t.methods.lookup.focus(n)},click:function(n){t.methods.lookup.click(n)},clickButton:function(n,i){return t.methods.lookup.clickButton(n,i)},blur:function(n){t.methods.lookup.blur(n)},setup:function(n){t.methods.lookup.setup(n)}},radiobuttonlist:{render:function(n){t.methods.listbox.render(n)},focus:function(n){return t.methods.listbox.focus(n)},click:function(n){t.methods.listbox.click(n)},clickButton:function(n,i){return t.methods.listbox.clickButton(n,i)},blur:function(n){t.methods.listbox.blur(n)}},checkboxlist:{render:function(n){t.methods.listbox.render(n)},focus:function(n){return t.methods.listbox.focus(n)},click:function(n){t.methods.listbox.click(n)},clickButton:function(n,i){return t.methods.listbox.clickButton(n,i)},blur:function(n){t.methods.listbox.blur(n)}},listbox:{render:function(n){var ft=n.container,o=n.inner,et,u,v,f=n.field,h,g,nt=f.ItemsStyle,ot=n.row,w,st=f.Columns,c,e=f.DynamicItems||f.Items,l,a,y,it,p,k,d,ut,ht;if(h=ot[f.Index],n.editing){if(w=t.canCreateItems(f,ot),a=e.length,st?c=Math.ceil((a+(w?1:0))/st):(c=f.Rows,c||(c=5)),ft.removeClass("app-null app-has-helper"),o.removeClass("app-collapsed"),it=o.find(".app-focus").text(),u=o.find(".app-data-list"),!u.length){o.empty();tt.height&&(et=$('<span class="app-data-list-outer"/>').appendTo(o));u=$('<span class="app-data-list" tabindex="0"/>').appendTo(et||o);tt.height&&u.css("margin-bottom",-tt.height);y=$('<span class="app-hscrollbar2"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"><\/span><\/span>').appendTo(o).find(".app-hscrollbar-handle");u.on("scroll",function(){if(u.data("scrolling")==!1)u.removeData("scrolling");else{ec(u,y,!0);var n=y.data("reveal-timeout"),t=y.parent();t.addClass("app-scrollbar-reveal");clearInterval(n);n=setInterval(function(){t.removeClass("app-scrollbar-reveal");clearInterval(n)},200);y.data("reveal-timeout",n)}})}a&&u.empty();u.removeClass("app-inner-shadow-right app-inner-shadow-left app-inner-shadow-left-right");nt=="CheckBoxList"&&h&&(l=i.csv.toArray(h.toString()));var ct=f.tagged("lookup-distinct"),s=f.is("lookup-top"),rt=e,b;if(s&&(s=parseInt(s),s)){if(e=e.slice(0),e.length&&e[0][0]==null&&nt.match(/^(RadioButtonList|ListBox)$/)&&(b=e[0],e.splice(0,1)),e=e.sort(rw),l||h==null||(l=[h.toString()]),l&&l.length){for(p=[],k=[],e.forEach(function(n){var t=n[0];t!=null&&l.indexOf(t)!=-1?p.push(n):k.push(n)}),d=0;d<k.length;d++){if(p.length>=s)break;p.push(k[d])}e=p.sort(rw)}e.splice(s);c=s;b&&(e.splice(0,0,b),c++)}$(e).each(function(n){n%c==0&&(v=$("<ul/>").appendTo(u));var r=this,i=$("<li>").appendTo(v),e=r[0],o=r[1];s&&(n=rt.indexOf(r));i.attr("data-index",n);o==null&&(o=bi.EmptyValue);f.HtmlEncode?i.text(o):i.html(o);ct&&e!=null&&t.addCount(i,r[r.length-1]);(l&&l.indexOf(e==null?"":e.toString())!=-1||h==e)&&i.addClass("app-selected");e==null&&i.addClass("app-null")});s&&rt.length>s&&$("<li>").appendTo(v).attr("data-index","more").text(rt.length-s-(b?1:0)+" "+fi);ut=u.find('[data-index="new"]');w?ut.length||((c&&a%c!=0||a<f.Rows)&&a||(v=$("<ul/>").appendTo(u)),$("<li>").appendTo(v).attr("data-index","new").text(pf.GenericNewToolTip)):ut.remove();this._scrollItemIntoView(u,!1);a||w&&u.find("li").length==1||u.children().addClass("app-hidden");it&&o.find("li").each(function(){var n=$(this);if(it==n.text())return n.addClass("app-focus"),!1});ht=u.next().show();a?ec(u):ht.hide();h!=null&&this._updateCollapsibleValue(f,ft)}else o.find(".app-data-list,.app-list-value").remove(),(nt=="CheckBoxList"||f.ItemsTargetController)&&h?(g=f.text(h,!1),f.HtmlEncode?o.text(g):o.html(g)):(t.methods.text.render(n),f.ItemsDataController&&n.row[f.Index]!=null&&!f.tagged("lookup-details-hidden")&&$('<span class="app-field-object-ref app-feedback"/>').appendTo(o).attr("title",r.LookupViewAction));t.methods.text._createFooter(n)},focus:function(n){t.beforeFocus();var i=n.find(".app-data-list");return i.length||(i=n.closest(".app-data-list")),i.focus(),this._focusItem(i),this._scrollItemIntoView(i),!1},click:function(r){var k=$(r.target),u=k.closest("li"),e,g,f,v,h,c,l,y,s,p,w,a;if(t.cancel()&&!u.parent().is(".app-hidden"))if(ni(),u.length){if(e=u.closest(".app-data-list"),f=t.elementToField(u),h=f.ItemsStyle,f._dataView._busy()||u.parent().is(".app-hidden"))return;if(s=d(e),p=u.attr("data-index"),p=="new"){this._focusItem(u);n.lookup({field:f,create:!0,dataInput:s});r.preventDefault();return}if(p=="more"){r.preventDefault();t.editor({dataView:v,fieldName:f.Name});return}if(v=f._dataView,c=f.DynamicItems||f.Items,c.length)if(h=="CheckBoxList")u.toggleClass("app-selected"),l=[],e.find(".app-selected").each(function(){var t=parseInt($(this).attr("data-index")),i=c[t],n=i[0];l.push((n!=null?n:"").toString())}),y=f.ItemsTargetController||h=="CheckBoxList"?i.csv.toString(l):l.join(","),clearTimeout(e.data("timeout")),e.data("timeout",setTimeout(function(){t.execute({dataView:v,values:[{name:f.Name,value:y==""?null:y}],skipDrawingInput:s})},250));else{if(u.is(".app-selected")){this._focusItem(e);t.methods.listbox._updateCollapsibleValue(f,s);return}e.find(".app-selected").removeClass("app-selected");u.addClass("app-selected");w=c[parseInt(u.attr("data-index"))];t.drawing(s,!1);clearTimeout(e.data("timeout"));e.data("timeout",setTimeout(function(){t.methods.listbox._useItemValue(f,w);t.methods.listbox._updateCollapsibleValue(f,s);!o&&f.is("lookup-auto-advance")&&w[0]!=null&&t.move(s,"right",9)},h=="RadioButtonList"?250:10))}g=b(e);g.height()>e.height()&&e.focus();this._scrollItemIntoView(u);this._focusItem(u);r.preventDefault()}else a=k.closest(".app-collapsed"),a.length&&(a.removeClass("app-collapsed"),u=a.find(".app-selected").first(),u.length&&(this._scrollItemIntoView(u),this._focusItem(u)))},blur:function(){},_updateCollapsibleValue:function(n,t){if(n.is("lookup-collapsible")){var i=t.find(".app-control-inner"),u=i.find(".app-list-value"),r,f;u.length||(u=$('<span class="app-list-value"/>').appendTo(i.addClass("app-has-list-value")),et("material-icon-expand-more",i).attr("title",fu.Maximize));r=[];i.find("ul").filter(function(){return!$(this).is("app-hidden")}).find(".app-selected").each(function(){r.push($(this).html())});u.html(r.join(", "));f=r.length>0;i.addClass("app-collapsible").toggleClass("app-collapsed",f)}},_scrollItemIntoView:function(n,t){if(n.is(".app-selected,.app-focus")||(n=n.find(".app-selected,.app-focus").first()),n.length){var r=n.offset(),f=n.outerWidth(),i=n.closest(".app-data-list"),e=i.width(),o=Math.min(f*.2,e*.1),u=i.offset();r.left<u.left?i.data("scrolling",!1).scrollLeft(n.parent().prev().length?i.scrollLeft()+r.left-u.left-o:0):r.left+f>u.left+e&&i.data("scrolling",!1).scrollLeft(i.scrollLeft()+r.left-u.left-(e-f-o));t!=!1&&ec(i,null,!1)}},_focusItem:function(n){if(!o){var t=n.closest(".app-data-list"),i=t.find("li").removeClass("app-focus");n.is("li")||(n=t.find(".app-selected").first());n.length||(n=i.first());n.addClass("app-focus")}},_useItemValue:function(n,r,u){var e=n._dataView,s,f=[{name:n.Name,value:r[0]}],h=n.Copy,c,l=n.Index!=n.AliasIndex,o;if(n.ItemsTargetController)s=e.editRow(),o=s[n.Index]||"",o&&(o+=","),o+=r[0].toString(),f[0].value=o;else if(l&&f.push({name:e._allFields[n.AliasIndex].Name,value:r[1]}),h)for(c=2;copyInfo=i._fieldMapRegex.exec(h);)copyToField=copyInfo[1],copyFromField=copyInfo[2],e.findField(copyToField)&&f.push({name:copyToField,value:copyFromField=="null"?null:r[c++]});u||(t.execute({dataView:e,values:f,skipPopulateField:n}),f.splice(0,l?2:1));f.length&&t.execute({dataView:e,values:f,populateDynamicLookups:!1,skipPopulateField:n})}}},of:function(n,t){n&&!n.jquery&&(n=$(n));var i=n.closest("[data-input]");return i.length||(i=n.find(".app-data-input").closest("[data-input]")),t?i.find(t):i},restoreLastPopup:function(){var n=this._lastInputBeforeScroll,e,r,u,f,i;n&&n.length&&!o&&(e=t.elementToButton(n),e.length&&(r=b(),u=r.offset(),f=n.offset(),u.top<f.top&&f.top+n.outerHeight()<u.top+r.height()&&(i=$.Event("keydown"),i.which=40,i.altKey=!0,nt().trigger(i))))},fieldToPlaceholder:function(n){var t="",i;return n.Watermark?t=n.Watermark:n.ItemsTargetController?t=pf.AddItem:n.ItemsStyle&&n.ItemsStyle!="CheckBox"&&n.ItemsStyle!="CheckBoxList"&&!n.ItemsTargetController?(i=n.DynamicItems||n.Items,t=i&&i.length&&i[0][0]==null?i[0][1]:pf.SelectLink):n.AllowNulls||(t=nh.Required),t},eventToButton:function(n){return this.elementToButton(n.target)},elementToButton:function(n){return d(n,".app-data-input-button")},eventToMethod:function(n){return this.elementToMethod(n.target)},elementToMethod:function(n){var i=d(n);return t.methods[i.attr("data-input")]},eventToField:function(n){return this.elementToField($(n.target))},elementToField:function(n){var e=n.closest("[data-field]"),r=e.attr("data-field"),u=n.closest("[data-input-container]"),t,f;if(r&&u.length)return t=i.find(u.attr("data-input-container")),t&&(f=t.findField(r)),f},inputsOf:function(n){return n.find('[data-input]:not([data-input="none"])').filter(ar)},peersOf:function(n){var t=n.closest("[data-input-container]"),i,r;return t.length||(t=s),n.data("active",!0),r=t.find('[data-input]:not([data-input="none"])').filter(ar).each(function(n){var t=$(this);if(t.data("active"))return i=n,t.removeData("active"),!1}),{list:r,index:i}},eventToDirection:function(n){function u(){return $(t).closest('[data-layout="form"]').length>0}var t=n.target,r,i=n.keyCode||n.which;if(i==9&&(r=n.shiftKey?"left":"right"),i!=37||this.selectionStart!=0||t.selectionEnd!=0||u()||(r="left"),i==39&&t.value&&t.selectionStart==t.value.length&&!u()&&(r="right"),(i!=38||n.ctrlKey)&&(i!=13||!n.shiftKey)||t.tagName=="TEXTAREA"&&t.selectionStart||t.tagName=="DIV"||(r="up"),i==40&&!n.ctrlKey||i==13&&!n.shiftKey){var f=t.tagName=="TEXTAREA",e=t.tagName=="INPUT",h=sw(t),o=t.selectionStart,s=t.value;h||(e||f)&&!e&&(!f||(i!=40||o!=s.length)&&(i!=13||o!=0||t.selectionEnd!=s.length))||(r="down")}return r},blur:function(n){this.move(n)},move:function(n,i,r,u){function tt(i){if(t.valid()){var r=$(i),e=r.attr("data-input"),u=t.methods[e],f=r.find("[data-input-hotspot]");u&&u.focus&&u.focus(f.length?f:r,n)}}var l;n.is("[data-input]")||(n=d(n));var p=nt(n),w=n.closest('[data-layout="form"]').length>0,e=typeof i=="string"?null:i,f;if(ni(),!e&&i){w&&(i=="down"&&(i="right"),i=="up"&&(i="left"));var s=t.peersOf(n),h=n.closest("[data-container]"),a=parseInt(h.attr("data-columns")),c,o;a>1&&(f=t.inputsOf(h),c=f.toArray().indexOf(n[0]));i=="left"?(a>1&&(o=h.prev(),o.is('[data-container="row"][data-columns]')?(f=t.inputsOf(o),f.length&&(e=f[c])):(o=h.nextAll('[data-container="row"][data-columns]').last(),o.length&&(f=t.inputsOf(o),f.length&&(e=f[c-1])))),e||(s.index?e=s.list[s.index-1]:r==9&&(f=t.find(n,"up"),f&&f.length&&(e=f[f.length-1])))):i=="right"?(a>1&&(o=h.next(),o.is('[data-container="row"][data-columns]')?(f=t.inputsOf(o),f.length&&(e=f[c],!e&&c&&(o=h.nextAll('[data-container="row"][data-columns]').last(),o.length&&(f=t.inputsOf(o),l=$(f[c-1]),l.length&&(s=t.peersOf(l),s.index==s.list.length-1?e=n:n=l))))):(o=h.prevAll('[data-container="row"][data-columns]').last(),o.length&&(f=t.inputsOf(o),f.length&&(e=f[c+1])))),e||(s.index<s.list.length-1?e=s.list.get(s.index+1):r==9&&(f=t.find(n,"down"),f&&f.length&&(e=f[0])))):(i=="up"||i=="down")&&(f=t.find(n,i),f&&(e=f[f.length>s.index?s.index:f.length-1]));w&&!e&&(e=n)}var b='[data-container="'+u+'"]',k=typeof u=="string",g=k&&p.closest(b).first().is($(e).closest(b).first()),v,y;(!k||g)&&(e&&!g&&i=="right"&&(y=$(e).closest("[data-container]").first(),v=y.find("[data-control][data-focus]").filter(ar),v.length&&!n.closest("[data-container]").first().is(y)&&(e=v.first())),p.blur(),e&&tt(e))},find:function(n,t){var i,r,u;return n.is("[data-input-container]")||(n=n.closest("[data-input-container]")),i=n.data("active",!0).parent().find("[data-input-container]"),$(i).each(function(n){var t=$(this);if(t.data("active"))return r=n,t.removeData("active"),!1}),u=t=="up"?r==0?null:$(i.get(r-1)):r<i.length-1?$(i.get(r+1)):null,u?u.find('[data-input]:not([data-input="none"])'):null},popup:function(){var t=this,n=t._popup,i;if(arguments.length==1)if(arguments[0]=="hide")$(n).hide();else return $(n).is(arguments[0]);else return n||(n=t._popup=$('<div class="app-data-input-popup"><\/div>').hide().appendTo(s),i=$("<ul/>").appendTo(n),n.data("ul",i)),n},render:function(n){var r=n.container,u=n.inner,o=n&&n.dataView||i.find(r.closest("[data-input-container]").attr("data-input-container")),f=n.field,s=n.row,e=n.editing,h,l,a,v,y,p,c;if(o&&!f){if(r.is("[data-layout]")&&!r.data("prepared"))return;e=e!=null?e:o.extension().editing();r.attr("data-state",e?"write":"read");s||(s=o.extension().commandRow());e?r.find('[data-control="field"]').each(function(){var i=$(this),u=i.data("node"),r,n;u.ready&&(r=i.attr("data-field"),n=o.findField(r),n&&n.Type!="DataView"&&t.render({container:i,dataView:o,field:n,editing:e,row:s}))}):r.find('[data-control="field"]').removeAttr("data-input")}else{if(c=r.data("node"),!c||!c.ready)return;if(!r.is(":visible")){c.dirty=!0;return}f&&(p=e&&r.attr("data-read-only")!="true"&&!f.isReadOnly()&&!f._inputReadOnly,l=(f.ItemsStyle||(f.OnDemand?"blob":"text")).toLowerCase(),a=r.attr("data-input"),v=p?l:"none",r.attr("data-input",v),a&&a!=v&&(u||(u=r.find(".app-control-inner")),u.prevAll().remove(),u.nextAll().remove(),u.empty()),h=r.attr("data-placeholder"),h&&(f.Watermark=h=="$label"?f.HeaderText:h));y=t.methods[l];y&&(u||(u=r.find(".app-control-inner")),u.length?u.addClass("app-field-data"):u=r,y.render({container:r,inner:u,dataView:o,field:f,row:s,editing:p}))}},createContainer:function(n){var i=n.children(),t=$('<div class="app-data-input-container"><\/div>').appendTo(n);return i.each(function(){var n=this;n.className.match(/\b(app-control-(helper|toolbar|frame))\b/)||(n.style.visibility="hidden")}),this.fitContainer(n,t),t},fitContainer:function(n,i,r){var e=n.find(".app-data-input-button"),c=n.is(".app-has-helper"),l=n.attr("data-size")=="auto"||e.length,o,u,h,f,s,a,v,y,w;i||(i=n.find(".app-data-input-container"));c&&(f=n.find(".app-control-inner"),f.length&&i.css({left:f.offset().left-n.offset().left,top:f.offset().top-n.offset().top}));i&&(l&&!i.is(".app-data-input")&&(i=n.find(".app-data-input")),i&&i.is(".app-data-input")&&(o=i,i=o.closest(".app-data-input-container"),l&&(arguments.length<3&&(r=o.val()),u=n.find(".app-control-inner"),h=u.text(),h!=r&&r.length&&h.length<=r.length+2&&(a=o.data("restoreText"),a||o.data("restoreText",h),u.addClass("app-control-inner-trailer"),u.text(r)),i.width(""))));v=n.is(".app-has-helper");e.length&&(u||(u=n.find(".app-control-inner")),y=(u.length?u:n)[0].getBoundingClientRect().height,e.css("visibility",""),i.css({height:y,width:v?u.outerWidth():Math.ceil(e.position().left)-p(i,"padding-left")*2+3}),c&&f.length&&i.length&&(w=i.offset().top,i.css({left:f.offset().left-n.offset().left,top:f.offset().top-n.offset().top}),s=i.offset(),w!=s.top&&t.popup(":visible")&&t.popup().css({left:s.left,top:e.is(".app-caret-u")?s.top-t.popup().outerHeight():s.top+i.outerHeight()})))},execute:function(r){var u=r.dataView,e=r.values,w=e.length,l=r.populateDynamicLookups,o=r.skipPopulateField,p=r.skipDrawingInput,a,b={},s,f,h,c;p&&(t.drawing(p,!1),o||(o=u.findField(p.attr("data-field"))));o&&(o.skipPopulate=!0);typeof u=="string"?u=i.find(u):u||(u=n.pageInfo().dataView);u._ignoreUnsavedChanges=!1;a=r.container||y('[data-input-container="'+u._id+'"]');c=u.editRow();l!=!1&&$(e).each(function(){var n=this,t=u.findField(n.name||n.Name);t&&u._enumerateContextFieldValues(t,e,b,c)});l!=!1&&$(e).each(function(){var n=this,i=n.name||n.Name,t=u.findField(i);t&&(t.CausesCalculate&&!s&&(s=t),c[t.Index]=n.name?n.value:n.NewValue)});l!=!1&&(f={dataView:u,row:c,fields:[],container:a},t.evaluate(f),f.visibilityChanged&&(clearTimeout(v._visibilityChangeTimeout),v._visibilityChangeTimeout=setTimeout(function(){gi()},10)));f&&f.fields.length?(h=e.slice(),$(h).each(function(){var n=this,i=u.findField(n.name||n.Name),t=f.fields.indexOf(i);t!=-1&&f.fields.splice(t,1)}),$(f.fields).each(function(){h.push({name:this.Name})})):h=e;$(h).each(function(){var n=this,i=n.name||n.Name,r=u.findField(i),f=u.editing(),e=$(a).find('[data-control][data-field="'+i+'"]');e.each(function(){var n=$(this),e=n.attr("data-control"),i;e!="label"&&(i=f&&n.attr("data-read-only")!="true"&&!r.isReadOnly(),t.drawing(n)?t.render({container:n,inner:n.find(".app-control-inner"),dataView:u,field:r,row:c,editing:i}):t.drawing(n,!0))})});s&&r.raiseCalculate!=!1&&u._raiseCalculate(s,s);l!=!1&&w!=e.length&&(u._busy()?u._pendingPopulate=!0:u._raisePopulateDynamicLookups());lr(a.closest(".app-wrapper"),!0);o&&(o.skipPopulate=!1);u.tagged("modal-auto-grow")&&ui()},evaluate:function(i){var r=i.dataView,f=i.row,e=i.scope,h=i.fields,u=i.container,l,a=[],s=[],v=[],d;if($(r._expressions).each(function(){var n=this,t=n.Scope,y,o,p,w="",b,c;n.Type==1&&(t==5&&(!e||e.readOnly)?(y=r.findField(n.Target),y&&(o=!!r._evaluateJavaScriptExpressions([n],f,!1),p=y._inputReadOnly!=o,y._inputReadOnlyChanged=p,y._inputReadOnly=o,p&&h&&h.indexOf(y)==-1&&h.push(y))):(t==3||t==2||t==7)&&u&&(!e||e.visibility)?(o=!!r._evaluateJavaScriptExpressions([n],f,!1),p=n._visChanged!=o,n._visChanged=o,p&&(i.visibilityChanged=!0,t==3?w="f:":t==2?(w="c:",l=!0):t==7&&(w="v:"),b=u.find('[data-visibility="'+w+n.Target+'"]').css("display",o?"":"none"),o?$(b).each(function(){var n=$(this).data("node");n&&a.push(n)}):t==3&&(c=r.findField(n.Target),c&&f[c.Index]!=null&&c.is("clear-on-hide")&&(s.push({name:c.Name}),c.Index!=c.AliasIndex&&s.push({name:r._allFields[c.AliasIndex].Name}))))):t==1&&(!e||e.readOnly)&&v.push(n))}),v.length&&u&&oe(r,f,u,v),!i.ignoreFormButtons&&(r.isDynamicAction("Custom")||r.isDynamicAction("Form"))&&u.find("[data-action]").each(function(){var t=$(this),i=t.attr("data-action"),n;r.isDynamicAction(i)&&(n=r.findAction(i),n&&(r._clonedRow=f,t.toggleClass("app-disabled",!r._isActionAvailable(n)),r._clonedRow=null))}),l&&r._isWizard&&ou("status"),a.length&&ko({controls:$(a)}),l&&vr(),!i.ignoreDynamicButtons&&r.isDynamicAction("Form")){var y=u.closest(".ui-page").find(".app-bar-buttons"),k,o,p=[],w=[],g=[],b=[];y.length&&y.first().find(".ui-btn").each(function(){p.push($(this).attr("data-action-path"))});r._clonedRow=f;r.extension().context(b);$(b).each(function(){var n=this;n.uiScope=="Form"&&w.push(n.path);n.icon&&g.push(n.icon)});p.length?p.join()!=w.join()&&(k=!0,o=!c(r).isModal):(n._toolbarButtons.each(function(){var t=this,n;if(t.style.display!="none"&&(d=!0,n=$(t).data("action-path"),n&&w.indexOf(n)==-1))return o=!0,!1}),d||(o=!0));(k||o)&&n.refreshAppButtons(b,{buttonBars:y,layout:u,toolbar:o,dataView:r});r._clonedRow=null}s.length&&t.execute({dataView:r,values:s})},valid:function(n){if(arguments.length)this._valid=n!=!1;else return this._valid!=!1},cancel:function(n){return t._canceled=n==!1,sn(),t._canceled=!1,t.valid()},triggerSetValue:function(n,t,i){this.valid(!0);var r=$.Event("setvalue.input.app",{inputValue:t,inputOriginalValue:i,inputElement:n[0],inputValid:!0,inputError:null});return n.trigger(r),r.inputElement=null,this.valid(r.inputValid),r},drawing:function(n,t){if(arguments.length==1)return n.data("redraw")!=!1;t?n.removeData("redraw"):n.data("redraw",!1)},addCount:function(n,t){t!=null&&$('<span class="app-muted"/>').appendTo(n).text(t>999?String.format("{0:N0}",t):t)},editor:function(r){function y(i){var s=i.rules.dataView(),l=s.survey(),c=s.data(),h=i.type;n.pageInfo(s)._canceled=!0;h=="submit"&&(uf(!1),e("ui.transitions.style","none"));ri(function(){h=="submit"&&(t.execute({dataView:f,values:[{name:a,value:c.Field}]}),uf(!0));o||t.focus({fieldName:u.Name});i.type=="submit"?r.submit&&r.submit(i):r.cancel&&r.cancel(i)})}var f=r.dataView,a=r.fieldName,u,v,s,h,c,r,l;typeof f=="string"?f=i.find(f):f||(f=n.pageInfo().dataView);u=f.findField(a);h=u.ItemsStyle;s={name:"Field",required:!u.AllowNulls,columns:u.Columns,rows:u.Row,options:{}};r=s.options;h&&(c=[],l=u.is("lookup-distinct"),$(u.DynamicItems||u.Items).each(function(){var n=this,t={value:n[0],text:n[1]};l&&(t.count=n[2]);c.push(t)}),s.items={style:h,list:c},r.lookup={distinct:l});v=f.row();s.value=v[u.Index];i.survey({text:u.HeaderText,parent:f._id,controller:f._id+"-editor",context:{},questions:[s],layout:'<div data-layout="form" data-layout-size="tn"><div data-container="row"><span data-control="field" data-field="Field" data-size="fit"/><\/div><\/div>',options:{modal:{fitContent:!0,always:!0},materialIcon:"edit",discardChangesPrompt:!1,contentStub:!1},submitText:"OK",submit:y,cancel:y})},beforeFocus:function(){ht&&ht.removeData().hide()},focus:function(n){var f;if(!rt){n||(n={});var i=n.container||y('[data-layout][data-state="write"]'),e=n.lastFocused,o=i.closest(".ui-page"),r=e?o.data("last-focused-field"):n.fieldName||i.find('[data-focus="true"]').attr("data-field"),s=r?'[data-field="'+r+'"]':"",h=i.find("[data-control]"+s+':not([data-input="none"])'),u=n.message;if(o.removeData("last-focused-field"),e&&!r)return;h.each(function(){var e=$(this),l=e.offset(),a=t.methods[e.attr("data-input")],o,h=e.closest('[data-container="tab"]'),c=e.closest('[data-container="wizard"]'),y,v;if(a&&a.focus&&(s||!h.length||h.is(".app-tab-active"))&&(!c.length||ou("visible",{step:c,container:i}))){if(c.length&&ou("show",{step:c,container:i}),e.closest('[data-container="collapsible"].app-container-collapsed').each(function(){var n=$(this);n.removeClass("app-container-collapsed").find(".app-icon-carat").attr("title",fu.Minimize);rs($(n.children()[1]),!0)}),h.length&&!h.is(".app-tab-active")){rt=!0;h.closest('[data-container="tabset"]').first().find(".app-tabs").first().find(".ui-btn").filter(function(){return $(this).text()==h.attr("data-tab-text")}).trigger("vclick");setTimeout(function(){rt=!1;t.focus(n)},100);return}return vu(i).hide(),a.focus(e),f=!0,u&&(t.popup("hide"),y=t.elementToField(e),y.ItemsStyle=="Lookup"&&(v=t.elementToButton(e),v.addClass("app-caret-r"),v.removeClass("app-caret-u app-caret-d")),o=e.find(".app-data-input,.app-data-list,.app-drop-box"),o.is(".app-drop-box")&&(o=o.prev()),o.length&&(l=o.offset(),setTimeout(function(){np(l.left+1,l.top+e.outerHeight(),u,null,!0);ht.data({fieldName:r,message:u})}))),!1}})}return f},focusCopyMaster:function(n){var i,r=new RegExp("\\b"+n.Name+"\\s*=\\s*.+\\b");$(n._dataView._fields).each(function(){var n=this,t=n.Copy;if(t&&r.exec(t))return i=n.Name,!1});i&&t.focus({fieldName:i})},canCreateItems:function(n,t){t||(t=n._dataView.editRow());var r=!!n.ItemsNewDataView,f=n.ContextFields,u,e;if(r&&f)while(e=i._fieldMapRegex.exec(f))u=n._dataView.findField(e[2]),u&&t[u.Index]==null&&(r=!1);return r}};$(document).on("getvalue.input.app",function(n){var i=t.eventToField(n),e=t.eventToMethod(n),u,f,o,r,s;i&&(f=i._dataView,u=f._allFields[i.AliasIndex],i.Index==u.AliasIndex||i.ItemsStyle||(u=i),s=f.editRow(),r=s[i.Index],i.ItemsTargetController?r=null:i.ItemsStyle&&i.ItemsStyle!="Lookup"&&i.ItemsStyle!="AutoComplete"&&(o=f._findItemByValue(i,r),o&&(r!=null||!i.tagged("lookup-null-value-none")&&i.AllowNulls)&&(r=o[1])),n.inputValue=r!=null?i.format(r):"",n.inputValueRaw=r,n.inputDataType=i.Type,u.Len&&(n.inputMaxLength=u.Len),i.Index!=u.Index&&(r=s[u.Index],n.inputAltValue=r!=null?u.format(r):""),i.ItemsStyle||(n.inputRows=i.Rows,i.TextMode==2&&(n.rtf=!0)),n.inputIsPassword=i.TextMode==1,n.placeholder=t.fieldToPlaceholder(i),e&&e.setup&&e.setup(n))}).on("setvalue.input.app",function(n){var i=t.eventToField(n),u,s,h=$(n.target),c=h.closest("[data-field]"),r=n.inputValue,e,o,f;!i||(i.isReadOnly()||i.ItemsStyle||i.OnDemand)&&(!i.is("lookup-accept-any-value")||i.ItemsTargetController)||(u=i._dataView,s=i.Name,o=u.editRow(),o&&(String.isBlank(r)?r=null:(e={NewValue:r},f=u._validateFieldValueFormat(i,e,!0),f||(r=e.NewValue)),f?(n.inputError=f,n.inputValid=!1):(i.Index!=i.AliasIndex&&(i.AliasIndex=i.Index),t.execute({dataView:u,values:[{name:i.Name,value:r}]}))))}).on("vclick",'[data-control="action"]',function(n){var u=$(n.target),f=u.closest("[data-control]"),e=f.closest("[data-input-container]"),r=i.find(e.attr("data-input-container")),t;if(r)return ni(),t=r.findAction(f.attr("data-action")),t&&r._isActionAvailable(t)&&it(u.closest(".app-action-column-button"),function(){var n=r.extension();n.command(n.commandRow(),t.CommandName,t.CommandArgument,t.CausesValidation,t.Path)}),!1}).on("vclick",'[data-control="label"]',function(){var r=$(this),s=r.closest("[data-input-container]"),h=i.find(s.attr("data-input-container")),c=r.attr("data-field"),l,n,a,v,u,f,e;return h&&(o||!hk())&&(f=h.findField(c),f&&(r.data("active",!0),s.find("[data-control]").each(function(){var t=$(this),i=t.attr("data-control"),r=t.attr("data-field");if(i=="label")t.data("active")&&(a=!0);else if(r==c)if(a){if(n)return!1;n=t}else l=t}),r.removeData("active"),n||(n=l),n.filter(ar).length||(e=n.nextAll("[data-input]").filter(ar).first(),n=e.length?e:n.prevAll("[data-input]").filter(ar).first()),n&&n.length&&(v=n.attr("data-input"),u=t.methods[v],u&&(u.focus?u.focus(n,r):t.focusCopyMaster(f))))),!1}).on("vclick mousedown touchend","[data-input]",function(n){var r=$(n.target),i,u;if(!r.closest(".app-data-input-button").length){if(n.type=="mousedown"&&n.which!=3)return;if(nt(this).length&&!r.closest(".app-control-helper").length)return}if(!lt&&(i=t.eventToMethod(n),i)){if(i.click&&i.click(n),n.isDefaultPrevented())return!1;if(i.focus)i.focus(r)&&(n.cancelable&&n.preventDefault(),n.type=="mousedown"&&$(this).find(".app-data-input-placeholder").css("display","none"));else if(n.type=="vclick"&&(o||!hk())&&(u=t.eventToField(n),!t.focus({fieldName:u.Name})))return t.focusCopyMaster(u),!1}}).on("blur",".app-data-input",function(n){function a(n,t){clearTimeout(v._focusTextInputTimeout);v._focusTextInputTimeout=setTimeout(function(){i.focus();n&&(i.attr("title",n),np(i.offset().left+1,i.offset().top+i.outerHeight()+1,n,null,!0));t&&t(r)},10)}function f(n){var e,u,f;t.valid(!0);e=$.Event("remove.input.app",{input:i});o.is(".app-has-rtf")&&l.handlers(i,!1);$(i).trigger(e);i.attr("title")&&ni();r.find(".app-data-input-focus").remove();r.find(".app-control-helper .app-focus").length||r.removeClass("app-has-focus");y.contents().css("visibility","");u=r.find(".app-control-inner").removeClass("app-control-inner-trailer");f=u.data("last-smart-text");f&&(r.is(".app-null")||u.text(f),u.removeData("last-smart-text"));o.remove().empty();t._lastInputBeforeScroll=null;n&&n(r)}function s(n){var t,n=n.split(/,/);return n.length==1?t=p.closest(n[0]).is(i.closest(n[0])):$(n).each(function(){return t=s(this),t?!1:void 0}),t}var i=$(n.target),e=t.eventToMethod(n),r=d(i),h=i.data("original"),c=ch(i),o=i.parent(),y=o.parent(),p=$(n.relatedTarget),u;if(t._canceled){clearTimeout(v._focusTextInputTimeout);f();return}if(s(".app-data-input-popup,.app-data-input-helper,.app-data-input-button"))return!1;if(i.data("keepFocus"))return i.removeData("keepFocus"),!1;(e&&e.blur&&e.blur(n),n.isDefaultPrevented())||(s(".app-data-input-container,.app-data-input-placeholder")?(n.preventDefault(),a()):c==h?f():(u=t.triggerSetValue(i,c,h),u.inputValid?f(u.inputValidCallback):t.ignoreErrors?f():(n.preventDefault(),a(u.inputError,u.inputErrorCallback))))}).on("keydown",function(r){var u,f;if(ve(),u=r.keyCode||r.which,u==27){if(w||vt){$(document).trigger($.Event("dragcancel.app",{drag:vt||w}));r.preventDefault();return}if(!n.busy()&&!t.popup(":visible")){if(f=$(".app-calendar-plugin-container"),f.length&&f.is(":visible"))return n.CalendarInput("escape"),!1;if(yo(!1))return r.preventDefault(),!1;if(y().is(".app-page-modal"))return setTimeout(di),r.preventDefault(),!1}}if(u==70&&(r.ctrlKey||r.metaKey))return i.search("enumerate"),!1;if((o||!ao(r))&&u==121){r.preventDefault();var e=r.shiftKey,s=e?n._contextButton:n._menuButton,h=$(".ui-panel-open");return e||s.is(".ui-icon-bars")&&!y().is(".app-page-modal")&&!h.length?setTimeout(function(){lt=!1;s.trigger("vclick")}):h.panel("close"),!1}}).on("keydown",".app-data-input,.app-drop-box",function(n){var at,ut,ft,p,c,et,nt,r,ot,a,v,s,st;ve();var e=this,w=n.ctrlKey||n.metaKey,ht=n.altKey,i=n.keyCode||n.which,b,ct,u=$(n.target),h=d(u),tt,yt=u.closest('[data-layout="form"]').length>0,it,f,k,pt=sw(e),s,r,rt,o;if(ao(n,!1,!1))return!1;if(!w&&(i==38||i==8||i==37)){var g=d(e,".app-control-before"),lt=g.find("li"),y=g.find(".app-focus"),wt=y,vt;if(lt.length&&!y.length&&!e.value&&!t.popup(":visible"))return y=lt.last(),(i==38||i==37)&&(vt=y.offset(),$(e).offset().top>g.offset().top+g.outerHeight()&&lt.each(function(){var n=$(this),t=n.offset();if(t.top==vt.top)return y=n,!1})),y.addClass("app-focus"),setTimeout(function(){g.focus().addClass("app-has-focus");fw(y)}),!1}if(i==27){if(t.popup(":visible"))return t.methods.lookup._hidePopup(),!1;if(!u.is(".app-data-input"))return u.blur(),sr(),!1;if(k=u.data("change"),b=u.data("original"),ct=ch(u)!=b,!ct&&(at=h.closest(".app-page-modal"),at.length&&!t.popup(":visible"))){kl(h.attr("data-field"),at);return}return n.stopPropagation(),n.preventDefault(),k?(u.val(b),b||h.data("autoComplete",!1),t.move(h,t.popup(":visible")?h.data("autoComplete",!1):null)):(ut=$.Event("cancel.input.app",{inputElement:u}),h.trigger(ut),ut.inputElement=null,ut.isDefaultPrevented()||(u.is("iframe")?l.document("blur"):ct?(ni(),u.val(b).select()):(t.blur(h),sr()))),!1}if((i==13&&!w||i==9)&&t.popup(":visible"))if(r=t.popup().find(".app-selected"),s=t.elementToField(u),r.length){if(i==9&&s.ItemsTargetController&&(i=13),(!r.is("[data-command]")||i==13)&&(r.trigger("vclick",{feedback:!1}),i==13))return!1}else if(i==13&&s.AllowAutoComplete!=!1&&lw(s)&&(u.data("original")||!!u.val()))return t.methods.lookup._createItemFromText(s,d(u),u.val()),!1;if((i==13&&w||i==39&&e.selectionStart==e.selectionEnd&&(!e.value||e.value.length==e.selectionEnd))&&(ft=t.eventToButton(n),ft.length&&t.elementToField(ft).ItemsStyle=="Lookup"&&ft.is(":visible")&&(tt=t.eventToMethod(n),tt&&tt.clickButton)))return t.popup(":visible")?t.popup().find('[data-command="SeeAll"].app-selected').trigger("vclick"):(n.stopPropagation(),n.preventDefault(),tt.clickButton(n)),!1;if(w&&i==13)return t.blur(h),n.preventDefault(),!1;if(!ht&&(i==38||i==40))if(s=t.eventToField(n),p=s.DynamicItems||s.Items,c=-1,s.ItemsStyle!="DropDownList"||t.popup(":visible")||s.ItemsTargetController){if(h.data("notify")&&(nt=h.closest("[data-container]").next("[data-container]").find("li[data-text]"),r=nt.filter(function(){return $(this).is(".app-selected")}).removeClass("app-selected"),nt.length))return r=r.length?i==40?r.next("[data-text]"):r.prev("[data-text]"):$(nt[i==40?0:nt.length-1]),r.addClass("app-selected"),n.preventDefault(),!1}else return s.is("lookup-auto-advance")||s.is("lookup-open-on-tap")?t.eventToMethod(n).clickButton(n):($(p).each(function(n){if(this[1]==e.value)return c=n,!1}),c!=-1?(i==38&&c>(!s.AllowNulls&&p[0][0]==null?1:0)&&c--,i==40&&c<p.length-1&&c++):(c=0,e.value==""&&i==40&&p.length&&p[0][0]==null&&c++),et=p[c],et&&($(e).data("last",et[1]),setTimeout(function(){t.methods.lookup._useItemValue(s,et,!0)}))),n.preventDefault(),!1;if(it=t.eventToDirection(n),i==32&&!(w||n.shiftKey||ht)&&!pt&&e.value!=null&&!e.value.trim())return!1;if(i==40&&ht||i==32&&w){if(k=u.data("change"),k)return t.popup(":visible")||(n.stopPropagation(),n.preventDefault(),setTimeout(function(){k({input:u,value:u.val(),lastValue:u.data("last")})})),!1;if(ot=$.Event("help.input.app",{inputElement:u}),h.trigger(ot),ot.inputElement=null,ot.isDefaultPrevented()||i==32)return!1}if(u.data("autoComplete",!((i==8||i==46)&&e.selectionStart>0&&e.selectionStart<e.selectionEnd&&t.popup(":visible"))),u.data("keyCode",i),(i==33||i==34)&&t.popup(":visible")){if(f=t.popup(),r=f.find(".app-selected"),r.length){for(o=r.removeClass("app-selected"),f.scrollTop(f.scrollTop()+(i==33?-1:1)*f.height());o.length;){if(i==33){if(o.offset().top<f.offset().top)break}else if(o.offset().top+o.outerHeight()-1>f.offset().top+f.height())break;o.is(".app-instruction")||(r=o);o=i==33?o.prev():o.next()}r.addClass("app-selected")}else r=f.find("li:not(.app-instruction)").first().addClass("app-selected");return!1}if((i==38||i==40)&&!(n.ctrlKey||n.shiftKey||n.altKey)&&t.popup(":visible")){if(n.preventDefault,n.stopPropagation(),f=t.popup(),r=f.find(".app-selected").removeClass("app-selected"),rt=f.find("li:not(.app-instruction)"),r.length)for(o=r;o.length;){if(o=i==38?o.prev():o.next(),o.length&&!o.is(".app-instruction")){r=o;break}o.length||rt.filter(":not([data-command])").length||(r=[])}else r=i==38?rt.last():rt.first();if(r.length)return r.addClass("app-selected"),i==38&&r.prev().is(".app-instruction")&&(r=r.prev()),i==40&&r.next().is(".app-instruction")&&(r=r.next()),a=r.offset(),v=f.offset(),i==38?a.top<v.top?f.scrollTop(a.top-v.top+f.scrollTop()-1):a.top>=v.top+f.height()&&f.scrollTop(a.top-v.top+f.scrollTop()-(f.height()-r.outerHeight())-1):i==40&&(a.top+r.outerHeight()>=v.top+f.height()?f.scrollTop(a.top-v.top+f.scrollTop()-(f.height()-r.outerHeight())-1):a.top<v.top&&f.scrollTop(a.top-v.top+f.scrollTop()-1)),!1}if(it&&h.is('[data-input-tab-stop="false"]'))return(i==13||i==9)&&(t.blur(h),n.stopPropagation(),n.preventDefault()),!1;if(it){if(yt&&i==13){if(!t.popup(":visible")&&(s=t.elementToField(u),st=u.val(),lw(s)&&st&&st!=u.data("original")))return t.methods.lookup._createItemFromText(s,d(u),st),!1;n.stopPropagation()}return setTimeout(function(){t.move(h,it,i)}),n.preventDefault(),!1}if(i==113){selectionStart=e.selectionStart;selectionEnd=e.selectionEnd;selectionStart==0&&selectionEnd==e.value.length?e.selectionStart=selectionEnd:(e.selectionStart=0,e.selectionEnd=this.value.length);n.preventDefault();return}}).on("input",".app-data-input",function(n){var c=this,l=n.keyCode||n.which,i=$(c),u=i.data("placeholder"),f,s=i.data("change"),e,r=ch(i),o,h=r.trim();h.length||(r=h);u&&(f=r?"none":"",u=u[0],u.style.display!=f&&(u.style.display=f));e=i.data("last");o=r!=e;o&&t.fitContainer(d(i),i);s&&o&&(i.data("last",r),s({input:i,value:r,lastValue:e,keyCode:l,keyboard:!0}))}).on("cut paste",".app-data-input",function(){var n=$(this);setTimeout(function(){n.trigger("keyup")})}).on("contextmenu",".app-data-input",function(){$(this).data("keepFocus",!0)}).on("mousedown contextmenu",".app-data-input-placeholder",function(n){n.which==3&&$(this).css("display","none")}).on("vclick mousedown",".app-data-input-popup",function(i){function l(){if(e)if(o=t.elementToMethod(r),e=="SeeAll")i.target=r,setTimeout(function(){t.popup("hide");o&&o.clickButton&&o.clickButton(i,!1)},dt);else if(e=="Clear")setTimeout(function(){r.blur();t.methods.lookup._clearValue(u);t.fitContainer(h,null,t.fieldToPlaceholder(u));setTimeout(function(){t.methods.lookup.focus(h)},100)},dt);else if(e=="New"){var l=r.val();r.blur();n.lookup({field:u,create:!0,dataInput:h,value:l})}else e=="ShowOptions"?setTimeout(function(){u._doSearch=!0;t.methods.lookup._showList({field:u,value:null,input:r})},dt):e=="SelectAll"?(t.popup("hide"),c=t.popup().find("li[data-index]"),c.each(function(n){t.methods.lookup._useItemValue(u,s[parseInt($(this).attr("data-index"))],null,n==c.length-1)})):e=="None"&&t.popup("hide");else t.popup("hide"),s&&u&&(r.removeData("restoreText"),t.methods.lookup._buttonUp(r),t.methods.lookup._useItemValue(u,s[parseInt(f.attr("data-index"))]))}var f=$(i.target).closest("li"),e=f.attr("data-command"),s=t.popup().data("list"),r=nt(),h=d(r),u=t.elementToField(r),c,o;return!f.length||f.is(".app-instruction")||f.data("selected")||(f.parent().find(".app-selected").removeClass("app-selected"),f.addClass("app-selected").attr("data-selected","true"),r.focus(),arguments.length!=2||arguments[1].feedback?setTimeout(l,dt):l()),!1}).on("keydown",".app-checkbox-container",function(n){if(!ao(n)){var r=n.keyCode||n.which,i=$(this),u;return u=r==32||r==39&&!i.is(".app-checkbox-on")||r==37&&i.is(".app-checkbox-on")?"toggle":t.eventToDirection(n),u?(u=="toggle"?t.elementToMethod(i)._toggleState(i):t.move(i,u,r),!1):void 0}}).on("keydown",".app-data-list",function(n){if(!ao(n)){var f=n.keyCode||n.which,e=$(this),i,u,r;return(f==32?i="vclick":f==8||f==46?i="clear":n.ctrlKey||(f==38?i="up":f==40?i="down":f==37?i="left":f==39?i="right":f==36?i="home":f==35&&(i="end")),i)?(u=e.find(".app-focus"),u.length?i=="up"?(r=u.prev(),r.length||(r=u.parent().prev().find("li").last())):i=="down"?(r=u.next(),r.length||(r=u.parent().next().find("li").first())):i=="right"?(r=u.parent().next().find("li:eq("+u.index()+")"),r.length||(r=u.parent().next().find("li").last())):i=="left"?r=u.parent().prev().find("li:eq("+u.index()+")"):i=="home"?r=e.find("ul").first().find("li").first():i=="end"?r=e.find("ul").last().find("li").last():i=="vclick"?(r=null,u.trigger("vclick")):i!="clear"||e.closest("[data-control]").is('[data-input="checkboxlist"]')||(r=null,e.find("ul").first().find("li").first().trigger("vclick")):t.methods.listbox._scrollItemIntoView(e.find(".app-selected").first().addClass("app-focus")),r&&r.length&&(t.methods.listbox._focusItem(r),t.methods.listbox._scrollItemIntoView(r)),!1):(i=t.eventToDirection(n),i)?(t.move(e,i,f),!1):void 0}}).on("keydown",".app-control-helper",function(n){var c=$(this),r=n.keyCode||n.which,s=c.find("li"),i=c.find(".app-focus"),a=i,o;if(s.length&&i.length){if(o=i.offset(),r==32||r==40&&(n.altKey||n.metaKey))return i.trigger("vclick"),!1;if(r==46||r==8)return t.methods.lookup._removeBasketItem(i,r!=8),!1;if(r==9||r==13||r==27)return setTimeout(function(){var u=d(i);n.shiftKey&&r!=27?t.move(u,"up",r):(c.data("focus",!1),t.methods.lookup.focus(u))}),!1;if(r==36)i=s.first();else if(r==35)i=s.last();else if(r==38){var f=o.left,u=f+i.outerWidth()-1,e=0,h=o.top-1;$(s.get().reverse()).each(function(){var o=$(this),r=o.offset(),n=r.left,t=n+o.outerWidth()-1,s;if(e==0&&r.top<h||e>0&&r.top==h)t<f||n>u||(s=n>=f&&t<=u?t-n+1:n<f&&t<=u?t-f+1:n<u&&t>=u?u-n+1:u-f+1,s>e&&(i=o,e=s,h=r.top));else if(e)return!1})}else if(r==40){var f=o.left,u=f+i.outerWidth()-1,e=0,h=o.top+1;s.each(function(){var o=$(this),r=o.offset(),n=r.left,t=n+o.outerWidth()-1,s;if(e==0&&r.top>h||e>0&&r.top==h)t<f||n>u||(s=n>=f&&t<=u?t-n+1:n<f&&t<=u?t-f+1:n<u&&t>=u?u-n+1:u-f+1,s>e&&(i=o,e=s,h=r.top));else if(e)return!1})}else if(r==39||r==37)s.each(function(){var t=$(this),n=t.offset();if(r==39&&n.top==o.top&&n.left>o.left)return i=t,!1;r==37&&n.top==o.top&&n.left<o.left&&(i=t)});else return;if(i==a){function l(){setTimeout(function(){c.data("focus",!1);t.methods.lookup.focus(d(i))})}if(r==39&&(i.next().length?i=i.next():l()),r==37&&i.prev().length&&(i=i.prev()),r==38)return setTimeout(function(){t.move(d(i),"up",9)}),!1;if(r==40)return l(),!1}return s.removeClass("app-focus"),i.addClass("app-focus"),fw(i),!1}}).on("blur",".app-data-list,.app-control-helper,.app-checkbox-container,.app-drop-box",function(){var n=$(this);n.find(".app-focus").removeClass("app-focus");n.parent().removeClass("app-has-focus")}).on("keydown",".ui-panel-inner",function(n){var u=n.keyCode||n.which,e=$(this),f,s=e.offset(),t,i,r,o;if(u==37?t="left":u==39?t="right":u==40?t="down":u==38?t="up":u==36?t="home":u==35?t="end":(u==13||u==32)&&(t="select"),u==9&&e.closest(".app-sidebar").length)return sr(),b().find(".app-selected").addClass("ui-btn-active"),!1;if(t){if(e.find("ul").each(function(){var n=$(this),t=n.offset();if(t.left>=s.left&&t.left<s.left+10)return f=n,!1}),!f)return!1;if(r=f.find(".ui-btn").filter(function(){return!$(this).parent().is(".ui-disabled")}),i=f.find(".app-focus"),i.length&&(t=="right"&&(t=i.find(".material-icon-chevron-right").length?"select":"down"),t=="left"&&(t=i.find(".material-icon-chevron-left").length?"select":"up"),t=="select")){if(i.length)return(o=i.data("data-context")||i.data("context-action"),u==32&&(!o||!o.keepOpen))?!1:(lt=!1,i.trigger("vclick"),!1);t="down"}i.length?t=="down"?$(r).each(function(n){if(i.is(this))return i=$(r.get(n<r.length-1?n+1:0)),!1}):t=="up"?$(r).each(function(n){if(i.is(this))return i=$(r.get(n>0?n-1:r.length-1)),!1}):t=="home"?i=r.first():t=="end"&&(i=r.last()):(i=r.first(),(t=="up"||t=="end")&&(i=r.last()),i.addClass("app-focus"));f.find(".ui-btn-active, .app-focus").removeClass("ui-btn-active app-focus");i.addClass("app-focus ui-btn-active");kk(i,e);event.preventDefault()}}).on("keydown",".app-drop-box",function(n){var i=n.keyCode||n.which,r=$(this),t;return i==32?t="vclick":(i==8||i==46)&&(t="clear"),t?(t=="vclick"?r.trigger(t):t=="clear"&&r.parent().find(".app-clear").trigger("vclick"),!1):void 0}).on("keydown",".app-wrapper",function(t){var rt=t.keyCode||t.which,s,w,nt,f,e,b,l,o,tt,i,v,k,d,u;switch(rt){case 35:i="end";break;case 36:i="home";break;case 39:i="right";break;case 40:i="down";break;case 37:i="left";break;case 38:i="up";break;case 13:if($(t.target).is("textarea"))return;i="enter";break;case 9:n._menuButton.is(".ui-icon-bars")&&!y().is(".app-page-modal")&&(i="tab")}if(i&&$(".ui-panel-dismiss:visible,.app-popup").length)return t.preventDefault(),!1;if(i&&!t.ctrlKey&&!$(t.target).is(":input")){if(s=$(this),f=s.children(".app-listview"),i=="tab"&&h.left.visible)return bt(!0),bt(!1,0),f.find(".ui-btn-active").removeClass("ui-btn-active"),h.left.inner.focus().find(".ui-btn").first().addClass("app-focus ui-btn-active"),!1;if(f.length&&f.is(":visible")){if(i.match(/left|right|home|end/)&&f.is(".app-grid")){o=n.dataView();var g=o.session("grid-avail-width"),it=f.find(".dv-item").first(),p=it.length&&Math.ceil(g-g*(it.width()/g)),r=o.session("scroll-left")||0,a;p&&(i=="right"&&r<p?(r=Math.min(r+32,p),a=!0):i=="left"&&r>0?(r=Math.max(r-32,0),a=!0):i=="home"?(r=0,a=!0):i=="end"&&(r=p,a=!0));a&&(o.session("scroll-left",r),of(o,-r));t.preventDefault();return}e=f.find(".dv-item .app-selected");e.length||(e=f.find(".dv-item").first().find("a"),i="none");e.length&&(u=e.parent(),o=n.dataView(),tt=o.extension(),i=="right"?i="down":i=="left"&&(i="up"),i=="down"?u=u.next():i=="up"&&(u=u.prev()),e=u.find("a"),b=e.data("data-context"),b&&!u.is(".dv-load-at-top-parent,.dv-load-at-bottom-parent,.app-calculated")&&(f.find(".ui-btn.app-selected").removeClass("app-selected ui-btn-active"),ee(o,e),tt.tap(b,i=="enter"?null:"none"),c(o).echoChanged=!0,e.addClass("app-selected ui-btn-active"),i.match(/up|down/)&&(l=u.offset(),w=s.offset(),headerBar=s.data("sticky-header"),nt=headerBar.offset(),k=Math.max(w.top,nt.top+headerBar.outerHeight()),d=w.top+s.height()-1,l.top<k?v=l.top-k:l.top+u.outerHeight()>d&&(v=l.top+u.outerHeight()-d)),t.preventDefault(),v&&setTimeout(function(){s.scrollTop(s.scrollTop()+v)},10)))}}}).on("mousedown",".app-hscrollbar2",function(n){if(!o){var i=$(this),t;$(n.target).is(".app-hscrollbar-handle")||(t=i.prev(),t.attr("class").match(/-outer/)&&(t=t.children().first()),t.scrollLeft(t.scrollLeft()+(n.pageX<i.find(".app-hscrollbar-handle").offset().left?-1:1)*kr(t)))}}).on("mousedown",".app-vscrollbar",function(n){if(!o){var i=$(this),t;$(n.target).is(".app-vscrollbar-handle")||(t=i.prev(),t.attr("class").match(/-outer/)&&(t=t.children().first()),t.scrollTop(t.scrollTop()+(n.pageY<i.find(".app-vscrollbar-handle").offset().top?-1:1)*t.height()))}}).on("transitionend",".app-hidden",function(){var t=$(this).parent(),i,n;t.is(".app-data-list")&&(n=t.find('[data-index="new"]'),n.length&&(i=t.data("revealTimeout"),clearTimeout(i),t.data("revealTimeout",setTimeout(function(){n.parent().prevAll().remove();n.prevAll().remove();n.parent().removeClass("app-hidden")},50))))}).on("vclick",'[data-container="toggle"]',function(){var n=$(this),i,r,t;return n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");setTimeout(function(){i=n.parent().toggleClass("app-container-collapsed").is(".app-container-collapsed");r=i?fu.Maximize:fu.Minimize;t=n.find(".app-collapsible-toggle-button");t.data("title")?(t.data("title",r),o||setTimeout(function(){t.attr("title",r).trigger("mouseenter",10)},50)):t.attr("title",r);n.parent().find('[data-control="dataview"]').each(function(){var t=$(this).attr("id")||"_ph",r=n.closest(".app-wrapper").find("#"+t.substring(0,t.length-3)+"_echo");r.css("display",i?"none":"")});i||ko({controls:n.closest('[data-container="collapsible"]').data("node").children});gi()})},dt),su(),ni(),!1}).on("vclick",".app-field-object-ref",function(){var t=$(this),f=t.closest("[data-control]"),e=t.closest("[data-input-container]"),r,u;return r=i.find(e.attr("data-input-container")),r&&(u=r.findField(f.attr("data-field")),u&&it(t,function(){n.details({field:u})})),!1}).on("vclick",".app-echo-see-all",function(){var t=$(this).addClass("ui-btn-active");return setTimeout(function(){t.removeClass("ui-btn-active");hh=!0;n.changePage(t.closest(".app-echo").attr("data-for"))},dt),!1}).on("vclick",".app-echo-toolbar a",function(t){var i=$(t.target),r=i.closest(".app-echo").attr("data-for");return cu(i)&&!n.busy()&&it(i,function(){i.is(".ui-icon-dots")&&n.showContextMenu({scope:r,position:tc(i).is(".app-page-panel")?"right":null})}),!1}).on("vclick",".app-sidebar ul",function(t){if(ku||!cu(t.target))return!1;var i=$(t.target).closest("a"),r=i.data("context-action");if(i.length){if(r)return n.busy()||it(i,function(){rr(r,i)}),!1;gt(i,!1)}}).on("vclick",".app-bar-buttons",function(n){var t=vi(n.clientX);return $(this).find(".ui-btn").each(function(){var n=$(this),i=n.offset();if(n.is(":visible")&&t>=i.left-8&&t<=i.left+n.outerWidth()+8)return setTimeout(function(){n.trigger("vclick")}),!1}),!1}).on("touchstart mousedown",".app-page-modal-title",function(){var t=nt(),n;t.length&&(n=d(t).data("field"),n&&y().data("last-focused-field",n))}).on("vclick",".app-page-modal-title",function(u){var f,e=vi(u.clientX);return $(this).find(".app-btn").each(function(){var n=$(this),t=n.offset();if(n.is(":visible")&&e>=t.left-8&&e<=t.left+n.outerWidth()+8){f=n;return}}),f&&it(f,function(){if(f.is(".ui-icon-dots"))n.showContextMenu();else if(f.is(".app-btn-search"))i.search();else if(f.is(".app-btn-close"))di();else if(f.is(".app-btn-fullscreen")){var u=!f.is(".app-btn-fullscreen-exit"),e=y().data("last-focused-field");f.removeData("title").toggleClass("app-btn-fullscreen-exit",u).attr("title",r[(u?"Exit":"")+"Fullscreen"]).closest(".ui-page").toggleClass("app-page-modal-fullscreen",u);gi(!0);e&&t.focus({lastFocused:e})}}),!1}).on("vclick",".app-btn-menu",nft).on("vclick",".app-back-text",function(){return n._menuButton.trigger("vclick"),!1}).on("vclick",".app-bar-toolbar",rit).on("vclick",".StatusBar .Segment",function(){var n=$(this).text();return setTimeout(function(){ou("select",{text:n})}),!1}).on("vclick",".app-page-modal-glass-pane-partial",function(){return setTimeout(di),!1}).on("vclick",".app-page-modal-glass-pane,.app-page-modal-background",function(){var t=n.pageInfo(),i;t.dataView&&t.dataView.tagged("modal-tap-out")?di():(i=y().toggleClass("app-page-modal-centered"),setTimeout(function(){i.toggleClass("app-page-modal-centered")},100))}).on("touchmove pointermove",".app-page-modal-glass-pane,.app-page-modal-background,.app-progress-screen",function(n){return n.preventDefault(),!1}).on("vclick",".app-sidebar .app-bar-toolbar-bottom .ui-btn",function(n){var t=$(n.target).closest(".ui-btn");return t.is(".app-selected")||(t.is(".app-btn-page")&&t.closest(".app-bar-toolbar-bottom").find(".ui-btn").removeClass("app-selected"),it(t,function(){var n=t.data("context");n?(t.addClass("app-selected"),io(n)):t.is(".app-btn-apps")?dc():t.is(".app-btn-settings")&&vs("left")})),!1}).on("focusout",".app-sidebar .ui-panel-inner",function(){$(this).find(".app-focus").removeClass("app-focus ui-btn-active")}).on("vclick",".app-bar-search",function(){var e=$(this),r,f,u;return($(this).find(".app-icon").each(function(){var n=$(this),t=vi(),i=n.offset();if(i.left<=t&&t<i.left+n.outerWidth())return r=n,!1}),r)?(f=n.contextDataView(),u=f.survey().context.id,it(r,function(){r.is(".material-icon-cancel")?(nt().blur(),r.closest(".app-bar-search").addClass("app-null"),t.execute({values:{name:"QuickFind",value:null}}),t.focus(),i.search("autoComplete",{id:u,dataInput:e.find('[data-field="QuickFind"]')})):r.is(".material-icon-search")?i.action({path:"form/submit"}):r.is(".material-icon-more")&&i.search("toggle",u)}),!1):nt().length?void 0:(t.focus(),!1)}).on("mousedown pointerdown touchstart",".app-control-toolbar",function(){l.range("save");l.focus();nt().data("keepFocus",!0)}).on("vclick",".app-control-toolbar",function(n){var i=$(n.target),u,c=vi(n.clientX),h,e,s,a;if(i.is(".app-has-droparrow"))e=nt().data("keepFocus",!0).blur(),h=t.elementToField(e),i.addClass("app-selected"),e.data("keepFocus",!0),l.range("restore",{force:!0}),setTimeout(function(){function t(){hi({anchor:i,items:n,y:i.offset().top+i.outerHeight(),afterclose:function(){i.removeClass("app-selected");l.focus()}})}var r=i.data("group"),n=[];r.list.forEach(function(t){var i=t.command,u=t.argument,r=t.icon,f;l.allow(h,t)&&i&&(f=l.toText(i,u),n.push({text:f,icon:r?"material-icon-"+r:r,context:{c:i,a:u},callback:l.exec}))});o?setTimeout(t,200):t()},dt);else{if(i.is(".app-control-toolbar-more"))return e=nt().data("keepFocus",!0).blur(),s=[],u=i,d(e,".app-control-toolbar").find(".app-has-droparrow,i,.app-divider").each(function(){var n=$(this),t=n.data("group"),u=n.data("command"),i=n.data("icon");t?s.push({text:t.text,icon:!1,transition:!0,callback:function(){var n=[{text:r.Back,icon:ot,callback:function(){ft(s,"#app-rtf",a)}},{}];t.list.forEach(function(t){var i=t.command,r=t.argument,u=t.icon;i&&l.allow(h,t)&&n.push({text:l.toText(i,r),icon:u?"material-icon-"+u:!1,context:{c:i,a:r},callback:l.exec})});ft(n,"#app-rtf-1",{close:l.focus})}}):u?s.push({text:n.data("text"),shortcut:n.data("shortcut"),icon:i?"material-icon-"+i:!1,context:{c:n.data("command"),a:n.data("argument")},callback:l.exec,disabled:n.is(".app-disabled"),state:n.is(".app-selected")}):s.push({})}),i.addClass("app-active"),e.data("keepFocus",!0),l.range("restore",{force:!0}),setTimeout(function(){i.removeClass("app-active");var n=l.range(),t=n?f.width-325>e.offset().left+n.getBoundingClientRect().right?"right":"left":"right";ft(s,"#app-rtf",{position:t,close:l.focus})},dt),!1;i.is(".app-shim-more")||$(this).find("i").each(function(){var n=$(this),t=n.offset();if(c>=t.left-4&&c<=t.left+n.outerWidth()+4)return u=n,!1})}return u&&u.length&&!u.is(".app-disabled")&&(tr||nt().data("keepFocus",!0).blur(),u.addClass("app-active"),setTimeout(function(){u.removeClass("app-active");l.range("restore");l.focus();l.range("exec",{command:u.data("command"),argument:u.data("argument")})},dt)),!1}).on("mousedown pointerdown touchstart",".app-has-rtf",function(n){if($(n.target).is(".app-has-rtf,.app-data-input-placeholder"))return!1}).on("rtfeditorsubmit.dataview.app",function(n){l.document("blur");var i=n.dataView,r=i.data(),u=n.survey.context.field;i.tag("discard-changes-prompt-none");ri(function(){t.execute({values:[{name:u,value:r.text}]})})}).on("touchstart pointerdown mousedown",".app-glass-pane",function(n){fe(n);$(this).addClass("app-glass-pane-reject");n.preventDefault();n.stopPropagation()}).on("mouseenter",".app-menu-strip .ui-btn",function(){if(!o){var n=$(this);clearTimeout(pl);pl=setTimeout(function(){n.is(".app-has-children")?n.trigger("vclick"):n.closest(".app-menu-strip").length&&vo(!0,".app-popup-menu")},$(".ui-popup-active .app-popup-menu").length?100:350)}}).on("mouseleave",".app-menu-strip .ui-btn",function(){if(!o){clearTimeout(pl);var n=$(this);n.data("selected")||vo(!0,".app-popup-menu")}}).on("mousedown",".ui-popup-screen,.app-menu-strip,.app-logo,.app-bar-toolbar",function(n){var t=n.pageX,i=n.pageY,r;if(!o&&$(".ui-popup-active").length&&n.button==0)return r=!$(n.target).closest(".app-bar-toolbar").length,vo(!0),r&&setTimeout(function(){var n=$.Event("vclick");n.pageX=n.clientX=t;n.pageY=n.clientY=i;$(document.elementFromPoint(t,i)).trigger(n)},75),!1}).on("vclick",".app-bar-tabs li",function(){var t=$(this),n=t.data("item");return n?io(n.context):dc("right",!1,!0),!1});l={list:[],groups:[{list:[{command:"undo",key:"Ctrl+Z",metaKey:!0,icon:"undo",toolbar:!1},{command:"redo",key:"Ctrl+Y",icon:"redo",toolbar:!1},{command:"redo",key:"Meta+Shift+Z",toolbar:!1,hidden:!0}]},{text:ol.Format,list:[{command:"formatBlock",argument:"p",icon:"short-text"},{command:"formatBlock",argument:"blockquote",icon:"format-quote"},{command:"formatBlock",argument:"h1",icon:"title"},{command:"formatBlock",argument:"h2"},{command:"formatBlock",argument:"h3"},{command:"formatBlock",argument:"h4"},{command:"formatBlock",argument:"h5"},{command:"formatBlock",argument:"h6"}]},{list:[{command:"bold",key:"Ctrl+B",metaKey:!0,icon:"format-bold"},{command:"italic",key:"Ctrl+I",metaKey:!0,icon:"format-italic"},{command:"underline",key:"Ctrl+U",metaKey:!0,icon:"format-underlined"},{command:"strikethrough",key:"Alt+Shift+5",metaKey:!0,icon:"strikethrough-s"}]},{list:[{command:"insertUnorderedList",icon:"format-list-bulleted"},{command:"insertOrderedList",icon:"format-list-numbered"}]},{list:[{command:"justifyLeft",key:"Ctrl+L",metaKey:!0,icon:"format-align-left"},{command:"justifyCenter",key:"Ctrl+E",metaKey:!0,icon:"format-align-center"},{command:"justifyRight",key:"Ctrl+R",metaKey:!0,icon:"format-align-right"},{command:"justifyFull",key:"Ctrl+J",metaKey:!0,icon:"format-align-justify"}]},{list:[{command:"indent",icon:"format-indent-increase",key:"Ctrl+]",which:221},{command:"outdent",icon:"format-indent-decrease",key:"Ctrl+[",which:219}]},{list:[{command:"removeFormat",icon:"format-clear"},{command:"rtf",argument:"editor",icon:"fullscreen",key:"F11"}]}],status:{undo:!0,redo:!0,indent:!0,outdent:!0},init:function(){l.groups.forEach(function(n){n.list.forEach(function(n){l.list.push(n)})})},allow:function(n,i){if(!n&&(n=t.elementToField(nt()),!n))return!1;var f=n.Tag,r,e=i.command,u=i.argument;return e=="rtf"&&u=="editor"&&n._dataView._controller=="rtfeditor_sys"?!1:!f||!f.match(/\brtf\-command\-/)?!0:(r=e,u&&(r+="-"+u),n.is("rtf-command-"+r))},document:function(n){var t=nt(),i=t.is("iframe")?t[0].contentDocument:null,r,u;return i&&(n=="focus"?i.body.focus():n=="blur"&&(r=t.offset(),u=$("<input/>").css({borderWidth:0,position:"absolute",left:r.left,top:r.top}).appendTo(t.parent()).focus(),t.blur(),u.remove(),sr())),i},window:function(n){var i=nt(),t=i.is("iframe")?i[0].contentWindow:null;return t&&n=="selection"&&(t=t.getSelection()),t},toText:function(n,t){var i=ol[n.substring(0,1).toUpperCase()+n.substring(1)];return typeof i!="string"&&(i=i[t]),i},range:function(n,t){var u,r,c,tt,a,b,f,e,it,o,h,i,rt,ut;if(n||(n="get"),n=="save"){l._range=l.range();return}if(n=="clear"){l._range=null;return}if(u=l.window("selection"),n=="get")return u&&u.getRangeAt&&u.rangeCount?u.getRangeAt(0):null;if(r=l.document(),i=l._range,n=="restore"){if(t&&t.force){if(i&&i.startOffset==i.endOffset)var g=i.getBoundingClientRect(),ft=nt(),et=ft.offset(),c=$('<span class="app-rtf-cursor"/>').appendTo(s).css({left:et.left+g.left,top:et.top+g.top+p(ft,"padding-top"),height:g.height}).data("blink",setInterval(function(){c.css("display",c.css("display")!="none"?"none":"")},500))}else c=$(".app-rtf-cursor"),clearInterval(c.data("blink")),c.remove();if(i&&u){try{u.removeAllRanges()}catch(ot){r.body.createTextRange().select();r.selection.empty()}try{u.addRange(i)}catch(ot){l._range=null}}}else if(n=="insert"){if(tt=!0,a=t&&t.tag,a)return a=="br"?(b=r.createElement(a),i.deleteContents(),i.insertNode(b),i.setStartAfter(b),i.setEndAfter(b),i.collapse(!1),u.removeAllRanges(),u.addRange(i),tt=!1):r.execCommand("formatBlock",!1,a),nt().trigger("rtfchanged"),tt}else if(n=="exec"&&t){if(f=t.command,e=t.argument,f=="rtf"){l.allow(null,t)&&(l.range("restore"),l[e]());return}if(t.validate&&f&&!f.match(/^(undo|redo)$/)&&!l.allow(null,t))return;l.range("restore");f=="formatBlock"&&e?r.execCommand(f,0,e)||r.execCommand(f,0,"<"+e+">"):r.execCommand(f,0,e);r.body.focus();l.range("status");nt().trigger("rtfchanged")}else if(n=="focus")l.range("restore"),nt().focus(),l.document("focus");else if(n=="status")d(nt(),".app-control-toolbar i").each(function(){var t=$(this),n=t.data("command");if(n&&n!="rtf")try{t.toggleClass("app-selected",r.queryCommandState(n));l.status[n]?t.toggleClass("app-disabled",!r.queryCommandEnabled(n)):t.toggleClass("app-selected",r.queryCommandState(n))}catch(i){}});else if(n=="select"){var v=t.x,k=t.y,y=t.x2,w=t.y2;if(v==null)return null;try{return y==null&&(y=v),w==null&&(w=k),it=l.window(),i=null,typeof r.caretPositionFromPoint!="undefined"?(o=r.caretPositionFromPoint(v,k),h=r.caretPositionFromPoint(y,w),i=r.createRange(),i.setStart(o.offsetNode,o.offset),i.setEnd(h.offsetNode,h.offset)):typeof r.caretRangeFromPoint!="undefined"&&(o=r.caretRangeFromPoint(v,k),h=r.caretRangeFromPoint(y,w),i=r.createRange(),i.setStart(o.startContainer,o.startOffset),i.setEnd(h.startContainer,h.startOffset)),i!==null&&typeof it.getSelection!="undefined"?(rt=it.getSelection(),rt.removeAllRanges(),rt.addRange(i)):typeof r.body.createTextRange!="undefined"&&(i=r.body.createTextRange(),i.moveToPoint(v,k),ut=i.duplicate(),ut.moveToPoint(y,w),i.setEndPoint("EndToEnd",ut),i.select()),i}catch(ot){return null}}},exec:function(n){l.range("exec",{command:n.c,argument:n.a})},focus:function(){l.range("focus")},editor:function(r){var u,e,c,o,s,h=[],a,v;if(r?(u=n.dataView().findField(r.field),o=r.type):u=t.elementToField(d(nt())),s=u.Tag,s)for(a=/\brtf\-command\-(.+?)(\s|$)/g;v=a.exec(s);)h.push(v[0]);e=u.Name;l.document("blur");c=u._dataView.data();kl(o?null:e);i.survey({controller:"rtfeditor_sys",context:{field:e},text:u.HeaderText,text2:gs.Scopes.Form.Edit.HeaderText,questions:[{name:"text",rows:5,mode:"rtf",value:c[e],tags:h.length?h.join(" "):null}],layout:'<div data-container="simple" data-wrap="true" class="app-rtf-editor"><div data-container="row"><span data-control="field" data-field="text"/><\/div><\/div>',options:{modal:{fullscreen:o?o=="fullscreen":f.width<=pt("xl")},materialIcon:"edit"},submit:"rtfeditorsubmit.dataview.app",submitKey:"Ctrl+Enter",submitText:el.SaveButton})},scrolled:function(){l.toolbar("position")},blur:function(n){var t=nt(d(n.target));!t.is("iframe")||t.is(n.target)||ku||nr||t.blur()},autoSize:function(){if(l.document()){var i=nt(),u=d(i),r=u.find(".app-control-inner"),f,n=ch(i),e=r.html(),o;e!=n&&(o=r.height(),r.html(n.length?n:t.fieldToPlaceholder(t.elementToField(i))||"&nbsp;"),e=n,o!=r.height()&&(i.parent().scrollTop(0),lr(),l.range("save")),f=u.find(".app-data-input-placeholder"),f.css("display",n.length?"none":""))}},handlers:function(i,r){var u=i[0].contentDocument,f=$(u),e=d(i),o=e.find(".app-control-inner"),s=o.html();if(r){i.on("rtfchanged",l.autoSize);$(document).one("focusin touchend",l.blur);$(document).on("scroll.app scrollstop.app resized.app",l.scrolled);f.on("keydown","body",function(r){var u,e,f;if(ve(),u=r.originalEvent.key,u=="Enter"&&(e=l.range("insert",{tag:r.shiftKey?"br":"p"}),!e))return!1;if(u=="Tab")return t.move(nt(),r.shiftKey?"up":"down"),!1;if(u=="F10")return r.shiftKey?n.showContextMenu():d(i,".app-control-toolbar-more").trigger("vclick"),!1;if(u&&u.match(/^Esc/))return f=$.Event("keydown"),f.which=27,i.trigger(f),!1;ao(r,!0)&&l.autoSize()}).on("mouseup keyup mouseout","body",function(){l.range("save");l.range("status")}).on("touchend","body",function(){setTimeout(function(){l.range("save");l.range("status")},100)}).on("paste","body",function(n){var t;n.originalEvent&&n.originalEvent.clipboardData&&n.originalEvent.clipboardData.getData?(n.preventDefault(),t=n.originalEvent.clipboardData.getData("text/plain"),u.execCommand("insertText",!1,t)):n.clipboardData&&n.clipboardData.getData?(n.preventDefault(),t=n.clipboardData.getData("text/plain"),u.execCommand("insertText",!1,t)):v.clipboardData&&v.clipboardData.getData&&(v._rtfLock||(v._rtfLock=!0,n.preventDefault(),u.execCommand("ms-pasteTextOnly",!1)),v._rtfLock=!1);l.autoSize()}).on("keyup","body",l.autoSize)}else l.range("clear"),f.off(),i.off("rtfchanged"),$(document).off("scroll.app scrollstop.app resized.app",l.scrolled)},toolbar:function(n,i){function h(){if(r=i.find(".app-control-toolbar"),!r.length){e=i.find(".app-control-inner");f=t.elementToField(i);f.is("rtf-frame")&&(u=$('<\/div><div class="app-control-frame app-hidden"><\/div>').insertBefore(e));r=$('<div class="app-control-toolbar app-hidden"><\/div>');u||r.addClass("app-control-toolbar-noframe");l.groups.forEach(function(n){var t,u=n.list,i=n.text;i?$(u).filter(function(){return l.allow(f,this)}).length&&(t=$('<span class="app-has-droparrow"/>').text(i).attr("title",i).data("group",n).appendTo(r)):u.forEach(function(n){var e=n.command,h=n.argument,c=n.toolbar!=!1,o=n.icon,s,u,i;!n.hidden&&e&&l.allow(f,n)&&(s=l.toText(e,h),u=n.key,o?(i=et("material-icon-"+o,r).attr("title",s+(u?" ("+u+")":"")),c||i.addClass("app-hidden")):i=$('<i class="app-hidden"/>').appendTo(r),i.data({command:e,argument:h,icon:o,text:s,shortcut:u}),t=i)});t&&(button=$('<span class="app-divider"/>').appendTo(r),t.is(".app-hidden")&&button.addClass("app-hidden"))});f.is("rtf-more-none")||($('<span class="app-shim-more"/>').appendTo(r),et("material-icon-more-"+(tr?"vert":"horiz"),r).addClass("app-control-toolbar-more").attr("title",fi+" (F10)"));var n={bar:r,frame:u,location:f.is("rtf-toolbar-location")=="bottom"?"bottom":tr?"bottom":"top"};n.defaultLocation=n.location;i.data("toolbar",n);o();s(i);setTimeout(function(){u&&u.removeClass("app-hidden");r.removeClass("app-hidden")})}}function o(){var f=i.find(".app-control-inner"),t=i.data("toolbar"),r=t.bar,u=t.frame,n;r.insertBefore(f);n=r.outerHeight();t.location=="top"?(n=-n,u&&u.css({top:n,bottom:""})):(r.insertAfter(f),u&&u.css({top:"",bottom:-n}),n=0);r.css("margin-top",n);t.floatin=!1}function s(n){n||(n=d(nt()));var u=b(),f=u.offset(),t=n.data("toolbar"),i,r;t&&(i=t.bar,r=i.offset(),(r.top<f.top||r.top+i.outerHeight()>f.top+u.height())&&(t.location=t.location=="bottom"?"top":"bottom",o()))}function c(){r=i.data("toolbar");r&&(r.bar.find("i,.app-has-droparrow").removeData(),r.bar.remove(),u=r.frame,u&&u.remove(),i.removeData("toolbar"))}var e,f,r,u;i||(i=d(nt()));n=="create"?h(i):n=="position"?s(i):c(i)}};Sys.Application.add_init(function(){kt=__settings});Sys.Application.add_load(function(){n._appLoaded=!0;$.mobile.initializePage()});Web.DataView.MobileGrid.registerClass("Web.DataView.MobileGrid",Web.DataView.MobileBase);Web.DataView.MobileForm.registerClass("Web.DataView.MobileForm",Web.DataView.MobileBase)})();